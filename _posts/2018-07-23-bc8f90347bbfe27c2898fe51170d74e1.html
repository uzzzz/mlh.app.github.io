---
layout: default
title: 比特币源码分析--深入理解比特币交易
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-e2445db1a8.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%BA%A4%E6%98%93%E6%98%AF%E6%AF%94%E7%89%B9%E5%B8%81%E6%9C%80%E9%87%8D%E8%A6%81%E7%9A%84%E4%B8%80%E5%9D%97%EF%BC%8C%E6%AF%94%E7%89%B9%E5%B8%81%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%85%B6%E4%BB%96%E9%83%A8%E5%88%86%E9%83%BD%E6%98%AF%E4%B8%BA%E4%BA%A4%E6%98%93%E6%9C%8D%E5%8A%A1%E7%9A%84%E3%80%82%E5%89%8D%E9%9D%A2%E7%9A%84%E7%AB%A0%E8%8A%82%E4%B8%AD%E5%B7%B2%E7%BB%8F%E5%AD%A6%E4%B9%A0%E4%BA%86%E5%90%84%E7%A7%8D%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95%E4%BB%A5%E5%8F%8A%E6%AF%94%E7%89%B9%E5%B8%81PoW%E5%85%B1%E8%AF%86%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%8C%E6%9C%AC%E6%96%87%E6%9D%A5%E5%88%86%E6%9E%90%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%AD%E7%9A%84%E4%BA%A4%E6%98%93%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BA%90%E7%A0%81%E3%80%82%3C%2Fp%3E+%0A++%3Ch1%3E1+%E5%88%9D%E8%AF%86%E6%AF%94%E7%89%B9%E5%B8%81%E4%BA%A4%E6%98%93%3C%2Fh1%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E9%80%9A%E8%BF%87%E6%AF%94%E7%89%B9%E5%B8%81%E6%A0%B8%E5%BF%83%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E5%91%BD%E4%BB%A4getrawtransaction%E5%92%8Cdecoderawtransaction%E5%8F%AF%E4%BB%A5%E6%A3%80%E7%B4%A2%E5%88%B0%E6%AF%94%E7%89%B9%E5%B8%81%E5%8C%BA%E5%9D%97%E9%93%BE%E4%B8%8A%E4%BB%BB%E6%84%8F%E4%B8%80%E7%AC%94%E4%BA%A4%E6%98%93%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF%EF%BC%8C%E4%BB%A5%E4%B8%8B%E6%98%AF%E8%BF%90%E8%A1%8C%E8%BF%99%E4%B8%A4%E4%B8%AA%E5%91%BD%E4%BB%A4%E5%90%8E%E5%BE%97%E5%88%B0%E7%9A%84%E6%9F%90%E7%AC%94%E4%BA%A4%E6%98%93%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF%EF%BC%8C%E8%AF%A5%E7%A4%BA%E4%BE%8B%E6%91%98%E8%87%AA%E3%80%8A%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81%E3%80%8B%E4%B8%80%E4%B9%A6%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-bash%22%3E%7B%0A++%22version%22%3A+1%2C%0A++%22locktime%22%3A+0%2C%0A++%22vin%22%3A+%5B%0A++++%7B%0A++++++%22txid%22%3A%227957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18%22%2C%0A++++++%22vout%22%3A+0%2C%0A++++++%22scriptSig%22%3A+%223045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813%5BALL%5D+0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf%22%2C%0A++++++%22sequence%22%3A+4294967295%0A++++%7D%0A+%5D%2C%0A++%22vout%22%3A+%5B%0A++++%7B%0A++++++%22value%22%3A+0.01500000%2C%0A++++++%22scriptPubKey%22%3A+%22OP_DUP+OP_HASH160+ab68025513c3dbd2f7b92a94e0581f5d50f654e7+OP_EQUALVERIFY+OP_CHECKSIG%22%0A++++%7D%2C%0A++++%7B%0A++++++%22value%22%3A+0.08450000%2C%0A++++++%22scriptPubKey%22%3A+%22OP_DUP+OP_HASH160+7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8+OP_EQUALVERIFY+OP_CHECKSIG%22%2C%0A++++%7D%0A++%5D%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%88%91%E4%BB%AC%E4%BB%94%E7%BB%86%E5%88%86%E6%9E%90%E4%B8%80%E4%B8%8B%E4%B8%8A%E9%9D%A2%E8%BF%99%E4%B8%AA%E8%BE%93%E5%87%BA%EF%BC%8C%E6%9D%A5%E7%9C%8B%E7%9C%8B%E4%B8%80%E7%AC%94%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84%E4%BA%A4%E6%98%93%E5%88%B0%E5%BA%95%E5%8C%85%E5%90%AB%E4%BA%86%E5%93%AA%E4%BA%9B%E4%B8%9C%E8%A5%BF%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E9%A6%96%E5%85%88%E6%98%AFvin%E5%AD%97%E6%AE%B5%EF%BC%8C%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AAjson%E6%95%B0%E7%BB%84%EF%BC%8C%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%AF%8F%E4%B8%AA%E5%85%83%E7%B4%A0%E4%BB%A3%E8%A1%A8%E4%B8%80%E7%AC%94%E4%BA%A4%E6%98%93%E7%9A%84%E8%BE%93%E5%85%A5%EF%BC%8C%E5%9C%A8%E8%BF%99%E4%B8%AA%E4%BE%8B%E5%AD%90%E4%B8%AD%E7%9A%84%E4%BA%A4%E6%98%93%EF%BC%8C%E5%8F%AA%E6%9C%89%E4%B8%80%E7%AC%94%E8%BE%93%E5%85%A5%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%85%B6%E6%AC%A1%E6%98%AFvout%E5%AD%97%E6%AE%B5%EF%BC%8C%E8%BF%99%E4%B9%9F%E6%98%AF%E4%B8%80%E4%B8%AAjson%E6%95%B0%E7%BB%84%EF%BC%8C%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%AF%8F%E4%B8%AA%E5%85%83%E7%B4%A0%E4%BB%A3%E8%A1%A8%E4%B8%80%E7%AC%94%E6%9C%AA%E8%8A%B1%E8%B4%B9%E7%9A%84%E8%BE%93%E5%87%BA%EF%BC%88UTXO%EF%BC%89%EF%BC%8C%E5%9C%A8%E8%BF%99%E4%B8%AA%E4%BE%8B%E5%AD%90%E4%B8%AD%E7%9A%84%E4%BA%A4%E6%98%93%E4%BA%A7%E7%94%9F%E4%BA%86%E4%B8%A4%E7%AC%94%E6%96%B0%E7%9A%84UTXO%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+OK%EF%BC%8C%E6%88%91%E4%BB%AC%E5%B7%B2%E7%BB%8F%E7%9C%8B%E5%88%B0%E4%B8%80%E7%AC%94%E6%AF%94%E7%89%B9%E5%B8%81%E4%BA%A4%E6%98%93%E5%8C%85%E5%90%AB%E4%BA%86%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA%E4%B8%A4%E4%B8%AA%E9%83%A8%E5%88%86%EF%BC%8C%E5%85%B6%E4%B8%AD%E8%BE%93%E5%85%A5%E8%A1%A8%E7%A4%BA%E8%A6%81%E8%8A%B1%E8%B4%B9%E7%9A%84%E6%AF%94%E7%89%B9%E5%B8%81%E6%9D%A5%E8%87%AA%E5%93%AA%E9%87%8C%EF%BC%8C%E8%80%8C%E8%BE%93%E5%87%BA%E5%88%99%E8%A1%A8%E7%A4%BA%E8%BE%93%E5%85%A5%E6%89%80%E6%8C%87%E5%90%91%E7%9A%84%E6%AF%94%E7%89%B9%E5%B8%81%E5%8E%BB%E4%BA%86%E5%93%AA%E9%87%8C%EF%BC%8C%E6%8D%A2%E5%8F%A5%E8%AF%9D%E8%AF%B4%EF%BC%8C%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84%E4%BA%A4%E6%98%93%E5%AE%9E%E9%99%85%E4%B8%8A%E9%9A%90%E5%90%AB%E7%9D%80%E4%BB%B7%E5%80%BC%E7%9A%84%E8%BD%AC%E7%A7%BB%E3%80%82%E4%BB%A5%E7%A4%BA%E4%BE%8B%E4%B8%AD%E7%9A%84%E4%BA%A4%E6%98%93%E4%B8%BA%E4%BE%8B%EF%BC%8C%E8%AF%A5%E4%BA%A4%E6%98%93%E6%89%80%E8%8A%B1%E8%B4%B9%E7%9A%84%E6%AF%94%E7%89%B9%E5%B8%81%E6%9D%A5%E8%87%AA%E4%BA%8E%E5%8F%A6%E5%A4%96%E4%B8%80%E7%AC%94%E4%BA%A4%E6%98%937957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18%E7%9A%84%E7%B4%A2%E5%BC%95%E4%B8%BA0%E7%9A%84UTXO%EF%BC%8C%E8%AF%A5UTXO%E7%9A%84%E5%8E%BB%E5%90%91%E5%9C%A8vout%E4%B8%AD%E6%8C%87%E5%AE%9A%EF%BC%8C0.015%E4%B8%AA%E6%AF%94%E7%89%B9%E5%B8%81%E5%8E%BB%E4%BA%86%E5%85%AC%E9%92%A5%E4%B8%BAab68025513c3dbd2f7b92a94e0581f5d50f654e7%E5%AF%B9%E5%BA%94%E7%9A%84%E9%92%B1%E5%8C%85%EF%BC%8C%E8%80%8C0.0845%E4%B8%AA%E6%AF%94%E7%89%B9%E5%B8%81%E5%88%99%E6%B5%81%E5%90%91%E4%BA%86%E5%85%AC%E9%92%A5%E4%B8%BA7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8%E5%AF%B9%E5%BA%94%E7%9A%84%E9%92%B1%E5%8C%85%E3%80%82%3C%2Fp%3E+%0A++%3Ch2%3E1.1+%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%3C%2Fh2%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%BA%A4%E6%98%93%E7%9A%84%E8%BE%93%E5%87%BA%E9%80%9A%E5%B8%B8%E4%B9%9F%E7%A7%B0%E4%B8%BAUTXO%EF%BC%8C%E5%8D%B3%E6%9C%AA%E8%8A%B1%E8%B4%B9%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%EF%BC%8C%E4%BB%8E%E4%BE%8B%E5%AD%90%E4%B8%AD%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E4%B8%80%E7%AC%94%E4%BA%A4%E6%98%93%E5%8F%AF%E8%83%BD%E4%BA%A7%E7%94%9F%E5%A4%9A%E4%B8%AAUTXO%EF%BC%8C%E8%BF%99%E4%BA%9BUTXO%E5%9C%A8%E5%90%8E%E7%BB%AD%E4%BA%A4%E6%98%93%E4%B8%AD%E4%BC%9A%E8%A2%AB%E8%8A%B1%E8%B4%B9%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%E5%8C%85%E5%90%AB%E4%B8%8B%E9%9D%A2%E4%B8%80%E4%BA%9B%E5%86%85%E5%AE%B9%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+value%EF%BC%9A%E8%AF%A5UTXO%E7%9A%84%E6%AF%94%E7%89%B9%E5%B8%81%E6%95%B0%E9%87%8F%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+scriptPubKey%EF%BC%9A%E9%80%9A%E5%B8%B8%E7%A7%B0%E4%B8%BA%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%EF%BC%8C%E5%86%B3%E5%AE%9A%E4%BA%86%E8%B0%81%E5%8F%AF%E4%BB%A5%E8%8A%B1%E8%B4%B9%E8%BF%99%E7%AC%94UTXO%EF%BC%8C%E5%8F%AA%E6%9C%89%E6%8F%90%E4%BE%9B%E4%BA%86%E6%AD%A3%E7%A1%AE%E7%9A%84%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%E6%89%8D%E8%83%BD%E8%A7%A3%E9%94%81%E5%B9%B6%E8%8A%B1%E8%B4%B9%E8%AF%A5UTXO%EF%BC%9B%3C%2Fp%3E+%0A++%3Ch2%3E1.2+%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%3C%2Fh2%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%BA%A4%E6%98%93%E7%9A%84%E8%BE%93%E5%85%A5%E5%8F%AF%E4%BB%A5%E7%90%86%E8%A7%A3%E4%B8%BA%E4%B8%80%E4%B8%AA%E6%8C%87%E5%90%91%E4%B8%80%E7%AC%94UTXO%E7%9A%84%E6%8C%87%E9%92%88%EF%BC%8C%E8%A1%A8%E7%A4%BA%E8%AF%A5%E4%BA%A4%E6%98%93%E8%A6%81%E8%8A%B1%E8%B4%B9%E7%9A%84UTXO%E5%9C%A8%E5%93%AA%E9%87%8C%E3%80%82%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%E5%8C%85%E5%90%AB%E5%A6%82%E4%B8%8B%E5%86%85%E5%AE%B9%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+txid%EF%BC%9A%E8%AF%A5%E4%BA%A4%E6%98%93%E8%A6%81%E8%8A%B1%E8%B4%B9%E7%9A%84UTXO%E6%89%80%E5%9C%A8%E7%9A%84%E4%BA%A4%E6%98%93%E7%9A%84hash%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+vout%EF%BC%9A%E7%B4%A2%E5%BC%95%E3%80%82%E4%B8%80%E7%AC%94%E4%BA%A4%E6%98%93%E5%8F%AF%E8%83%BD%E4%BA%A7%E7%94%9F%E5%A4%9A%E4%B8%AAUTXO%E5%AD%98%E6%94%BE%E5%9C%A8%E6%95%B0%E7%BB%84%E4%B8%AD%EF%BC%8C%E8%AF%A5%E7%B4%A2%E5%BC%95%E5%8D%B3%E4%B8%BAUTXO%E5%9C%A8%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E4%B8%8B%E6%A0%87%E3%80%82%E9%80%9A%E8%BF%87%28txid%2C+vout%29%E5%B0%B1%E8%83%BD%E6%A3%80%E7%B4%A2%E5%88%B0%E4%BA%A4%E6%98%93%E4%B8%AD%E7%9A%84UTXO%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+scriptSig%EF%BC%9A%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%EF%BC%8C%E7%94%A8%E4%BA%8E%E8%A7%A3%E9%94%81%28txid%2C+vout%29%E6%89%80%E6%8C%87%E5%90%91%E7%9A%84UTXO%E3%80%82%E5%89%8D%E6%96%87%E6%8F%90%E5%88%B0%E4%BA%A4%E6%98%93%E7%94%9F%E6%88%90%E7%9A%84%E6%AF%8F%E4%B8%80%E7%AC%94UTXO%E9%83%BD%E4%BC%9A%E8%AE%BE%E5%AE%9A%E4%B8%80%E4%B8%AA%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E5%8D%B3scriptPubKey%EF%BC%8C%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%ACscriptSig%E7%94%A8%E6%9D%A5%E8%A7%A3%E9%94%81%E3%80%82%E5%A6%82%E6%9E%9C%E6%8A%8AUTXO%E6%AF%94%E4%BD%9C%E4%B8%80%E4%B8%AA%E5%8C%85%E5%90%AB%E4%BA%86%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84%E5%AE%9D%E7%AE%B1%EF%BC%8C%E9%82%A3%E4%B9%88scriptPubKey%E5%B0%B1%E6%98%AF%E7%BB%99%E8%AF%A5%E5%AE%9D%E7%AE%B1%E4%B8%8A%E4%BA%86%E4%B8%80%E6%8A%8A%E9%94%81%EF%BC%8C%E8%80%8CscriptSig%E5%88%99%E6%98%AF%E9%92%A5%E5%8C%99%EF%BC%8C%E5%8F%AA%E6%9C%89%E6%8F%90%E4%BE%9B%E7%9C%9F%E7%A1%AE%E7%9A%84%E9%92%A5%E5%8C%99%E6%89%8D%E8%83%BD%E8%A7%A3%E5%BC%80%E9%94%81%E5%B9%B6%E8%8A%B1%E8%B4%B9%E5%AE%9D%E7%AE%B1%E9%87%8C%E7%9A%84%E6%AF%94%E7%89%B9%E5%B8%81%E3%80%82%3C%2Fp%3E+%0A++%3Ch2%3E1.3+%E4%BA%A4%E6%98%93%E9%93%BE%3C%2Fh2%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84%E4%BA%A4%E6%98%93%E5%AE%9E%E9%99%85%E4%B8%8A%E6%98%AF%E4%BB%A5%E9%93%BE%E7%9A%84%E5%BD%A2%E5%BC%8F%E4%B8%B2%E8%81%94%E5%9C%A8%E4%B8%80%E8%B5%B7%E7%9A%84%EF%BC%8C%E4%B8%80%E7%AC%94%E4%BA%A4%E6%98%93%E4%B8%8E%E5%85%B6%E5%89%8D%E9%A9%B1%E7%9A%84%E4%BA%A4%E6%98%93%E9%80%9A%E8%BF%87%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E4%B8%B2%E8%81%94%E8%B5%B7%E6%9D%A5%E3%80%82%E5%81%87%E8%AE%BE%E5%BC%A0%E4%B8%89%E7%9A%84%E9%92%B1%E5%8C%85%E9%87%8C%E6%9C%89%E4%B8%80%E7%AC%942%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84UTXO%EF%BC%8C%E7%84%B6%E5%90%8E%E5%BC%A0%E4%B8%89%E7%BB%99%E8%87%AA%E5%B7%B1%E7%9A%84%E5%A5%BD%E5%8F%8B%E6%9D%8E%E5%9B%9B%E8%BD%AC%E4%BA%860.5%E4%B8%AA%E6%AF%94%E7%89%B9%E5%B8%81%EF%BC%8C%E4%BA%8E%E6%98%AF%E7%94%9F%E6%88%90%E4%B8%80%E7%AC%94%E7%B1%BB%E4%BC%BC%E4%B8%8B%E9%9D%A2%E8%BF%99%E6%A0%B7%E7%9A%84%E4%BA%A4%E6%98%93%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180718210841811%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0ZW10X3N3Mg%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%BA%A4%E6%98%93T1%E7%9A%84%E8%BE%93%E5%85%A5%E6%8C%87%E5%90%91%E4%BA%86%E4%BA%A4%E6%98%93T0%E7%9A%84UTXO%EF%BC%8C%E8%AF%A5UTXO%E8%A2%AB%E5%88%86%E6%88%90%E4%BA%86%E4%B8%A4%E9%83%A8%E5%88%86%EF%BC%8C%E5%BD%A2%E6%88%90%E4%B8%A4%E7%AC%94%E6%96%B0%E7%9A%84UTXO%EF%BC%9A0.5BTC%E5%BD%92%E6%9D%8E%E5%9B%9B%E6%89%80%E6%9C%89%EF%BC%8C%E5%89%A9%E4%B8%8B%E7%9A%841.5BTC%E4%BD%9C%E4%B8%BA%E6%89%BE%E9%9B%B6%E5%8F%88%E5%9B%9E%E5%88%B0%E4%BA%86%E5%BC%A0%E4%B8%89%E7%9A%84%E9%92%B1%E5%8C%85%E3%80%82%E5%81%87%E8%AE%BE%E4%B9%8B%E5%90%8E%E6%9D%8E%E5%9B%9B%E5%9C%A8%E5%92%96%E5%95%A1%E9%A6%86%E5%B0%86%E6%94%B6%E5%88%B0%E7%9A%840.5BTC%E6%B6%88%E8%B4%B9%E6%8E%89%E4%BA%860.1BTC%EF%BC%8C%E5%88%99%E4%BA%A4%E6%98%93%E9%93%BE%E6%9D%A1%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180718211707654%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0ZW10X3N3Mg%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%BA%94%E8%AF%A5%E6%B3%A8%E6%84%8F%E5%88%B0%E8%BF%99%E6%A0%B7%E4%B8%80%E4%B8%AA%E9%87%8D%E8%A6%81%E4%BA%8B%E5%AE%9E%EF%BC%9A%E6%AF%8F%E4%B8%80%E7%AC%94%E6%96%B0%E7%94%9F%E6%88%90%E7%9A%84%E4%BA%A4%E6%98%93%EF%BC%8C%E5%85%B6%E4%BA%A4%E6%98%93%E7%9A%84%E8%BE%93%E5%85%A5%E4%B8%80%E5%AE%9A%E6%8C%87%E5%90%91%E5%8F%A6%E5%A4%96%E4%B8%80%E7%AC%94%E4%BA%A4%E6%98%93%E7%9A%84%E8%BE%93%E5%87%BA%E3%80%82%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84%E4%BA%A4%E6%98%93%E9%80%9A%E8%BF%87%E8%BF%99%E7%A7%8D%E9%93%BE%E6%9D%A1%E7%9A%84%E5%BD%A2%E5%BC%8F%E4%B8%B2%E8%81%94%E5%9C%A8%E4%B8%80%E8%B5%B7%EF%BC%8C%E9%80%9A%E8%BF%87%E4%BA%A4%E6%98%93%E7%9A%84%E8%BE%93%E5%85%A5%E5%B0%B1%E8%83%BD%E6%89%BE%E5%88%B0%E5%85%B6%E4%BE%9D%E8%B5%96%E7%9A%84%E5%8F%A6%E5%A4%96%E4%B8%80%E7%AC%94%E4%BA%A4%E6%98%93%E3%80%82%3C%2Fp%3E+%0A++%3Ch1%3E2+%E4%BA%A4%E6%98%93%E7%9B%B8%E5%85%B3%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%3C%2Fh1%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E7%8E%B0%E5%9C%A8%E6%88%91%E4%BB%AC%E5%B7%B2%E7%BB%8F%E4%BB%8E%E7%9B%B4%E8%A7%82%E4%B8%8A%E7%9F%A5%E9%81%93%E4%BA%86%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84%E4%BA%A4%E6%98%93%E9%95%BF%E4%BB%80%E4%B9%88%E6%A0%B7%E5%AD%90%EF%BC%8C%E6%9C%AC%E8%8A%82%E6%88%91%E4%BB%AC%E7%9C%8B%E7%9C%8B%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%EF%BC%8C%E4%BA%A4%E6%98%93%E6%98%AF%E5%A6%82%E4%BD%95%E8%A1%A8%E7%A4%BA%E7%9A%84%E3%80%82%3C%2Fp%3E+%0A++%3Ch2%3E2.1+%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%3C%2Fh2%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%BA%A4%E6%98%93%E7%9A%84%E8%BE%93%E5%85%A5%E7%94%A8%E5%A6%82%E4%B8%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%9D%A5%E8%A1%A8%E7%A4%BA%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3E%2F**+An+input+of+a+transaction.++It+contains+the+location+of+the+previous%0A+*+transaction%27s+output+that+it+claims+and+a+signature+that+matches+the%0A+*+output%27s+public+key.%0A+*%2F%0Aclass+CTxIn%0A%7B%0Apublic%3A%0A++++%2F%2F%E8%AF%A5%E8%BE%93%E5%85%A5%E5%BC%95%E7%94%A8%E7%9A%84UTXO%0A++++COutPoint+prevout%3B%0A++++%2F%2F%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%EF%BC%8C%E7%94%A8%E4%BA%8E%E8%A7%A3%E9%94%81%E8%BE%93%E5%85%A5%E6%8C%87%E5%90%91%E7%9A%84UTXO%0A++++CScript+scriptSig%3B%0A++++%2F%2F%E7%9B%B8%E5%AF%B9%E6%97%B6%E9%97%B4%E9%94%81%0A++++uint32_t+nSequence%3B%0A++++%2F%2F%E8%A7%81%E8%AF%81%E8%84%9A%E6%9C%AC%0A++++CScriptWitness+scriptWitness%3B+%2F%2F%21+Only+serialized+through+CTransaction%0A%0A++++%2F*+Setting+nSequence+to+this+value+for+every+input+in+a+transaction%0A+++++*+disables+nLockTime.+*%2F%0A++++static+const+uint32_t+SEQUENCE_FINAL+%3D+0xffffffff%3B%0A%0A++++%2F*+Below+flags+apply+in+the+context+of+BIP+68*%2F%0A++++%2F*+If+this+flag+set%2C+CTxIn%3A%3AnSequence+is+NOT+interpreted+as+a%0A+++++*+relative+lock-time.+*%2F%0A++++static+const+uint32_t+SEQUENCE_LOCKTIME_DISABLE_FLAG+%3D+%281+%26lt%3B%26lt%3B+31%29%3B%0A%0A++++%2F*+If+CTxIn%3A%3AnSequence+encodes+a+relative+lock-time+and+this+flag%0A+++++*+is+set%2C+the+relative+lock-time+has+units+of+512+seconds%2C%0A+++++*+otherwise+it+specifies+blocks+with+a+granularity+of+1.+*%2F%0A++++static+const+uint32_t+SEQUENCE_LOCKTIME_TYPE_FLAG+%3D+%281+%26lt%3B%26lt%3B+22%29%3B%0A%0A++++%2F*+If+CTxIn%3A%3AnSequence+encodes+a+relative+lock-time%2C+this+mask+is%0A+++++*+applied+to+extract+that+lock-time+from+the+sequence+field.+*%2F%0A++++static+const+uint32_t+SEQUENCE_LOCKTIME_MASK+%3D+0x0000ffff%3B%0A%0A++++%2F*+In+order+to+use+the+same+number+of+bits+to+encode+roughly+the%0A+++++*+same+wall-clock+duration%2C+and+because+blocks+are+naturally%0A+++++*+limited+to+occur+every+600s+on+average%2C+the+minimum+granularity%0A+++++*+for+time-based+relative+lock-time+is+fixed+at+512+seconds.%0A+++++*+Converting+from+CTxIn%3A%3AnSequence+to+seconds+is+performed+by%0A+++++*+multiplying+by+512+%3D+2%5E9%2C+or+equivalently+shifting+up+by%0A+++++*+9+bits.+*%2F%0A++++static+const+int+SEQUENCE_LOCKTIME_GRANULARITY+%3D+9%3B%0A%0A++++CTxIn%28%29%0A++++%7B%0A++++++++nSequence+%3D+SEQUENCE_FINAL%3B%0A++++%7D%0A%0A++++explicit+CTxIn%28COutPoint+prevoutIn%2C+CScript+scriptSigIn%3DCScript%28%29%2C+uint32_t+nSequenceIn%3DSEQUENCE_FINAL%29%3B%0A++++CTxIn%28uint256+hashPrevTx%2C+uint32_t+nOut%2C+CScript+scriptSigIn%3DCScript%28%29%2C+uint32_t+nSequenceIn%3DSEQUENCE_FINAL%29%3B%0A%0A++++ADD_SERIALIZE_METHODS%3B%0A%0A++++template+%26lt%3Btypename+Stream%2C+typename+Operation%26gt%3B%0A++++inline+void+SerializationOp%28Stream%26amp%3B+s%2C+Operation+ser_action%29+%7B%0A++++++++READWRITE%28prevout%29%3B%0A++++++++READWRITE%28scriptSig%29%3B%0A++++++++READWRITE%28nSequence%29%3B%0A++++%7D%0A%0A++++friend+bool+operator%3D%3D%28const+CTxIn%26amp%3B+a%2C+const+CTxIn%26amp%3B+b%29%0A++++%7B%0A++++++++return+%28a.prevout+++%3D%3D+b.prevout+%26amp%3B%26amp%3B%0A++++++++++++++++a.scriptSig+%3D%3D+b.scriptSig+%26amp%3B%26amp%3B%0A++++++++++++++++a.nSequence+%3D%3D+b.nSequence%29%3B%0A++++%7D%0A%0A++++friend+bool+operator%21%3D%28const+CTxIn%26amp%3B+a%2C+const+CTxIn%26amp%3B+b%29%0A++++%7B%0A++++++++return+%21%28a+%3D%3D+b%29%3B%0A++++%7D%0A%0A++++std%3A%3Astring+ToString%28%29+const%3B%0A%7D%3B%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%BB%A3%E7%A0%81%E4%B8%AD%E7%9A%84COutPoint%E6%98%AF%E8%AF%A5%E8%BE%93%E5%85%A5%E6%89%80%E6%8C%87%E5%90%91%E7%9A%84UTXO%EF%BC%8C%E9%80%9A%E8%BF%87COutPoint%E5%AE%9A%E4%BD%8D%E5%88%B0%E8%BE%93%E5%85%A5%E6%8C%87%E5%90%91%E7%9A%84UTXO%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3E%2F**+An+outpoint+-+a+combination+of+a+transaction+hash+and+an+index+n+into+its+vout+*%2F%0Aclass+COutPoint%0A%7B%0Apublic%3A%0A++++%2F%2FUTXO%E6%89%80%E5%9C%A8%E7%9A%84%E4%BA%A4%E6%98%93hash%0A++++uint256+hash%3B%0A++++%2F%2FUTXO%E7%9A%84%E7%B4%A2%E5%BC%95%0A++++uint32_t+n%3B%0A%0A++++COutPoint%28%29%3A+n%28%28uint32_t%29+-1%29+%7B+%7D%0A++++COutPoint%28const+uint256%26amp%3B+hashIn%2C+uint32_t+nIn%29%3A+hash%28hashIn%29%2C+n%28nIn%29+%7B+%7D%0A%0A++++ADD_SERIALIZE_METHODS%3B%0A%0A++++template+%26lt%3Btypename+Stream%2C+typename+Operation%26gt%3B%0A++++inline+void+SerializationOp%28Stream%26amp%3B+s%2C+Operation+ser_action%29+%7B%0A++++++++READWRITE%28hash%29%3B%0A++++++++READWRITE%28n%29%3B%0A++++%7D%0A%0A++++void+SetNull%28%29+%7B+hash.SetNull%28%29%3B+n+%3D+%28uint32_t%29+-1%3B+%7D%0A++++bool+IsNull%28%29+const+%7B+return+%28hash.IsNull%28%29+%26amp%3B%26amp%3B+n+%3D%3D+%28uint32_t%29+-1%29%3B+%7D%0A%0A++++friend+bool+operator%26lt%3B%28const+COutPoint%26amp%3B+a%2C+const+COutPoint%26amp%3B+b%29%0A++++%7B%0A++++++++int+cmp+%3D+a.hash.Compare%28b.hash%29%3B%0A++++++++return+cmp+%26lt%3B+0+%7C%7C+%28cmp+%3D%3D+0+%26amp%3B%26amp%3B+a.n+%26lt%3B+b.n%29%3B%0A++++%7D%0A%0A++++friend+bool+operator%3D%3D%28const+COutPoint%26amp%3B+a%2C+const+COutPoint%26amp%3B+b%29%0A++++%7B%0A++++++++return+%28a.hash+%3D%3D+b.hash+%26amp%3B%26amp%3B+a.n+%3D%3D+b.n%29%3B%0A++++%7D%0A%0A++++friend+bool+operator%21%3D%28const+COutPoint%26amp%3B+a%2C+const+COutPoint%26amp%3B+b%29%0A++++%7B%0A++++++++return+%21%28a+%3D%3D+b%29%3B%0A++++%7D%0A%0A++++std%3A%3Astring+ToString%28%29+const%3B%0A%7D%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Ch2%3E2.2+%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%3C%2Fh2%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3E%2F**+An+output+of+a+transaction.++It+contains+the+public+key+that+the+next+input%0A+*+must+be+able+to+sign+with+to+claim+it.%0A+*%2F%0Aclass+CTxOut%0A%7B%0Apublic%3A%0A++++CAmount+nValue%3B%0A++++CScript+scriptPubKey%3B%0A%0A++++CTxOut%28%29%0A++++%7B%0A++++++++SetNull%28%29%3B%0A++++%7D%0A%0A++++CTxOut%28const+CAmount%26amp%3B+nValueIn%2C+CScript+scriptPubKeyIn%29%3B%0A%0A++++ADD_SERIALIZE_METHODS%3B%0A%0A++++template+%26lt%3Btypename+Stream%2C+typename+Operation%26gt%3B%0A++++inline+void+SerializationOp%28Stream%26amp%3B+s%2C+Operation+ser_action%29+%7B%0A++++++++READWRITE%28nValue%29%3B%0A++++++++READWRITE%28scriptPubKey%29%3B%0A++++%7D%0A%0A++++void+SetNull%28%29%0A++++%7B%0A++++++++nValue+%3D+-1%3B%0A++++++++scriptPubKey.clear%28%29%3B%0A++++%7D%0A%0A++++bool+IsNull%28%29+const%0A++++%7B%0A++++++++return+%28nValue+%3D%3D+-1%29%3B%0A++++%7D%0A%0A++++friend+bool+operator%3D%3D%28const+CTxOut%26amp%3B+a%2C+const+CTxOut%26amp%3B+b%29%0A++++%7B%0A++++++++return+%28a.nValue+++++++%3D%3D+b.nValue+%26amp%3B%26amp%3B%0A++++++++++++++++a.scriptPubKey+%3D%3D+b.scriptPubKey%29%3B%0A++++%7D%0A%0A++++friend+bool+operator%21%3D%28const+CTxOut%26amp%3B+a%2C+const+CTxOut%26amp%3B+b%29%0A++++%7B%0A++++++++return+%21%28a+%3D%3D+b%29%3B%0A++++%7D%0A%0A++++std%3A%3Astring+ToString%28%29+const%3B%0A%7D%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E5%AE%9A%E4%B9%89%E9%9D%9E%E5%B8%B8%E7%AE%80%E5%8D%95%EF%BC%8C%E5%8F%AA%E6%9C%89%E4%B8%A4%E4%B8%AA%E5%AD%97%E6%AE%B5%EF%BC%9ACAmount%E8%A1%A8%E7%A4%BA%E8%AF%A5UTXO%E7%9A%84%E6%AF%94%E7%89%B9%E5%B8%81%E6%95%B0%E9%87%8F%EF%BC%8CscriptPubKey%E8%A1%A8%E7%A4%BA%E8%AF%A5UTXO%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E3%80%82%3C%2Fp%3E+%0A++%3Ch2%3E2.3+UTXO%3C%2Fh2%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+UTXO%E7%9A%84%E6%A6%82%E5%BF%B5%E5%9C%A8%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%AD%E9%9D%9E%E5%B8%B8%E9%87%8D%E8%A6%81%EF%BC%8C%E4%B8%93%E9%97%A8%E7%94%A8%E4%B8%80%E4%B8%AA%E7%B1%BBCoin%E6%9D%A5%E5%B0%81%E8%A3%85%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3E%2F**%0A+*+A+UTXO+entry.%0A+*%0A+*+Serialized+format%3A%0A+*+-+VARINT%28%28coinbase+%3F+1+%3A+0%29+%7C+%28height+%26lt%3B%26lt%3B+1%29%29%0A+*+-+the+non-spent+CTxOut+%28via+CTxOutCompressor%29%0A+*%2F%0Aclass+Coin%0A%7B%0Apublic%3A%0A++++%2F%2F%21+unspent+transaction+output%0A++++%2F%2FUTXO%E5%AF%B9%E5%BA%94%E7%9A%84%E6%80%A5%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%0A++++CTxOut+out%3B%0A%0A++++%2F%2F%21+whether+containing+transaction+was+a+coinbase%0A++++%2F%2F%E8%AF%A5UTXO%E6%98%AF%E5%90%A6%E6%98%AFcoinbase%E4%BA%A4%E6%98%93%0A++++unsigned+int+fCoinBase+%3A+1%3B%0A%0A++++%2F%2F%21+at+which+height+this+containing+transaction+was+included+in+the+active+block+chain%0A++++%2F%2F%E5%8C%85%E5%90%AB%E8%AF%A5UTXO%E7%9A%84%E4%BA%A4%E6%98%93%E6%89%80%E5%9C%A8%E5%8C%BA%E5%9D%97%E5%9C%A8%E5%8C%BA%E5%9D%97%E9%93%BE%E4%B8%8A%E7%9A%84%E9%AB%98%E5%BA%A6%0A++++uint32_t+nHeight+%3A+31%3B%0A%0A++++%2F%2F%21+construct+a+Coin+from+a+CTxOut+and+height%2Fcoinbase+information.%0A++++Coin%28CTxOut%26amp%3B%26amp%3B+outIn%2C+int+nHeightIn%2C+bool+fCoinBaseIn%29+%3A+out%28std%3A%3Amove%28outIn%29%29%2C+fCoinBase%28fCoinBaseIn%29%2C+nHeight%28nHeightIn%29+%7B%7D%0A++++Coin%28const+CTxOut%26amp%3B+outIn%2C+int+nHeightIn%2C+bool+fCoinBaseIn%29+%3A+out%28outIn%29%2C+fCoinBase%28fCoinBaseIn%29%2CnHeight%28nHeightIn%29+%7B%7D%0A%0A++++void+Clear%28%29+%7B%0A++++++++out.SetNull%28%29%3B%0A++++++++fCoinBase+%3D+false%3B%0A++++++++nHeight+%3D+0%3B%0A++++%7D%0A%0A++++%2F%2F%21+empty+constructor%0A++++Coin%28%29+%3A+fCoinBase%28false%29%2C+nHeight%280%29+%7B+%7D%0A%0A++++bool+IsCoinBase%28%29+const+%7B%0A++++++++return+fCoinBase%3B%0A++++%7D%0A%0A++++template%26lt%3Btypename+Stream%26gt%3B%0A++++void+Serialize%28Stream+%26amp%3Bs%29+const+%7B%0A++++++++assert%28%21IsSpent%28%29%29%3B%0A++++++++uint32_t+code+%3D+nHeight+*+2+%2B+fCoinBase%3B%0A++++++++%3A%3ASerialize%28s%2C+VARINT%28code%29%29%3B%0A++++++++%3A%3ASerialize%28s%2C+CTxOutCompressor%28REF%28out%29%29%29%3B%0A++++%7D%0A%0A++++template%26lt%3Btypename+Stream%26gt%3B%0A++++void+Unserialize%28Stream+%26amp%3Bs%29+%7B%0A++++++++uint32_t+code+%3D+0%3B%0A++++++++%3A%3AUnserialize%28s%2C+VARINT%28code%29%29%3B%0A++++++++nHeight+%3D+code+%26gt%3B%26gt%3B+1%3B%0A++++++++fCoinBase+%3D+code+%26amp%3B+1%3B%0A++++++++%3A%3AUnserialize%28s%2C+CTxOutCompressor%28out%29%29%3B%0A++++%7D%0A%0A++++bool+IsSpent%28%29+const+%7B%0A++++++++return+out.IsNull%28%29%3B%0A++++%7D%0A%0A++++size_t+DynamicMemoryUsage%28%29+const+%7B%0A++++++++return+memusage%3A%3ADynamicUsage%28out.scriptPubKey%29%3B%0A++++%7D%0A%7D%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%AF%94%E7%89%B9%E5%B8%81%E9%92%B1%E5%8C%85%E5%AE%9E%E9%99%85%E4%B8%8A%E5%B0%B1%E6%98%AF%E4%B8%80%E4%B8%AA%E7%94%B1Coin%E6%9E%84%E6%88%90%E7%9A%84DB%E3%80%82bitcoind%E5%9C%A8%E5%90%AF%E5%8A%A8%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E4%BB%8EDB%E4%B8%AD%E5%8A%A0%E8%BD%BDCoin%E5%B9%B6%E5%AD%98%E6%94%BE%E8%87%B3%E5%86%85%E5%AD%98%E4%B8%AD%E3%80%82%3C%2Fp%3E+%0A++%3Ch2%3E2.4+%E4%BA%A4%E6%98%93%E8%84%9A%E6%9C%AC%3C%2Fh2%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%9A%84%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%ACscriptSig%E5%92%8C%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%ACscriptPubKey%E9%83%BD%E6%98%AFCScript%E7%B1%BB%E5%9E%8B%EF%BC%8CCScript%E7%94%A8%E6%9D%A5%E8%A1%A8%E7%A4%BA%E4%BA%A4%E6%98%93%E8%84%9A%E6%9C%AC%E3%80%82%E4%BA%A4%E6%98%93%E8%84%9A%E6%9C%AC%E6%98%AF%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%AD%E4%B8%80%E4%B8%AA%E9%9D%9E%E5%B8%B8%E9%87%8D%E8%A6%81%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%8C%E7%94%A8%E6%AF%94%E7%89%B9%E5%B8%81%E6%8F%90%E4%BE%9B%E7%9A%84%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E5%8F%AF%E4%BB%A5%E5%AE%8C%E6%88%90%E9%9D%9E%E5%B8%B8%E5%A4%8D%E6%9D%82%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E6%9C%AC%E6%96%87%E7%A8%8D%E5%90%8E%E8%BF%98%E4%BC%9A%E6%9C%89%E6%9B%B4%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E3%80%82%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3E%2F**+Serialized+script%2C+used+inside+transaction+inputs+and+outputs+*%2F%0Aclass+CScript+%3A+public+CScriptBase%0A%7B%0Aprotected%3A%0A++++CScript%26amp%3B+push_int64%28int64_t+n%29%0A++++%7B%0A++++++++if+%28n+%3D%3D+-1+%7C%7C+%28n+%26gt%3B%3D+1+%26amp%3B%26amp%3B+n+%26lt%3B%3D+16%29%29%0A++++++++%7B%0A++++++++++++push_back%28n+%2B+%28OP_1+-+1%29%29%3B%0A++++++++%7D%0A++++++++else+if+%28n+%3D%3D+0%29%0A++++++++%7B%0A++++++++++++push_back%28OP_0%29%3B%0A++++++++%7D%0A++++++++else%0A++++++++%7B%0A++++++++++++*this+%26lt%3B%26lt%3B+CScriptNum%3A%3Aserialize%28n%29%3B%0A++++++++%7D%0A++++++++return+*this%3B%0A++++%7D%0Apublic%3A%0A++++CScript%28%29+%7B+%7D%0A++++CScript%28const_iterator+pbegin%2C+const_iterator+pend%29+%3A+CScriptBase%28pbegin%2C+pend%29+%7B+%7D%0A++++CScript%28std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B%3A%3Aconst_iterator+pbegin%2C+std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B%3A%3Aconst_iterator+pend%29+%3A+CScriptBase%28pbegin%2C+pend%29+%7B+%7D%0A++++CScript%28const+unsigned+char*+pbegin%2C+const+unsigned+char*+pend%29+%3A+CScriptBase%28pbegin%2C+pend%29+%7B+%7D%0A%0A++++ADD_SERIALIZE_METHODS%3B%0A%0A++++template+%26lt%3Btypename+Stream%2C+typename+Operation%26gt%3B%0A++++inline+void+SerializationOp%28Stream%26amp%3B+s%2C+Operation+ser_action%29+%7B%0A++++++++READWRITEAS%28CScriptBase%2C+*this%29%3B%0A++++%7D%0A%0A++++CScript%26amp%3B+operator%2B%3D%28const+CScript%26amp%3B+b%29%0A++++%7B%0A++++++++reserve%28size%28%29+%2B+b.size%28%29%29%3B%0A++++++++insert%28end%28%29%2C+b.begin%28%29%2C+b.end%28%29%29%3B%0A++++++++return+*this%3B%0A++++%7D%0A%0A++++friend+CScript+operator%2B%28const+CScript%26amp%3B+a%2C+const+CScript%26amp%3B+b%29%0A++++%7B%0A++++++++CScript+ret+%3D+a%3B%0A++++++++ret+%2B%3D+b%3B%0A++++++++return+ret%3B%0A++++%7D%0A%0A++++CScript%28int64_t+b%29++++++++%7B+operator%26lt%3B%26lt%3B%28b%29%3B+%7D%0A%0A++++explicit+CScript%28opcodetype+b%29+++++%7B+operator%26lt%3B%26lt%3B%28b%29%3B+%7D%0A++++explicit+CScript%28const+CScriptNum%26amp%3B+b%29+%7B+operator%26lt%3B%26lt%3B%28b%29%3B+%7D%0A++++explicit+CScript%28const+std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B%26amp%3B+b%29+%7B+operator%26lt%3B%26lt%3B%28b%29%3B+%7D%0A%0A%0A++++CScript%26amp%3B+operator%26lt%3B%26lt%3B%28int64_t+b%29+%7B+return+push_int64%28b%29%3B+%7D%0A%0A++++CScript%26amp%3B+operator%26lt%3B%26lt%3B%28opcodetype+opcode%29%0A++++%7B%0A++++++++if+%28opcode+%26lt%3B+0+%7C%7C+opcode+%26gt%3B+0xff%29%0A++++++++++++throw+std%3A%3Aruntime_error%28%22CScript%3A%3Aoperator%26lt%3B%26lt%3B%28%29%3A+invalid+opcode%22%29%3B%0A++++++++insert%28end%28%29%2C+%28unsigned+char%29opcode%29%3B%0A++++++++return+*this%3B%0A++++%7D%0A%0A++++CScript%26amp%3B+operator%26lt%3B%26lt%3B%28const+CScriptNum%26amp%3B+b%29%0A++++%7B%0A++++++++*this+%26lt%3B%26lt%3B+b.getvch%28%29%3B%0A++++++++return+*this%3B%0A++++%7D%0A%0A++++CScript%26amp%3B+operator%26lt%3B%26lt%3B%28const+std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B%26amp%3B+b%29%0A++++%7B%0A++++++++if+%28b.size%28%29+%26lt%3B+OP_PUSHDATA1%29%0A++++++++%7B%0A++++++++++++insert%28end%28%29%2C+%28unsigned+char%29b.size%28%29%29%3B%0A++++++++%7D%0A++++++++else+if+%28b.size%28%29+%26lt%3B%3D+0xff%29%0A++++++++%7B%0A++++++++++++insert%28end%28%29%2C+OP_PUSHDATA1%29%3B%0A++++++++++++insert%28end%28%29%2C+%28unsigned+char%29b.size%28%29%29%3B%0A++++++++%7D%0A++++++++else+if+%28b.size%28%29+%26lt%3B%3D+0xffff%29%0A++++++++%7B%0A++++++++++++insert%28end%28%29%2C+OP_PUSHDATA2%29%3B%0A++++++++++++uint8_t+_data%5B2%5D%3B%0A++++++++++++WriteLE16%28_data%2C+b.size%28%29%29%3B%0A++++++++++++insert%28end%28%29%2C+_data%2C+_data+%2B+sizeof%28_data%29%29%3B%0A++++++++%7D%0A++++++++else%0A++++++++%7B%0A++++++++++++insert%28end%28%29%2C+OP_PUSHDATA4%29%3B%0A++++++++++++uint8_t+_data%5B4%5D%3B%0A++++++++++++WriteLE32%28_data%2C+b.size%28%29%29%3B%0A++++++++++++insert%28end%28%29%2C+_data%2C+_data+%2B+sizeof%28_data%29%29%3B%0A++++++++%7D%0A++++++++insert%28end%28%29%2C+b.begin%28%29%2C+b.end%28%29%29%3B%0A++++++++return+*this%3B%0A++++%7D%0A%0A++++CScript%26amp%3B+operator%26lt%3B%26lt%3B%28const+CScript%26amp%3B+b%29%0A++++%7B%0A++++++++%2F%2F+I%27m+not+sure+if+this+should+push+the+script+or+concatenate+scripts.%0A++++++++%2F%2F+If+there%27s+ever+a+use+for+pushing+a+script+onto+a+script%2C+delete+this+member+fn%0A++++++++assert%28%21%22Warning%3A+Pushing+a+CScript+onto+a+CScript+with+%26lt%3B%26lt%3B+is+probably+not+intended%2C+use+%2B+to+concatenate%21%22%29%3B%0A++++++++return+*this%3B%0A++++%7D%0A%0A%0A++++bool+GetOp%28const_iterator%26amp%3B+pc%2C+opcodetype%26amp%3B+opcodeRet%2C+std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B%26amp%3B+vchRet%29+const%0A++++%7B%0A++++++++return+GetScriptOp%28pc%2C+end%28%29%2C+opcodeRet%2C+%26amp%3BvchRet%29%3B%0A++++%7D%0A%0A++++bool+GetOp%28const_iterator%26amp%3B+pc%2C+opcodetype%26amp%3B+opcodeRet%29+const%0A++++%7B%0A++++++++return+GetScriptOp%28pc%2C+end%28%29%2C+opcodeRet%2C+nullptr%29%3B%0A++++%7D%0A%0A%0A++++%2F**+Encode%2Fdecode+small+integers%3A+*%2F%0A++++static+int+DecodeOP_N%28opcodetype+opcode%29%0A++++%7B%0A++++++++if+%28opcode+%3D%3D+OP_0%29%0A++++++++++++return+0%3B%0A++++++++assert%28opcode+%26gt%3B%3D+OP_1+%26amp%3B%26amp%3B+opcode+%26lt%3B%3D+OP_16%29%3B%0A++++++++return+%28int%29opcode+-+%28int%29%28OP_1+-+1%29%3B%0A++++%7D%0A++++static+opcodetype+EncodeOP_N%28int+n%29%0A++++%7B%0A++++++++assert%28n+%26gt%3B%3D+0+%26amp%3B%26amp%3B+n+%26lt%3B%3D+16%29%3B%0A++++++++if+%28n+%3D%3D+0%29%0A++++++++++++return+OP_0%3B%0A++++++++return+%28opcodetype%29%28OP_1%2Bn-1%29%3B%0A++++%7D%0A%0A++++%2F**%0A+++++*+Pre-version-0.6%2C+Bitcoin+always+counted+CHECKMULTISIGs%0A+++++*+as+20+sigops.+With+pay-to-script-hash%2C+that+changed%3A%0A+++++*+CHECKMULTISIGs+serialized+in+scriptSigs+are%0A+++++*+counted+more+accurately%2C+assuming+they+are+of+the+form%0A+++++*++...+OP_N+CHECKMULTISIG+...%0A+++++*%2F%0A++++unsigned+int+GetSigOpCount%28bool+fAccurate%29+const%3B%0A%0A++++%2F**%0A+++++*+Accurately+count+sigOps%2C+including+sigOps+in%0A+++++*+pay-to-script-hash+transactions%3A%0A+++++*%2F%0A++++unsigned+int+GetSigOpCount%28const+CScript%26amp%3B+scriptSig%29+const%3B%0A%0A++++bool+IsPayToScriptHash%28%29+const%3B%0A++++bool+IsPayToWitnessScriptHash%28%29+const%3B%0A++++bool+IsWitnessProgram%28int%26amp%3B+version%2C+std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B%26amp%3B+program%29+const%3B%0A%0A++++%2F**+Called+by+IsStandardTx+and+P2SH%2FBIP62+VerifyScript+%28which+makes+it+consensus-critical%29.+*%2F%0A++++bool+IsPushOnly%28const_iterator+pc%29+const%3B%0A++++bool+IsPushOnly%28%29+const%3B%0A%0A++++%2F**+Check+if+the+script+contains+valid+OP_CODES+*%2F%0A++++bool+HasValidOps%28%29+const%3B%0A%0A++++%2F**%0A+++++*+Returns+whether+the+script+is+guaranteed+to+fail+at+execution%2C%0A+++++*+regardless+of+the+initial+stack.+This+allows+outputs+to+be+pruned%0A+++++*+instantly+when+entering+the+UTXO+set.%0A+++++*%2F%0A++++bool+IsUnspendable%28%29+const%0A++++%7B%0A++++++++return+%28size%28%29+%26gt%3B+0+%26amp%3B%26amp%3B+*begin%28%29+%3D%3D+OP_RETURN%29+%7C%7C+%28size%28%29+%26gt%3B+MAX_SCRIPT_SIZE%29%3B%0A++++%7D%0A%0A++++void+clear%28%29%0A++++%7B%0A++++++++%2F%2F+The+default+prevector%3A%3Aclear%28%29+does+not+release+memory%0A++++++++CScriptBase%3A%3Aclear%28%29%3B%0A++++++++shrink_to_fit%28%29%3B%0A++++%7D%0A%7D%3B%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+CScript%E7%BB%A7%E6%89%BF%E8%87%AAScriptBase%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3E%2F**%0A+*+We+use+a+prevector+for+the+script+to+reduce+the+considerable+memory+overhead%0A+*++of+vectors+in+cases+where+they+normally+contain+a+small+number+of+small+elements.%0A+*+Tests+in+October+2015+showed+use+of+this+reduced+dbcache+memory+usage+by+23%25%0A+*++and+made+an+initial+sync+13%25+faster.%0A+*%2F%0Atypedef+prevector%26lt%3B28%2C+unsigned+char%26gt%3B+CScriptBase%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+CScriptBase%E5%AE%9E%E9%99%85%E4%B8%8A%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84vector%E3%80%82CScript%E9%87%8D%E5%86%99%E4%BA%86%26lt%3B%26lt%3B%E6%93%8D%E4%BD%9C%E7%AC%A6%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%BE%88%E6%96%B9%E4%BE%BF%E7%9A%84%E5%90%91%E5%90%91%E9%87%8F%E4%B8%AD%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE%E3%80%82%3C%2Fp%3E+%0A++%3Ch2%3E2.5+%E4%BA%A4%E6%98%93%3C%2Fh2%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84%E4%BA%A4%E6%98%93%E5%92%8C%E6%88%91%E4%BB%AC%E5%B7%B2%E7%BB%8F%E7%9C%8B%E5%88%B0%E7%9A%84%E9%82%A3%E6%A0%B7%EF%BC%8C%E7%94%B1%E4%B8%80%E7%BB%84%E8%BE%93%E5%85%A5%E5%92%8C%E4%B8%80%E7%BB%84%E8%BE%93%E5%87%BA%E7%BB%84%E6%88%90%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3E%2F**+The+basic+transaction+that+is+broadcasted+on+the+network+and+contained+in%0A+*+blocks.++A+transaction+can+contain+multiple+inputs+and+outputs.%0A+*%2F%0Aclass+CTransaction%0A%7B%0Apublic%3A%0A++++%2F%2F+Default+transaction+version.%0A++++static+const+int32_t+CURRENT_VERSION%3D2%3B%0A%0A++++%2F%2F+Changing+the+default+transaction+version+requires+a+two+step+process%3A+first%0A++++%2F%2F+adapting+relay+policy+by+bumping+MAX_STANDARD_VERSION%2C+and+then+later+date%0A++++%2F%2F+bumping+the+default+CURRENT_VERSION+at+which+point+both+CURRENT_VERSION+and%0A++++%2F%2F+MAX_STANDARD_VERSION+will+be+equal.%0A++++static+const+int32_t+MAX_STANDARD_VERSION%3D2%3B%0A%0A++++%2F%2F+The+local+variables+are+made+const+to+prevent+unintended+modification%0A++++%2F%2F+without+updating+the+cached+hash+value.+However%2C+CTransaction+is+not%0A++++%2F%2F+actually+immutable%3B+deserialization+and+assignment+are+implemented%2C%0A++++%2F%2F+and+bypass+the+constness.+This+is+safe%2C+as+they+update+the+entire%0A++++%2F%2F+structure%2C+including+the+hash.%0A++++%2F%2F%E4%BA%A4%E6%98%93%E7%9A%84%E5%85%A8%E9%83%A8%E8%BE%93%E5%85%A5%0A++++const+std%3A%3Avector%26lt%3BCTxIn%26gt%3B+vin%3B%0A++++%2F%2F%E4%BA%A4%E6%98%93%E7%9A%84%E5%85%A8%E9%83%A8%E8%BE%93%E5%87%BA%0A++++const+std%3A%3Avector%26lt%3BCTxOut%26gt%3B+vout%3B%0A++++%2F%2F%E4%BA%A4%E6%98%93%E7%89%88%E6%9C%AC%0A++++const+int32_t+nVersion%3B%0A++++%2F%2F%E4%BA%A4%E6%98%93%E9%94%81%E5%AE%9A%E6%97%B6%E9%97%B4%EF%BC%8C%E7%94%A8%E6%9D%A5%E6%8E%A7%E5%88%B6%E5%9C%A8%E4%B8%80%E5%AE%9A%E7%9A%84%E6%97%B6%E9%97%B4%E4%B9%8B%E5%90%8E%E4%BA%A4%E6%98%93%E7%9A%84%E8%BE%93%E5%87%BA%E6%89%8D%E8%83%BD%E8%A2%AB%E8%8A%B1%E8%B4%B9%0A++++const+uint32_t+nLockTime%3B%0A%0Aprivate%3A%0A++++%2F**+Memory+only.+*%2F%0A++++const+uint256+hash%3B%0A%0A++++uint256+ComputeHash%28%29+const%3B%0A%0Apublic%3A%0A++++%2F**+Construct+a+CTransaction+that+qualifies+as+IsNull%28%29+*%2F%0A++++CTransaction%28%29%3B%0A%0A++++%2F**+Convert+a+CMutableTransaction+into+a+CTransaction.+*%2F%0A++++CTransaction%28const+CMutableTransaction+%26amp%3Btx%29%3B%0A++++CTransaction%28CMutableTransaction+%26amp%3B%26amp%3Btx%29%3B%0A%0A++++template+%26lt%3Btypename+Stream%26gt%3B%0A++++inline+void+Serialize%28Stream%26amp%3B+s%29+const+%7B%0A++++++++SerializeTransaction%28*this%2C+s%29%3B%0A++++%7D%0A%0A++++%2F**+This+deserializing+constructor+is+provided+instead+of+an+Unserialize+method.%0A+++++*++Unserialize+is+not+possible%2C+since+it+would+require+overwriting+const+fields.+*%2F%0A++++template+%26lt%3Btypename+Stream%26gt%3B%0A++++CTransaction%28deserialize_type%2C+Stream%26amp%3B+s%29+%3A+CTransaction%28CMutableTransaction%28deserialize%2C+s%29%29+%7B%7D%0A%0A++++bool+IsNull%28%29+const+%7B%0A++++++++return+vin.empty%28%29+%26amp%3B%26amp%3B+vout.empty%28%29%3B%0A++++%7D%0A%0A++++const+uint256%26amp%3B+GetHash%28%29+const+%7B%0A++++++++return+hash%3B%0A++++%7D%0A%0A++++%2F%2F+Compute+a+hash+that+includes+both+transaction+and+witness+data%0A++++uint256+GetWitnessHash%28%29+const%3B%0A%0A++++%2F%2F+Return+sum+of+txouts.%0A++++CAmount+GetValueOut%28%29+const%3B%0A++++%2F%2F+GetValueIn%28%29+is+a+method+on+CCoinsViewCache%2C+because%0A++++%2F%2F+inputs+must+be+known+to+compute+value+in.%0A%0A++++%2F**%0A+++++*+Get+the+total+transaction+size+in+bytes%2C+including+witness+data.%0A+++++*+%22Total+Size%22+defined+in+BIP141+and+BIP144.%0A+++++*+%40return+Total+transaction+size+in+bytes%0A+++++*%2F%0A++++unsigned+int+GetTotalSize%28%29+const%3B%0A%0A++++bool+IsCoinBase%28%29+const%0A++++%7B%0A++++++++return+%28vin.size%28%29+%3D%3D+1+%26amp%3B%26amp%3B+vin%5B0%5D.prevout.IsNull%28%29%29%3B%0A++++%7D%0A%0A++++friend+bool+operator%3D%3D%28const+CTransaction%26amp%3B+a%2C+const+CTransaction%26amp%3B+b%29%0A++++%7B%0A++++++++return+a.hash+%3D%3D+b.hash%3B%0A++++%7D%0A%0A++++friend+bool+operator%21%3D%28const+CTransaction%26amp%3B+a%2C+const+CTransaction%26amp%3B+b%29%0A++++%7B%0A++++++++return+a.hash+%21%3D+b.hash%3B%0A++++%7D%0A%0A++++std%3A%3Astring+ToString%28%29+const%3B%0A%0A++++bool+HasWitness%28%29+const%0A++++%7B%0A++++++++for+%28size_t+i+%3D+0%3B+i+%26lt%3B+vin.size%28%29%3B+i%2B%2B%29+%7B%0A++++++++++++if+%28%21vin%5Bi%5D.scriptWitness.IsNull%28%29%29+%7B%0A++++++++++++++++return+true%3B%0A++++++++++++%7D%0A++++++++%7D%0A++++++++return+false%3B%0A++++%7D%0A%7D%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%E9%99%A4%E4%BA%86%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA%E5%A4%96%EF%BC%8C%E8%BF%98%E6%9C%89%E4%BA%A4%E6%98%93%E7%9A%84%E7%89%88%E6%9C%AC%E5%92%8C%E4%BA%A4%E6%98%93%E6%97%B6%E9%97%B4%E9%94%81nLockTime%EF%BC%8C%E4%BA%A4%E6%98%93%E6%97%B6%E9%97%B4%E9%94%81%E7%94%A8%E6%9D%A5%E6%8E%A7%E5%88%B6%E4%BA%A4%E6%98%93%E7%9A%84%E8%BE%93%E5%87%BA%E5%8F%AA%E6%9C%89%E5%9C%A8%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E5%90%8E%E6%89%8D%E8%83%BD%E8%A2%AB%E8%8A%B1%E8%B4%B9%EF%BC%8C%E5%85%B3%E4%BA%8E%E8%AF%A5%E5%AD%97%E6%AE%B5%E5%9C%A8%E3%80%8A%E7%B2%BE%E9%80%9A%E6%AF%94%E7%89%B9%E5%B8%81%E3%80%8B%E7%AC%AC2%E7%89%88%E6%9C%89%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%8F%A6%E5%A4%96%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E6%98%AFCTransaction%E4%B8%AD%E6%89%80%E6%9C%89%E7%9A%84%E5%AD%97%E6%AE%B5%E5%85%A8%E9%83%A8%E7%94%A8const%E4%BF%AE%E9%A5%B0%E7%AC%A6%E6%9D%A5%E4%BF%AE%E9%A5%B0%EF%BC%8C%E8%AF%B4%E6%98%8E%E4%B8%80%E6%97%A6%E5%88%9B%E5%BB%BA%E5%87%BACTransaction%E5%AF%B9%E8%B1%A1%E4%BB%A5%E5%90%8E%EF%BC%8C%E5%85%B6%E4%B8%AD%E7%9A%84%E5%86%85%E5%AE%B9%E5%B0%B1%E4%B8%8D%E8%83%BD%E5%9C%A8%E6%9B%B4%E6%94%B9%E4%BA%86%EF%BC%8C%E5%9B%A0%E6%AD%A4CTransaction%E6%98%AF%E4%B8%80%E4%B8%AA%E4%B8%8D%E5%8F%AF%E5%8F%98%E7%9A%84%E5%AF%B9%E8%B1%A1%EF%BC%8C%E4%B8%8E%E4%B9%8B%E7%9B%B8%E5%AF%B9%E5%BA%94%E7%9A%84%EF%BC%8C%E8%BF%98%E6%9C%89%E4%B8%80%E4%B8%AA%E4%BA%A4%E6%98%93%E7%9A%84%E5%8F%AF%E5%8F%98%E7%89%88%E6%9C%AC%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3E%2F**+A+mutable+version+of+CTransaction.+*%2F%0Astruct+CMutableTransaction%0A%7B%0A++++std%3A%3Avector%26lt%3BCTxIn%26gt%3B+vin%3B%0A++++std%3A%3Avector%26lt%3BCTxOut%26gt%3B+vout%3B%0A++++int32_t+nVersion%3B%0A++++uint32_t+nLockTime%3B%0A%0A++++CMutableTransaction%28%29%3B%0A++++CMutableTransaction%28const+CTransaction%26amp%3B+tx%29%3B%0A%0A++++template+%26lt%3Btypename+Stream%26gt%3B%0A++++inline+void+Serialize%28Stream%26amp%3B+s%29+const+%7B%0A++++++++SerializeTransaction%28*this%2C+s%29%3B%0A++++%7D%0A%0A%0A++++template+%26lt%3Btypename+Stream%26gt%3B%0A++++inline+void+Unserialize%28Stream%26amp%3B+s%29+%7B%0A++++++++UnserializeTransaction%28*this%2C+s%29%3B%0A++++%7D%0A%0A++++template+%26lt%3Btypename+Stream%26gt%3B%0A++++CMutableTransaction%28deserialize_type%2C+Stream%26amp%3B+s%29+%7B%0A++++++++Unserialize%28s%29%3B%0A++++%7D%0A%0A++++%2F**+Compute+the+hash+of+this+CMutableTransaction.+This+is+computed+on+the%0A+++++*+fly%2C+as+opposed+to+GetHash%28%29+in+CTransaction%2C+which+uses+a+cached+result.%0A+++++*%2F%0A++++uint256+GetHash%28%29+const%3B%0A%0A++++friend+bool+operator%3D%3D%28const+CMutableTransaction%26amp%3B+a%2C+const+CMutableTransaction%26amp%3B+b%29%0A++++%7B%0A++++++++return+a.GetHash%28%29+%3D%3D+b.GetHash%28%29%3B%0A++++%7D%0A%0A++++bool+HasWitness%28%29+const%0A++++%7B%0A++++++++for+%28size_t+i+%3D+0%3B+i+%26lt%3B+vin.size%28%29%3B+i%2B%2B%29+%7B%0A++++++++++++if+%28%21vin%5Bi%5D.scriptWitness.IsNull%28%29%29+%7B%0A++++++++++++++++return+true%3B%0A++++++++++++%7D%0A++++++++%7D%0A++++++++return+false%3B%0A++++%7D%0A%7D%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+CMutableTransaction%E4%B8%8ECTransaction%E7%9A%84%E5%AD%97%E6%AE%B5%E5%AE%8C%E5%85%A8%E7%9B%B8%E5%90%8C%EF%BC%8C%E6%89%80%E4%B8%8D%E5%90%8C%E7%9A%84%E6%98%AF%E5%AD%97%E6%AE%B5%E5%89%8D%E9%9D%A2%E5%B0%91%E4%BA%86const%E4%BF%AE%E9%A5%B0%E7%AC%A6%EF%BC%8C%E5%9B%A0%E6%AD%A4%E4%B8%80%E4%B8%AACMutableTransaction%E5%AF%B9%E8%B1%A1%E7%94%9F%E6%88%90%E4%BB%A5%E5%90%8E%EF%BC%8C%E5%AE%83%E7%9A%84%E5%AD%97%E6%AE%B5%E8%BF%98%E5%8F%AF%E4%BB%A5%E9%87%8D%E6%96%B0%E8%B5%8B%E5%80%BC%E3%80%82%3C%2Fp%3E+%0A++%3Ch1%3E3+%E4%BA%A4%E6%98%93%E7%9A%84%E5%88%9B%E5%BB%BA%3C%2Fh1%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%BA%86%E8%A7%A3%E4%BA%86%E5%92%8C%E4%BA%A4%E6%98%93%E7%9B%B8%E5%85%B3%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BB%A5%E5%90%8E%EF%BC%8C%E6%9C%AC%E8%8A%82%E6%88%91%E4%BB%AC%E6%9D%A5%E5%88%86%E6%9E%90%E4%B8%80%E4%B8%8B%E6%AF%94%E7%89%B9%E5%B8%81%E4%BA%A4%E6%98%93%E6%98%AF%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E7%9A%84%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E9%80%9A%E8%BF%87%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84JSONAP%E5%91%BD%E4%BB%A4createrawtransaction%E5%8F%AF%E4%BB%A5%E5%88%9B%E5%BB%BA%E4%B8%80%E7%AC%94%E4%BA%A4%E6%98%93%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%91%BD%E4%BB%A4%E9%9C%80%E8%A6%81%E4%BC%A0%E5%85%A5%E4%BB%A5%E4%B8%8B%E5%BD%A2%E5%BC%8F%E7%9A%84json%E5%8F%82%E6%95%B0%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3E%221.+%5C%22inputs%5C%22++++++++++++++++%28array%2C+required%29+A+json+array+of+json+objects%5Cn%22%0A++++++++++++%22+++++%5B%5Cn%22%0A++++++++++++%22+++++++%7B%5Cn%22%0A++++++++++++%22+++++++++%5C%22txid%5C%22%3A%5C%22id%5C%22%2C++++++%28string%2C+required%29+The+transaction+id%5Cn%22%0A++++++++++++%22+++++++++%5C%22vout%5C%22%3An%2C+++++++++%28numeric%2C+required%29+The+output+number%5Cn%22%0A++++++++++++%22+++++++++%5C%22sequence%5C%22%3An++++++%28numeric%2C+optional%29+The+sequence+number%5Cn%22%0A++++++++++++%22+++++++%7D+%5Cn%22%0A++++++++++++%22+++++++%2C...%5Cn%22%0A++++++++++++%22+++++%5D%5Cn%22%0A++++++++++++%222.+%5C%22outputs%5C%22+++++++++++++++%28array%2C+required%29+a+json+array+with+outputs+%28key-value+pairs%29%5Cn%22%0A++++++++++++%22+++%5B%5Cn%22%0A++++++++++++%22++++%7B%5Cn%22%0A++++++++++++%22++++++%5C%22address%5C%22%3A+x.xxx%2C++++%28obj%2C+optional%29+A+key-value+pair.+The+key+%28string%29+is+the+bitcoin+address%2C+the+value+%28float+or+string%29+is+the+amount+in+%22+%2B+CURRENCY_UNIT+%2B+%22%5Cn%22%0A++++++++++++%22++++%7D%2C%5Cn%22%0A++++++++++++%22++++%7B%5Cn%22%0A++++++++++++%22++++++%5C%22data%5C%22%3A+%5C%22hex%5C%22++++++++%28obj%2C+optional%29+A+key-value+pair.+The+key+must+be+%5C%22data%5C%22%2C+the+value+is+hex+encoded+data%5Cn%22%0A++++++++++++%22++++%7D%5Cn%22%0A++++++++++++%22++++%2C...+++++++++++++++++++++More+key-value+pairs+of+the+above+form.+For+compatibility+reasons%2C+a+dictionary%2C+which+holds+the+key-value+pairs+directly%2C+is+also%5Cn%22%0A++++++++++++%22+++++++++++++++++++++++++++++accepted+as+second+parameter.%5Cn%22%0A++++++++++++%22+++%5D%5Cn%22%0A++++++++++++%223.+locktime++++++++++++++++++%28numeric%2C+optional%2C+default%3D0%29+Raw+locktime.+Non-0+value+also+locktime-activates+inputs%5Cn%22%0A++++++++++++%224.+replaceable+++++++++++++++%28boolean%2C+optional%2C+default%3Dfalse%29+Marks+this+transaction+as+BIP125+replaceable.%5Cn%22%0A++++++++++++%22+++++++++++++++++++++++++++++Allows+this+transaction+to+be+replaced+by+a+transaction+with+higher+fees.+If+provided%2C+it+is+an+error+if+explicit+sequence+numbers+are+incompatible.%5Cn%22%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E9%9C%80%E8%A6%81%E5%9C%A8%E5%8F%82%E6%95%B0%E4%B8%AD%E6%8C%87%E5%AE%9A%E6%AF%8F%E4%B8%80%E7%AC%94%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA%E3%80%82%E5%AE%9E%E9%99%85%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%AF%94%E7%89%B9%E5%B8%81%E9%92%B1%E5%8C%85%E6%97%B6%EF%BC%8C%E8%BF%99%E4%BA%9B%E8%84%8F%E6%B4%BB%E9%83%BD%E7%94%B1%E9%92%B1%E5%8C%85%E5%B8%AE%E6%88%91%E4%BB%AC%E5%81%9A%E4%BA%86%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%88%91%E4%BB%AC%E7%9C%8B%E7%9C%8Bcreaterawtransaction%E6%98%AF%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E5%87%BA%E4%B8%80%E7%AC%94%E6%AF%94%E7%89%B9%E5%B8%81%E4%BA%A4%E6%98%93%E7%9A%84%EF%BC%8C%E8%AF%A5%E5%91%BD%E4%BB%A4%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%BD%8D%E4%BA%8Erawtransaction.cpp%E4%B8%AD%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Estatic+UniValue+createrawtransaction%28const+JSONRPCRequest%26amp%3B+request%29%0A%7B%0A++++%2F%2F%E8%BE%93%E5%85%A5%E5%8F%82%E6%95%B0%E4%B8%8D%E5%90%88%E6%B3%95%EF%BC%8C%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%EF%BC%8C%E6%8F%90%E7%A4%BA%E5%8F%82%E6%95%B0%E6%A0%BC%E5%BC%8F%0A++++if+%28request.fHelp+%7C%7C+request.params.size%28%29+%26lt%3B+2+%7C%7C+request.params.size%28%29+%26gt%3B+4%29+%7B%0A++++++++throw+std%3A%3Aruntime_error%28%0A++++++++++++++++%2F%2F+clang-format+off%0A++++++++++++++++%22createrawtransaction+%5B%7B%5C%22txid%5C%22%3A%5C%22id%5C%22%2C%5C%22vout%5C%22%3An%7D%2C...%5D+%5B%7B%5C%22address%5C%22%3Aamount%7D%2C%7B%5C%22data%5C%22%3A%5C%22hex%5C%22%7D%2C...%5D+%28+locktime+%29+%28+replaceable+%29%5Cn%22%0A++++++++++++++++++++++++%22%5CnCreate+a+transaction+spending+the+given+inputs+and+creating+new+outputs.%5Cn%22%0A++++++++++++++++++++++++%22Outputs+can+be+addresses+or+data.%5Cn%22%0A++++++++++++++++++++++++%22Returns+hex-encoded+raw+transaction.%5Cn%22%0A++++++++++++++++++++++++%22Note+that+the+transaction%27s+inputs+are+not+signed%2C+and%5Cn%22%0A++++++++++++++++++++++++%22it+is+not+stored+in+the+wallet+or+transmitted+to+the+network.%5Cn%22%0A%0A++++++++++++++++++++++++%22%5CnArguments%3A%5Cn%22%0A++++++++++++++++++++++++%221.+%5C%22inputs%5C%22++++++++++++++++%28array%2C+required%29+A+json+array+of+json+objects%5Cn%22%0A++++++++++++++++++++++++%22+++++%5B%5Cn%22%0A++++++++++++++++++++++++%22+++++++%7B%5Cn%22%0A++++++++++++++++++++++++%22+++++++++%5C%22txid%5C%22%3A%5C%22id%5C%22%2C++++++%28string%2C+required%29+The+transaction+id%5Cn%22%0A++++++++++++++++++++++++%22+++++++++%5C%22vout%5C%22%3An%2C+++++++++%28numeric%2C+required%29+The+output+number%5Cn%22%0A++++++++++++++++++++++++%22+++++++++%5C%22sequence%5C%22%3An++++++%28numeric%2C+optional%29+The+sequence+number%5Cn%22%0A++++++++++++++++++++++++%22+++++++%7D+%5Cn%22%0A++++++++++++++++++++++++%22+++++++%2C...%5Cn%22%0A++++++++++++++++++++++++%22+++++%5D%5Cn%22%0A++++++++++++++++++++++++%222.+%5C%22outputs%5C%22+++++++++++++++%28array%2C+required%29+a+json+array+with+outputs+%28key-value+pairs%29%5Cn%22%0A++++++++++++++++++++++++%22+++%5B%5Cn%22%0A++++++++++++++++++++++++%22++++%7B%5Cn%22%0A++++++++++++++++++++++++%22++++++%5C%22address%5C%22%3A+x.xxx%2C++++%28obj%2C+optional%29+A+key-value+pair.+The+key+%28string%29+is+the+bitcoin+address%2C+the+value+%28float+or+string%29+is+the+amount+in+%22+%2B+CURRENCY_UNIT+%2B+%22%5Cn%22%0A++++++++++++++++++++++++%22++++%7D%2C%5Cn%22%0A++++++++++++++++++++++++%22++++%7B%5Cn%22%0A++++++++++++++++++++++++%22++++++%5C%22data%5C%22%3A+%5C%22hex%5C%22++++++++%28obj%2C+optional%29+A+key-value+pair.+The+key+must+be+%5C%22data%5C%22%2C+the+value+is+hex+encoded+data%5Cn%22%0A++++++++++++++++++++++++%22++++%7D%5Cn%22%0A++++++++++++++++++++++++%22++++%2C...+++++++++++++++++++++More+key-value+pairs+of+the+above+form.+For+compatibility+reasons%2C+a+dictionary%2C+which+holds+the+key-value+pairs+directly%2C+is+also%5Cn%22%0A++++++++++++++++++++++++%22+++++++++++++++++++++++++++++accepted+as+second+parameter.%5Cn%22%0A++++++++++++++++++++++++%22+++%5D%5Cn%22%0A++++++++++++++++++++++++%223.+locktime++++++++++++++++++%28numeric%2C+optional%2C+default%3D0%29+Raw+locktime.+Non-0+value+also+locktime-activates+inputs%5Cn%22%0A++++++++++++++++++++++++%224.+replaceable+++++++++++++++%28boolean%2C+optional%2C+default%3Dfalse%29+Marks+this+transaction+as+BIP125+replaceable.%5Cn%22%0A++++++++++++++++++++++++%22+++++++++++++++++++++++++++++Allows+this+transaction+to+be+replaced+by+a+transaction+with+higher+fees.+If+provided%2C+it+is+an+error+if+explicit+sequence+numbers+are+incompatible.%5Cn%22%0A++++++++++++++++++++++++%22%5CnResult%3A%5Cn%22%0A++++++++++++++++++++++++%22%5C%22transaction%5C%22++++++++++++++%28string%29+hex+string+of+the+transaction%5Cn%22%0A%0A++++++++++++++++++++++++%22%5CnExamples%3A%5Cn%22%0A++++++++++++++++%2B+HelpExampleCli%28%22createrawtransaction%22%2C+%22%5C%22%5B%7B%5C%5C%5C%22txid%5C%5C%5C%22%3A%5C%5C%5C%22myid%5C%5C%5C%22%2C%5C%5C%5C%22vout%5C%5C%5C%22%3A0%7D%5D%5C%22+%5C%22%5B%7B%5C%5C%5C%22address%5C%5C%5C%22%3A0.01%7D%5D%5C%22%22%29%0A++++++++++++++++%2B+HelpExampleCli%28%22createrawtransaction%22%2C+%22%5C%22%5B%7B%5C%5C%5C%22txid%5C%5C%5C%22%3A%5C%5C%5C%22myid%5C%5C%5C%22%2C%5C%5C%5C%22vout%5C%5C%5C%22%3A0%7D%5D%5C%22+%5C%22%5B%7B%5C%5C%5C%22data%5C%5C%5C%22%3A%5C%5C%5C%2200010203%5C%5C%5C%22%7D%5D%5C%22%22%29%0A++++++++++++++++%2B+HelpExampleRpc%28%22createrawtransaction%22%2C+%22%5C%22%5B%7B%5C%5C%5C%22txid%5C%5C%5C%22%3A%5C%5C%5C%22myid%5C%5C%5C%22%2C%5C%5C%5C%22vout%5C%5C%5C%22%3A0%7D%5D%5C%22%2C+%5C%22%5B%7B%5C%5C%5C%22address%5C%5C%5C%22%3A0.01%7D%5D%5C%22%22%29%0A++++++++++++++++%2B+HelpExampleRpc%28%22createrawtransaction%22%2C+%22%5C%22%5B%7B%5C%5C%5C%22txid%5C%5C%5C%22%3A%5C%5C%5C%22myid%5C%5C%5C%22%2C%5C%5C%5C%22vout%5C%5C%5C%22%3A0%7D%5D%5C%22%2C+%5C%22%5B%7B%5C%5C%5C%22data%5C%5C%5C%22%3A%5C%5C%5C%2200010203%5C%5C%5C%22%7D%5D%5C%22%22%29%0A++++++++++++++++%2F%2F+clang-format+on%0A++++++++%29%3B%0A++++%7D%0A%0A++++%2F%2F%E6%A3%80%E6%9F%A5%E5%8F%82%E6%95%B0%0A++++RPCTypeCheck%28request.params%2C+%7B%0A+++++++++++++++++++++++++UniValue%3A%3AVARR%2C%0A+++++++++++++++++++++++++UniValueType%28%29%2C+%2F%2F+ARR+or+OBJ%2C+checked+later%0A+++++++++++++++++++++++++UniValue%3A%3AVNUM%2C%0A+++++++++++++++++++++++++UniValue%3A%3AVBOOL%0A+++++++++++++++++%7D%2C+true%0A++++%29%3B%0A++++if+%28request.params%5B0%5D.isNull%28%29+%7C%7C+request.params%5B1%5D.isNull%28%29%29%0A++++++++throw+JSONRPCError%28RPC_INVALID_PARAMETER%2C+%22Invalid+parameter%2C+arguments+1+and+2+must+be+non-null%22%29%3B%0A%0A++++UniValue+inputs+%3D+request.params%5B0%5D.get_array%28%29%3B%0A++++const+bool+outputs_is_obj+%3D+request.params%5B1%5D.isObject%28%29%3B%0A++++UniValue+outputs+%3D+outputs_is_obj+%3F%0A+++++++++++++++++++++++request.params%5B1%5D.get_obj%28%29+%3A%0A+++++++++++++++++++++++request.params%5B1%5D.get_array%28%29%3B%0A%0A++++%2F%2F%E7%94%9F%E6%88%90%E4%BA%A4%E6%98%93%E5%AF%B9%E8%B1%A1%0A++++CMutableTransaction+rawTx%3B%0A%0A++++%2F%2F%E4%BB%8E%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96%E4%BA%A4%E6%98%93%E7%9A%84%E9%94%81%E5%AE%9A%E6%97%B6%E9%97%B4%EF%BC%88%E5%A6%82%E6%9E%9C%E6%8F%90%E4%BE%9B%E7%9A%84%E8%AF%9D%EF%BC%89%0A++++if+%28%21request.params%5B2%5D.isNull%28%29%29+%7B%0A++++++++int64_t+nLockTime+%3D+request.params%5B2%5D.get_int64%28%29%3B%0A++++++++if+%28nLockTime+%26lt%3B+0+%7C%7C+nLockTime+%26gt%3B+std%3A%3Anumeric_limits%26lt%3Buint32_t%26gt%3B%3A%3Amax%28%29%29%0A++++++++++++throw+JSONRPCError%28RPC_INVALID_PARAMETER%2C+%22Invalid+parameter%2C+locktime+out+of+range%22%29%3B%0A++++++++rawTx.nLockTime+%3D+nLockTime%3B%0A++++%7D%0A%0A++++bool+rbfOptIn+%3D+request.params%5B3%5D.isTrue%28%29%3B%0A%0A++++%2F%2F%E8%A7%A3%E6%9E%90%E5%8F%82%E6%95%B0%EF%BC%8C%E7%94%9F%E6%88%90%E4%BA%A4%E6%98%93%E7%9A%84%E8%BE%93%E5%85%A5%0A++++for+%28unsigned+int+idx+%3D+0%3B+idx+%26lt%3B+inputs.size%28%29%3B+idx%2B%2B%29+%7B%0A++++++++const+UniValue%26amp%3B+input+%3D+inputs%5Bidx%5D%3B%0A++++++++const+UniValue%26amp%3B+o+%3D+input.get_obj%28%29%3B%0A%0A++++++++%2F%2F%E8%AF%A5%E8%BE%93%E5%85%A5%E6%8C%87%E5%90%91%E7%9A%84%E4%BA%A4%E6%98%93%0A++++++++uint256+txid+%3D+ParseHashO%28o%2C+%22txid%22%29%3B%0A++++++++%2F%2F%E8%AF%A5%E8%BE%93%E5%85%A5%E6%8C%87%E5%90%91%E7%9A%84UTXO%E5%9C%A8%E5%85%B6%E4%BA%A4%E6%98%93%E4%B8%AD%E7%9A%84%E7%B4%A2%E5%BC%95%0A++++++++const+UniValue%26amp%3B+vout_v+%3D+find_value%28o%2C+%22vout%22%29%3B%0A++++++++if+%28%21vout_v.isNum%28%29%29%0A++++++++++++throw+JSONRPCError%28RPC_INVALID_PARAMETER%2C+%22Invalid+parameter%2C+missing+vout+key%22%29%3B%0A++++++++int+nOutput+%3D+vout_v.get_int%28%29%3B%0A++++++++if+%28nOutput+%26lt%3B+0%29%0A++++++++++++throw+JSONRPCError%28RPC_INVALID_PARAMETER%2C+%22Invalid+parameter%2C+vout+must+be+positive%22%29%3B%0A%0A++++++++uint32_t+nSequence%3B%0A++++++++if+%28rbfOptIn%29+%7B%0A++++++++++++nSequence+%3D+MAX_BIP125_RBF_SEQUENCE%3B%0A++++++++%7D+else+if+%28rawTx.nLockTime%29+%7B%0A++++++++++++nSequence+%3D+std%3A%3Anumeric_limits%26lt%3Buint32_t%26gt%3B%3A%3Amax%28%29+-+1%3B%0A++++++++%7D+else+%7B%0A++++++++++++nSequence+%3D+std%3A%3Anumeric_limits%26lt%3Buint32_t%26gt%3B%3A%3Amax%28%29%3B%0A++++++++%7D%0A%0A++++++++%2F%2F+set+the+sequence+number+if+passed+in+the+parameters+object%0A++++++++const+UniValue%26amp%3B+sequenceObj+%3D+find_value%28o%2C+%22sequence%22%29%3B%0A++++++++if+%28sequenceObj.isNum%28%29%29+%7B%0A++++++++++++int64_t+seqNr64+%3D+sequenceObj.get_int64%28%29%3B%0A++++++++++++if+%28seqNr64+%26lt%3B+0+%7C%7C+seqNr64+%26gt%3B+std%3A%3Anumeric_limits%26lt%3Buint32_t%26gt%3B%3A%3Amax%28%29%29+%7B%0A++++++++++++++++throw+JSONRPCError%28RPC_INVALID_PARAMETER%2C+%22Invalid+parameter%2C+sequence+number+is+out+of+range%22%29%3B%0A++++++++++++%7D+else+%7B%0A++++++++++++++++nSequence+%3D+%28uint32_t%29seqNr64%3B%0A++++++++++++%7D%0A++++++++%7D%0A%0A++++++++CTxIn+in%28COutPoint%28txid%2C+nOutput%29%2C+CScript%28%29%2C+nSequence%29%3B%0A%0A++++++++rawTx.vin.push_back%28in%29%3B%0A++++%7D%0A%0A++++std%3A%3Aset%26lt%3BCTxDestination%26gt%3B+destinations%3B%0A++++if+%28%21outputs_is_obj%29+%7B%0A++++++++%2F%2F+Translate+array+of+key-value+pairs+into+dict%0A++++++++UniValue+outputs_dict+%3D+UniValue%28UniValue%3A%3AVOBJ%29%3B%0A++++++++for+%28size_t+i+%3D+0%3B+i+%26lt%3B+outputs.size%28%29%3B+%2B%2Bi%29+%7B%0A++++++++++++const+UniValue%26amp%3B+output+%3D+outputs%5Bi%5D%3B%0A++++++++++++if+%28%21output.isObject%28%29%29+%7B%0A++++++++++++++++throw+JSONRPCError%28RPC_INVALID_PARAMETER%2C+%22Invalid+parameter%2C+key-value+pair+not+an+object+as+expected%22%29%3B%0A++++++++++++%7D%0A++++++++++++if+%28output.size%28%29+%21%3D+1%29+%7B%0A++++++++++++++++throw+JSONRPCError%28RPC_INVALID_PARAMETER%2C+%22Invalid+parameter%2C+key-value+pair+must+contain+exactly+one+key%22%29%3B%0A++++++++++++%7D%0A++++++++++++outputs_dict.pushKVs%28output%29%3B%0A++++++++%7D%0A++++++++outputs+%3D+std%3A%3Amove%28outputs_dict%29%3B%0A++++%7D%0A++++%2F%2F%E6%A0%B9%E6%8D%AE%E5%8F%82%E6%95%B0%E7%94%9F%E6%88%90%E4%BA%A4%E6%98%93%E7%9A%84%E8%BE%93%E5%87%BA%0A++++for+%28const+std%3A%3Astring%26amp%3B+name_+%3A+outputs.getKeys%28%29%29+%7B%0A++++++++if+%28name_+%3D%3D+%22data%22%29+%7B%0A++++++++++++std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B+data+%3D+ParseHexV%28outputs%5Bname_%5D.getValStr%28%29%2C+%22Data%22%29%3B%0A%0A++++++++++++CTxOut+out%280%2C+CScript%28%29+%26lt%3B%26lt%3B+OP_rawTx.vout.push_back%28out%29RETURN+%26lt%3B%26lt%3B+data%29%3B%0A%0A++++++++%7D+else+%7B%0A++++++++++++%2F%2F%E8%A7%A3%E6%9E%90%E5%87%BA%E7%9B%AE%E6%A0%87%E5%9C%B0%E5%9D%80%EF%BC%88%E6%AF%94%E7%89%B9%E5%B8%81%E6%9C%80%E7%BB%88%E6%B5%81%E5%90%91%E7%9A%84%E5%9C%B0%E6%96%B9%EF%BC%89%0A++++++++++++CTxDestination+destination+%3D+DecodeDestination%28name_%29%3B%0A++++++++++++if+%28%21IsValidDestination%28destination%29%29+%7B%0A++++++++++++++++throw+JSONRPCError%28RPC_INVALID_ADDRESS_OR_KEY%2C+std%3A%3Astring%28%22Invalid+Bitcoin+address%3A+%22%29+%2B+name_%29%3B%0A++++++++++++%7D%0A%0A++++++++++++if+%28%21destinations.insert%28destination%29.second%29+%7B%0A++++++++++++++++throw+JSONRPCError%28RPC_INVALID_PARAMETER%2C+std%3A%3Astring%28%22Invalid+parameter%2C+duplicated+address%3A+%22%29+%2B+name_%29%3B%0A++++++++++++%7D%0A++++++++++++%2F%2F%E6%A0%B9%E6%8D%AE%E5%9C%B0%E5%9D%80%E7%94%9F%E6%88%90%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%0A++++++++++++CScript+scriptPubKey+%3D+GetScriptForDestination%28destination%29%3B%0A++++++++++++%0A++++++++++++CAmount+nAmount+%3D+AmountFromValue%28outputs%5Bname_%5D%29%3B%0A%0A++++++++++++CTxOut+out%28nAmount%2C+scriptPubKey%29%3B%0A++++++++++++rawTx.vout.push_back%28out%29%3B%0A++++++++%7D%0A++++%7D%0A%0A++++if+%28%21request.params%5B3%5D.isNull%28%29+%26amp%3B%26amp%3B+rbfOptIn+%21%3D+SignalsOptInRBF%28rawTx%29%29+%7B%0A++++++++throw+JSONRPCError%28RPC_INVALID_PARAMETER%2C+%22Invalid+parameter+combination%3A+Sequence+number%28s%29+contradict+replaceable+option%22%29%3B%0A++++%7D%0A%0A++++%2F%2F%E5%AF%B9%E4%BA%A4%E6%98%93%E8%BF%9B%E8%A1%8C%E7%BC%96%E7%A0%81%E5%B9%B6%E8%BF%94%E5%9B%9E%0A++++return+EncodeHexTx%28rawTx%29%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%95%B4%E4%BD%93%E7%9A%84%E8%BF%87%E7%A8%8B%E5%B9%B6%E4%B8%8D%E5%A4%8D%E6%9D%82%EF%BC%9A%E4%BB%8E%E5%8F%82%E6%95%B0%E4%B8%AD%E8%A7%A3%E6%9E%90%E5%87%BA%E6%AF%8F%E4%B8%80%E7%AC%94%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA%EF%BC%8C%E5%B9%B6%E5%A1%AB%E5%86%99%E5%88%B0CMutableTransaction%E5%AF%B9%E8%B1%A1%E4%B8%AD%EF%BC%8C%E6%9C%80%E5%90%8E%E5%B0%86%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A0%81%E5%90%8E%E8%BF%94%E5%9B%9E%E3%80%82%E4%BD%86%E6%98%AF%E8%BF%99%E9%87%8C%E6%9C%89%E4%B8%A4%E4%B8%AA%E9%97%AE%E9%A2%98%E5%80%BC%E5%BE%97%E6%B3%A8%E6%84%8F%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%281%29+%E4%BB%8E%E4%BB%A3%E7%A0%81%E4%B8%AD%E6%B2%A1%E6%9C%89%E7%9C%8B%E5%88%B0%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E4%B8%AD%E7%9A%84%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%ACscriptSig%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%282%29+%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90%E7%9A%84%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%85%B3%E4%BA%8E%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8C%E9%9A%8F%E5%90%8E%E5%9C%A8%E5%88%86%E6%9E%90%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%E6%97%B6%E8%A7%A3%E7%AD%94%EF%BC%8C%E4%B8%8B%E9%9D%A2%E6%88%91%E4%BB%AC%E5%85%88%E6%9D%A5%E7%9C%8B%E7%9C%8B%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%9A%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90%E3%80%82%E7%94%9F%E6%88%90%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E7%9A%84%E4%BB%A3%E7%A0%81%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3ECScript+scriptPubKey+%3D+GetScriptForDestination%28destination%29%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%88%91%E4%BB%AC%E6%9D%A5%E7%9C%8B%E7%9C%8B%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3ECScript+GetScriptForDestination%28const+CTxDestination%26amp%3B+dest%29%0A%7B%0A++++CScript+script%3B%0A%0A++++boost%3A%3Aapply_visitor%28CScriptVisitor%28%26amp%3Bscript%29%2C+dest%29%3B%0A++++return+script%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E9%A6%96%E5%85%88%EF%BC%8C%E8%AF%A5%E6%96%B9%E6%B3%95%E6%8E%A5%E5%8F%97CTxDestination%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0%EF%BC%8C%E8%AF%A5%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3E%2F**%0A+*+A+txout+script+template+with+a+specific+destination.+It+is+either%3A%0A+*++*+CNoDestination%3A+no+destination+set%0A+*++*+CKeyID%3A+TX_PUBKEYHASH+destination+%28P2PKH%29%0A+*++*+CScriptID%3A+TX_SCRIPTHASH+destination+%28P2SH%29%0A+*++*+WitnessV0ScriptHash%3A+TX_WITNESS_V0_SCRIPTHASH+destination+%28P2WSH%29%0A+*++*+WitnessV0KeyHash%3A+TX_WITNESS_V0_KEYHASH+destination+%28P2WPKH%29%0A+*++*+WitnessUnknown%3A+TX_WITNESS_UNKNOWN+destination+%28P2W%3F%3F%3F%29%0A+*++A+CTxDestination+is+the+internal+data+type+encoded+in+a+bitcoin+address%0A+*%2F%0Atypedef+boost%3A%3Avariant%26lt%3BCNoDestination%2C+CKeyID%2C+CScriptID%2C+WitnessV0ScriptHash%2C+WitnessV0KeyHash%2C+WitnessUnknown%26gt%3B+CTxDestination%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+CTxDestination%E6%98%AFboost%3A%3Avariant%E7%B1%BB%E5%9E%8B%EF%BC%8C%E8%A1%A8%E7%A4%BA%E4%B8%80%E4%B8%AA%E7%89%B9%E5%AE%9A%E7%9A%84%E6%AF%94%E7%89%B9%E5%B8%81%E5%9C%B0%E5%9D%80%E3%80%82boost%3A%3Avariant%E5%8F%AF%E4%BB%A5%E7%90%86%E8%A7%A3%E4%B8%BA%E4%B8%80%E7%A7%8D%E5%A2%9E%E5%BC%BA%E7%9A%84union%E7%B1%BB%E5%9E%8B%EF%BC%8C%E4%BB%8E%E8%AF%A5%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%AE%9A%E4%B9%89%E6%88%91%E4%BB%AC%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%87%BA%E7%9B%AE%E5%89%8D%E6%AF%94%E7%89%B9%E5%B8%81%E6%94%AF%E6%8C%81%E5%A6%82%E4%B8%8B%E5%87%A0%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+CKeyID%EF%BC%9A%E5%85%AC%E9%92%A5%EF%BC%8C%E9%80%82%E7%94%A8%E4%BA%8EP2PKH%E6%A0%87%E5%87%86%E4%BA%A4%E6%98%93%EF%BC%8C%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E4%B8%AD%E6%8C%87%E5%AE%9A%E6%AF%94%E7%89%B9%E5%B8%81%E6%8E%A5%E5%8F%97%E8%80%85%E7%9A%84%E5%85%AC%E9%92%A5%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+CScriptID%EF%BC%9A%E9%80%82%E7%94%A8%E4%BA%8EP2SH%E6%A0%87%E5%87%86%E4%BA%A4%E6%98%93%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+WitnessV0ScriptHash%EF%BC%9A%E9%80%82%E7%94%A8%E4%BA%8EP2WSH%E4%BA%A4%E6%98%93%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+WitnessV0KeyHash%EF%BC%9A%E9%80%82%E7%94%A8%E4%BA%8EP2WPKH%E4%BA%A4%E6%98%93%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%8F%AF%E8%A7%81%EF%BC%8C%E9%92%88%E5%AF%B9%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E7%9A%84%E4%BA%A4%E6%98%93%EF%BC%8C%E6%9C%89%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%8C%E5%9B%A0%E6%AD%A4%E7%94%9F%E6%88%90%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E6%97%B6%E4%B9%9F%E8%A6%81%E6%A0%B9%E6%8D%AE%E4%BA%A4%E6%98%93%E7%B1%BB%E5%9E%8B%E6%9D%A5%E5%85%B7%E4%BD%93%E5%A4%84%E7%90%86%E3%80%82%E4%B8%BA%E4%BA%86%E9%81%BF%E5%85%8D%E5%87%BA%E7%8E%B0%E5%BE%88%E5%A4%9Aif-else%E5%88%86%E6%94%AF%EF%BC%8C%E6%AF%94%E7%89%B9%E5%B8%81%E4%BD%BF%E7%94%A8boost%E6%8F%90%E4%BE%9B%E7%9A%84visitor%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%9D%A5%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86%EF%BC%8C%E6%8F%90%E4%BE%9B%E4%BA%86CScriptVisitor%E9%92%88%E5%AF%B9%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%9C%B0%E5%9D%80%E7%94%9F%E6%88%90%E5%AF%B9%E5%BA%94%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Eclass+CScriptVisitor+%3A+public+boost%3A%3Astatic_visitor%26lt%3Bbool%26gt%3B%0A%7B%0Aprivate%3A%0A++++CScript+*script%3B%0Apublic%3A%0A++++explicit+CScriptVisitor%28CScript+*scriptin%29+%7B+script+%3D+scriptin%3B+%7D%0A%0A++++bool+operator%28%29%28const+CNoDestination+%26amp%3Bdest%29+const+%7B%0A++++++++script-%26gt%3Bclear%28%29%3B%0A++++++++return+false%3B%0A++++%7D%0A%0A++++%2F%2FP2PKH%E6%A0%87%E5%87%86%E4%BA%A4%E6%98%93%0A++++bool+operator%28%29%28const+CKeyID+%26amp%3BkeyID%29+const+%7B%0A++++++++script-%26gt%3Bclear%28%29%3B%0A++++++++*script+%26lt%3B%26lt%3B+OP_DUP+%26lt%3B%26lt%3B+OP_HASH160+%26lt%3B%26lt%3B+ToByteVector%28keyID%29+%26lt%3B%26lt%3B+OP_EQUALVERIFY+%26lt%3B%26lt%3B+OP_CHECKSIG%3B%0A++++++++return+true%3B%0A++++%7D%0A++++%2F%2FP2SH%E6%A0%87%E5%87%86%E4%BA%A4%E6%98%93%0A++++bool+operator%28%29%28const+CScriptID+%26amp%3BscriptID%29+const+%7B%0A++++++++script-%26gt%3Bclear%28%29%3B%0A++++++++*script+%26lt%3B%26lt%3B+OP_HASH160+%26lt%3B%26lt%3B+ToByteVector%28scriptID%29+%26lt%3B%26lt%3B+OP_EQUAL%3B%0A++++++++return+true%3B%0A++++%7D%0A++++%2F%2FP2WSH%E4%BA%A4%E6%98%93%0A++++bool+operator%28%29%28const+WitnessV0KeyHash%26amp%3B+id%29+const%0A++++%7B%0A++++++++script-%26gt%3Bclear%28%29%3B%0A++++++++*script+%26lt%3B%26lt%3B+OP_0+%26lt%3B%26lt%3B+ToByteVector%28id%29%3B%0A++++++++return+true%3B%0A++++%7D%0A++++%2F%2FP2WKH%E4%BA%A4%E6%98%93%0A++++bool+operator%28%29%28const+WitnessV0ScriptHash%26amp%3B+id%29+const%0A++++%7B%0A++++++++script-%26gt%3Bclear%28%29%3B%0A++++++++*script+%26lt%3B%26lt%3B+OP_0+%26lt%3B%26lt%3B+ToByteVector%28id%29%3B%0A++++++++return+true%3B%0A++++%7D%0A%0A++++bool+operator%28%29%28const+WitnessUnknown%26amp%3B+id%29+const%0A++++%7B%0A++++++++script-%26gt%3Bclear%28%29%3B%0A++++++++*script+%26lt%3B%26lt%3B+CScript%3A%3AEncodeOP_N%28id.version%29+%26lt%3B%26lt%3B+std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B%28id.program%2C+id.program+%2B+id.length%29%3B%0A++++++++return+true%3B%0A++++%7D%0A%7D%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E7%8E%B0%E5%9C%A8%EF%BC%8C%E6%88%91%E4%BB%AC%E5%B7%B2%E7%BB%8F%E4%BA%86%E8%A7%A3%E5%88%B0%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E7%9A%84%E7%94%9F%E6%88%90%E8%BF%87%E7%A8%8B%E4%BA%86%EF%BC%8C%E6%9A%82%E6%97%B6%E5%85%88%E4%B8%8D%E7%94%A8%E7%AE%A1%E8%84%9A%E6%9C%AC%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E7%9A%84%EF%BC%8C%E6%9C%AC%E6%96%87%E7%A8%8D%E5%90%8E%E8%BF%98%E4%BC%9A%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E%E4%BA%A4%E6%98%93%E8%84%9A%E6%9C%AC%E7%9A%84%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E3%80%82%3C%2Fp%3E+%0A++%3Ch1%3E4+%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%3C%2Fh1%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%9C%AC%E8%8A%82%E6%9D%A5%E5%9B%9E%E7%AD%94%E4%B8%8A%E4%B8%80%E8%8A%82%E6%8F%90%E5%88%B0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%9A%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%9A%84%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%ACscriptSig%E6%98%AF%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90%E7%9A%84%E3%80%82%E6%88%91%E4%BB%AC%E5%85%88%E6%9D%A5%E6%90%9E%E6%B8%85%E6%A5%9A%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AF%B9%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%EF%BC%8C%E7%AD%BE%E5%90%8D%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%88%E6%98%AF%E6%80%8E%E6%A0%B7%EF%BC%9F%3C%2Fp%3E+%0A++%3Ch2%3E4.1+%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BA%A4%E6%98%93%E9%9C%80%E8%A6%81%E7%AD%BE%E5%90%8D%3C%2Fh2%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%9C%A8%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%AD%E5%AF%B9%E4%BA%A4%E6%98%93%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%E7%9A%84%E4%B8%BB%E8%A6%81%E4%BD%9C%E7%94%A8%E6%98%AF%E8%AF%81%E6%98%8E%E6%9F%90%E4%BA%BA%E5%AF%B9%E6%9F%90%E4%B8%80%E7%AC%94UTXO%E7%9A%84%E6%89%80%E6%9C%89%E6%9D%83%E3%80%82%E5%81%87%E8%AE%BE%E5%BC%A0%E4%B8%89%E7%BB%99%E6%9D%8E%E5%9B%9B%E8%BD%AC%E8%B4%A61BTC%EF%BC%8C%E4%BA%A4%E6%98%93%E4%B8%AD%E5%B0%B1%E4%BC%9A%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA1BTC%E7%9A%84UTXO%EF%BC%8C%E4%B8%BA%E4%BA%86%E7%A1%AE%E4%BF%9D%E8%BF%99%E7%AC%94UTXO%E9%9A%8F%E5%90%8E%E5%8F%AA%E8%83%BD%E8%A2%AB%E6%9D%8E%E5%9B%9B%E8%8A%B1%E8%B4%B9%EF%BC%8C%E5%BF%85%E9%A1%BB%E8%A6%81%E5%AF%B9%E4%BA%A4%E6%98%93%E8%BF%9B%E8%A1%8C%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E3%80%82%3C%2Fp%3E+%0A++%3Ch2%3E4.2+%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%E7%9A%84%E5%8E%9F%E7%90%86%3C%2Fh2%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%E5%AE%9E%E9%99%85%E4%B8%8A%E5%B0%B1%E6%98%AF%E5%AF%B9%E4%BA%A4%E6%98%93%E8%BF%9B%E8%A1%8C%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E3%80%82%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E4%B9%8B%E5%89%8D%E5%9C%A8%3Ca+href%3D%22https%3A%2F%2Fmp.csdn.net%2Fpostedit%2F80579467%22+rel%3D%22nofollow%22%3E%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%3C%2Fa%3E%E4%B8%AD%E5%B7%B2%E7%BB%8F%E6%9C%89%E8%AF%B4%E6%98%8E%EF%BC%8C%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E5%86%8D%E6%AC%A1%E5%9B%9E%E9%A1%BE%E4%B8%80%E4%B8%8B%EF%BC%9A%E5%81%87%E8%AE%BE%E5%BC%A0%E4%B8%89%E5%9C%A8%E4%B8%80%E6%9D%A1%E4%B8%8D%E5%8F%AF%E9%9D%A0%E7%9A%84%E9%80%9A%E4%BF%A1%E4%BF%A1%E9%81%93%E4%B8%8A%E7%BB%99%E6%9D%8E%E5%9B%9B%E5%8F%91%E9%80%81%E4%BA%86%E4%B8%80%E6%9D%A1%E6%B6%88%E6%81%AFmsg%EF%BC%8C%E6%9D%8E%E5%9B%9B%E5%A6%82%E4%BD%95%E7%A1%AE%E8%AE%A4%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E7%9A%84%E4%BA%BA%E5%B0%B1%E6%98%AF%E5%BC%A0%E4%B8%89%E8%80%8C%E4%B8%8D%E6%98%AF%E5%88%AB%E4%BA%BA%E5%91%A2%EF%BC%9F%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%281%29+%E5%BC%A0%E4%B8%89%E7%94%A8hash%E5%AF%B9msg%E7%94%9F%E6%88%90%E6%91%98%E8%A6%81D%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22D%3DHash%28msg%29%22+class%3D%22mathcode%22+src%3D%22https%3A%2F%2Fprivate.codecogs.com%2Fgif.latex%3FD%253DHash%2528msg%2529%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%282%29+%E5%BC%A0%E4%B8%89%E7%94%A8%E6%9F%90%E7%A7%8D%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95F%EF%BC%8C%E5%8A%A0%E4%B8%8A%E8%87%AA%E5%B7%B1%E7%9A%84%E7%A7%81%E9%92%A5key%E5%AF%B9%E6%91%98%E8%A6%81D%E7%94%9F%E6%88%90%E7%AD%BE%E5%90%8DS%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%3Cimg+alt%3D%22S%3DF%5Cleft+%28+key%2CD+%5Cright+%29%22+class%3D%22mathcode%22+src%3D%22https%3A%2F%2Fprivate.codecogs.com%2Fgif.latex%3FS%253DF%255Cleft%2520%2528%2520key%252CD%2520%255Cright%2520%2529%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%283%29+%E5%BC%A0%E4%B8%89%E5%B0%86%E7%AD%BE%E5%90%8DS%E5%92%8C%E6%B6%88%E6%81%AFmsg%E4%B8%80%E5%B9%B6%E5%8F%91%E9%80%81%E7%BB%99%E6%9D%8E%E5%9B%9B%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%284%29+%E6%9D%8E%E5%9B%9B%E7%94%A8%E5%BC%A0%E4%B8%89%E7%9A%84%E5%85%AC%E9%92%A5pubkey%E4%BB%8E%E6%94%B6%E5%88%B0%E7%9A%84%E7%AD%BE%E5%90%8DS%E4%B8%AD%E8%A7%A3%E5%87%BA%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81D%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22D%3DF%5Cleft+%28+pubkey%2CS+%5Cright+%29%22+class%3D%22mathcode%22+src%3D%22https%3A%2F%2Fprivate.codecogs.com%2Fgif.latex%3FD%253DF%255Cleft%2520%2528%2520pubkey%252CS%2520%255Cright%2520%2529%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%285%29+%E6%9D%8E%E5%9B%9B%E5%AF%B9%E6%94%B6%E5%88%B0%E7%9A%84%E6%B6%88%E6%81%AFmsg%E8%BF%9B%E8%A1%8Chash%E5%BE%97%E5%88%B0%E6%91%98%E8%A6%81D1%EF%BC%8C%E7%84%B6%E5%90%8E%E5%92%8C%E8%A7%A3%E5%87%BA%E7%9A%84D%E5%AF%B9%E6%AF%94%E6%98%AF%E5%90%A6%E7%9B%B8%E5%90%8C%EF%BC%8C%E7%9B%B8%E5%90%8C%E5%B0%B1%E8%83%BD%E8%AF%81%E6%98%8E%E8%AF%A5%E6%B6%88%E6%81%AF%E7%A1%AE%E5%AE%9E%E6%9D%A5%E8%87%AA%E4%BA%8E%E5%BC%A0%E4%B8%89%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%AF%94%E7%89%B9%E5%B8%81%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%E7%9A%84%E6%98%AF%E7%9B%B8%E5%90%8C%E7%9A%84%E9%81%93%E7%90%86%EF%BC%8C%E5%85%B6%E4%B8%ADmsg%E5%B0%B1%E6%98%AF%E4%BA%A4%E6%98%93%EF%BC%8CF%E6%98%AF%E6%AF%94%E7%89%B9%E5%B8%81%E9%87%87%E7%94%A8%E7%9A%84ECDSA%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95%EF%BC%8C%E6%88%91%E4%BB%AC%E4%BB%A5%E6%9C%80%E5%B8%B8%E8%A7%81%E7%9A%84P2PKH%E4%BA%A4%E6%98%93%E4%B8%BA%E4%BE%8B%E6%9D%A5%E8%AF%B4%E6%98%8E%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%81%87%E8%AE%BE%E5%BC%A0%E4%B8%89%E7%BB%99%E6%9D%8E%E5%9B%9B%E8%BD%AC%E8%B4%A61BTC%EF%BC%8C%E4%BA%8E%E6%98%AF%E5%BC%A0%E4%B8%89%E7%9A%84%E9%92%B1%E5%8C%85%E7%94%9F%E6%88%90%E4%BA%86%E4%BA%A4%E6%98%93%EF%BC%8C%E4%BA%A4%E6%98%93T%E4%B8%AD%E6%9C%89%E4%B8%80%E7%AC%94%E6%8C%87%E5%90%91%E6%9D%8E%E5%9B%9B%E7%9A%84UTXO%EF%BC%8C%E4%BB%B7%E5%80%BC1BTC%E3%80%82%E5%BC%A0%E4%B8%89%E4%B8%BA%E4%BA%86%E7%A1%AE%E4%BF%9D%E8%BF%99%E7%AC%94UTXO%E4%BB%A5%E5%90%8E%E5%8F%AA%E8%83%BD%E7%94%B1%E6%9D%8E%E5%9B%9B%E6%B6%88%E8%B4%B9%EF%BC%8C%E4%BC%9A%E5%9C%A8%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%ACscriptPubKey%E4%B8%AD%E8%AE%BE%E7%BD%AE%E4%B8%A4%E4%B8%AA%E6%9D%A1%E4%BB%B6%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%28C1%29+%E6%B6%88%E8%B4%B9%E8%80%85%E5%BF%85%E9%A1%BB%E6%8F%90%E4%BE%9B%E8%87%AA%E5%B7%B1%E7%9A%84%E5%85%AC%E9%92%A5%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%AF%B9%E5%85%AC%E9%92%A5%E8%BF%9B%E8%A1%8Chash%E5%90%8E%E7%9A%84%E5%80%BC%E9%9C%80%E8%A6%81%E4%B8%8E%E6%9D%8E%E5%9B%9B%E7%9A%84%E5%85%AC%E9%92%A5%E7%9A%84hash%E5%80%BC%E7%9B%B8%E7%AD%89%EF%BC%8C%E5%81%87%E8%AE%BE%E6%9D%8E%E5%9B%9B%E7%9A%84%E5%85%AC%E9%92%A5%E4%B8%BAP%EF%BC%8C%E6%B6%88%E8%B4%B9%E8%80%85%E6%8F%90%E4%BE%9B%E7%9A%84%E5%85%AC%E9%92%A5%E4%B8%BApubkey%EF%BC%8C%E5%88%99%E5%BF%85%E9%A1%BB%E6%BB%A1%E8%B6%B3%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22Hash%5Cleft+%28+pubkey+%5Cright+%29%3DHash%5Cleft+%28+P+%5Cright+%29%22+class%3D%22mathcode%22+src%3D%22https%3A%2F%2Fprivate.codecogs.com%2Fgif.latex%3FHash%255Cleft%2520%2528%2520pubkey%2520%255Cright%2520%2529%253DHash%255Cleft%2520%2528%2520P%2520%255Cright%2520%2529%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%BC%A0%E4%B8%89%E4%BC%9A%E5%B0%86%E6%9D%8E%E5%9B%9B%E7%9A%84%E5%85%AC%E9%92%A5hash%E5%8D%B3Hash%28P%29%E5%86%99%E5%85%A5%E5%88%B0scriptPubKey%E8%84%9A%E6%9C%AC%E4%B8%AD%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%28C2%29+%E6%B6%88%E8%B4%B9%E8%80%85%E6%8F%90%E4%BE%9B%E7%9A%84%E7%AD%BE%E5%90%8D%E5%BF%85%E9%A1%BB%E6%AD%A3%E7%A1%AE%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E9%9A%8F%E5%90%8E%EF%BC%8C%E6%9D%8E%E5%9B%9B%E7%9A%84%E9%92%B1%E5%8C%85%E7%94%9F%E6%88%90%E4%BA%A4%E6%98%93T%EF%BC%8C%E6%83%B3%E8%8A%B1%E8%B4%B9%E8%BF%99%E7%AC%94UTXO%EF%BC%8C%E5%88%99%E6%9D%8E%E5%9B%9B%E9%9C%80%E8%A6%81%E6%8F%90%E4%BE%9B%E4%B8%A4%E6%A0%B7%E4%B8%9C%E8%A5%BF%EF%BC%9A%E6%9D%8E%E5%9B%9B%E7%9A%84%E5%85%AC%E9%92%A5pubkey%EF%BC%8C%E5%92%8C%E6%9D%8E%E5%9B%9B%E5%AF%B9%E4%BA%A4%E6%98%93T%E7%9A%84%E7%AD%BE%E5%90%8D%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%281%29+%E6%9D%8E%E5%9B%9B%E5%AF%B9%E4%BA%A4%E6%98%93T%E9%87%87%E7%94%A8hash%E7%94%9F%E6%88%90%E6%91%98%E8%A6%81D%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22D%3DHash%5Cleft+%28+T+%5Cright+%29%22+class%3D%22mathcode%22+src%3D%22https%3A%2F%2Fprivate.codecogs.com%2Fgif.latex%3FD%253DHash%255Cleft%2520%2528%2520T%2520%255Cright%2520%2529%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%282%29+%E6%9D%8E%E5%9B%9B%E7%94%A8ECDSA%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95%EF%BC%8C%E7%94%A8%E8%87%AA%E5%B7%B1%E7%9A%84%E7%A7%81%E9%92%A5key%E5%AF%B9%E6%91%98%E8%A6%81D%E7%94%9F%E6%88%90%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8DS%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22S%3DECDSA%5Cleft+%28+key%2CD+%5Cright+%29%22+class%3D%22mathcode%22+src%3D%22https%3A%2F%2Fprivate.codecogs.com%2Fgif.latex%3FS%253DECDSA%255Cleft%2520%2528%2520key%252CD%2520%255Cright%2520%2529%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%283%29+%E6%9D%8E%E5%9B%9B%E5%B0%86%E8%87%AA%E5%B7%B1%E7%9A%84%E5%85%AC%E9%92%A5pubkey%E5%92%8C%E7%AD%BE%E5%90%8DS%E5%86%99%E5%85%A5%E5%88%B0%E4%BA%A4%E6%98%93T%E7%9A%84%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%ACscriptSig%E4%B8%AD%EF%BC%8C%E7%84%B6%E5%90%8E%E5%B0%86%E4%BA%A4%E6%98%93T%E5%B9%BF%E6%92%AD%E5%88%B0%E7%BD%91%E7%BB%9C%E4%B8%AD%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%284%29+%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%9A%84%E8%8A%82%E7%82%B9%E6%94%B6%E5%88%B0%E4%BA%A4%E6%98%93T%EF%BC%8C%E5%AF%B9%E4%BA%A4%E6%98%93%E8%BF%9B%E8%A1%8C%E9%AA%8C%E8%AF%81%EF%BC%8C%E7%A1%AE%E8%AE%A4%E6%9D%8E%E5%9B%9B%E7%A1%AE%E5%AE%9E%E5%8F%AF%E4%BB%A5%E8%8A%B1%E8%B4%B9%E8%BF%99%E7%AC%94UTXO%E3%80%82%E9%A6%96%E5%85%88%E5%AF%B9%E6%94%B6%E5%88%B0%E7%9A%84%E4%BA%A4%E6%98%93T%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E4%B8%AD%E7%9A%84%E5%85%AC%E9%92%A5pubkey%E8%BF%9B%E8%A1%8Chash%EF%BC%8C%E7%9C%8B%E6%98%AF%E5%90%A6%E5%92%8CUTXO%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E4%B8%AD%E7%9A%84%E5%85%AC%E9%92%A5hash%E7%9B%B8%E5%90%8C%EF%BC%88%E6%BB%A1%E8%B6%B3%E6%9D%A1%E4%BB%B6C1%EF%BC%89%EF%BC%9B%E7%84%B6%E5%90%8E%E6%A3%80%E6%9F%A5%E7%AD%BE%E5%90%8D%EF%BC%9A%E9%A6%96%E5%85%88%E8%8A%82%E7%82%B9%E5%AF%B9%E6%94%B6%E5%88%B0%E7%9A%84%E4%BA%A4%E6%98%93%E8%BF%9B%E8%A1%8Chash%E7%94%9F%E6%88%90%E4%BA%A4%E6%98%93%E7%9A%84%E6%91%98%E8%A6%81D%27%3A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22D%27%3DHash%5Cleft+%28+T+%5Cright+%29%22+class%3D%22mathcode%22+src%3D%22https%3A%2F%2Fprivate.codecogs.com%2Fgif.latex%3FD%2527%253DHash%255Cleft%2520%2528%2520T%2520%255Cright%2520%2529%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E7%84%B6%E5%90%8E%E7%94%A8%E5%85%AC%E9%92%A5pubkey%E4%BB%8E%E7%AD%BE%E5%90%8DS%E4%B8%AD%E8%A7%A3%E5%87%BA%E4%BA%A4%E6%98%93%E6%91%98%E8%A6%81D%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22D%3DECDSA%5Cleft+%28+pubkey%2C+S+%5Cright+%29%22+class%3D%22mathcode%22+src%3D%22https%3A%2F%2Fprivate.codecogs.com%2Fgif.latex%3FD%253DECDSA%255Cleft%2520%2528%2520pubkey%252C%2520S%2520%255Cright%2520%2529%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%A6%82%E6%9E%9C%3Cimg+alt%3D%22D%27%3D%3DD%22+class%3D%22mathcode%22+src%3D%22https%3A%2F%2Fprivate.codecogs.com%2Fgif.latex%3FD%2527%253D%253DD%22%3E%E5%88%99%E5%8F%AF%E4%BB%A5%E8%AF%81%E6%98%8E%E8%BF%99%E7%AC%94%E4%BA%A4%E6%98%93T%E7%A1%AE%E5%AE%9E%E6%98%AF%E6%9D%8E%E5%9B%9B%E7%94%9F%E6%88%90%EF%BC%8C%E4%BB%96%E6%9C%89%E6%9D%83%E8%8A%B1%E8%B4%B9%E8%BF%99%E7%AC%94UTXO%E3%80%82%3C%2Fp%3E+%0A++%3Ch2%3E4.3+%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%E7%9A%84%E7%94%9F%E6%88%90%3C%2Fh2%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%88%91%E4%BB%AC%E5%86%8D%E6%AC%A1%E5%9B%9E%E9%A1%BE%E4%BA%86%E6%AF%94%E7%89%B9%E5%B8%81%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%E7%9A%84%E5%8E%9F%E7%90%86%E3%80%82%E6%8E%A5%E4%B8%8B%E6%9D%A5%E6%88%91%E4%BB%AC%E6%9D%A5%E7%9C%8B%E7%9C%8B%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%9A%84%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%EF%BC%88%E5%85%AC%E9%92%A5%2B%E7%AD%BE%E5%90%8D%EF%BC%89%E6%98%AF%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90%E7%9A%84%E3%80%82%E7%AC%AC3%E8%8A%82%E4%BB%8B%E7%BB%8D%E4%BA%86%E9%80%9A%E8%BF%87createrawtransaction%E7%94%9F%E6%88%90%E4%BA%A4%E6%98%93%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%8C%E4%BD%86%E6%98%AFcreaterawtransaction%E7%94%9F%E6%88%90%E7%9A%84%E4%BA%A4%E6%98%93%E7%9A%84%E8%BE%93%E5%85%A5%E4%B8%AD%E8%BF%98%E7%BC%BA%E5%B0%91%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%ACscriptSig%EF%BC%8C%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%E9%9C%80%E8%A6%81%E9%80%9A%E8%BF%87%E5%8F%A6%E4%B8%80%E4%B8%AAjsonapi%EF%BC%9Asignrawtransaction%EF%BC%8C%E8%BF%99%E6%9D%A1%E5%91%BD%E4%BB%A4%E9%9C%80%E8%A6%81%E7%9A%84%E5%8F%82%E6%95%B0%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-bash%22%3E%221.+%5C%22hexstring%5C%22+++++%28string%2C+required%29+The+transaction+hex+string%5Cn%22%0A++++++++++++%222.+%5C%22prevtxs%5C%22+++++++%28string%2C+optional%29+An+json+array+of+previous+dependent+transaction+outputs%5Cn%22%0A++++++++++++%22+++++%5B+++++++++++++++%28json+array+of+json+objects%2C+or+%27null%27+if+none+provided%29%5Cn%22%0A++++++++++++%22+++++++%7B%5Cn%22%0A++++++++++++%22+++++++++%5C%22txid%5C%22%3A%5C%22id%5C%22%2C+++++++++++++%28string%2C+required%29+The+transaction+id%5Cn%22%0A++++++++++++%22+++++++++%5C%22vout%5C%22%3An%2C++++++++++++++++++%28numeric%2C+required%29+The+output+number%5Cn%22%0A++++++++++++%22+++++++++%5C%22scriptPubKey%5C%22%3A+%5C%22hex%5C%22%2C+++%28string%2C+required%29+script+key%5Cn%22%0A++++++++++++%22+++++++++%5C%22redeemScript%5C%22%3A+%5C%22hex%5C%22%2C+++%28string%2C+required+for+P2SH+or+P2WSH%29+redeem+script%5Cn%22%0A++++++++++++%22+++++++++%5C%22amount%5C%22%3A+value++++++++++++%28numeric%2C+required%29+The+amount+spent%5Cn%22%0A++++++++++++%22+++++++%7D%5Cn%22%0A++++++++++++%22+++++++%2C...%5Cn%22%0A++++++++++++%22++++%5D%5Cn%22%0A++++++++++++%223.+%5C%22privkeys%5C%22+++++%28string%2C+optional%29+A+json+array+of+base58-encoded+private+keys+for+signing%5Cn%22%0A++++++++++++%22++++%5B++++++++++++++++++%28json+array+of+strings%2C+or+%27null%27+if+none+provided%29%5Cn%22%0A++++++++++++%22++++++%5C%22privatekey%5C%22+++%28string%29+private+key+in+base58-encoding%5Cn%22%0A++++++++++++%22++++++%2C...%5Cn%22%0A++++++++++++%22++++%5D%5Cn%22%0A++++++++++++%224.+%5C%22sighashtype%5C%22+++++%28string%2C+optional%2C+default%3DALL%29+The+signature+hash+type.+Must+be+one+of%5Cn%22%0A++++++++++++%22+++++++%5C%22ALL%5C%22%5Cn%22%0A++++++++++++%22+++++++%5C%22NONE%5C%22%5Cn%22%0A++++++++++++%22+++++++%5C%22SINGLE%5C%22%5Cn%22%0A++++++++++++%22+++++++%5C%22ALL%7CANYONECANPAY%5C%22%5Cn%22%0A++++++++++++%22+++++++%5C%22NONE%7CANYONECANPAY%5C%22%5Cn%22%0A++++++++++++%22+++++++%5C%22SINGLE%7CANYONECANPAY%5C%22%5Cn%22%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+prevtxs%E6%8F%90%E4%BE%9B%E8%AF%A5%E4%BA%A4%E6%98%93%E7%9A%84%E8%BE%93%E5%85%A5%E6%89%80%E6%8C%87%E5%90%91%E7%9A%84UTXO%EF%BC%8Cprivkeys%E5%88%99%E6%98%AF%E8%A7%A3%E9%94%81%E8%BF%99%E4%BA%9BUTXO%E9%9C%80%E8%A6%81%E7%9A%84%E7%A7%81%E9%92%A5%EF%BC%8Csighashtype%E5%88%99%E6%8C%87%E5%AE%9A%E4%BA%86%E5%8F%AA%E7%AD%BE%E5%90%8D%E4%BA%A4%E6%98%93%E4%B8%AD%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86%E4%BA%A4%E6%98%93%E8%BF%98%E6%98%AF%E5%AF%B9%E5%85%A8%E9%83%A8%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E9%83%BD%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E7%AD%BE%E5%90%8D%E7%9A%84%E8%BF%87%E7%A8%8B%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3EUniValue+signrawtransaction%28const+JSONRPCRequest%26amp%3B+request%29+%7B%0A%23ifdef+ENABLE_WALLET%0A++++CWallet+*+const+pwallet+%3D+GetWalletForJSONRPCRequest%28request%29%3B%0A%23endif%0A%0A++++%2F%2F%E6%A3%80%E6%9F%A5%E5%8F%82%E6%95%B0%E6%A0%BC%E5%BC%8F%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%A0%BC%E5%BC%8F%E4%B8%8D%E6%AD%A3%E7%A1%AE%EF%BC%8C%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%E6%8F%90%E7%A4%BA%E6%AD%A3%E7%A1%AE%E7%94%A8%E6%B3%95%0A++++if+%28request.fHelp+%7C%7C+request.params.size%28%29+%26lt%3B+1+%7C%7C+request.params.size%28%29+%26gt%3B+4%29%0A++++++++throw+std%3A%3Aruntime_error%28%0A++++++++++++++++%22signrawtransaction+%5C%22hexstring%5C%22+%28+%5B%7B%5C%22txid%5C%22%3A%5C%22id%5C%22%2C%5C%22vout%5C%22%3An%2C%5C%22scriptPubKey%5C%22%3A%5C%22hex%5C%22%2C%5C%22redeemScript%5C%22%3A%5C%22hex%5C%22%7D%2C...%5D+%5B%5C%22privatekey1%5C%22%2C...%5D+sighashtype+%29%5Cn%22%0A++++++++++++++++++++++++%22%5CnDEPRECATED.+Sign+inputs+for+raw+transaction+%28serialized%2C+hex-encoded%29.%5Cn%22%0A++++++++++++++++++++++++%22The+second+optional+argument+%28may+be+null%29+is+an+array+of+previous+transaction+outputs+that%5Cn%22%0A++++++++++++++++++++++++%22this+transaction+depends+on+but+may+not+yet+be+in+the+block+chain.%5Cn%22%0A++++++++++++++++++++++++%22The+third+optional+argument+%28may+be+null%29+is+an+array+of+base58-encoded+private%5Cn%22%0A++++++++++++++++++++++++%22keys+that%2C+if+given%2C+will+be+the+only+keys+used+to+sign+the+transaction.%5Cn%22%0A%23ifdef+ENABLE_WALLET%0A++++++++++++++++++++++++%2B+HelpRequiringPassphrase%28pwallet%29+%2B+%22%5Cn%22%0A%23endif%0A++++++++++++++++++++++++%22%5CnArguments%3A%5Cn%22%0A++++++++++++++++++++++++%221.+%5C%22hexstring%5C%22+++++%28string%2C+required%29+The+transaction+hex+string%5Cn%22%0A++++++++++++++++++++++++%222.+%5C%22prevtxs%5C%22+++++++%28string%2C+optional%29+An+json+array+of+previous+dependent+transaction+outputs%5Cn%22%0A++++++++++++++++++++++++%22+++++%5B+++++++++++++++%28json+array+of+json+objects%2C+or+%27null%27+if+none+provided%29%5Cn%22%0A++++++++++++++++++++++++%22+++++++%7B%5Cn%22%0A++++++++++++++++++++++++%22+++++++++%5C%22txid%5C%22%3A%5C%22id%5C%22%2C+++++++++++++%28string%2C+required%29+The+transaction+id%5Cn%22%0A++++++++++++++++++++++++%22+++++++++%5C%22vout%5C%22%3An%2C++++++++++++++++++%28numeric%2C+required%29+The+output+number%5Cn%22%0A++++++++++++++++++++++++%22+++++++++%5C%22scriptPubKey%5C%22%3A+%5C%22hex%5C%22%2C+++%28string%2C+required%29+script+key%5Cn%22%0A++++++++++++++++++++++++%22+++++++++%5C%22redeemScript%5C%22%3A+%5C%22hex%5C%22%2C+++%28string%2C+required+for+P2SH+or+P2WSH%29+redeem+script%5Cn%22%0A++++++++++++++++++++++++%22+++++++++%5C%22amount%5C%22%3A+value++++++++++++%28numeric%2C+required%29+The+amount+spent%5Cn%22%0A++++++++++++++++++++++++%22+++++++%7D%5Cn%22%0A++++++++++++++++++++++++%22+++++++%2C...%5Cn%22%0A++++++++++++++++++++++++%22++++%5D%5Cn%22%0A++++++++++++++++++++++++%223.+%5C%22privkeys%5C%22+++++%28string%2C+optional%29+A+json+array+of+base58-encoded+private+keys+for+signing%5Cn%22%0A++++++++++++++++++++++++%22++++%5B++++++++++++++++++%28json+array+of+strings%2C+or+%27null%27+if+none+provided%29%5Cn%22%0A++++++++++++++++++++++++%22++++++%5C%22privatekey%5C%22+++%28string%29+private+key+in+base58-encoding%5Cn%22%0A++++++++++++++++++++++++%22++++++%2C...%5Cn%22%0A++++++++++++++++++++++++%22++++%5D%5Cn%22%0A++++++++++++++++++++++++%224.+%5C%22sighashtype%5C%22+++++%28string%2C+optional%2C+default%3DALL%29+The+signature+hash+type.+Must+be+one+of%5Cn%22%0A++++++++++++++++++++++++%22+++++++%5C%22ALL%5C%22%5Cn%22%0A++++++++++++++++++++++++%22+++++++%5C%22NONE%5C%22%5Cn%22%0A++++++++++++++++++++++++%22+++++++%5C%22SINGLE%5C%22%5Cn%22%0A++++++++++++++++++++++++%22+++++++%5C%22ALL%7CANYONECANPAY%5C%22%5Cn%22%0A++++++++++++++++++++++++%22+++++++%5C%22NONE%7CANYONECANPAY%5C%22%5Cn%22%0A++++++++++++++++++++++++%22+++++++%5C%22SINGLE%7CANYONECANPAY%5C%22%5Cn%22%0A%0A++++++++++++++++++++++++%22%5CnResult%3A%5Cn%22%0A++++++++++++++++++++++++%22%7B%5Cn%22%0A++++++++++++++++++++++++%22++%5C%22hex%5C%22+%3A+%5C%22value%5C%22%2C+++++++++++%28string%29+The+hex-encoded+raw+transaction+with+signature%28s%29%5Cn%22%0A++++++++++++++++++++++++%22++%5C%22complete%5C%22+%3A+true%7Cfalse%2C+++%28boolean%29+If+the+transaction+has+a+complete+set+of+signatures%5Cn%22%0A++++++++++++++++++++++++%22++%5C%22errors%5C%22+%3A+%5B+++++++++++++++++%28json+array+of+objects%29+Script+verification+errors+%28if+there+are+any%29%5Cn%22%0A++++++++++++++++++++++++%22++++%7B%5Cn%22%0A++++++++++++++++++++++++%22++++++%5C%22txid%5C%22+%3A+%5C%22hash%5C%22%2C+++++++++++%28string%29+The+hash+of+the+referenced%2C+previous+transaction%5Cn%22%0A++++++++++++++++++++++++%22++++++%5C%22vout%5C%22+%3A+n%2C++++++++++++++++%28numeric%29+The+index+of+the+output+to+spent+and+used+as+input%5Cn%22%0A++++++++++++++++++++++++%22++++++%5C%22scriptSig%5C%22+%3A+%5C%22hex%5C%22%2C+++++++%28string%29+The+hex-encoded+signature+script%5Cn%22%0A++++++++++++++++++++++++%22++++++%5C%22sequence%5C%22+%3A+n%2C++++++++++++%28numeric%29+Script+sequence+number%5Cn%22%0A++++++++++++++++++++++++%22++++++%5C%22error%5C%22+%3A+%5C%22text%5C%22+++++++++++%28string%29+Verification+or+signing+error+related+to+the+input%5Cn%22%0A++++++++++++++++++++++++%22++++%7D%5Cn%22%0A++++++++++++++++++++++++%22++++%2C...%5Cn%22%0A++++++++++++++++++++++++%22++%5D%5Cn%22%0A++++++++++++++++++++++++%22%7D%5Cn%22%0A%0A++++++++++++++++++++++++%22%5CnExamples%3A%5Cn%22%0A++++++++++++++++%2B+HelpExampleCli%28%22signrawtransaction%22%2C+%22%5C%22myhex%5C%22%22%29%0A++++++++++++++++%2B+HelpExampleRpc%28%22signrawtransaction%22%2C+%22%5C%22myhex%5C%22%22%29%0A++++++++%29%3B%0A%0A++++if+%28%21IsDeprecatedRPCEnabled%28%22signrawtransaction%22%29%29+%7B%0A++++++++throw+JSONRPCError%28RPC_METHOD_DEPRECATED%2C%0A+++++++++++++++++++++++++++%22signrawtransaction+is+deprecated+and+will+be+fully+removed+in+v0.18.+%22%0A+++++++++++++++++++++++++++++++++++%22To+use+signrawtransaction+in+v0.17%2C+restart+bitcoind+with+-deprecatedrpc%3Dsignrawtransaction.%5Cn%22%0A+++++++++++++++++++++++++++++++++++%22Projects+should+transition+to+using+signrawtransactionwithkey+and+signrawtransactionwithwallet+before+upgrading+to+v0.18%22%29%3B%0A++++%7D%0A%0A++++%2F%2F%E6%A3%80%E6%9F%A5%E5%8F%82%E6%95%B0%0A++++RPCTypeCheck%28request.params%2C+%7BUniValue%3A%3AVSTR%2C+UniValue%3A%3AVARR%2C+UniValue%3A%3AVARR%2C+UniValue%3A%3AVSTR%7D%2C%0A+++++++++++++++++true%29%3B%0A%0A++++%2F%2F+Make+a+JSONRPCRequest+to+pass+on+to+the+right+signrawtransaction*+command%0A++++JSONRPCRequest+new_request%3B%0A++++new_request.id+%3D+request.id%3B%0A++++new_request.params.setArray%28%29%3B%0A%0A++++%2F%2F+For+signing+with+private+keys%0A++++if+%28%21request.params%5B2%5D.isNull%28%29%29+%7B%0A++++++++%2F%2F%E9%80%9A%E8%BF%87%E5%8F%82%E6%95%B0%E6%8F%90%E4%BE%9B%E7%9A%84%E7%A7%81%E9%92%A5%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%0A++++++++new_request.params.push_back%28request.params%5B0%5D%29%3B%0A++++++++%2F%2F+Note%3A+the+prevtxs+and+privkeys+are+reversed+for+signrawtransactionwithkey%0A++++++++new_request.params.push_back%28request.params%5B2%5D%29%3B%0A++++++++new_request.params.push_back%28request.params%5B1%5D%29%3B%0A++++++++new_request.params.push_back%28request.params%5B3%5D%29%3B%0A++++++++return+signrawtransactionwithkey%28new_request%29%3B%0A++++%7D+else+%7B%0A%23ifdef+ENABLE_WALLET%0A++++++++%2F%2F+Otherwise+sign+with+the+wallet+which+does+not+take+a+privkeys+parameter%0A++++++++%2F%2F%E9%80%9A%E8%BF%87%E9%92%B1%E5%8C%85%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%0A++++++++new_request.params.push_back%28request.params%5B0%5D%29%3B%0A++++++++new_request.params.push_back%28request.params%5B1%5D%29%3B%0A++++++++new_request.params.push_back%28request.params%5B3%5D%29%3B%0A++++++++return+signrawtransactionwithwallet%28new_request%29%3B%0A%23else%0A++++++++%2F%2F+If+we+have+made+it+this+far%2C+then+wallet+is+disabled+and+no+private+keys+were+given%2C+so+fail+here.%0A++++++++throw+JSONRPCError%28RPC_INVALID_PARAMETER%2C+%22No+private+keys+available.%22%29%3B%0A%23endif%0A++++%7D%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%88%91%E4%BB%AC%E8%BF%99%E9%87%8C%E5%8F%AA%E5%88%86%E6%9E%90%E9%80%9A%E8%BF%87%E6%8F%90%E4%BE%9B%E7%9A%84%E7%A7%81%E9%92%A5%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%98%AF%E9%80%9A%E8%BF%87signrawtransactionwithkey%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3E%0Astatic+UniValue+signrawtransactionwithkey%28const+JSONRPCRequest%26amp%3B+request%29%0A%7B%0A++++%2F%2F%E5%8F%82%E6%95%B0%E6%A3%80%E6%9F%A5%0A++++if+%28request.fHelp+%7C%7C+request.params.size%28%29+%26lt%3B+2+%7C%7C+request.params.size%28%29+%26gt%3B+4%29%0A++++++++throw+std%3A%3Aruntime_error%28%0A++++++++++++++++%22signrawtransactionwithkey+%5C%22hexstring%5C%22+%5B%5C%22privatekey1%5C%22%2C...%5D+%28+%5B%7B%5C%22txid%5C%22%3A%5C%22id%5C%22%2C%5C%22vout%5C%22%3An%2C%5C%22scriptPubKey%5C%22%3A%5C%22hex%5C%22%2C%5C%22redeemScript%5C%22%3A%5C%22hex%5C%22%7D%2C...%5D+sighashtype+%29%5Cn%22%0A++++++++++++++++++++++++%22%5CnSign+inputs+for+raw+transaction+%28serialized%2C+hex-encoded%29.%5Cn%22%0A++++++++++++++++++++++++%22The+second+argument+is+an+array+of+base58-encoded+private%5Cn%22%0A++++++++++++++++++++++++%22keys+that+will+be+the+only+keys+used+to+sign+the+transaction.%5Cn%22%0A++++++++++++++++++++++++%22The+third+optional+argument+%28may+be+null%29+is+an+array+of+previous+transaction+outputs+that%5Cn%22%0A++++++++++++++++++++++++%22this+transaction+depends+on+but+may+not+yet+be+in+the+block+chain.%5Cn%22%0A%0A++++++++++++++++++++++++%22%5CnArguments%3A%5Cn%22%0A++++++++++++++++++++++++%221.+%5C%22hexstring%5C%22++++++++++++++++++++++%28string%2C+required%29+The+transaction+hex+string%5Cn%22%0A++++++++++++++++++++++++%222.+%5C%22privkeys%5C%22+++++++++++++++++++++++%28string%2C+required%29+A+json+array+of+base58-encoded+private+keys+for+signing%5Cn%22%0A++++++++++++++++++++++++%22++++%5B+++++++++++++++++++++++++++++++%28json+array+of+strings%29%5Cn%22%0A++++++++++++++++++++++++%22++++++%5C%22privatekey%5C%22++++++++++++++++++%28string%29+private+key+in+base58-encoding%5Cn%22%0A++++++++++++++++++++++++%22++++++%2C...%5Cn%22%0A++++++++++++++++++++++++%22++++%5D%5Cn%22%0A++++++++++++++++++++++++%223.+%5C%22prevtxs%5C%22++++++++++++++++++++++++%28string%2C+optional%29+An+json+array+of+previous+dependent+transaction+outputs%5Cn%22%0A++++++++++++++++++++++++%22+++++%5B++++++++++++++++++++++++++++++%28json+array+of+json+objects%2C+or+%27null%27+if+none+provided%29%5Cn%22%0A++++++++++++++++++++++++%22+++++++%7B%5Cn%22%0A++++++++++++++++++++++++%22+++++++++%5C%22txid%5C%22%3A%5C%22id%5C%22%2C+++++++++++++++%28string%2C+required%29+The+transaction+id%5Cn%22%0A++++++++++++++++++++++++%22+++++++++%5C%22vout%5C%22%3An%2C++++++++++++++++++%28numeric%2C+required%29+The+output+number%5Cn%22%0A++++++++++++++++++++++++%22+++++++++%5C%22scriptPubKey%5C%22%3A+%5C%22hex%5C%22%2C+++++%28string%2C+required%29+script+key%5Cn%22%0A++++++++++++++++++++++++%22+++++++++%5C%22redeemScript%5C%22%3A+%5C%22hex%5C%22%2C+++++%28string%2C+required+for+P2SH+or+P2WSH%29+redeem+script%5Cn%22%0A++++++++++++++++++++++++%22+++++++++%5C%22amount%5C%22%3A+value++++++++++++%28numeric%2C+required%29+The+amount+spent%5Cn%22%0A++++++++++++++++++++++++%22+++++++%7D%5Cn%22%0A++++++++++++++++++++++++%22+++++++%2C...%5Cn%22%0A++++++++++++++++++++++++%22++++%5D%5Cn%22%0A++++++++++++++++++++++++%224.+%5C%22sighashtype%5C%22++++++++++++++++++++%28string%2C+optional%2C+default%3DALL%29+The+signature+hash+type.+Must+be+one+of%5Cn%22%0A++++++++++++++++++++++++%22+++++++%5C%22ALL%5C%22%5Cn%22%0A++++++++++++++++++++++++%22+++++++%5C%22NONE%5C%22%5Cn%22%0A++++++++++++++++++++++++%22+++++++%5C%22SINGLE%5C%22%5Cn%22%0A++++++++++++++++++++++++%22+++++++%5C%22ALL%7CANYONECANPAY%5C%22%5Cn%22%0A++++++++++++++++++++++++%22+++++++%5C%22NONE%7CANYONECANPAY%5C%22%5Cn%22%0A++++++++++++++++++++++++%22+++++++%5C%22SINGLE%7CANYONECANPAY%5C%22%5Cn%22%0A%0A++++++++++++++++++++++++%22%5CnResult%3A%5Cn%22%0A++++++++++++++++++++++++%22%7B%5Cn%22%0A++++++++++++++++++++++++%22++%5C%22hex%5C%22+%3A+%5C%22value%5C%22%2C++++++++++++++++++%28string%29+The+hex-encoded+raw+transaction+with+signature%28s%29%5Cn%22%0A++++++++++++++++++++++++%22++%5C%22complete%5C%22+%3A+true%7Cfalse%2C++++++++++%28boolean%29+If+the+transaction+has+a+complete+set+of+signatures%5Cn%22%0A++++++++++++++++++++++++%22++%5C%22errors%5C%22+%3A+%5B++++++++++++++++++++++%28json+array+of+objects%29+Script+verification+errors+%28if+there+are+any%29%5Cn%22%0A++++++++++++++++++++++++%22++++%7B%5Cn%22%0A++++++++++++++++++++++++%22++++++%5C%22txid%5C%22+%3A+%5C%22hash%5C%22%2C++++++++++++++%28string%29+The+hash+of+the+referenced%2C+previous+transaction%5Cn%22%0A++++++++++++++++++++++++%22++++++%5C%22vout%5C%22+%3A+n%2C+++++++++++++++++++%28numeric%29+The+index+of+the+output+to+spent+and+used+as+input%5Cn%22%0A++++++++++++++++++++++++%22++++++%5C%22scriptSig%5C%22+%3A+%5C%22hex%5C%22%2C++++++++++%28string%29+The+hex-encoded+signature+script%5Cn%22%0A++++++++++++++++++++++++%22++++++%5C%22sequence%5C%22+%3A+n%2C+++++++++++++++%28numeric%29+Script+sequence+number%5Cn%22%0A++++++++++++++++++++++++%22++++++%5C%22error%5C%22+%3A+%5C%22text%5C%22++++++++++++++%28string%29+Verification+or+signing+error+related+to+the+input%5Cn%22%0A++++++++++++++++++++++++%22++++%7D%5Cn%22%0A++++++++++++++++++++++++%22++++%2C...%5Cn%22%0A++++++++++++++++++++++++%22++%5D%5Cn%22%0A++++++++++++++++++++++++%22%7D%5Cn%22%0A%0A++++++++++++++++++++++++%22%5CnExamples%3A%5Cn%22%0A++++++++++++++++%2B+HelpExampleCli%28%22signrawtransactionwithkey%22%2C+%22%5C%22myhex%5C%22%22%29%0A++++++++++++++++%2B+HelpExampleRpc%28%22signrawtransactionwithkey%22%2C+%22%5C%22myhex%5C%22%22%29%0A++++++++%29%3B%0A%0A++++RPCTypeCheck%28request.params%2C+%7BUniValue%3A%3AVSTR%2C+UniValue%3A%3AVARR%2C+UniValue%3A%3AVARR%2C+UniValue%3A%3AVSTR%7D%2C+true%29%3B%0A%0A++++%2F%2F%E8%A7%A3%E7%A0%81%E5%87%BA%E5%8E%9F%E5%A7%8B%E4%BA%A4%E6%98%93%0A++++CMutableTransaction+mtx%3B%0A++++if+%28%21DecodeHexTx%28mtx%2C+request.params%5B0%5D.get_str%28%29%2C+true%29%29+%7B%0A++++++++throw+JSONRPCError%28RPC_DESERIALIZATION_ERROR%2C+%22TX+decode+failed%22%29%3B%0A++++%7D%0A%0A++++%2F%2F%E4%BB%8E%E6%8F%90%E4%BE%9B%E7%9A%84%E7%A7%81%E9%92%A5%E5%BE%97%E5%88%B0%E5%AF%B9%E5%BA%94%E7%9A%84%E5%85%AC%E9%92%A5%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%B0%86%E7%A7%81%E9%92%A5-%E5%85%AC%E9%92%A5%E5%AF%B9%E4%BF%9D%E5%AD%98%E5%9C%A8keystore%E4%B8%AD%0A++++CBasicKeyStore+keystore%3B%0A++++const+UniValue%26amp%3B+keys+%3D+request.params%5B1%5D.get_array%28%29%3B%0A++++for+%28unsigned+int+idx+%3D+0%3B+idx+%26lt%3B+keys.size%28%29%3B+%2B%2Bidx%29+%7B%0A++++++++UniValue+k+%3D+keys%5Bidx%5D%3B%0A++++++++CKey+key+%3D+DecodeSecret%28k.get_str%28%29%29%3B%0A++++++++if+%28%21key.IsValid%28%29%29+%7B%0A++++++++++++throw+JSONRPCError%28RPC_INVALID_ADDRESS_OR_KEY%2C+%22Invalid+private+key%22%29%3B%0A++++++++%7D%0A++++++++keystore.AddKey%28key%29%3B%0A++++%7D%0A%0A++++%2F%2F%E5%AF%B9%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%EF%BC%8C%E7%94%9F%E6%88%90%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%ACscriptSig%0A++++return+SignTransaction%28mtx%2C+request.params%5B2%5D%2C+%26amp%3Bkeystore%2C+true%2C+request.params%5B3%5D%29%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%AD%E4%BB%8E%E6%8F%90%E4%BE%9B%E7%9A%84%E7%A7%81%E9%92%A5%E5%BE%97%E5%88%B0%E5%AF%B9%E5%BA%94%E7%9A%84%E5%85%AC%E9%92%A5%EF%BC%8C%E7%84%B6%E5%90%8E%E5%B0%86%E7%A7%81%E9%92%A5-%E5%85%AC%E9%92%A5%E7%9A%84%E9%85%8D%E5%AF%B9%E5%AD%98%E6%94%BE%E5%9C%A8keystore%E4%B8%AD%EF%BC%8C%E6%96%B9%E4%BE%BF%E5%90%8E%E7%BB%AD%E8%BF%9B%E8%A1%8C%E6%A3%80%E7%B4%A2%E3%80%82%E7%9C%9F%E6%AD%A3%E7%9A%84%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%E6%98%AF%E5%9C%A8SignTransaction%E4%B8%AD%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3EUniValue+SignTransaction%28CMutableTransaction%26amp%3B+mtx%2C+const+UniValue%26amp%3B+prevTxsUnival%2C+CBasicKeyStore+*keystore%2C+bool+is_temp_keystore%2C+const+UniValue%26amp%3B+hashType%29%0A%7B%0A++++%2F%2F+Fetch+previous+transactions+%28inputs%29%3A%0A++++CCoinsView+viewDummy%3B%0A++++CCoinsViewCache+view%28%26amp%3BviewDummy%29%3B%0A++++%7B%0A++++++++LOCK2%28cs_main%2C+mempool.cs%29%3B%0A++++++++CCoinsViewCache+%26amp%3BviewChain+%3D+*pcoinsTip%3B%0A++++++++CCoinsViewMemPool+viewMempool%28%26amp%3BviewChain%2C+mempool%29%3B%0A++++++++view.SetBackend%28viewMempool%29%3B+%2F%2F+temporarily+switch+cache+backend+to+db%2Bmempool+view%0A%0A++++++++for+%28const+CTxIn%26amp%3B+txin+%3A+mtx.vin%29+%7B%0A++++++++++++view.AccessCoin%28txin.prevout%29%3B+%2F%2F+Load+entries+from+viewChain+into+view%3B+can+fail.%0A++++++++%7D%0A%0A++++++++view.SetBackend%28viewDummy%29%3B+%2F%2F+switch+back+to+avoid+locking+mempool+for+too+long%0A++++%7D%0A%0A++++%2F%2F+Add+previous+txouts+given+in+the+RPC+call%3A%0A++++%2F%2F%E6%9F%A5%E6%89%BE%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E6%8C%87%E5%90%91%E7%9A%84UTXO%E5%B9%B6%E5%8A%A0%E5%85%A5%E5%88%B0%E5%86%85%E5%AD%98%E4%B8%AD%0A++++if+%28%21prevTxsUnival.isNull%28%29%29+%7B%0A++++++++UniValue+prevTxs+%3D+prevTxsUnival.get_array%28%29%3B%0A++++++++for+%28unsigned+int+idx+%3D+0%3B+idx+%26lt%3B+prevTxs.size%28%29%3B+%2B%2Bidx%29+%7B%0A++++++++++++const+UniValue%26amp%3B+p+%3D+prevTxs%5Bidx%5D%3B%0A++++++++++++if+%28%21p.isObject%28%29%29+%7B%0A++++++++++++++++throw+JSONRPCError%28RPC_DESERIALIZATION_ERROR%2C+%22expected+object+with+%7B%5C%22txid%27%5C%22%2C%5C%22vout%5C%22%2C%5C%22scriptPubKey%5C%22%7D%22%29%3B%0A++++++++++++%7D%0A%0A++++++++++++UniValue+prevOut+%3D+p.get_obj%28%29%3B%0A%0A++++++++++++%2F%2F%E5%8F%82%E6%95%B0%E6%A3%80%E6%9F%A5%0A++++++++++++RPCTypeCheckObj%28prevOut%2C%0A++++++++++++++++++++++++++++%7B%0A++++++++++++++++++++++++++++++++++++%7B%22txid%22%2C+UniValueType%28UniValue%3A%3AVSTR%29%7D%2C%0A++++++++++++++++++++++++++++++++++++%7B%22vout%22%2C+UniValueType%28UniValue%3A%3AVNUM%29%7D%2C%0A++++++++++++++++++++++++++++++++++++%7B%22scriptPubKey%22%2C+UniValueType%28UniValue%3A%3AVSTR%29%7D%2C%0A++++++++++++++++++++++++++++%7D%29%3B%0A++++++++++++%2F%2F%E4%BB%8E%E5%8F%82%E6%95%B0%E4%B8%AD%E5%BE%97%E5%88%B0txid%E5%92%8Cvout%EF%BC%8C%E7%94%9F%E6%88%90COutPoint%E6%8C%87%E5%90%91%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E5%BC%95%E7%94%A8%E7%9A%84UTXO%0A++++++++++++uint256+txid+%3D+ParseHashO%28prevOut%2C+%22txid%22%29%3B%0A%0A++++++++++++int+nOut+%3D+find_value%28prevOut%2C+%22vout%22%29.get_int%28%29%3B%0A++++++++++++if+%28nOut+%26lt%3B+0%29+%7B%0A++++++++++++++++throw+JSONRPCError%28RPC_DESERIALIZATION_ERROR%2C+%22vout+must+be+positive%22%29%3B%0A++++++++++++%7D%0A%0A++++++++++++COutPoint+out%28txid%2C+nOut%29%3B%0A%0A++++++++++++%2F%2F%E8%A7%A3%E6%9E%90%E5%8F%82%E6%95%B0%EF%BC%8C%E5%BE%97%E5%88%B0%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E6%8C%87%E5%90%91%E7%9A%84UTXO%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%0A++++++++++++std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B+pkData%28ParseHexO%28prevOut%2C+%22scriptPubKey%22%29%29%3B%0A++++++++++++CScript+scriptPubKey%28pkData.begin%28%29%2C+pkData.end%28%29%29%3B%0A%0A++++++++++++%2F%2F%E6%9F%A5%E6%89%BE%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E6%8C%87%E5%90%91%E7%9A%84UTXO%0A++++++++++++%7B%0A++++++++++++++++const+Coin%26amp%3B+coin+%3D+view.AccessCoin%28out%29%3B%0A++++++++++++++++if+%28%21coin.IsSpent%28%29+%26amp%3B%26amp%3B+coin.out.scriptPubKey+%21%3D+scriptPubKey%29+%7B%0A++++++++++++++++++++std%3A%3Astring+err%28%22Previous+output+scriptPubKey+mismatch%3A%5Cn%22%29%3B%0A++++++++++++++++++++err+%3D+err+%2B+ScriptToAsmStr%28coin.out.scriptPubKey%29+%2B+%22%5Cnvs%3A%5Cn%22%2B%0A++++++++++++++++++++++++++ScriptToAsmStr%28scriptPubKey%29%3B%0A++++++++++++++++++++throw+JSONRPCError%28RPC_DESERIALIZATION_ERROR%2C+err%29%3B%0A++++++++++++++++%7D%0A++++++++++++++++Coin+newcoin%3B%0A++++++++++++++++newcoin.out.scriptPubKey+%3D+scriptPubKey%3B%0A++++++++++++++++newcoin.out.nValue+%3D+0%3B%0A++++++++++++++++if+%28prevOut.exists%28%22amount%22%29%29+%7B%0A++++++++++++++++++++newcoin.out.nValue+%3D+AmountFromValue%28find_value%28prevOut%2C+%22amount%22%29%29%3B%0A++++++++++++++++%7D%0A++++++++++++++++newcoin.nHeight+%3D+1%3B%0A++++++++++++++++view.AddCoin%28out%2C+std%3A%3Amove%28newcoin%29%2C+true%29%3B%0A++++++++++++%7D%0A%0A++++++++++++%2F%2F+if+redeemScript+given+and+not+using+the+local+wallet+%28private+keys%0A++++++++++++%2F%2F+given%29%2C+add+redeemScript+to+the+keystore+so+it+can+be+signed%3A%0A++++++++++++%2F%2F%E5%A6%82%E6%9E%9C%E6%98%AFP2SH%E6%88%96%E8%80%85P2WSH%E4%BA%A4%E6%98%93%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%8C%87%E5%AE%9A%E4%BA%86%E8%B5%8E%E5%9B%9E%E8%84%9A%E6%9C%AC%E4%B9%9F%E9%9C%80%E8%A6%81%E5%8A%A0%E5%85%A5%E5%88%B0keystore%E4%B8%AD%0A++++++++++++if+%28is_temp_keystore+%26amp%3B%26amp%3B+%28scriptPubKey.IsPayToScriptHash%28%29+%7C%7C+scriptPubKey.IsPayToWitnessScriptHash%28%29%29%29+%7B%0A++++++++++++++++RPCTypeCheckObj%28prevOut%2C%0A++++++++++++++++++++++++++++++++%7B%0A++++++++++++++++++++++++++++++++++++++++%7B%22redeemScript%22%2C+UniValueType%28UniValue%3A%3AVSTR%29%7D%2C%0A++++++++++++++++++++++++++++++++%7D%29%3B%0A++++++++++++++++UniValue+v+%3D+find_value%28prevOut%2C+%22redeemScript%22%29%3B%0A++++++++++++++++if+%28%21v.isNull%28%29%29+%7B%0A++++++++++++++++++++std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B+rsData%28ParseHexV%28v%2C+%22redeemScript%22%29%29%3B%0A++++++++++++++++++++CScript+redeemScript%28rsData.begin%28%29%2C+rsData.end%28%29%29%3B%0A++++++++++++++++++++keystore-%26gt%3BAddCScript%28redeemScript%29%3B%0A++++++++++++++++++++%2F%2F+Automatically+also+add+the+P2WSH+wrapped+version+of+the+script+%28to+deal+with+P2SH-P2WSH%29.%0A++++++++++++++++++++keystore-%26gt%3BAddCScript%28GetScriptForWitness%28redeemScript%29%29%3B%0A++++++++++++++++%7D%0A++++++++++++%7D%0A++++++++%7D%0A++++%7D%0A%0A++++%2F%2F%E8%A7%A3%E6%9E%90hashtype%0A++++int+nHashType+%3D+SIGHASH_ALL%3B%0A++++if+%28%21hashType.isNull%28%29%29+%7B%0A++++++++static+std%3A%3Amap%26lt%3Bstd%3A%3Astring%2C+int%26gt%3B+mapSigHashValues+%3D+%7B%0A++++++++++++++++%7Bstd%3A%3Astring%28%22ALL%22%29%2C+int%28SIGHASH_ALL%29%7D%2C%0A++++++++++++++++%7Bstd%3A%3Astring%28%22ALL%7CANYONECANPAY%22%29%2C+int%28SIGHASH_ALL%7CSIGHASH_ANYONECANPAY%29%7D%2C%0A++++++++++++++++%7Bstd%3A%3Astring%28%22NONE%22%29%2C+int%28SIGHASH_NONE%29%7D%2C%0A++++++++++++++++%7Bstd%3A%3Astring%28%22NONE%7CANYONECANPAY%22%29%2C+int%28SIGHASH_NONE%7CSIGHASH_ANYONECANPAY%29%7D%2C%0A++++++++++++++++%7Bstd%3A%3Astring%28%22SINGLE%22%29%2C+int%28SIGHASH_SINGLE%29%7D%2C%0A++++++++++++++++%7Bstd%3A%3Astring%28%22SINGLE%7CANYONECANPAY%22%29%2C+int%28SIGHASH_SINGLE%7CSIGHASH_ANYONECANPAY%29%7D%2C%0A++++++++%7D%3B%0A++++++++std%3A%3Astring+strHashType+%3D+hashType.get_str%28%29%3B%0A++++++++if+%28mapSigHashValues.count%28strHashType%29%29+%7B%0A++++++++++++nHashType+%3D+mapSigHashValues%5BstrHashType%5D%3B%0A++++++++%7D+else+%7B%0A++++++++++++throw+JSONRPCError%28RPC_INVALID_PARAMETER%2C+%22Invalid+sighash+param%22%29%3B%0A++++++++%7D%0A++++%7D%0A%0A++++bool+fHashSingle+%3D+%28%28nHashType+%26amp%3B+%7ESIGHASH_ANYONECANPAY%29+%3D%3D+SIGHASH_SINGLE%29%3B%0A%0A++++%2F%2F+Script+verification+errors%0A++++UniValue+vErrors%28UniValue%3A%3AVARR%29%3B%0A%0A++++%2F%2F+Use+CTransaction+for+the+constant+parts+of+the%0A++++%2F%2F+transaction+to+avoid+rehashing.%0A++++const+CTransaction+txConst%28mtx%29%3B%0A++++%2F%2F+Sign+what+we+can%3A%0A++++%2F%2F%E5%AF%B9%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%94%9F%E6%88%90%E7%AD%BE%E5%90%8D%0A++++for+%28unsigned+int+i+%3D+0%3B+i+%26lt%3B+mtx.vin.size%28%29%3B+i%2B%2B%29+%7B%0A++++++++%2F%2F%E6%89%BE%E5%88%B0%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E6%8C%87%E5%90%91%E7%9A%84UTXO%0A++++++++CTxIn%26amp%3B+txin+%3D+mtx.vin%5Bi%5D%3B%0A++++++++const+Coin%26amp%3B+coin+%3D+view.AccessCoin%28txin.prevout%29%3B%0A++++++++if+%28coin.IsSpent%28%29%29+%7B%0A++++++++++++TxInErrorToJSON%28txin%2C+vErrors%2C+%22Input+not+found+or+already+spent%22%29%3B%0A++++++++++++continue%3B%0A++++++++%7D%0A++++++++%2F%2F%E6%8B%BF%E5%88%B0%E8%BE%93%E5%85%A5%E6%8C%87%E5%90%91%E7%9A%84UTXO%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%0A++++++++const+CScript%26amp%3B+prevPubKey+%3D+coin.out.scriptPubKey%3B%0A++++++++const+CAmount%26amp%3B+amount+%3D+coin.out.nValue%3B%0A%0A++++++++SignatureData+sigdata%3B%0A++++++++%2F%2F+Only+sign+SIGHASH_SINGLE+if+there%27s+a+corresponding+output%3A%0A%0A++++++++%2F%2F%E7%94%9F%E6%88%90%E4%BA%A4%E6%98%93%E7%9A%84%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%EF%BC%8C%E5%AD%98%E6%94%BE%E5%9C%A8sigdata%E4%B8%AD%0A++++++++if+%28%21fHashSingle+%7C%7C+%28i+%26lt%3B+mtx.vout.size%28%29%29%29+%7B%0A++++++++++++ProduceSignature%28*keystore%2C+MutableTransactionSignatureCreator%28%26amp%3Bmtx%2C+i%2C+amount%2C+nHashType%29%2C+prevPubKey%2C+sigdata%29%3B%0A++++++++%7D%0A++++++++sigdata+%3D+CombineSignatures%28prevPubKey%2C+TransactionSignatureChecker%28%26amp%3BtxConst%2C+i%2C+amount%29%2C+sigdata%2C+DataFromTransaction%28mtx%2C+i%29%29%3B%0A%0A++++++++%2F%2F%E5%B0%86%E7%94%9F%E6%88%90%E7%9A%84%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%E5%A1%AB%E5%85%85%E5%88%B0%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E4%B8%AD%0A++++++++UpdateTransaction%28mtx%2C+i%2C+sigdata%29%3B%0A%0A++++++++ScriptError+serror+%3D+SCRIPT_ERR_OK%3B%0A++++++++%2F%2F%E8%84%9A%E6%9C%AC%E6%A0%A1%E9%AA%8C%0A++++++++if+%28%21VerifyScript%28txin.scriptSig%2C+prevPubKey%2C+%26amp%3Btxin.scriptWitness%2C+STANDARD_SCRIPT_VERIFY_FLAGS%2C+TransactionSignatureChecker%28%26amp%3BtxConst%2C+i%2C+amount%29%2C+%26amp%3Bserror%29%29+%7B%0A++++++++++++if+%28serror+%3D%3D+SCRIPT_ERR_INVALID_STACK_OPERATION%29+%7B%0A++++++++++++++++%2F%2F+Unable+to+sign+input+and+verification+failed+%28possible+attempt+to+partially+sign%29.%0A++++++++++++++++TxInErrorToJSON%28txin%2C+vErrors%2C+%22Unable+to+sign+input%2C+invalid+stack+size+%28possibly+missing+key%29%22%29%3B%0A++++++++++++%7D+else+%7B%0A++++++++++++++++TxInErrorToJSON%28txin%2C+vErrors%2C+ScriptErrorString%28serror%29%29%3B%0A++++++++++++%7D%0A++++++++%7D%0A++++%7D%0A++++bool+fComplete+%3D+vErrors.empty%28%29%3B%0A%0A++++UniValue+result%28UniValue%3A%3AVOBJ%29%3B%0A++++result.pushKV%28%22hex%22%2C+EncodeHexTx%28mtx%29%29%3B%0A++++result.pushKV%28%22complete%22%2C+fComplete%29%3B%0A++++if+%28%21vErrors.empty%28%29%29+%7B%0A++++++++result.pushKV%28%22errors%22%2C+vErrors%29%3B%0A++++%7D%0A%0A++++return+result%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%A6%82%E6%9E%9C%E6%8A%9B%E5%BC%80%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%BB%E8%A6%81%E5%81%9A%E7%9A%84%E5%85%B6%E5%AE%9E%E5%B0%B1%E6%98%AF%E4%B8%A4%E4%BB%B6%E4%BA%8B%EF%BC%9A%E4%B8%BA%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%94%9F%E6%88%90%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%E4%BB%A5%E5%8F%8A%E6%A0%A1%E9%AA%8C%E8%84%9A%E6%9C%AC%E3%80%82%3C%2Fp%3E+%0A++%3Ch3%3E4.3.1+%E4%B8%BA%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%94%9F%E6%88%90%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%3C%2Fh3%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E7%BB%99%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%94%9F%E6%88%90%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%E6%98%AF%E5%9C%A8ProduceSignature%E6%96%B9%E6%B3%95%E4%B8%AD%E8%BF%9B%E8%A1%8C%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Ebool+ProduceSignature%28const+SigningProvider%26amp%3B+provider%2C+const+BaseSignatureCreator%26amp%3B+creator%2C+const+CScript%26amp%3B+fromPubKey%2C+SignatureData%26amp%3B+sigdata%29%0A%7B%0A++++std%3A%3Avector%26lt%3Bvaltype%26gt%3B+result%3B%0A++++txnouttype+whichType%3B%0A++++%2F%2F%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%0A++++bool+solved+%3D+SignStep%28provider%2C+creator%2C+fromPubKey%2C+result%2C+whichType%2C+SigVersion%3A%3ABASE%29%3B%0A++++bool+P2SH+%3D+false%3B%0A++++CScript+subscript%3B%0A++++sigdata.scriptWitness.stack.clear%28%29%3B%0A%0A++++%2F%2FP2SH%E4%BA%A4%E6%98%93%EF%BC%8C%E9%9C%80%E8%A6%81%E5%AF%B9%E5%AD%90%E8%84%9A%E6%9C%AC%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%0A++++if+%28solved+%26amp%3B%26amp%3B+whichType+%3D%3D+TX_SCRIPTHASH%29%0A++++%7B%0A++++++++%2F%2F+Solver+returns+the+subscript+that+needs+to+be+evaluated%3B%0A++++++++%2F%2F+the+final+scriptSig+is+the+signatures+from+that%0A++++++++%2F%2F+and+then+the+serialized+subscript%3A%0A++++++++subscript+%3D+CScript%28result%5B0%5D.begin%28%29%2C+result%5B0%5D.end%28%29%29%3B%0A++++++++solved+%3D+solved+%26amp%3B%26amp%3B+SignStep%28provider%2C+creator%2C+subscript%2C+result%2C+whichType%2C+SigVersion%3A%3ABASE%29+%26amp%3B%26amp%3B+whichType+%21%3D+TX_SCRIPTHASH%3B%0A++++++++P2SH+%3D+true%3B%0A++++%7D%0A%0A++++%2F%2FP2WKH%E4%BA%A4%E6%98%93%EF%BC%8C%E9%9C%80%E8%A6%81%E5%AF%B9%E8%A7%81%E8%AF%81%E8%84%9A%E6%9C%AC%E7%AD%BE%E5%90%8D%0A++++if+%28solved+%26amp%3B%26amp%3B+whichType+%3D%3D+TX_WITNESS_V0_KEYHASH%29%0A++++%7B%0A++++++++CScript+witnessscript%3B%0A++++++++witnessscript+%26lt%3B%26lt%3B+OP_DUP+%26lt%3B%26lt%3B+OP_HASH160+%26lt%3B%26lt%3B+ToByteVector%28result%5B0%5D%29+%26lt%3B%26lt%3B+OP_EQUALVERIFY+%26lt%3B%26lt%3B+OP_CHECKSIG%3B%0A++++++++txnouttype+subType%3B%0A++++++++solved+%3D+solved+%26amp%3B%26amp%3B+SignStep%28provider%2C+creator%2C+witnessscript%2C+result%2C+subType%2C+SigVersion%3A%3AWITNESS_V0%29%3B%0A++++++++sigdata.scriptWitness.stack+%3D+result%3B%0A++++++++result.clear%28%29%3B%0A++++%7D%0A++++%2F%2FP2WSH%E4%BA%A4%E6%98%93%0A++++else+if+%28solved+%26amp%3B%26amp%3B+whichType+%3D%3D+TX_WITNESS_V0_SCRIPTHASH%29%0A++++%7B%0A++++++++CScript+witnessscript%28result%5B0%5D.begin%28%29%2C+result%5B0%5D.end%28%29%29%3B%0A++++++++txnouttype+subType%3B%0A++++++++solved+%3D+solved+%26amp%3B%26amp%3B+SignStep%28provider%2C+creator%2C+witnessscript%2C+result%2C+subType%2C+SigVersion%3A%3AWITNESS_V0%29+%26amp%3B%26amp%3B+subType+%21%3D+TX_SCRIPTHASH+%26amp%3B%26amp%3B+subType+%21%3D+TX_WITNESS_V0_SCRIPTHASH+%26amp%3B%26amp%3B+subType+%21%3D+TX_WITNESS_V0_KEYHASH%3B%0A++++++++result.push_back%28std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B%28witnessscript.begin%28%29%2C+witnessscript.end%28%29%29%29%3B%0A++++++++sigdata.scriptWitness.stack+%3D+result%3B%0A++++++++result.clear%28%29%3B%0A++++%7D%0A%0A++++if+%28P2SH%29+%7B%0A++++++++result.push_back%28std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B%28subscript.begin%28%29%2C+subscript.end%28%29%29%29%3B%0A++++%7D%0A++++%0A++++%2F%2F%E5%B0%86%E7%94%9F%E6%88%90%E7%9A%84%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%E5%86%99%E5%85%A5%E5%88%B0sigdata%E4%B8%AD%0A++++sigdata.scriptSig+%3D+PushAll%28result%29%3B%0A%0A++++%2F%2F+%E6%A0%A1%E9%AA%8C%E8%84%9A%E6%9C%AC%0A++++return+solved+%26amp%3B%26amp%3B+VerifyScript%28sigdata.scriptSig%2C+fromPubKey%2C+%26amp%3Bsigdata.scriptWitness%2C+STANDARD_SCRIPT_VERIFY_FLAGS%2C+creator.Checker%28%29%29%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%85%88%E6%9D%A5%E7%9C%8B%E7%9C%8B%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0%EF%BC%9Aprovider%EF%BC%9Akeystore%EF%BC%8C%E5%AD%98%E6%94%BE%E4%BA%86%E5%85%AC%E9%92%A5-%E7%A7%81%E9%92%A5%E9%85%8D%E5%AF%B9%EF%BC%8C%E4%B9%8B%E5%89%8D%E7%9A%84%E4%BB%A3%E7%A0%81%E4%B8%AD%E5%B7%B2%E7%BB%8F%E6%8F%90%E5%88%B0%E8%BF%87%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+creator%EF%BC%9ABaseSignatureCreator%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%AE%9E%E4%BE%8B%EF%BC%8C%E7%94%A8%E4%BA%8E%E6%9C%80%E5%90%8E%E5%AF%B9%E4%BA%A4%E6%98%93%E7%94%9F%E6%88%90%E7%AD%BE%E5%90%8D%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+fromPubKey%EF%BC%9ACScript%E7%B1%BB%E5%9E%8B%EF%BC%8C%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E5%BC%95%E7%94%A8%E7%9A%84UTXO%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+sigData%EF%BC%9ASignatureData%E7%B1%BB%E5%9E%8B%EF%BC%8C%E6%98%AF%E8%BE%93%E5%87%BA%E5%8F%82%E6%95%B0%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%AD%98%E6%94%BE%E7%94%9F%E6%88%90%E7%9A%84%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%83%8F%E6%B4%8B%E8%91%B1%E4%B8%80%E6%A0%B7%E4%B8%80%E5%B1%82%E5%8F%88%E4%B8%80%E5%B1%82%E5%90%8E%EF%BC%8C%E6%9C%80%E7%BB%88%E5%AF%B9%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E5%AE%8C%E6%88%90%E7%AD%BE%E5%90%8D%E7%9A%84%E6%98%AFSignStep%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3E%2F**%0A+*+Sign+scriptPubKey+using+signature+made+with+creator.%0A+*+Signatures+are+returned+in+scriptSigRet+%28or+returns+false+if+scriptPubKey+can%27t+be+signed%29%2C%0A+*+unless+whichTypeRet+is+TX_SCRIPTHASH%2C+in+which+case+scriptSigRet+is+the+redemption+script.%0A+*+Returns+false+if+scriptPubKey+could+not+be+completely+satisfied.%0A+*%2F%0Astatic+bool+SignStep%28const+SigningProvider%26amp%3B+provider%2C+const+BaseSignatureCreator%26amp%3B+creator%2C+const+CScript%26amp%3B+scriptPubKey%2C%0A+++++++++++++++++++++std%3A%3Avector%26lt%3Bvaltype%26gt%3B%26amp%3B+ret%2C+txnouttype%26amp%3B+whichTypeRet%2C+SigVersion+sigversion%29%0A%7B%0A++++CScript+scriptRet%3B%0A++++uint160+h160%3B%0A++++ret.clear%28%29%3B%0A%0A++++std%3A%3Avector%26lt%3Bvaltype%26gt%3B+vSolutions%3B%0A++++%2F%2F%E8%A7%A3%E6%9E%90%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E5%BC%95%E7%94%A8%E7%9A%84UTXO%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%EF%BC%8C%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E7%9A%84%E7%B1%BB%E5%9E%8B%E5%AD%98%E5%9C%A8%E8%BE%93%E5%87%BA%E5%8F%82%E6%95%B0whichTypeRet%E4%B8%AD%EF%BC%8C%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E6%94%BE%E5%9C%A8%E5%90%91%E9%87%8FvSolutions%E4%B8%AD%0A++++if+%28%21Solver%28scriptPubKey%2C+whichTypeRet%2C+vSolutions%29%29%0A++++++++return+false%3B%0A%0A++++CKeyID+keyID%3B%0A++++%2F%2F%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%89%A7%E8%A1%8C%E7%AD%BE%E5%90%8D%0A++++switch+%28whichTypeRet%29%0A++++%7B%0A++++++++case+TX_NONSTANDARD%3A%0A++++++++case+TX_NULL_DATA%3A%0A++++++++case+TX_WITNESS_UNKNOWN%3A%0A++++++++++++return+false%3B%0A++++++++case+TX_PUBKEY%3A+++++%2F%2F%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E6%98%AFP2PK%E7%B1%BB%E5%9E%8B%0A++++++++++++keyID+%3D+CPubKey%28vSolutions%5B0%5D%29.GetID%28%29%3B%0A++++++++++++return+Sign1%28provider%2C+keyID%2C+creator%2C+scriptPubKey%2C+ret%2C+sigversion%29%3B%0A++++++++case+TX_PUBKEYHASH%3A+%2F%2F%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E6%98%AFP2PKH%E7%B1%BB%E5%9E%8B%0A++++++++++++keyID+%3D+CKeyID%28uint160%28vSolutions%5B0%5D%29%29%3B%0A++++++++++++if+%28%21Sign1%28provider%2C+keyID%2C+creator%2C+scriptPubKey%2C+ret%2C+sigversion%29%29%0A++++++++++++++++return+false%3B%0A++++++++++++else%0A++++++++++++%7B%0A++++++++++++++++CPubKey+vch%3B%0A++++++++++++++++provider.GetPubKey%28keyID%2C+vch%29%3B%0A++++++++++++++++ret.push_back%28ToByteVector%28vch%29%29%3B%0A++++++++++++%7D%0A++++++++++++return+true%3B%0A++++++++case+TX_SCRIPTHASH%3A++++%2F%2F%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E6%98%AFP2SH%E7%B1%BB%E5%9E%8B%0A++++++++++++if+%28provider.GetCScript%28uint160%28vSolutions%5B0%5D%29%2C+scriptRet%29%29+%7B%0A++++++++++++++++ret.push_back%28std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B%28scriptRet.begin%28%29%2C+scriptRet.end%28%29%29%29%3B%0A++++++++++++++++return+true%3B%0A++++++++++++%7D%0A++++++++++++return+false%3B%0A%0A++++++++case+TX_MULTISIG%3A++++%2F%2F%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E6%98%AFMultiSig%EF%BC%88%E5%A4%9A%E9%87%8D%E7%AD%BE%E5%90%8D%EF%BC%89%0A++++++++++++ret.push_back%28valtype%28%29%29%3B+%2F%2F+workaround+CHECKMULTISIG+bug%0A++++++++++++return+%28SignN%28provider%2C+vSolutions%2C+creator%2C+scriptPubKey%2C+ret%2C+sigversion%29%29%3B%0A%0A++++++++case+TX_WITNESS_V0_KEYHASH%3A++++%2F%2F%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E6%98%AFP2WKH%E7%B1%BB%E5%9E%8B%0A++++++++++++ret.push_back%28vSolutions%5B0%5D%29%3B%0A++++++++++++return+true%3B%0A%0A++++++++case+TX_WITNESS_V0_SCRIPTHASH%3A++++%2F%2F%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E6%98%AFP2WSH%E7%B1%BB%E5%9E%8B%0A++++++++++++CRIPEMD160%28%29.Write%28%26amp%3BvSolutions%5B0%5D%5B0%5D%2C+vSolutions%5B0%5D.size%28%29%29.Finalize%28h160.begin%28%29%29%3B%0A++++++++++++if+%28provider.GetCScript%28h160%2C+scriptRet%29%29+%7B%0A++++++++++++++++ret.push_back%28std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B%28scriptRet.begin%28%29%2C+scriptRet.end%28%29%29%29%3B%0A++++++++++++++++return+true%3B%0A++++++++++++%7D%0A++++++++++++return+false%3B%0A%0A++++++++default%3A%0A++++++++++++return+false%3B%0A++++%7D%0A%7D%0A%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E9%A6%96%E5%85%88%E6%98%AF%E8%A7%A3%E6%9E%90%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E5%BC%95%E7%94%A8%E7%9A%84UTXO%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%EF%BC%8C%E7%84%B6%E5%90%8E%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E7%B1%BB%E5%9E%8B%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%E3%80%82%E6%AD%A4%E5%A4%84%E6%88%91%E4%BB%AC%E4%BB%A5%E6%9C%80%E5%B8%B8%E8%A7%81%E7%9A%84P2PKH%E4%BA%A4%E6%98%93%E6%9D%A5%E4%BD%9C%E4%B8%BA%E4%BE%8B%E5%AD%90%EF%BC%8C%E5%85%B6%E4%BB%96%E7%9A%84%E4%BA%A4%E6%98%93%E7%B1%BB%E5%9E%8B%E5%8E%9F%E7%90%86%E5%B7%AE%E4%B8%8D%E5%A4%9A%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%281%29+%E8%A7%A3%E6%9E%90%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%85%88%E6%9D%A5%E8%BF%87%E4%B8%8B%E6%BA%90%E7%A0%81%EF%BC%8C%E7%9C%8B%E7%9C%8B%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E6%98%AF%E5%A6%82%E4%BD%95%E8%A7%A3%E6%9E%90%E7%9A%84%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Ebool+Solver%28const+CScript%26amp%3B+scriptPubKey%2C+txnouttype%26amp%3B+typeRet%2C+std%3A%3Avector%26lt%3Bstd%3A%3Avector%26lt%3Bunsigned+char%26gt%3B+%26gt%3B%26amp%3B+vSolutionsRet%29%0A%7B%0A++++%2F%2F+Templates%0A++++%2F%2FP2PK%2FP2PKH%2FMULTISIG%E4%BA%A4%E6%98%93%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E6%A8%A1%E6%9D%BF%0A++++static+std%3A%3Amultimap%26lt%3Btxnouttype%2C+CScript%26gt%3B+mTemplates%3B%0A++++if+%28mTemplates.empty%28%29%29%0A++++%7B%0A++++++++%2F%2F+Standard+tx%2C+sender+provides+pubkey%2C+receiver+adds+signature%0A++++++++mTemplates.insert%28std%3A%3Amake_pair%28TX_PUBKEY%2C+CScript%28%29+%26lt%3B%26lt%3B+OP_PUBKEY+%26lt%3B%26lt%3B+OP_CHECKSIG%29%29%3B%0A%0A++++++++%2F%2F+Bitcoin+address+tx%2C+sender+provides+hash+of+pubkey%2C+receiver+provides+signature+and+pubkey%0A++++++++mTemplates.insert%28std%3A%3Amake_pair%28TX_PUBKEYHASH%2C+CScript%28%29+%26lt%3B%26lt%3B+OP_DUP+%26lt%3B%26lt%3B+OP_HASH160+%26lt%3B%26lt%3B+OP_PUBKEYHASH+%26lt%3B%26lt%3B+OP_EQUALVERIFY+%26lt%3B%26lt%3B+OP_CHECKSIG%29%29%3B%0A%0A++++++++%2F%2F+Sender+provides+N+pubkeys%2C+receivers+provides+M+signatures%0A++++++++mTemplates.insert%28std%3A%3Amake_pair%28TX_MULTISIG%2C+CScript%28%29+%26lt%3B%26lt%3B+OP_SMALLINTEGER+%26lt%3B%26lt%3B+OP_PUBKEYS+%26lt%3B%26lt%3B+OP_SMALLINTEGER+%26lt%3B%26lt%3B+OP_CHECKMULTISIG%29%29%3B%0A++++%7D%0A%0A++++vSolutionsRet.clear%28%29%3B%0A%0A++++%2F%2F+Shortcut+for+pay-to-script-hash%2C+which+are+more+constrained+than+the+other+types%3A%0A++++%2F%2F+it+is+always+OP_HASH160+20+%5B20+byte+hash%5D+OP_EQUAL%0A++++%2F%2F%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E6%98%AFP2SH%E7%B1%BB%E5%9E%8B%EF%BC%8C%E8%BF%99%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E7%9A%84%E6%A0%BC%E5%BC%8F%EF%BC%9AOP_HASH160+20+%5B20+byte+hash%5D+OP_EQUAL%EF%BC%8C%E8%84%9A%E6%9C%AC%E4%B8%AD2-22%E4%B8%BA20%E5%AD%97%E8%8A%82%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%94%BE%E5%88%B0vSolutionsRet%E4%B8%AD%0A++++if+%28scriptPubKey.IsPayToScriptHash%28%29%29%0A++++%7B%0A++++++++typeRet+%3D+TX_SCRIPTHASH%3B%0A++++++++std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B+hashBytes%28scriptPubKey.begin%28%29%2B2%2C+scriptPubKey.begin%28%29%2B22%29%3B%0A++++++++vSolutionsRet.push_back%28hashBytes%29%3B%0A++++++++return+true%3B%0A++++%7D%0A%0A++++%2F%2FP2WKH%2FP2WSH%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%A4%84%E7%90%86%0A++++int+witnessversion%3B%0A++++std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B+witnessprogram%3B%0A++++if+%28scriptPubKey.IsWitnessProgram%28witnessversion%2C+witnessprogram%29%29+%7B%0A++++++++if+%28witnessversion+%3D%3D+0+%26amp%3B%26amp%3B+witnessprogram.size%28%29+%3D%3D+WITNESS_V0_KEYHASH_SIZE%29+%7B%0A++++++++++++typeRet+%3D+TX_WITNESS_V0_KEYHASH%3B%0A++++++++++++vSolutionsRet.push_back%28witnessprogram%29%3B%0A++++++++++++return+true%3B%0A++++++++%7D%0A++++++++if+%28witnessversion+%3D%3D+0+%26amp%3B%26amp%3B+witnessprogram.size%28%29+%3D%3D+WITNESS_V0_SCRIPTHASH_SIZE%29+%7B%0A++++++++++++typeRet+%3D+TX_WITNESS_V0_SCRIPTHASH%3B%0A++++++++++++vSolutionsRet.push_back%28witnessprogram%29%3B%0A++++++++++++return+true%3B%0A++++++++%7D%0A++++++++if+%28witnessversion+%21%3D+0%29+%7B%0A++++++++++++typeRet+%3D+TX_WITNESS_UNKNOWN%3B%0A++++++++++++vSolutionsRet.push_back%28std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B%7B%28unsigned+char%29witnessversion%7D%29%3B%0A++++++++++++vSolutionsRet.push_back%28std%3A%3Amove%28witnessprogram%29%29%3B%0A++++++++++++return+true%3B%0A++++++++%7D%0A++++++++return+false%3B%0A++++%7D%0A%0A++++%2F%2F+Provably+prunable%2C+data-carrying+output%0A++++%2F%2F%0A++++%2F%2F+So+long+as+script+passes+the+IsUnspendable%28%29+test+and+all+but+the+first%0A++++%2F%2F+byte+passes+the+IsPushOnly%28%29+test+we+don%27t+care+what+exactly+is+in+the%0A++++%2F%2F+script.%0A++++if+%28scriptPubKey.size%28%29+%26gt%3B%3D+1+%26amp%3B%26amp%3B+scriptPubKey%5B0%5D+%3D%3D+OP_RETURN+%26amp%3B%26amp%3B+scriptPubKey.IsPushOnly%28scriptPubKey.begin%28%29%2B1%29%29+%7B%0A++++++++typeRet+%3D+TX_NULL_DATA%3B%0A++++++++return+true%3B%0A++++%7D%0A%0A++++%2F%2F+Scan+templates%0A++++%2F%2FP2PKH%2FP2PK%2FMULTISIG%E7%B1%BB%E5%9E%8B%EF%BC%8C%E6%89%AB%E6%8F%8F%E6%A8%A1%E6%9D%BF%E8%BF%9B%E8%A1%8C%E8%A7%A3%E6%9E%90%0A++++const+CScript%26amp%3B+script1+%3D+scriptPubKey%3B%0A++++for+%28const+std%3A%3Apair%26lt%3Btxnouttype%2C+CScript%26gt%3B%26amp%3B+tplate+%3A+mTemplates%29%0A++++%7B%0A++++++++const+CScript%26amp%3B+script2+%3D+tplate.second%3B%0A++++++++vSolutionsRet.clear%28%29%3B%0A%0A++++++++opcodetype+opcode1%2C+opcode2%3B%0A++++++++std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B+vch1%2C+vch2%3B%0A%0A++++++++%2F%2F+Compare%0A++++++++%2F%2Fpc1%E6%8C%87%E5%90%91UTXO%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%EF%BC%8Cpc2%E6%8C%87%E5%90%91%E8%84%9A%E6%9C%AC%E6%A8%A1%E6%9D%BF%0A++++++++CScript%3A%3Aconst_iterator+pc1+%3D+script1.begin%28%29%3B%0A++++++++CScript%3A%3Aconst_iterator+pc2+%3D+script2.begin%28%29%3B%0A++++++++while+%28true%29%0A++++++++%7B%0A++++++++++++%2F%2F%E4%B8%A4%E4%B8%AA%E6%8C%87%E9%92%88%E5%90%8C%E6%97%B6%E5%88%B0%E4%BA%86%E7%BB%93%E5%B0%BE%EF%BC%8C%E5%88%99%E6%89%BE%E5%88%B0%E5%92%8C%E6%A8%A1%E6%9D%BF%E5%8C%B9%E9%85%8D%E7%9A%84%E4%BA%A4%E6%98%93%E7%B1%BB%E5%9E%8B%EF%BC%8C%E8%BF%94%E5%9B%9E%0A++++++++++++if+%28pc1+%3D%3D+script1.end%28%29+%26amp%3B%26amp%3B+pc2+%3D%3D+script2.end%28%29%29%0A++++++++++++%7B%0A++++++++++++++++%2F%2F+Found+a+match%0A++++++++++++++++typeRet+%3D+tplate.first%3B%0A++++++++++++++++if+%28typeRet+%3D%3D+TX_MULTISIG%29%0A++++++++++++++++%7B%0A++++++++++++++++++++%2F%2F+Additional+checks+for+TX_MULTISIG%3A%0A++++++++++++++++++++unsigned+char+m+%3D+vSolutionsRet.front%28%29%5B0%5D%3B%0A++++++++++++++++++++unsigned+char+n+%3D+vSolutionsRet.back%28%29%5B0%5D%3B%0A++++++++++++++++++++if+%28m+%26lt%3B+1+%7C%7C+n+%26lt%3B+1+%7C%7C+m+%26gt%3B+n+%7C%7C+vSolutionsRet.size%28%29-2+%21%3D+n%29%0A++++++++++++++++++++++++return+false%3B%0A++++++++++++++++%7D%0A++++++++++++++++return+true%3B%0A++++++++++++%7D%0A++++++++++++%2F%2F%E5%BE%97%E5%88%B0%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%92%8C%E6%93%8D%E4%BD%9C%E6%95%B0%0A++++++++++++if+%28%21script1.GetOp%28pc1%2C+opcode1%2C+vch1%29%29%0A++++++++++++++++break%3B%0A++++++++++++if+%28%21script2.GetOp%28pc2%2C+opcode2%2C+vch2%29%29%0A++++++++++++++++break%3B%0A%0A++++++++++++%2F%2F+Template+matching+opcodes%3A%0A++++++++++++%2F%2F%E5%87%A0%E7%A7%8D%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%9A%84%E5%A4%84%E7%90%86%0A++++++++++++if+%28opcode2+%3D%3D+OP_PUBKEYS%29%0A++++++++++++%7B%0A++++++++++++++++while+%28CPubKey%3A%3AValidSize%28vch1%29%29%0A++++++++++++++++%7B%0A++++++++++++++++++++vSolutionsRet.push_back%28vch1%29%3B%0A++++++++++++++++++++if+%28%21script1.GetOp%28pc1%2C+opcode1%2C+vch1%29%29%0A++++++++++++++++++++++++break%3B%0A++++++++++++++++%7D%0A++++++++++++++++if+%28%21script2.GetOp%28pc2%2C+opcode2%2C+vch2%29%29%0A++++++++++++++++++++break%3B%0A++++++++++++++++%2F%2F+Normal+situation+is+to+fall+through%0A++++++++++++++++%2F%2F+to+other+if%2Felse+statements%0A++++++++++++%7D%0A%0A++++++++++++if+%28opcode2+%3D%3D+OP_PUBKEY%29%0A++++++++++++%7B%0A++++++++++++++++if+%28%21CPubKey%3A%3AValidSize%28vch1%29%29%0A++++++++++++++++++++break%3B%0A++++++++++++++++vSolutionsRet.push_back%28vch1%29%3B%0A++++++++++++%7D%0A++++++++++++else+if+%28opcode2+%3D%3D+OP_PUBKEYHASH%29%0A++++++++++++%7B%0A++++++++++++++++if+%28vch1.size%28%29+%21%3D+sizeof%28uint160%29%29%0A++++++++++++++++++++break%3B%0A++++++++++++++++vSolutionsRet.push_back%28vch1%29%3B%0A++++++++++++%7D%0A++++++++++++else+if+%28opcode2+%3D%3D+OP_SMALLINTEGER%29%0A++++++++++++%7B+++%2F%2F+Single-byte+small+integer+pushed+onto+vSolutions%0A++++++++++++++++if+%28opcode1+%3D%3D+OP_0+%7C%7C%0A++++++++++++++++++++%28opcode1+%26gt%3B%3D+OP_1+%26amp%3B%26amp%3B+opcode1+%26lt%3B%3D+OP_16%29%29%0A++++++++++++++++%7B%0A++++++++++++++++++++char+n+%3D+%28char%29CScript%3A%3ADecodeOP_N%28opcode1%29%3B%0A++++++++++++++++++++vSolutionsRet.push_back%28valtype%281%2C+n%29%29%3B%0A++++++++++++++++%7D%0A++++++++++++++++else%0A++++++++++++++++++++break%3B%0A++++++++++++%7D%0A++++++++++++else+if+%28opcode1+%21%3D+opcode2+%7C%7C+vch1+%21%3D+vch2%29%0A++++++++++++%7B%0A++++++++++++++++%2F%2F+Others+must+match+exactly%0A++++++++++++++++break%3B%0A++++++++++++%7D%0A++++++++%7D%0A++++%7D%0A%0A++++vSolutionsRet.clear%28%29%3B%0A++++typeRet+%3D+TX_NONSTANDARD%3B%0A++++return+false%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%B8%8A%E9%9D%A2%E7%9A%84%E4%BB%A3%E7%A0%81%E9%92%88%E5%AF%B9%E4%B8%8D%E5%90%8C%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%9C%89%E4%B8%8D%E5%90%8C%E7%9A%84%E5%A4%84%E7%90%86%EF%BC%8C%E5%AF%B9%E4%BA%8EP2PKH%2FP2PK%2FMULTISIG%EF%BC%8C%E6%98%AF%E9%80%9A%E8%BF%87%E6%A8%A1%E6%9D%BF%E6%9D%A5%E8%BF%9B%E8%A1%8C%E5%8C%B9%E9%85%8D%E5%A4%84%E7%90%86%E7%9A%84%E3%80%82%E7%9C%8B%E4%BB%A3%E7%A0%81%E5%8F%AF%E8%83%BD%E4%B8%8D%E8%83%BD%E4%B8%80%E4%B8%8B%E5%AD%90%E7%90%86%E8%A7%A3%E8%BF%99%E9%87%8C%E7%9A%84%E9%80%BB%E8%BE%91%EF%BC%8C%E7%94%BB%E4%B8%AA%E5%9B%BE%E6%9D%A5%E8%AF%B4%E6%98%8E%E4%B8%80%E4%B8%8B%E4%BC%9A%E9%9D%9E%E5%B8%B8%E6%B8%85%E6%A5%9A%E3%80%82%E4%BB%A5P2PKH%E4%B8%BA%E4%BE%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E9%A6%96%E5%85%88%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180720131747267%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0ZW10X3N3Mg%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E7%84%B6%E5%90%8E%E7%9C%8B%E7%9C%8BUTXO%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E6%98%AF%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84%EF%BC%8C%E5%9B%9E%E9%A1%BE%E4%B9%8B%E5%89%8D%E5%88%9B%E5%BB%BA%E4%BA%A4%E6%98%93%E7%9A%84%E4%BB%A3%E7%A0%81%E4%B8%AD%E4%B8%BA%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%E7%94%9F%E6%88%90%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E7%9A%84%E4%BB%A3%E7%A0%81%EF%BC%88CScriptVisitor%EF%BC%89%EF%BC%8C%E5%AF%B9%E4%BA%8EP2PKH%E7%B1%BB%E5%9E%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Ebool+operator%28%29%28const+CKeyID+%26amp%3BkeyID%29+const+%7B%0A++++++++script-%26gt%3Bclear%28%29%3B%0A++++++++*script+%26lt%3B%26lt%3B+OP_DUP+%26lt%3B%26lt%3B+OP_HASH160+%26lt%3B%26lt%3B+ToByteVector%28keyID%29+%26lt%3B%26lt%3B+OP_EQUALVERIFY+%26lt%3B%26lt%3B+OP_CHECKSIG%3B%0A++++++++return+true%3B%0A++++%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E8%BF%99%E9%87%8C%E8%A6%81%E6%B3%A8%E6%84%8F%E4%B8%8BCScript%E9%87%8D%E8%BD%BD%E7%9A%84%26lt%3B%26lt%3B%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%9A%84%E4%BB%A5vector%E4%B8%BA%E5%8F%82%E6%95%B0%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%8C%E5%85%B6%E4%B8%ADkeyID%E6%98%AF160%E4%BD%8D%E6%97%A0%E7%AC%A6%E5%8F%B7%E6%95%B4%E6%95%B0%EF%BC%8C%E5%8D%A020%E5%AD%97%E8%8A%82%E3%80%82%E6%A0%B9%E6%8D%AECScript%E9%87%8D%E8%BD%BD%E7%9A%84%26lt%3B%26lt%3B%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%8C%E6%9C%80%E7%BB%88%E7%94%9F%E6%88%90%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E7%9A%84%E9%95%BF%E4%B8%8B%E9%9D%A2%E8%BF%99%E6%A0%B7%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180720131937509%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0ZW10X3N3Mg%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B20%E4%BB%A3%E8%A1%A8%E8%84%9A%E6%9C%AC%E4%B8%AD%E9%9A%8F%E5%90%8E%E7%9A%84%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%E6%98%AF20%E5%AD%97%E8%8A%82%E7%9A%84%E5%85%AC%E9%92%A5%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%A0%B9%E6%8D%AE%E4%BB%A3%E7%A0%81%EF%BC%8C%E8%A7%A3%E6%9E%90%E7%9A%84%E6%97%B6%E5%80%99%E5%B0%86%E4%BB%8E%E6%A8%A1%E6%9D%BF%E8%84%9A%E6%9C%AC%E5%92%8C%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E7%9A%84%E5%BC%80%E5%A7%8B%E5%A4%84%E9%80%90%E4%B8%80%E8%A7%A3%E6%9E%90%E6%AF%8F%E4%B8%AA%E6%93%8D%E4%BD%9C%E7%AC%A6%EF%BC%8C%E9%A6%96%E5%85%88OP_DUP%E5%92%8COP_HASH%E4%BB%80%E4%B9%88%E9%83%BD%E4%B8%8D%E5%81%9A%EF%BC%8C%E6%8C%87%E9%92%88%E5%90%91%E5%89%8D%E7%A7%BB%E5%8A%A8%E5%8D%B3%E5%8F%AF%EF%BC%8C%E8%BF%9B%E8%A1%8C%E5%88%B0%E4%B8%8B%E9%9D%A2%E7%9A%84%E7%8A%B6%E6%80%81%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E9%9C%80%E8%A6%81%E7%95%99%E7%A5%9E%E4%BA%86%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180720135057265%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0ZW10X3N3Mg%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%E6%A8%A1%E6%9D%BF%E7%9A%84%E6%8C%87%E9%92%88%E5%A5%BD%E5%A4%84%E7%90%86%EF%BC%8C%E7%9B%B4%E6%8E%A5%E5%89%8D%E7%A7%BB%EF%BC%8C%E4%BD%86%E6%98%AF%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E7%9A%84%E5%A4%84%E7%90%86%E5%B0%B1%E4%B8%8D%E4%B8%80%E6%A0%B7%E4%BA%86%EF%BC%8C%E7%9C%8B%E7%9C%8B%E8%A7%A3%E6%9E%90%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%92%8C%E5%8F%82%E6%95%B0%E7%9A%84%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%B7%B2%E7%BB%8F%E6%A0%B9%E6%8D%AE%E4%BE%8B%E5%AD%90%E5%AF%B9%E4%BB%A3%E7%A0%81%E5%81%9A%E4%BA%86%E6%B3%A8%E9%87%8A%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Ebool+GetScriptOp%28CScriptBase%3A%3Aconst_iterator%26amp%3B+pc%2C+CScriptBase%3A%3Aconst_iterator+end%2C+opcodetype%26amp%3B+opcodeRet%2C+std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B*+pvchRet%29%0A%7B%0A++++opcodeRet+%3D+OP_INVALIDOPCODE%3B%0A++++if+%28pvchRet%29%0A++++++++pvchRet-%26gt%3Bclear%28%29%3B%0A++++if+%28pc+%26gt%3B%3D+end%29%0A++++++++return+false%3B%0A%0A++++%2F%2F+Read+instruction%0A++++if+%28end+-+pc+%26lt%3B+1%29%0A++++++++return+false%3B%0A++++%2F%2F%E5%9C%A8%E6%88%91%E4%BB%AC%E7%9A%84%E4%BE%8B%E5%AD%90%E4%B8%ADopcode%E5%B0%86%E4%BC%9A%E6%98%AF20%EF%BC%8C%E7%84%B6%E5%90%8E%E6%8C%87%E9%92%88%E5%89%8D%E7%A7%BB%E5%88%B0%E4%B8%8B%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%EF%BC%8820%E5%AD%97%E8%8A%82%E7%9A%84%E5%85%AC%E9%92%A5%EF%BC%89%0A++++unsigned+int+opcode+%3D+*pc%2B%2B%3B%0A%0A++++%2F%2F+Immediate+operand%0A++++%2F%2FOP_PUSHDATA4%E7%9A%84%E5%80%BC%E4%B8%BA0x4e%EF%BC%8C%E4%BE%8B%E5%AD%90%E4%B8%ADopcode%E4%B8%BA20%EF%BC%8C%E6%89%80%E4%BB%A5%E8%BF%9B%E5%85%A5%E5%88%86%E6%94%AF%0A++++if+%28opcode+%26lt%3B%3D+OP_PUSHDATA4%29%0A++++%7B%0A++++++++unsigned+int+nSize+%3D+0%3B%0A++++++++%2F%2Fopcode%E4%B8%BA20%EF%BC%8COP_PUSHDATA1%E4%B8%BA0x4c%EF%BC%8C%E8%BF%9B%E5%85%A5%E6%AD%A4%E5%88%86%E6%94%AF%0A++++++++if+%28opcode+%26lt%3B+OP_PUSHDATA1%29%0A++++++++%7B%0A++++++++++++nSize+%3D+opcode%3B%0A++++++++%7D%0A++++++++else+if+%28opcode+%3D%3D+OP_PUSHDATA1%29%0A++++++++%7B%0A++++++++++++if+%28end+-+pc+%26lt%3B+1%29%0A++++++++++++++++return+false%3B%0A++++++++++++nSize+%3D+*pc%2B%2B%3B%0A++++++++%7D%0A++++++++else+if+%28opcode+%3D%3D+OP_PUSHDATA2%29%0A++++++++%7B%0A++++++++++++if+%28end+-+pc+%26lt%3B+2%29%0A++++++++++++++++return+false%3B%0A++++++++++++nSize+%3D+ReadLE16%28%26amp%3Bpc%5B0%5D%29%3B%0A++++++++++++pc+%2B%3D+2%3B%0A++++++++%7D%0A++++++++else+if+%28opcode+%3D%3D+OP_PUSHDATA4%29%0A++++++++%7B%0A++++++++++++if+%28end+-+pc+%26lt%3B+4%29%0A++++++++++++++++return+false%3B%0A++++++++++++nSize+%3D+ReadLE32%28%26amp%3Bpc%5B0%5D%29%3B%0A++++++++++++pc+%2B%3D+4%3B%0A++++++++%7D%0A++++++++if+%28end+-+pc+%26lt%3B+0+%7C%7C+%28unsigned+int%29%28end+-+pc%29+%26lt%3B+nSize%29%0A++++++++++++return+false%3B%0A++++++++%2F%2F%E5%B0%86%E9%9A%8F%E5%90%8E20%E5%AD%97%E8%8A%82%E7%9A%84%E5%85%AC%E9%92%A5%E5%A1%AB%E5%85%85%E7%9A%84%E8%BE%93%E5%87%BA%E5%8F%82%E6%95%B0%E4%B8%AD%0A++++++++if+%28pvchRet%29%0A++++++++++++pvchRet-%26gt%3Bassign%28pc%2C+pc+%2B+nSize%29%3B%0A++++++++%2F%2F%E6%8C%87%E9%92%88%E7%A7%BB%E5%8A%A820%E5%AD%97%E8%8A%82%0A++++++++pc+%2B%3D+nSize%3B%0A++++%7D%0A%0A++++opcodeRet+%3D+static_cast%26lt%3Bopcodetype%26gt%3B%28opcode%29%3B%0A++++return+true%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%9C%80%E7%BB%88%EF%BC%8C20%E5%AD%97%E8%8A%82%E7%9A%84%E5%85%AC%E9%92%A5%E5%80%BC%E8%A2%AB%E6%8F%90%E5%8F%96%E5%B9%B6%E4%BF%9D%E5%AD%98%E5%86%8D%E6%9D%A5%EF%BC%8C%E6%89%A7%E8%A1%8C%E5%AE%8C%E6%93%8D%E4%BD%9C%E7%AC%A6%E8%A7%A3%E6%9E%90%E5%90%8E%E7%9A%84%E7%8A%B6%E6%80%81%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180720135906568%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0ZW10X3N3Mg%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%EF%BC%882%EF%BC%89+%E7%AD%BE%E5%90%8D%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E8%A7%A3%E6%9E%90%E5%AE%8CUTXO%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E5%90%8E%EF%BC%8C%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%B0%B1%E8%A6%81%E5%BC%80%E5%A7%8B%E7%AD%BE%E5%90%8D%E4%BA%86%EF%BC%8C%E8%BF%98%E6%98%AF%E4%BB%A5%E4%B8%8A%E9%9D%A2%E7%9A%84%E4%BE%8B%E5%AD%90%E6%9D%A5%E5%88%86%E6%9E%90%EF%BC%8CSignStep%E5%87%BD%E6%95%B0%E5%9C%A8%E8%B0%83%E7%94%A8Solver%E8%A7%A3%E6%9E%90%E5%AE%8C%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%EF%BC%8C%E5%BE%97%E5%88%B0%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E7%9A%84%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%85%B6%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0%EF%BC%8C%E7%84%B6%E5%90%8E%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E7%B1%BB%E5%9E%8B%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86%EF%BC%8C%E5%AF%B9%E4%BA%8EP2PKH%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%A4%84%E7%90%86%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Ecase+TX_PUBKEYHASH%3A%0A++++++++keyID+%3D+CKeyID%28uint160%28vSolutions%5B0%5D%29%29%3B%0A++++++++if+%28%21Sign1%28provider%2C+keyID%2C+creator%2C+scriptPubKey%2C+ret%2C+sigversion%29%29%0A++++++++++++return+false%3B%0A++++++++else%0A++++++++%7B%0A++++++++++++CPubKey+vch%3B%0A++++++++++++provider.GetPubKey%28keyID%2C+vch%29%3B%0A++++++++++++ret.push_back%28ToByteVector%28vch%29%29%3B%0A++++++++%7D%0A++++++++return+true%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E9%A6%96%E5%85%88%E6%8B%BF%E5%88%B0Solver%E5%87%BD%E6%95%B0%E8%A7%A3%E6%9E%90%E5%87%BA%E7%9A%8420%E5%AD%97%E8%8A%82%E7%9A%84%E5%85%AC%E9%92%A5%EF%BC%8C%E7%84%B6%E5%90%8E%E8%B0%83%E7%94%A8Sign1%E5%87%BD%E6%95%B0%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Estatic+bool+Sign1%28const+SigningProvider%26amp%3B+provider%2C+const+CKeyID%26amp%3B+address%2C+const+BaseSignatureCreator%26amp%3B+creator%2C+const+CScript%26amp%3B+scriptCode%2C+std%3A%3Avector%26lt%3Bvaltype%26gt%3B%26amp%3B+ret%2C+SigVersion+sigversion%29%0A%7B%0A++++std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B+vchSig%3B%0A++++if+%28%21creator.CreateSig%28provider%2C+vchSig%2C+address%2C+scriptCode%2C+sigversion%29%29%0A++++++++return+false%3B%0A++++ret.push_back%28vchSig%29%3B%0A++++return+true%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%8C%E9%80%9A%E8%BF%87%E4%BC%A0%E5%85%A5%E7%9A%84%E5%8F%82%E6%95%B0BaseSignatureCreator%3A%3ACreateSig%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%EF%BC%8C%E5%B0%86%E7%94%9F%E6%88%90%E7%9A%84%E7%AD%BE%E5%90%8D%E4%BF%9D%E5%AD%98%E5%9C%A8%E8%BE%93%E5%87%BA%E5%8F%82%E6%95%B0ret%E4%B8%AD%E3%80%82%E8%BF%99%E9%87%8C%E5%8F%82%E6%95%B0%E4%B8%AD%E4%BC%A0%E5%85%A5%E7%9A%84BaseSignatureCreator%E6%98%AFMutableTransactionSignatureCreator%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%9B%9E%E5%BF%86%E4%B8%8B%E5%89%8D%E9%9D%A2ProduceSignature%E7%9A%84%E4%BB%A3%E7%A0%81%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Eif+%28%21fHashSingle+%7C%7C+%28i+%26lt%3B+mtx.vout.size%28%29%29%29+%7B%0A++++++++++++ProduceSignature%28*keystore%2C+MutableTransactionSignatureCreator%28%26amp%3Bmtx%2C+i%2C+amount%2C+nHashType%29%2C+prevPubKey%2C+sigdata%29%3B%0A++++++++%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%EF%BC%8C%E5%88%9B%E5%BB%BAMutableTransactionSignatureCreator%E6%97%B6%EF%BC%8C%E4%BC%A0%E5%85%A5%E4%BA%86%E4%BA%A4%E6%98%93%E3%80%81%E8%A6%81%E7%AD%BE%E5%90%8D%E7%9A%84%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%9A%84%E7%B4%A2%E5%BC%95%EF%BC%8C%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E5%BC%95%E7%94%A8%E7%9A%84UTXO%E7%9A%84%E6%AF%94%E7%89%B9%E5%B8%81%E6%95%B0%E9%87%8F%E4%BB%A5%E5%8F%8Ahashtype%EF%BC%8C%E6%9D%A5%E7%9C%8B%E7%9C%8B%E7%AD%BE%E5%90%8D%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Ebool+TransactionSignatureCreator%3A%3ACreateSig%28const+SigningProvider%26amp%3B+provider%2C+std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B%26amp%3B+vchSig%2C+const+CKeyID%26amp%3B+address%2C+const+CScript%26amp%3B+scriptCode%2C+SigVersion+sigversion%29+const%0A%7B%0A++++%2F%2F%E4%BB%8Ekeystore%E4%B8%AD%E6%8B%BF%E5%88%B0%E4%B8%8E%E5%85%AC%E9%92%A5%E5%AF%B9%E5%BA%94%E7%9A%84%E7%A7%81%E9%92%A5%0A++++CKey+key%3B%0A++++if+%28%21provider.GetKey%28address%2C+key%29%29%0A++++++++return+false%3B%0A%0A++++%2F%2F+Signing+with+uncompressed+keys+is+disabled+in+witness+scripts%0A++++if+%28sigversion+%3D%3D+SigVersion%3A%3AWITNESS_V0+%26amp%3B%26amp%3B+%21key.IsCompressed%28%29%29%0A++++++++return+false%3B%0A%0A++++%2F%2F%E5%AF%B9%E4%BA%A4%E6%98%93%E7%94%9F%E6%88%90hash%E6%91%98%E8%A6%81%0A++++uint256+hash+%3D+SignatureHash%28scriptCode%2C+*txTo%2C+nIn%2C+nHashType%2C+amount%2C+sigversion%29%3B%0A++++%0A++++%2F%2F%E7%94%A8%E7%A7%81%E9%92%A5%E5%AF%B9%E4%BA%A4%E6%98%93%E7%9A%84hash%E6%91%98%E8%A6%81%E8%BF%9B%E8%A1%8C%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%EF%BC%8C%E7%AD%BE%E5%90%8D%E4%BF%9D%E5%AD%98%E5%9C%A8%E8%BE%93%E5%87%BA%E5%8F%82%E6%95%B0vchSig%E4%B8%AD%0A++++if+%28%21key.Sign%28hash%2C+vchSig%29%29%0A++++++++return+false%3B%0A++++vchSig.push_back%28%28unsigned+char%29nHashType%29%3B%0A++++return+true%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%88%B0%E6%AD%A4%E4%B8%BA%E6%AD%A2%EF%BC%8C%E5%AF%B9%E4%BA%A4%E6%98%93%E7%9A%84%E7%AD%BE%E5%90%8D%E5%B0%B1%E7%AE%97%E6%98%AF%E5%AE%8C%E6%88%90%E4%BA%86%E3%80%82%3C%2Fp%3E+%0A++%3Ch3%3E4.3.2+%E6%A0%A1%E9%AA%8C%E8%84%9A%E6%9C%AC%3C%2Fh3%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%E5%AF%B9%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%E5%AE%8C%E6%88%90%E4%BB%A5%E5%90%8E%EF%BC%8C%E4%BA%A4%E6%98%93%E7%9A%84%E8%BE%93%E5%85%A5%E5%B0%B1%E6%9C%89%E4%BA%86%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%EF%BC%8C%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%B0%B1%E8%A6%81%E8%BF%9B%E8%A1%8C%E6%A0%A1%E9%AA%8C%EF%BC%8C%E7%9C%8B%E7%94%9F%E6%88%90%E7%9A%84%E8%BF%99%E4%B8%AA%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%E6%98%AF%E4%B8%8D%E6%98%AF%E8%83%BD%E5%A4%9F%E5%92%8C%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E6%8C%87%E5%90%91%E7%9A%84UTXO%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E5%8C%B9%E9%85%8D%EF%BC%88%E4%B8%80%E6%8A%8A%E9%92%A5%E5%8C%99%E4%B8%80%E6%8A%8A%E9%94%81%EF%BC%8C%E4%B8%80%E4%B8%AA%E8%90%9D%E5%8D%9C%E4%B8%80%E4%B8%AA%E5%9D%91%EF%BC%89%E3%80%82%E6%97%A0%E8%AE%BA%E6%98%AF%E6%9C%AC%E5%9C%B0%E8%BF%98%E6%98%AF%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%9A%84%E5%85%B6%E4%BB%96%E8%8A%82%E7%82%B9%EF%BC%8C%E5%AF%B9%E4%BA%8E%E6%96%B0%E4%BA%A4%E6%98%93%EF%BC%8C%E9%83%BD%E5%BF%85%E9%A1%BB%E5%AF%B9%E8%84%9A%E6%9C%AC%E8%BF%9B%E8%A1%8C%E6%A0%A1%E9%AA%8C%E5%90%8E%E6%89%8D%E8%83%BD%E5%B0%86%E4%BA%A4%E6%98%93%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%86%85%E5%AD%98%E4%BA%A4%E6%98%93%E6%B1%A0%E9%87%8C%E7%AD%89%E5%BE%85%E8%A2%AB%E7%9F%BF%E5%B7%A5%E6%8C%96%E5%8F%96%E3%80%82%3C%2Fp%3E+%0A++%3Ch3%3E4.3.2.1+%E6%AF%94%E7%89%B9%E5%B8%81%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%3C%2Fh3%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E6%98%AF%E4%B8%80%E7%A7%8D%E5%9F%BA%E4%BA%8E%E5%A0%86%E6%A0%88%E7%9A%84%E9%9D%9E%E5%9B%BE%E7%81%B5%E5%AE%8C%E5%A4%87%E7%9A%84%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E3%80%82%E6%88%91%E4%BB%AC%E7%9F%A5%E9%81%93%E5%8C%BA%E5%9D%97%E9%93%BE2.0%E7%9A%84%E4%B8%80%E4%B8%AA%E6%A0%87%E8%AF%86%E6%98%AF%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%8C%E5%85%B6%E4%BB%A3%E8%A1%A8%E5%B0%B1%E6%98%AF%E4%BB%A5%E5%A4%AA%E5%9D%8A%EF%BC%8C%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%8F%90%E4%BE%9B%E4%BA%86solidity%E8%AF%AD%E8%A8%80%EF%BC%8C%E5%88%A9%E7%94%A8%E8%AF%A5%E8%AF%AD%E8%A8%80%E5%8F%AF%E4%BB%A5%E7%BC%96%E5%86%99%E5%87%BA%E9%9D%9E%E5%B8%B8%E5%A4%8D%E6%9D%82%E7%9A%84%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96DApp%E3%80%82%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E7%9A%84%E4%BD%9C%E7%94%A8%E5%92%8Csolidity%E7%B1%BB%E4%BC%BC%EF%BC%8C%E5%88%A9%E7%94%A8%E8%AF%A5%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E5%90%8C%E6%A0%B7%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%86%99%E5%87%BA%E5%85%B7%E6%9C%89%E5%A4%8D%E6%9D%82%E9%80%BB%E8%BE%91%E7%9A%84%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E3%80%82%E6%88%91%E4%BB%AC%E4%B9%8B%E5%89%8D%E4%BB%8B%E7%BB%8D%E7%9A%84P2PKH%E5%B0%B1%E6%98%AF%E7%94%A8%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E7%BC%96%E5%86%99%E7%9A%84%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E8%84%9A%E6%9C%AC%E7%9A%84%E4%BE%8B%E5%AD%90%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E4%B8%8D%E6%94%AF%E6%8C%81%E7%B1%BB%E4%BC%BC%E4%BA%8Efor%E7%9A%84%E5%BE%AA%E7%8E%AF%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%8F%AF%E4%BB%A5%E9%81%BF%E5%85%8D%E4%B8%8D%E6%80%80%E5%A5%BD%E6%84%8F%E7%9A%84%E8%8A%82%E7%82%B9%E7%BC%96%E5%86%99%E5%87%BA%E5%85%B7%E6%9C%89%E6%97%A0%E9%99%90%E5%BE%AA%E7%8E%AF%E7%9A%84%E6%81%B6%E6%84%8F%E8%84%9A%E6%9C%AC%E5%BC%95%E5%8F%91DoS%E6%94%BB%E5%87%BB%E3%80%82%E4%BD%86%E6%98%AF%E5%83%8Fif-else%E8%BF%99%E6%A0%B7%E7%9A%84%E9%80%BB%E8%BE%91%E6%98%AF%E6%94%AF%E6%8C%81%E7%9A%84%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%AF%94%E7%89%B9%E5%B8%81%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E6%94%AF%E6%8C%81%E7%9A%84%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%AE%9A%E4%B9%89%E5%9C%A8%E6%9E%9A%E4%B8%BEopcode%E4%B8%AD%EF%BC%8C%E8%BF%99%E9%87%8C%E5%88%97%E5%87%BA%E6%9D%A5%EF%BC%8C%E8%AF%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E4%BA%86%E8%A7%A3%E4%B8%80%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3E%2F**+Script+opcodes+*%2F%0Aenum+opcodetype%0A%7B%0A++++%2F%2F+push+value%0A++++OP_0+%3D+0x00%2C%0A++++OP_FALSE+%3D+OP_0%2C%0A++++OP_PUSHDATA1+%3D+0x4c%2C%0A++++OP_PUSHDATA2+%3D+0x4d%2C%0A++++OP_PUSHDATA4+%3D+0x4e%2C%0A++++OP_1NEGATE+%3D+0x4f%2C%0A++++OP_RESERVED+%3D+0x50%2C%0A++++OP_1+%3D+0x51%2C%0A++++OP_TRUE%3DOP_1%2C%0A++++OP_2+%3D+0x52%2C%0A++++OP_3+%3D+0x53%2C%0A++++OP_4+%3D+0x54%2C%0A++++OP_5+%3D+0x55%2C%0A++++OP_6+%3D+0x56%2C%0A++++OP_7+%3D+0x57%2C%0A++++OP_8+%3D+0x58%2C%0A++++OP_9+%3D+0x59%2C%0A++++OP_10+%3D+0x5a%2C%0A++++OP_11+%3D+0x5b%2C%0A++++OP_12+%3D+0x5c%2C%0A++++OP_13+%3D+0x5d%2C%0A++++OP_14+%3D+0x5e%2C%0A++++OP_15+%3D+0x5f%2C%0A++++OP_16+%3D+0x60%2C%0A%0A++++%2F%2F+control%0A++++OP_NOP+%3D+0x61%2C%0A++++OP_VER+%3D+0x62%2C%0A++++OP_IF+%3D+0x63%2C%0A++++OP_NOTIF+%3D+0x64%2C%0A++++OP_VERIF+%3D+0x65%2C%0A++++OP_VERNOTIF+%3D+0x66%2C%0A++++OP_ELSE+%3D+0x67%2C%0A++++OP_ENDIF+%3D+0x68%2C%0A++++OP_VERIFY+%3D+0x69%2C%0A++++OP_RETURN+%3D+0x6a%2C%0A%0A++++%2F%2F+stack+ops%0A++++OP_TOALTSTACK+%3D+0x6b%2C%0A++++OP_FROMALTSTACK+%3D+0x6c%2C%0A++++OP_2DROP+%3D+0x6d%2C%0A++++OP_2DUP+%3D+0x6e%2C%0A++++OP_3DUP+%3D+0x6f%2C%0A++++OP_2OVER+%3D+0x70%2C%0A++++OP_2ROT+%3D+0x71%2C%0A++++OP_2SWAP+%3D+0x72%2C%0A++++OP_IFDUP+%3D+0x73%2C%0A++++OP_DEPTH+%3D+0x74%2C%0A++++OP_DROP+%3D+0x75%2C%0A++++OP_DUP+%3D+0x76%2C%0A++++OP_NIP+%3D+0x77%2C%0A++++OP_OVER+%3D+0x78%2C%0A++++OP_PICK+%3D+0x79%2C%0A++++OP_ROLL+%3D+0x7a%2C%0A++++OP_ROT+%3D+0x7b%2C%0A++++OP_SWAP+%3D+0x7c%2C%0A++++OP_TUCK+%3D+0x7d%2C%0A%0A++++%2F%2F+splice+ops%0A++++OP_CAT+%3D+0x7e%2C%0A++++OP_SUBSTR+%3D+0x7f%2C%0A++++OP_LEFT+%3D+0x80%2C%0A++++OP_RIGHT+%3D+0x81%2C%0A++++OP_SIZE+%3D+0x82%2C%0A%0A++++%2F%2F+bit+logic%0A++++OP_INVERT+%3D+0x83%2C%0A++++OP_AND+%3D+0x84%2C%0A++++OP_OR+%3D+0x85%2C%0A++++OP_XOR+%3D+0x86%2C%0A++++OP_EQUAL+%3D+0x87%2C%0A++++OP_EQUALVERIFY+%3D+0x88%2C%0A++++OP_RESERVED1+%3D+0x89%2C%0A++++OP_RESERVED2+%3D+0x8a%2C%0A%0A++++%2F%2F+numeric%0A++++OP_1ADD+%3D+0x8b%2C%0A++++OP_1SUB+%3D+0x8c%2C%0A++++OP_2MUL+%3D+0x8d%2C%0A++++OP_2DIV+%3D+0x8e%2C%0A++++OP_NEGATE+%3D+0x8f%2C%0A++++OP_ABS+%3D+0x90%2C%0A++++OP_NOT+%3D+0x91%2C%0A++++OP_0NOTEQUAL+%3D+0x92%2C%0A%0A++++OP_ADD+%3D+0x93%2C%0A++++OP_SUB+%3D+0x94%2C%0A++++OP_MUL+%3D+0x95%2C%0A++++OP_DIV+%3D+0x96%2C%0A++++OP_MOD+%3D+0x97%2C%0A++++OP_LSHIFT+%3D+0x98%2C%0A++++OP_RSHIFT+%3D+0x99%2C%0A%0A++++OP_BOOLAND+%3D+0x9a%2C%0A++++OP_BOOLOR+%3D+0x9b%2C%0A++++OP_NUMEQUAL+%3D+0x9c%2C%0A++++OP_NUMEQUALVERIFY+%3D+0x9d%2C%0A++++OP_NUMNOTEQUAL+%3D+0x9e%2C%0A++++OP_LESSTHAN+%3D+0x9f%2C%0A++++OP_GREATERTHAN+%3D+0xa0%2C%0A++++OP_LESSTHANOREQUAL+%3D+0xa1%2C%0A++++OP_GREATERTHANOREQUAL+%3D+0xa2%2C%0A++++OP_MIN+%3D+0xa3%2C%0A++++OP_MAX+%3D+0xa4%2C%0A%0A++++OP_WITHIN+%3D+0xa5%2C%0A%0A++++%2F%2F+crypto%0A++++OP_RIPEMD160+%3D+0xa6%2C%0A++++OP_SHA1+%3D+0xa7%2C%0A++++OP_SHA256+%3D+0xa8%2C%0A++++OP_HASH160+%3D+0xa9%2C%0A++++OP_HASH256+%3D+0xaa%2C%0A++++OP_CODESEPARATOR+%3D+0xab%2C%0A++++OP_CHECKSIG+%3D+0xac%2C%0A++++OP_CHECKSIGVERIFY+%3D+0xad%2C%0A++++OP_CHECKMULTISIG+%3D+0xae%2C%0A++++OP_CHECKMULTISIGVERIFY+%3D+0xaf%2C%0A%0A++++%2F%2F+expansion%0A++++OP_NOP1+%3D+0xb0%2C%0A++++OP_CHECKLOCKTIMEVERIFY+%3D+0xb1%2C%0A++++OP_NOP2+%3D+OP_CHECKLOCKTIMEVERIFY%2C%0A++++OP_CHECKSEQUENCEVERIFY+%3D+0xb2%2C%0A++++OP_NOP3+%3D+OP_CHECKSEQUENCEVERIFY%2C%0A++++OP_NOP4+%3D+0xb3%2C%0A++++OP_NOP5+%3D+0xb4%2C%0A++++OP_NOP6+%3D+0xb5%2C%0A++++OP_NOP7+%3D+0xb6%2C%0A++++OP_NOP8+%3D+0xb7%2C%0A++++OP_NOP9+%3D+0xb8%2C%0A++++OP_NOP10+%3D+0xb9%2C%0A%0A%0A++++%2F%2F+template+matching+params%0A++++OP_SMALLINTEGER+%3D+0xfa%2C%0A++++OP_PUBKEYS+%3D+0xfb%2C%0A++++OP_PUBKEYHASH+%3D+0xfd%2C%0A++++OP_PUBKEY+%3D+0xfe%2C%0A%0A++++OP_INVALIDOPCODE+%3D+0xff%2C%0A%7D%3B%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E8%BF%99%E4%BA%9B%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%88%86%E4%B8%BA%E5%87%A0%E7%B1%BB%EF%BC%8C%E6%AF%94%E5%A6%82OP_N%28N%3D0%EF%BC%8C1%EF%BC%8C...%EF%BC%8C16%29%E7%94%A8%E6%9D%A5push%E5%80%BC%EF%BC%8Cif%EF%BC%8Celse%E7%AD%89%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%9A%84%E6%93%8D%E4%BD%9C%E7%AC%A6%EF%BC%8C%E5%8A%A0%E5%87%8F%E4%B9%98%E9%99%A4%E7%AD%89%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97%E6%93%8D%E4%BD%9C%E7%AC%A6%EF%BC%8C%E7%94%A8%E6%9D%A5%E6%93%8D%E4%BD%9C%E5%A0%86%E6%A0%88%E7%9A%84%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%AD%89%E7%AD%89%E3%80%82%3C%2Fp%3E+%0A++%3Ch3%3E4.3.2.2+%E6%A0%87%E5%87%86%E7%9A%84%E6%AF%94%E7%89%B9%E5%B8%81%E4%BA%A4%E6%98%93%3C%2Fh3%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%AF%94%E7%89%B9%E5%B8%81%E5%BD%93%E5%89%8D%E6%94%AF%E6%8C%81%E7%9A%84%E6%A0%87%E5%87%86%E4%BA%A4%E6%98%93%E9%83%BD%E6%98%AF%E7%94%A8%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E7%BC%96%E5%86%99%E7%9A%84%E5%8F%AF%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E7%9A%84%E4%BE%8B%E5%AD%90%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%90%86%E8%A7%A3%E6%88%90%E6%98%AF%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%8A%E7%94%A8%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80%E7%BC%96%E5%86%99%E7%9A%84%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E3%80%82%E6%9C%AC%E5%B0%8F%E8%8A%82%E6%88%91%E4%BB%AC%E7%AE%80%E5%8D%95%E7%9A%84%E8%BF%87%E4%B8%80%E4%B8%8B%E8%BF%99%E4%BA%9B%E6%A0%87%E5%87%86%E4%BA%A4%E6%98%93%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B+%3Cstrong%3E%EF%BC%881%EF%BC%89P2PKH%E4%BA%A4%E6%98%93%3C%2Fstrong%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+%E6%9C%80%E5%B8%B8%E8%A7%81%E7%9A%84%E6%AF%94%E7%89%B9%E5%B8%81%E6%A0%87%E5%87%86%E4%BA%A4%E6%98%93%EF%BC%8C%E5%85%A8%E7%A7%B0%E4%B8%BAPay+to+public+key+hash%E7%9A%84%E7%AE%80%E7%A7%B0%E3%80%82%E4%BB%8E%E5%90%8D%E5%AD%97%E4%B8%AD%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%8C%9C%E5%87%BA%E8%BF%99%E7%A7%8D%E4%BA%A4%E6%98%93%E6%98%AF%E5%9F%BA%E4%BA%8E%E5%85%AC%E9%92%A5%E7%9A%84%E3%80%82%E8%BF%99%E7%A7%8D%E4%BA%A4%E6%98%93%E4%BC%9A%E6%8C%87%E5%AE%9A%E6%96%B0%E7%9A%84UTXO%E7%9A%84%E6%8E%A5%E6%94%B6%E8%80%85%E7%9A%84%E5%85%AC%E9%92%A5%EF%BC%8C%E8%8A%B1%E8%B4%B9UTXO%E7%9A%84%E4%BA%BA%E9%A1%BB%E6%8F%90%E4%BE%9B%E8%87%AA%E5%B7%B1%E7%9A%84%E5%85%AC%E9%92%A5%E5%92%8C%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%EF%BC%8C%E5%8F%AA%E6%9C%89%E6%BB%A1%E8%B6%B3%E4%B8%8B%E9%9D%A2%E4%B8%A4%E4%B8%AA%E6%9D%A1%E4%BB%B6%E6%97%B6%E6%89%8D%E5%8F%AF%E4%BB%A5%E6%B6%88%E8%80%97UTXO%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+%28C1%29+%E6%B6%88%E8%B4%B9%E8%80%85%E6%8F%90%E4%BE%9B%E7%9A%84%E5%85%AC%E9%92%A5%E7%9A%84hash%E5%BF%85%E9%A1%BB%E5%92%8CUTXO%E4%B8%8A%E6%8C%87%E5%AE%9A%E7%9A%84%E5%85%AC%E9%92%A5%E7%9A%84hash%E7%9B%B8%E5%90%8C%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+%28C2%29+%E6%B6%88%E8%B4%B9%E8%80%85%E7%9A%84%E7%AD%BE%E5%90%8D%E5%BF%85%E9%A1%BB%E6%AD%A3%E7%A1%AE%EF%BC%88%E5%AF%B9%E4%BA%A4%E6%98%93%E7%94%9F%E6%88%90%E6%91%98%E8%A6%81D%EF%BC%8C%E7%84%B6%E5%90%8E%E7%94%A8%E7%BB%99%E5%AE%9A%E7%9A%84%E5%85%AC%E9%92%A5%E4%BB%8E%E7%AD%BE%E5%90%8D%E4%B8%AD%E6%B1%82%E5%BE%97%E7%9A%84%E4%BA%A4%E6%98%93%E6%91%98%E8%A6%81D%E2%80%98%E5%BF%85%E9%A1%BB%E5%92%8CD%E7%9B%B8%E5%90%8C%EF%BC%89%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+%E5%8F%AA%E8%A6%81%E8%83%BD%E6%BB%A1%E8%B6%B3%E4%B8%8A%E9%9D%A2%E4%B8%A4%E4%B8%AA%E6%9D%A1%E4%BB%B6%EF%BC%8C%E5%B0%B1%E8%83%BD%E8%AF%81%E6%98%8E%E6%9F%90%E4%BA%BA%E5%AF%B9UTXO%E7%9A%84%E6%89%80%E6%9C%89%E6%9D%83%EF%BC%8C%E8%80%8C%E8%83%BD%E6%BB%A1%E8%B6%B3%E4%B8%8A%E9%9D%A2%E8%BF%99%E4%B8%A4%E4%B8%AA%E6%9D%A1%E4%BB%B6%E7%9A%84%E8%84%9A%E6%9C%AC%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+Signature%26nbsp%3B+%7C%26nbsp%3B+Public+key%26nbsp%3B+%7C%26nbsp%3B+OP_DU%26nbsp%3B+%7C%26nbsp%3B+OP_HASH160%26nbsp%3B+%7C%26nbsp%3B+OP_PUBKEYHASH%26nbsp%3B+%7C%26nbsp%3B+OP_EQUALVERIFY%26nbsp%3B+%7C%26nbsp%3B+OP_CHECKSIG%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+%E5%B0%86%E4%BA%A4%E6%98%93%E7%9A%84%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%E5%92%8C%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E5%90%88%E5%B9%B6%E8%B5%B7%E6%9D%A5%E5%B0%B1%E5%BD%A2%E6%88%90%E4%BA%86%E4%B8%8A%E8%BF%B0%E8%84%9A%E6%9C%AC%EF%BC%8C%E8%BF%99%E6%AE%B5%E8%84%9A%E6%9C%AC%E6%9C%80%E7%BB%88%E7%94%B1%E8%84%9A%E6%9C%AC%E5%BC%95%E6%93%8E%E8%A7%A3%E9%87%8A%E5%B9%B6%E6%89%A7%E8%A1%8C%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%3Cstrong%3E%26nbsp%3B+%282%29+P2PK%E4%BA%A4%E6%98%93%3C%2Fstrong%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B+Pay+To+Public+Key%E7%9A%84%E7%AE%80%E7%A7%B0%EF%BC%8C%E8%BF%99%E7%A7%8D%E4%BA%A4%E6%98%93%E6%9B%B4%E7%AE%80%E5%8D%95%EF%BC%8C%E4%B8%8EP2PKH%E4%B8%8D%E5%90%8C%E7%9A%84%E5%9C%B0%E6%96%B9%E5%9C%A8%E4%BA%8E%E4%BB%96%E4%B8%8D%E7%94%A8%E9%AA%8C%E8%AF%81UTXO%E4%B8%8A%E6%8C%87%E5%AE%9A%E7%9A%84%E5%85%AC%E9%92%A5%E4%B8%8E%E6%B6%88%E8%B4%B9%E8%80%85%E6%8F%90%E4%BE%9B%E7%9A%84%E5%85%AC%E9%92%A5%E7%9A%84hash%EF%BC%8C%E5%8F%AA%E6%A3%80%E6%9F%A5%E7%AD%BE%E5%90%8D%EF%BC%8C%E7%9B%B8%E5%BA%94%E7%9A%84%E8%84%9A%E6%9C%AC%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+Signature%26nbsp%3B+%7C%26nbsp%3B+Public+Key%26nbsp%3B+%7C%26nbsp%3B+OP_CHECKSIG%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+%3Cstrong%3E%283%29+MULTISIG%E4%BA%A4%E6%98%93%3C%2Fstrong%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%E5%A4%9A%E9%87%8D%E7%AD%BE%E5%90%8D%E4%BA%A4%E6%98%93%EF%BC%8C%E8%BF%99%E7%A7%8D%E4%BA%A4%E6%98%93%E7%94%A8%E5%9C%A8%E8%A6%81%E6%B1%82%E6%9B%B4%E5%8A%A0%E4%B8%A5%E6%A0%BC%E7%9A%84%E5%9C%BA%E5%90%88%EF%BC%8C%E7%AE%80%E5%8D%95%E7%9A%84%E8%AF%B4%E5%B0%B1%E6%98%AF%E8%A6%81%E6%94%AF%E5%87%BA%E4%B8%80%E7%AC%94%E9%92%B1%EF%BC%8C%E9%9C%80%E8%A6%81%E5%BE%97%E5%88%B0N%E4%B8%AA%E4%BA%BA%E4%B8%AD%E8%87%B3%E5%B0%91M%E4%B8%AA%E4%BA%BA%E7%9A%84%E7%AD%BE%E5%AD%97%E8%AE%A4%E5%8F%AF%EF%BC%88M+%26lt%3B%3D+N%EF%BC%89%E6%89%8D%E8%A1%8C%E3%80%82%E8%BF%99%E7%A7%8D%E4%BA%A4%E6%98%93%E4%BC%9A%E5%9C%A8UTXO%E4%B8%8A%E6%8C%87%E5%AE%9AN%E4%B8%AA%E5%85%AC%E9%92%A5%EF%BC%88N%E4%B8%AA%E7%9B%91%E7%AE%A1%E4%BA%BA%E7%9A%84%E5%85%AC%E9%92%A5%EF%BC%89%EF%BC%8C%E9%9C%80%E8%A6%81%E6%8F%90%E5%8F%96%E8%B5%84%E9%87%91%E6%97%B6%EF%BC%8C%E5%BF%85%E9%A1%BB%E6%8F%90%E4%BE%9B%E8%87%B3%E5%B0%91M%E4%B8%AA%E7%AD%BE%E5%90%8D%EF%BC%8C%E5%8F%AA%E6%9C%89%E6%89%80%E6%9C%89%E7%9A%84%E7%AD%BE%E5%90%8D%E9%83%BD%E8%83%BD%E6%BB%A1%E8%B6%B3%E6%89%8D%E8%A1%8C%E3%80%82%E4%BB%A53%E4%B8%AA%E4%BA%BA%E7%AE%A1%E7%90%86%E4%B8%80%E7%AC%94%E8%B5%84%E9%87%91%EF%BC%8C%E6%8F%90%E5%8F%96%E6%97%B6%E5%BF%85%E9%A1%BB%E5%BE%97%E5%88%B0%E5%85%B6%E4%B8%AD2%E4%B8%AA%E4%BA%BA%E7%9A%84%E7%AD%BE%E5%90%8D%E4%B8%BA%E4%BE%8B%EF%BC%8C%E6%BB%A1%E8%B6%B3%E6%9D%A1%E4%BB%B6%E7%9A%84%E8%84%9A%E6%9C%AC%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+0%26nbsp%3B+%7C%26nbsp%3B+Sig1+%7C%26nbsp%3B+Sig2%26nbsp%3B+%7C%26nbsp%3B+2%26nbsp%3B+%7C%26nbsp%3B+Public+Key+1%26nbsp%3B+%7C+Public+Key+2%26nbsp%3B+%7C+Public+Key+3%26nbsp%3B+%7C%26nbsp%3B+3%26nbsp%3B+%7C%26nbsp%3B+OP_CHECKMULTISIG%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+%E6%B3%A8%E6%84%8F%E8%BF%99%E9%87%8CMULTISIG%E7%9A%84%E8%84%9A%E6%9C%AC%E5%BF%85%E9%A1%BB%E4%BB%A50%E5%BC%80%E5%A7%8B%EF%BC%8C%E8%BF%99%E6%BA%90%E8%87%AA%E4%B8%8EOP_CHECKMULTISIG%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%9C%A8%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E4%B8%80%E4%B8%AAbug%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+%3Cstrong%3E%284%29+P2SH%E4%BA%A4%E6%98%93%3C%2Fstrong%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B+%E6%B3%A8%E6%84%8F%E5%88%B0MULTISIG%E5%A4%9A%E9%87%8D%E7%AD%BE%E5%90%8D%E7%9A%84%E4%BA%A4%E6%98%93%E5%AD%98%E5%9C%A8%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%8C%E5%81%87%E8%AE%BEA%E8%A6%81%E5%90%91B%E6%94%AF%E4%BB%98%E4%B8%80%E7%AC%94%E8%B5%84%E9%87%91%EF%BC%8C%E4%BD%86%E6%98%AFB%E8%A6%81%E6%B1%82%E8%BF%99%E7%AC%94%E8%B5%84%E9%87%91%E9%9C%80%E8%A6%81MULTISIG%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E8%A6%81%E8%8A%B1%E8%BF%99%E7%AC%94%E9%92%B1%E9%9C%80%E8%A6%81B%E8%87%AA%E5%B7%B1%E4%BB%A5%E5%8F%8A%E4%BB%96%E7%9A%84%E8%8B%A5%E5%B9%B2%E5%90%88%E4%BC%99%E4%BA%BA%E5%90%8C%E6%97%B6%E7%AD%BE%E5%90%8D%E3%80%82%E8%BF%99%E6%A0%B7A%E7%9A%84%E9%92%B1%E5%8C%85%E7%94%9F%E6%88%90%E7%BB%99B%E8%BD%AC%E8%B4%A6%E7%9A%84%E4%BA%A4%E6%98%93%E6%97%B6%EF%BC%8C%E4%BA%A4%E6%98%93%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E4%BC%9A%E5%8C%85%E5%90%AB%E5%BE%88%E5%A4%9A%E9%95%BF%E5%BA%A6%E5%BE%88%E9%95%BF%E7%9A%84%E5%85%AC%E9%92%A5%EF%BC%8C%E5%AF%BC%E8%87%B4%E4%BA%A4%E6%98%93%E6%89%80%E5%8D%A0%E7%94%A8%E7%9A%84%E4%BD%93%E7%A7%AF%E4%BC%9A%E7%9B%B8%E5%BD%93%E5%A4%A7%EF%BC%8C%E8%BF%99%E4%BC%9A%E5%AF%BC%E8%87%B4A%E8%A6%81%E5%A4%9A%E6%94%AF%E4%BB%98%E4%B8%8D%E5%B0%91%E7%9A%84%E4%BA%A4%E6%98%93%E8%B4%B9%E7%94%A8%E3%80%82P2SH%E4%BA%A4%E6%98%93%E5%8F%AF%E4%BB%A5%E8%A7%A3%E5%86%B3%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%E3%80%82%E5%A6%82%E6%9E%9C%E4%B8%80%E4%B8%AA%E4%BA%A4%E6%98%93%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E9%9D%9E%E5%B8%B8%E5%A4%8D%E6%9D%82%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%80%83%E8%99%91%E7%94%A8P2SH%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+%E4%BB%8D%E6%97%A7%E4%BB%A52-3%E5%A4%9A%E9%87%8D%E7%AD%BE%E5%90%8D%E4%B8%BA%E4%BE%8B%EF%BC%8C%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E6%88%91%E4%BB%AC%E5%81%87%E8%AE%BE%E4%B8%BAS%EF%BC%8C%E5%88%99%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+S+%3D+2%26nbsp%3B+%7C%26nbsp%3B+Public+Key+1%26nbsp%3B+%7C+Public+Key+2%26nbsp%3B+%7C+Public+Key+3%26nbsp%3B+%7C%26nbsp%3B+3%26nbsp%3B+%7C%26nbsp%3B+OP_CHECKMULTISIG%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+%E7%94%B1%E4%BA%8E%E5%85%AC%E9%92%A5%E7%9A%84%E9%95%BF%E5%BA%A6%E5%BE%88%E9%95%BF%EF%BC%8C%E6%89%80%E4%BB%A5%E4%B8%8A%E9%9D%A2%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E6%9C%80%E7%BB%88%E7%9A%84%E4%BD%93%E7%A7%AF%E4%BC%9A%E5%BE%88%E5%A4%A7%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%94%B9%E7%94%A8P2SH%E4%BA%A4%E6%98%93%EF%BC%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E5%AF%B9%E4%B8%8A%E9%9D%A2%E9%95%BF%E9%95%BF%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E8%BF%9B%E8%A1%8Chash%E5%A4%84%E7%90%86%EF%BC%8C%E7%94%9F%E6%88%9020%E5%AD%97%E8%8A%82%E7%9A%84%E8%84%9A%E6%9C%AChash%EF%BC%8C%E8%BF%99%E6%A0%B7%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E5%B0%B1%E5%8F%98%E6%88%90%E4%BA%86%E4%B8%8B%E9%9D%A2%E8%BF%99%E6%A0%B7%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B+OP_HASH160%26nbsp%3B+%7C%26nbsp%3B+%5B20+bytes+script+hash%5D%26nbsp%3B+%7C%26nbsp%3B+OP_EQUAL%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B+%E7%84%B6%E5%90%8E%E6%B6%88%E8%B4%B9%E8%80%85%E4%B8%BA%E4%BA%86%E6%94%AF%E5%87%BA%E8%B5%84%E9%87%91%EF%BC%8C%E5%BF%85%E9%A1%BB%E6%8F%90%E4%BE%9B%E4%B8%80%E4%B8%AA%E8%B5%8E%E5%9B%9E%E8%84%9A%E6%9C%AC%EF%BC%88redeem+script%EF%BC%89%EF%BC%8C%E8%BF%99%E4%B8%AA%E8%B5%8E%E5%9B%9E%E8%84%9A%E6%9C%ACredeem%E5%92%8CS%E6%98%AF%E7%9B%B8%E5%90%8C%E7%9A%84%EF%BC%8C%E5%BD%93%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E6%A0%A1%E9%AA%8C%E6%97%B6%EF%BC%8C%E9%A6%96%E5%85%88%E5%B0%86%E6%B6%88%E8%B4%B9%E8%80%85%E6%8F%90%E4%BE%9B%E7%9A%84%E8%B5%8E%E5%9B%9E%E8%84%9A%E6%9C%AC%E8%BF%9B%E8%A1%8Chash%EF%BC%8C%E7%84%B6%E5%90%8E%E6%AF%94%E8%BE%83hash%E6%98%AF%E5%90%A6%E5%92%8C%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E4%B8%AD%E7%9A%84hash%E7%9B%B8%E5%90%8C%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+redeem%26nbsp%3B+%7C%26nbsp%3B+OP_HASH160%26nbsp%3B+%7C%26nbsp%3B+20+bytes+script+hash+%7C%26nbsp%3B+OP_EQUAL%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+%E5%A6%82%E6%9E%9C%E4%B8%8A%E4%B8%80%E6%AD%A5%E6%89%A7%E8%A1%8C%E6%88%90%E5%8A%9F%EF%BC%8C%E5%88%99%E6%89%A7%E8%A1%8C%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+Sig1%26nbsp%3B+%7C%26nbsp%3B+Sig2%26nbsp%3B+%7C%26nbsp%3B+2%26nbsp%3B+%7C%26nbsp%3B+Public+Key+1%26nbsp%3B+%7C+Public+Key+2%26nbsp%3B+%7C+Public+Key+3%26nbsp%3B+%7C%26nbsp%3B+3%26nbsp%3B+%7C%26nbsp%3B+OP_CHECKMULTISIG%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%E4%B8%8E%E5%A4%9A%E9%87%8D%E7%AD%BE%E5%90%8D%E7%9B%B8%E6%AF%94%EF%BC%8CP2SH%E6%9C%80%E5%A4%A7%E7%9A%84%E4%B8%8D%E5%90%8C%E6%98%AF%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E5%8F%98%E7%9F%AD%E4%BA%86%EF%BC%8C%E8%80%8C%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%E5%8F%98%E9%95%BF%E4%BA%86%EF%BC%8C%E8%BF%99%E6%A0%B7%E9%A2%9D%E5%A4%96%E7%9A%84%E4%BA%A4%E6%98%93%E8%B4%B9%E5%8F%98%E6%88%90%E4%BA%86%E7%94%B1UTXO%E7%9A%84%E6%B6%88%E8%B4%B9%E8%80%85%E6%9D%A5%E6%94%AF%E4%BB%98%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E6%94%AF%E4%BB%98%E8%80%85%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B+%E4%BB%A5%E4%B8%8A%E8%BF%99%E4%BA%9B%E6%A0%87%E5%87%86%E4%BA%A4%E6%98%93%E8%84%9A%E6%9C%AC%E6%9C%80%E7%BB%88%E7%94%B1%E8%84%9A%E6%9C%AC%E5%BC%95%E6%93%8E%E8%A7%A3%E9%87%8A%E6%89%A7%E8%A1%8C%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8%E4%B8%8B%E8%8A%82%E5%9C%A8%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E%E3%80%82%3C%2Fp%3E+%0A++%3Ch3%3E4.3.2.3+%E4%BA%A4%E6%98%93%E8%84%9A%E6%9C%AC%E7%9A%84%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%3C%2Fh3%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84%E8%84%9A%E6%9C%AC%E5%BC%95%E6%93%8E%E6%98%AF%E5%9F%BA%E4%BA%8E%E5%A0%86%E6%A0%88%E7%9A%84%EF%BC%8C%E8%84%9A%E6%9C%AC%E8%A7%A3%E9%87%8A%E5%99%A8%E4%BC%9A%E9%80%90%E4%B8%80%E8%A7%A3%E6%9E%90%E8%84%9A%E6%9C%AC%E7%9A%84%E6%93%8D%E4%BD%9C%E7%AC%A6%EF%BC%8C%E6%A0%B9%E6%8D%AE%E6%93%8D%E4%BD%9C%E7%AC%A6%E8%BF%9B%E8%A1%8C%E5%85%A5%E6%A0%88%E5%92%8C%E5%BC%B9%E6%A0%88%E7%9A%84%E6%93%8D%E4%BD%9C%E3%80%82%E4%BB%8D%E7%84%B6%E4%BB%A5P2PKH%E4%BA%A4%E6%98%93%E4%B8%BA%E4%BE%8B%EF%BC%8C%E6%AF%94%E7%89%B9%E5%B8%81%E4%BC%9A%E5%B0%86UTXO%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%E5%92%8C%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%E5%90%88%E5%B9%B6%E5%9C%A8%E4%B8%80%E8%B5%B7%EF%BC%8C%E7%84%B6%E5%90%8E%E5%9C%A8%E5%A0%86%E6%A0%88%E4%B8%8A%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C%EF%BC%8C%E6%88%91%E4%BB%AC%E7%94%A8%E5%9B%BE%E6%9D%A5%E8%A1%A8%E7%A4%BA%E6%95%B4%E4%B8%AA%E8%BF%87%E7%A8%8B%E4%BC%9A%E6%9B%B4%E6%B8%85%E6%A5%9A%E4%B8%80%E4%BA%9B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%EF%BC%881%EF%BC%89%E7%AD%BE%E5%90%8D%E5%85%A5%E6%A0%88%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180723193310900%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0ZW10X3N3Mg%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%EF%BC%882%EF%BC%89%E5%85%AC%E9%92%A5%E5%85%A5%E6%A0%88%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180723193510786%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0ZW10X3N3Mg%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%EF%BC%883%EF%BC%89%E5%A4%8D%E5%88%B6%E6%A0%88%E9%A1%B6%E5%85%83%E7%B4%A0%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180723193715525%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0ZW10X3N3Mg%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%EF%BC%884%EF%BC%89%E6%A0%88%E9%A1%B6%E5%85%83%E7%B4%A0%E5%BC%B9%E6%A0%88%EF%BC%8C%E8%BF%9B%E8%A1%8Chash%E5%90%8E%E7%9A%84%E5%80%BC%E5%85%A5%E6%A0%88%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180723193934716%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0ZW10X3N3Mg%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%EF%BC%885%EF%BC%89%E5%85%AC%E9%92%A5hash%E5%85%A5%E6%A0%88%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180723194323923%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0ZW10X3N3Mg%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%EF%BC%886%EF%BC%89OP_EQUALVERIFY%E5%B0%86%E5%A0%86%E6%A0%88%E4%B8%AD%E7%9A%84%E5%89%8D%E4%B8%A4%E4%B8%AA%E6%93%8D%E4%BD%9C%E6%95%B0%E5%BC%B9%E6%A0%88%EF%BC%8C%E5%B9%B6%E8%BF%9B%E8%A1%8C%E6%AF%94%E8%BE%83%EF%BC%8C%E7%9B%B8%E5%90%8C%E5%88%99%E7%BB%A7%E7%BB%AD%EF%BC%8C%E4%B8%8D%E7%9B%B8%E7%AD%89%E5%87%BA%E9%94%99%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180723195330605%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0ZW10X3N3Mg%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%EF%BC%887%EF%BC%89%E5%BC%B9%E5%87%BA%E5%A0%86%E6%A0%88%E4%B8%AD%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%93%8D%E4%BD%9C%E6%95%B0%EF%BC%8C%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%E6%A0%A1%E9%AA%8C%EF%BC%8C%E6%88%90%E5%8A%9F%E6%A0%88%E9%A1%B6%E5%85%A5%E6%A0%88TRUE%EF%BC%8C%E5%90%A6%E5%88%99%E6%A0%88%E9%A1%B6%E5%85%A5%E6%A0%88FALSE%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180723195742337%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0ZW10X3N3Mg%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%E6%9C%80%E5%90%8E%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%A0%88%E9%A1%B6%E5%85%83%E7%B4%A0%E4%B8%BATRUE%E5%88%99%E8%84%9A%E6%9C%AC%E8%BF%90%E8%A1%8C%E7%9A%84%E7%BB%93%E6%9E%9C%E4%B8%BA%E7%9C%9F%EF%BC%8C%E8%84%9A%E6%9C%AC%E9%AA%8C%E8%AF%81%E9%80%9A%E8%BF%87%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%E4%B8%8A%E9%9D%A2%E6%8F%8F%E8%BF%B0%E7%9A%84%E4%BA%A4%E6%98%93%E8%84%9A%E6%9C%AC%E7%9A%84%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B%EF%BC%8C%E4%BD%8D%E4%BA%8Einterpreter.cpp%EF%BC%88%E5%90%8D%E5%AD%97%E5%BE%88%E5%BD%A2%E8%B1%A1%EF%BC%8C%E4%B8%80%E7%9C%8B%E5%B0%B1%E7%9F%A5%E9%81%93%E6%96%87%E4%BB%B6%E4%B8%AD%E6%98%AF%E8%84%9A%E6%9C%AC%E8%A7%A3%E9%87%8A%E5%99%A8%E7%9B%B8%E5%85%B3%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%89%E7%9A%84EvalScript%E5%87%BD%E6%95%B0%E4%B8%AD%EF%BC%8C%E8%AF%A5%E5%87%BD%E6%95%B0%E7%9A%84%E5%8E%9F%E5%9E%8B%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Ebool+EvalScript%28std%3A%3Avector%26lt%3Bstd%3A%3Avector%26lt%3Bunsigned+char%26gt%3B+%26gt%3B%26amp%3B+stack%2C+const+CScript%26amp%3B+script%2C+unsigned+int+flags%2C+const+BaseSignatureChecker%26amp%3B+checker%2C+SigVersion+sigversion%2C+ScriptError*+serror%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%E8%AF%A5%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3Bstack%EF%BC%9A%E8%BE%93%E5%87%BA%E5%8F%82%E6%95%B0%EF%BC%8C%E4%B8%8A%E6%96%87%E5%9B%BE%E4%B8%AD%E7%9A%84%E5%A0%86%E6%A0%88%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3Bscript%EF%BC%9A%E8%A6%81%E8%A7%A3%E9%87%8A%E7%9A%84%E8%84%9A%E6%9C%AC%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3Bflags%EF%BC%9A%E6%A0%A1%E9%AA%8C%E7%9B%B8%E5%85%B3%E7%9A%84%E6%A0%87%E8%AF%86%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3Bchecker%EF%BC%9A%E7%94%A8%E4%BA%8E%E6%A0%A1%E9%AA%8C%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3Bserror%EF%BC%9A%E5%AD%98%E6%94%BE%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%EF%BC%9B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3BEvalScript%E5%9C%A8%E6%89%A7%E8%A1%8C%E6%97%B6%EF%BC%8C%E4%BC%9A%E4%BB%8E%E5%A4%B4%E4%BE%9D%E6%AC%A1%E5%BC%80%E5%A7%8B%E8%A7%A3%E6%9E%90%E8%BE%93%E5%85%A5%E8%84%9A%E6%9C%AC%EF%BC%8C%E5%B9%B6%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C%E7%9A%84%E6%93%8D%E4%BD%9C%E7%AC%A6%E6%9B%B4%E6%94%B9%E5%A0%86%E6%A0%88%E3%80%82%E6%95%B4%E4%B8%AA%E8%BF%87%E7%A8%8B%E5%B0%B1%E6%98%AF%E5%89%8D%E6%96%87%E5%9B%BE%E4%B8%AD%E6%8F%8F%E8%BF%B0%E7%9A%84%E9%82%A3%E6%A0%B7%EF%BC%8C%E8%AF%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E8%87%AA%E8%A1%8C%E5%9C%A8%E6%BA%90%E7%A0%81%E4%B8%AD%E9%98%85%E8%AF%BB%E8%BF%99%E6%AE%B5%E4%BB%A3%E7%A0%81%EF%BC%8C%E8%BF%99%E9%87%8C%E5%B0%B1%E4%B8%8D%E5%9C%A8%E5%88%97%E5%87%BA%E4%BA%86%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%E6%88%91%E4%BB%AC%E5%9C%A8%E5%9B%9E%E5%A4%B4%E7%9C%8B%E7%9C%8B%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E6%AD%A5%EF%BC%8C%E5%BD%93ProduceSignature%E5%87%BD%E6%95%B0%E4%B8%BA%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%94%9F%E6%88%90%E4%BA%86%E7%AD%BE%E5%90%8D%E4%BB%A5%E5%90%8E%EF%BC%8C%E6%9C%80%E5%90%8E%E4%B8%80%E6%AD%A5%E5%B0%B1%E6%98%AF%E8%A6%81%E8%BF%9B%E8%A1%8C%E8%84%9A%E6%9C%AC%E6%A0%A1%E9%AA%8C%E4%BA%86%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%84%9A%E6%9C%AC%E6%A0%A1%E9%AA%8C%E9%80%9A%E8%BF%87%EF%BC%8C%E8%AF%B4%E6%98%8E%E7%A1%AE%E5%AE%9E%E6%9C%89%E6%9D%83%E6%B6%88%E8%B4%B9%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E5%BC%95%E7%94%A8%E7%9A%84UTXO%EF%BC%8C%E8%AF%A5%E4%BA%A4%E6%98%93%E9%9A%8F%E5%90%8E%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%86%85%E5%AD%98%E6%B1%A0%E5%B9%B6%E5%B9%BF%E6%92%AD%E5%88%B0%E7%BD%91%E7%BB%9C%E4%B8%AD%E4%BA%86%EF%BC%8C%E5%9C%A8SignTransaction%E7%9A%84%E6%9C%80%E5%90%8E%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Eif+%28%21VerifyScript%28txin.scriptSig%2C+prevPubKey%2C+%26amp%3Btxin.scriptWitness%2C+STANDARD_SCRIPT_VERIFY_FLAGS%2C+TransactionSignatureChecker%28%26amp%3BtxConst%2C+i%2C+amount%29%2C+%26amp%3Bserror%29%29+%7B%0A++++++++++++if+%28serror+%3D%3D+SCRIPT_ERR_INVALID_STACK_OPERATION%29+%7B%0A++++++++++++++++%2F%2F+Unable+to+sign+input+and+verification+failed+%28possible+attempt+to+partially+sign%29.%0A++++++++++++++++TxInErrorToJSON%28txin%2C+vErrors%2C+%22Unable+to+sign+input%2C+invalid+stack+size+%28possibly+missing+key%29%22%29%3B%0A++++++++++++%7D+else+%7B%0A++++++++++++++++TxInErrorToJSON%28txin%2C+vErrors%2C+ScriptErrorString%28serror%29%29%3B%0A++++++++++++%7D%0A++++++++%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E8%B0%83%E7%94%A8%E4%BA%86VerifyScript%E6%9D%A5%E6%A0%A1%E9%AA%8C%E8%84%9A%E6%9C%AC%EF%BC%8C%E4%BC%A0%E5%85%A5%E4%BA%86%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%9A%84%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%E4%BB%A5%E5%8F%8A%E8%BE%93%E5%85%A5%E5%BC%95%E7%94%A8%E7%9A%84UTXO%E7%9A%84%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%EF%BC%8C%E5%8F%A6%E5%A4%96%E8%BF%98%E6%9C%89%E4%B8%80%E4%B8%AATransactionSignatureChecker%E5%AF%B9%E8%B1%A1%EF%BC%8C%E7%94%A8%E4%BA%8E%E6%A0%A1%E9%AA%8C%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%EF%BC%8C%E8%BF%99%E9%87%8C%E5%88%97%E5%87%BAVerifyScript%E7%9A%84%E6%BA%90%E7%A0%81%E4%BE%9B%E8%AF%BB%E8%80%85%E5%8F%82%E8%80%83%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Ebool+VerifyScript%28const+CScript%26amp%3B+scriptSig%2C+const+CScript%26amp%3B+scriptPubKey%2C+const+CScriptWitness*+witness%2C+unsigned+int+flags%2C+const+BaseSignatureChecker%26amp%3B+checker%2C+ScriptError*+serror%29%0A%7B%0A++++static+const+CScriptWitness+emptyWitness%3B%0A++++if+%28witness+%3D%3D+nullptr%29+%7B%0A++++++++witness+%3D+%26amp%3BemptyWitness%3B%0A++++%7D%0A++++bool+hadWitness+%3D+false%3B%0A%0A++++set_error%28serror%2C+SCRIPT_ERR_UNKNOWN_ERROR%29%3B%0A%0A++++if+%28%28flags+%26amp%3B+SCRIPT_VERIFY_SIGPUSHONLY%29+%21%3D+0+%26amp%3B%26amp%3B+%21scriptSig.IsPushOnly%28%29%29+%7B%0A++++++++return+set_error%28serror%2C+SCRIPT_ERR_SIG_PUSHONLY%29%3B%0A++++%7D%0A%0A++++%2F%2F%E5%A0%86%E6%A0%88%0A++++std%3A%3Avector%26lt%3Bstd%3A%3Avector%26lt%3Bunsigned+char%26gt%3B+%26gt%3B+stack%2C+stackCopy%3B%0A++++%0A++++%2F%2F%E8%A7%A3%E6%9E%90%E5%B9%B6%E6%89%A7%E8%A1%8C%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%A7%A3%E6%9E%90%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%87%BA%E9%94%99%E5%88%99%E8%BF%94%E5%9B%9E%EF%BC%8C%E4%BB%A5P2PKH%E4%BA%A4%E6%98%93%E4%B8%BA%E4%BE%8B%EF%BC%8C%E6%89%A7%E8%A1%8C%E5%AE%8C%E5%90%8E%E5%A0%86%E6%A0%88%E4%B8%AD%E5%B0%86%E4%BF%9D%E5%AD%98%E5%85%AC%E9%92%A5%E5%92%8C%E7%AD%BE%E5%90%8D%0A++++if+%28%21EvalScript%28stack%2C+scriptSig%2C+flags%2C+checker%2C+SigVersion%3A%3ABASE%2C+serror%29%29%0A++++++++%2F%2F+serror+is+set%0A++++++++return+false%3B%0A++++if+%28flags+%26amp%3B+SCRIPT_VERIFY_P2SH%29%0A++++++++stackCopy+%3D+stack%3B%0A++++%2F%2F%E7%BB%A7%E7%BB%AD%E8%A7%A3%E6%9E%90%E6%89%A7%E8%A1%8C%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC%0A++++if+%28%21EvalScript%28stack%2C+scriptPubKey%2C+flags%2C+checker%2C+SigVersion%3A%3ABASE%2C+serror%29%29%0A++++++++%2F%2F+serror+is+set%0A++++++++return+false%3B%0A++++%0A++++%2F%2F%E5%A6%82%E6%9E%9C%E6%9C%80%E7%BB%88%E5%A0%86%E6%A0%88%E4%B8%BA%E7%A9%BA%EF%BC%8C%E5%88%99%E8%AF%B4%E6%98%8E%E6%9C%89%E9%94%99%E8%AF%AF%EF%BC%8C%E8%BF%94%E5%9B%9E%0A++++if+%28stack.empty%28%29%29%0A++++++++return+set_error%28serror%2C+SCRIPT_ERR_EVAL_FALSE%29%3B%0A++++%2F%2F%E5%A0%86%E6%A0%88%E4%B8%AD%E6%8B%BF%E5%87%BA%E8%84%9A%E6%9C%AC%E8%BF%90%E8%A1%8C%E7%9A%84%E7%BB%93%E6%9E%9C%0A++++if+%28CastToBool%28stack.back%28%29%29+%3D%3D+false%29%0A++++++++return+set_error%28serror%2C+SCRIPT_ERR_EVAL_FALSE%29%3B%0A%0A++++%2F%2F%E5%85%B6%E4%BB%96%E4%B8%80%E4%BA%9B%E4%BA%A4%E6%98%93%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%A4%84%E7%90%86%0A++++%2F%2F+Bare+witness+programs%0A++++int+witnessversion%3B%0A++++std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B+witnessprogram%3B%0A++++if+%28flags+%26amp%3B+SCRIPT_VERIFY_WITNESS%29+%7B%0A++++++++if+%28scriptPubKey.IsWitnessProgram%28witnessversion%2C+witnessprogram%29%29+%7B%0A++++++++++++hadWitness+%3D+true%3B%0A++++++++++++if+%28scriptSig.size%28%29+%21%3D+0%29+%7B%0A++++++++++++++++%2F%2F+The+scriptSig+must+be+_exactly_+CScript%28%29%2C+otherwise+we+reintroduce+malleability.%0A++++++++++++++++return+set_error%28serror%2C+SCRIPT_ERR_WITNESS_MALLEATED%29%3B%0A++++++++++++%7D%0A++++++++++++if+%28%21VerifyWitnessProgram%28*witness%2C+witnessversion%2C+witnessprogram%2C+flags%2C+checker%2C+serror%29%29+%7B%0A++++++++++++++++return+false%3B%0A++++++++++++%7D%0A++++++++++++%2F%2F+Bypass+the+cleanstack+check+at+the+end.+The+actual+stack+is+obviously+not+clean%0A++++++++++++%2F%2F+for+witness+programs.%0A++++++++++++stack.resize%281%29%3B%0A++++++++%7D%0A++++%7D%0A%0A++++%2F%2F+Additional+validation+for+spend-to-script-hash+transactions%3A%0A++++if+%28%28flags+%26amp%3B+SCRIPT_VERIFY_P2SH%29+%26amp%3B%26amp%3B+scriptPubKey.IsPayToScriptHash%28%29%29%0A++++%7B%0A++++++++%2F%2F+scriptSig+must+be+literals-only+or+validation+fails%0A++++++++if+%28%21scriptSig.IsPushOnly%28%29%29%0A++++++++++++return+set_error%28serror%2C+SCRIPT_ERR_SIG_PUSHONLY%29%3B%0A%0A++++++++%2F%2F+Restore+stack.%0A++++++++swap%28stack%2C+stackCopy%29%3B%0A%0A++++++++%2F%2F+stack+cannot+be+empty+here%2C+because+if+it+was+the%0A++++++++%2F%2F+P2SH++HASH+%26lt%3B%26gt%3B+EQUAL++scriptPubKey+would+be+evaluated+with%0A++++++++%2F%2F+an+empty+stack+and+the+EvalScript+above+would+return+false.%0A++++++++assert%28%21stack.empty%28%29%29%3B%0A%0A++++++++const+valtype%26amp%3B+pubKeySerialized+%3D+stack.back%28%29%3B%0A++++++++CScript+pubKey2%28pubKeySerialized.begin%28%29%2C+pubKeySerialized.end%28%29%29%3B%0A++++++++popstack%28stack%29%3B%0A%0A++++++++if+%28%21EvalScript%28stack%2C+pubKey2%2C+flags%2C+checker%2C+SigVersion%3A%3ABASE%2C+serror%29%29%0A++++++++++++%2F%2F+serror+is+set%0A++++++++++++return+false%3B%0A++++++++if+%28stack.empty%28%29%29%0A++++++++++++return+set_error%28serror%2C+SCRIPT_ERR_EVAL_FALSE%29%3B%0A++++++++if+%28%21CastToBool%28stack.back%28%29%29%29%0A++++++++++++return+set_error%28serror%2C+SCRIPT_ERR_EVAL_FALSE%29%3B%0A%0A++++++++%2F%2F+P2SH+witness+program%0A++++++++if+%28flags+%26amp%3B+SCRIPT_VERIFY_WITNESS%29+%7B%0A++++++++++++if+%28pubKey2.IsWitnessProgram%28witnessversion%2C+witnessprogram%29%29+%7B%0A++++++++++++++++hadWitness+%3D+true%3B%0A++++++++++++++++if+%28scriptSig+%21%3D+CScript%28%29+%26lt%3B%26lt%3B+std%3A%3Avector%26lt%3Bunsigned+char%26gt%3B%28pubKey2.begin%28%29%2C+pubKey2.end%28%29%29%29+%7B%0A++++++++++++++++++++%2F%2F+The+scriptSig+must+be+_exactly_+a+single+push+of+the+redeemScript.+Otherwise+we%0A++++++++++++++++++++%2F%2F+reintroduce+malleability.%0A++++++++++++++++++++return+set_error%28serror%2C+SCRIPT_ERR_WITNESS_MALLEATED_P2SH%29%3B%0A++++++++++++++++%7D%0A++++++++++++++++if+%28%21VerifyWitnessProgram%28*witness%2C+witnessversion%2C+witnessprogram%2C+flags%2C+checker%2C+serror%29%29+%7B%0A++++++++++++++++++++return+false%3B%0A++++++++++++++++%7D%0A++++++++++++++++%2F%2F+Bypass+the+cleanstack+check+at+the+end.+The+actual+stack+is+obviously+not+clean%0A++++++++++++++++%2F%2F+for+witness+programs.%0A++++++++++++++++stack.resize%281%29%3B%0A++++++++++++%7D%0A++++++++%7D%0A++++%7D%0A%0A++++%2F%2F+The+CLEANSTACK+check+is+only+performed+after+potential+P2SH+evaluation%2C%0A++++%2F%2F+as+the+non-P2SH+evaluation+of+a+P2SH+script+will+obviously+not+result+in%0A++++%2F%2F+a+clean+stack+%28the+P2SH+inputs+remain%29.+The+same+holds+for+witness+evaluation.%0A++++if+%28%28flags+%26amp%3B+SCRIPT_VERIFY_CLEANSTACK%29+%21%3D+0%29+%7B%0A++++++++%2F%2F+Disallow+CLEANSTACK+without+P2SH%2C+as+otherwise+a+switch+CLEANSTACK-%26gt%3BP2SH%2BCLEANSTACK%0A++++++++%2F%2F+would+be+possible%2C+which+is+not+a+softfork+%28and+P2SH+should+be+one%29.%0A++++++++assert%28%28flags+%26amp%3B+SCRIPT_VERIFY_P2SH%29+%21%3D+0%29%3B%0A++++++++assert%28%28flags+%26amp%3B+SCRIPT_VERIFY_WITNESS%29+%21%3D+0%29%3B%0A++++++++if+%28stack.size%28%29+%21%3D+1%29+%7B%0A++++++++++++return+set_error%28serror%2C+SCRIPT_ERR_CLEANSTACK%29%3B%0A++++++++%7D%0A++++%7D%0A%0A++++if+%28flags+%26amp%3B+SCRIPT_VERIFY_WITNESS%29+%7B%0A++++++++%2F%2F+We+can%27t+check+for+correct+unexpected+witness+data+if+P2SH+was+off%2C+so+require%0A++++++++%2F%2F+that+WITNESS+implies+P2SH.+Otherwise%2C+going+from+WITNESS-%26gt%3BP2SH%2BWITNESS+would+be%0A++++++++%2F%2F+possible%2C+which+is+not+a+softfork.%0A++++++++assert%28%28flags+%26amp%3B+SCRIPT_VERIFY_P2SH%29+%21%3D+0%29%3B%0A++++++++if+%28%21hadWitness+%26amp%3B%26amp%3B+%21witness-%26gt%3BIsNull%28%29%29+%7B%0A++++++++++++return+set_error%28serror%2C+SCRIPT_ERR_WITNESS_UNEXPECTED%29%3B%0A++++++++%7D%0A++++%7D%0A%0A++++return+set_success%28serror%29%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%BA%90%E7%A0%81%E4%B8%AD%E4%B8%BB%E8%A6%81%E5%B0%B1%E6%98%AF%E8%B0%83%E7%94%A8%E5%89%8D%E9%9D%A2%E6%8F%90%E5%88%B0%E7%9A%84EvalScript%E5%87%BD%E6%95%B0%E8%A7%A3%E6%9E%90%E8%84%9A%E6%9C%AC%E5%B9%B6%E6%9B%B4%E6%96%B0%E5%A0%86%E6%A0%88%EF%BC%8C%E8%BF%98%E6%98%AF%E6%AF%94%E8%BE%83%E5%AE%B9%E6%98%93%E7%90%86%E8%A7%A3%E7%9A%84%E3%80%82%3C%2Fp%3E+%0A++%3Ch1%3E5+%E4%BA%A4%E6%98%93%E5%B9%BF%E6%92%AD%E4%B8%8E%E6%8E%A5%E6%94%B6%3C%2Fh1%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E7%BB%8F%E8%BF%87%E4%B8%8A%E4%B8%80%E8%8A%82%E7%9A%84%E5%A4%84%E7%90%86%E4%BB%A5%E5%90%8E%EF%BC%8C%E4%BA%A4%E6%98%93%E7%9A%84%E8%84%9A%E6%9C%AC%E4%BB%A5%E5%8F%8A%E8%84%9A%E6%9C%AC%E7%9A%84%E9%AA%8C%E8%AF%81%E9%83%BD%E9%80%9A%E8%BF%87%EF%BC%8C%E4%B8%80%E7%AC%94%E4%BA%A4%E6%98%93%E5%B0%B1%E6%AD%A3%E5%BC%8F%E5%88%9B%E5%BB%BA%E6%88%90%E5%8A%9F%E4%BA%86%EF%BC%8C%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%B0%B1%E9%9C%80%E8%A6%81%E5%B0%86%E4%BA%A4%E6%98%93%E5%8A%A0%E5%85%A5%E5%88%B0%E8%8A%82%E7%82%B9%E7%9A%84+%E5%86%85%E5%AD%98%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%EF%BC%8C%E7%AD%89%E5%BE%85%E8%A2%AB%E6%8C%96%E7%9F%BF%EF%BC%8C%E5%90%8C%E6%97%B6%E8%8A%82%E7%82%B9%E8%BF%98%E8%A6%81%E5%B0%86%E4%BA%A4%E6%98%93%E5%B9%BF%E6%92%AD%E5%88%B0%E7%BD%91%E7%BB%9C%E4%B8%AD%EF%BC%8C%E5%85%B6%E4%BB%96%E8%8A%82%E7%82%B9%E5%AF%B9%E4%BA%A4%E6%98%93%E8%BF%9B%E8%A1%8C%E9%AA%8C%E8%AF%81%EF%BC%8C%E6%97%A0%E8%AF%AF%E4%BB%A5%E5%90%8E%E4%B9%9F%E5%8A%A0%E5%85%A5%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BA%A4%E6%98%93%E6%B1%A0%E9%87%8C%E3%80%82%3C%2Fp%3E+%0A++%3Ch2%3E5.1+%E5%B9%BF%E6%92%AD%E4%BA%A4%E6%98%93%3C%2Fh2%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%88%9B%E5%BB%BA%E5%A5%BD%E7%9A%84%E4%BA%A4%E6%98%93%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87jsonapi+sendrawtransaction%E5%91%BD%E4%BB%A4%E5%B9%BF%E6%92%AD%E5%88%B0%E7%BD%91%E7%BB%9C%E5%BD%93%E4%B8%AD%EF%BC%8C%E6%88%91%E4%BB%AC%E7%9B%B4%E6%8E%A5%E7%9C%8B%E8%BF%99%E4%B8%AA%E5%91%BD%E4%BB%A4%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Estatic+UniValue+sendrawtransaction%28const+JSONRPCRequest%26amp%3B+request%29%0A%7B%0A++++%2F%2F%E5%8F%82%E6%95%B0%E6%A3%80%E6%9F%A5%0A++++if+%28request.fHelp+%7C%7C+request.params.size%28%29+%26lt%3B+1+%7C%7C+request.params.size%28%29+%26gt%3B+2%29%0A++++++++throw+std%3A%3Aruntime_error%28%0A++++++++++++++++%22sendrawtransaction+%5C%22hexstring%5C%22+%28+allowhighfees+%29%5Cn%22%0A++++++++++++++++++++++++%22%5CnSubmits+raw+transaction+%28serialized%2C+hex-encoded%29+to+local+node+and+network.%5Cn%22%0A++++++++++++++++++++++++%22%5CnAlso+see+createrawtransaction+and+signrawtransaction+calls.%5Cn%22%0A++++++++++++++++++++++++%22%5CnArguments%3A%5Cn%22%0A++++++++++++++++++++++++%221.+%5C%22hexstring%5C%22++++%28string%2C+required%29+The+hex+string+of+the+raw+transaction%29%5Cn%22%0A++++++++++++++++++++++++%222.+allowhighfees++++%28boolean%2C+optional%2C+default%3Dfalse%29+Allow+high+fees%5Cn%22%0A++++++++++++++++++++++++%22%5CnResult%3A%5Cn%22%0A++++++++++++++++++++++++%22%5C%22hex%5C%22+++++++++++++%28string%29+The+transaction+hash+in+hex%5Cn%22%0A++++++++++++++++++++++++%22%5CnExamples%3A%5Cn%22%0A++++++++++++++++++++++++%22%5CnCreate+a+transaction%5Cn%22%0A++++++++++++++++%2B+HelpExampleCli%28%22createrawtransaction%22%2C+%22%5C%22%5B%7B%5C%5C%5C%22txid%5C%5C%5C%22+%3A+%5C%5C%5C%22mytxid%5C%5C%5C%22%2C%5C%5C%5C%22vout%5C%5C%5C%22%3A0%7D%5D%5C%22+%5C%22%7B%5C%5C%5C%22myaddress%5C%5C%5C%22%3A0.01%7D%5C%22%22%29+%2B%0A++++++++++++++++%22Sign+the+transaction%2C+and+get+back+the+hex%5Cn%22%0A++++++++++++++++%2B+HelpExampleCli%28%22signrawtransaction%22%2C+%22%5C%22myhex%5C%22%22%29+%2B%0A++++++++++++++++%22%5CnSend+the+transaction+%28signed+hex%29%5Cn%22%0A++++++++++++++++%2B+HelpExampleCli%28%22sendrawtransaction%22%2C+%22%5C%22signedhex%5C%22%22%29+%2B%0A++++++++++++++++%22%5CnAs+a+json+rpc+call%5Cn%22%0A++++++++++++++++%2B+HelpExampleRpc%28%22sendrawtransaction%22%2C+%22%5C%22signedhex%5C%22%22%29%0A++++++++%29%3B%0A%0A++++std%3A%3Apromise%26lt%3Bvoid%26gt%3B+promise%3B%0A%0A++++RPCTypeCheck%28request.params%2C+%7BUniValue%3A%3AVSTR%2C+UniValue%3A%3AVBOOL%7D%29%3B%0A%0A++++%2F%2F+parse+hex+string+from+parameter%0A++++%2F%2F%E8%A7%A3%E7%A0%81%E5%87%BA%E4%BA%A4%E6%98%93%0A++++CMutableTransaction+mtx%3B%0A++++if+%28%21DecodeHexTx%28mtx%2C+request.params%5B0%5D.get_str%28%29%29%29%0A++++++++throw+JSONRPCError%28RPC_DESERIALIZATION_ERROR%2C+%22TX+decode+failed%22%29%3B%0A++++CTransactionRef+tx%28MakeTransactionRef%28std%3A%3Amove%28mtx%29%29%29%3B%0A++++const+uint256%26amp%3B+hashTx+%3D+tx-%26gt%3BGetHash%28%29%3B%0A%0A++++CAmount+nMaxRawTxFee+%3D+maxTxFee%3B%0A++++if+%28%21request.params%5B1%5D.isNull%28%29+%26amp%3B%26amp%3B+request.params%5B1%5D.get_bool%28%29%29%0A++++++++nMaxRawTxFee+%3D+0%3B%0A%0A++++%7B+%2F%2F+cs_main+scope%0A++++++++LOCK%28cs_main%29%3B%0A++++++++CCoinsViewCache+%26amp%3Bview+%3D+*pcoinsTip%3B%0A++++++++%2F%2F%E5%88%A4%E6%96%AD%E4%BA%A4%E6%98%93%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%9C%A8%E5%86%85%E5%AD%98%E6%B1%A0%E4%B8%AD%EF%BC%8C%E4%BA%A4%E6%98%93%E6%98%AF%E5%90%A6%E6%9C%89%E8%BE%93%E5%87%BA%E5%B7%B2%E7%BB%8F%E8%A2%AB%E8%8A%B1%E8%B4%B9%E6%8E%89%E4%BA%86%0A++++++++bool+fHaveChain+%3D+false%3B%0A++++++++for+%28size_t+o+%3D+0%3B+%21fHaveChain+%26amp%3B%26amp%3B+o+%26lt%3B+tx-%26gt%3Bvout.size%28%29%3B+o%2B%2B%29+%7B%0A++++++++++++const+Coin%26amp%3B+existingCoin+%3D+view.AccessCoin%28COutPoint%28hashTx%2C+o%29%29%3B%0A++++++++++++fHaveChain+%3D+%21existingCoin.IsSpent%28%29%3B%0A++++++++%7D%0A++++++++bool+fHaveMempool+%3D+mempool.exists%28hashTx%29%3B%0A++++++++%2F%2F%E5%A6%82%E6%9E%9C%E4%BA%A4%E6%98%93%E5%9C%A8%E5%86%85%E5%AD%98%E6%B1%A0%E4%B8%AD%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%B9%B6%E4%B8%94%E4%BA%A4%E6%98%93%E6%89%80%E6%9C%89%E7%9A%84%E8%BE%93%E5%87%BA%E9%83%BD%E6%9C%AA%E8%8A%B1%E8%B4%B9%EF%BC%8C%E5%88%99%E5%B0%86%E4%BA%A4%E6%98%93%E5%8A%A0%E5%85%A5%E5%86%85%E5%AD%98%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%0A++++++++if+%28%21fHaveMempool+%26amp%3B%26amp%3B+%21fHaveChain%29+%7B%0A++++++++++++%2F%2F+push+to+local+node+and+sync+with+wallets%0A++++++++++++CValidationState+state%3B%0A++++++++++++bool+fMissingInputs%3B%0A++++++++++++%2F%2F%E5%B0%9D%E8%AF%95%E5%B0%86%E4%BA%A4%E6%98%93%E5%8A%A0%E5%85%A5%E4%BA%A4%E6%98%93%E6%B1%A0%0A++++++++++++if+%28%21AcceptToMemoryPool%28mempool%2C+state%2C+std%3A%3Amove%28tx%29%2C+%26amp%3BfMissingInputs%2C%0A++++++++++++++++++++++++++++++++++++nullptr+%2F*+plTxnReplaced+*%2F%2C+false+%2F*+bypass_limits+*%2F%2C+nMaxRawTxFee%29%29+%7B%0A++++++++++++++++if+%28state.IsInvalid%28%29%29+%7B%0A++++++++++++++++++++throw+JSONRPCError%28RPC_TRANSACTION_REJECTED%2C+FormatStateMessage%28state%29%29%3B%0A++++++++++++++++%7D+else+%7B%0A++++++++++++++++++++if+%28fMissingInputs%29+%7B%0A++++++++++++++++++++++++throw+JSONRPCError%28RPC_TRANSACTION_ERROR%2C+%22Missing+inputs%22%29%3B%0A++++++++++++++++++++%7D%0A++++++++++++++++++++throw+JSONRPCError%28RPC_TRANSACTION_ERROR%2C+FormatStateMessage%28state%29%29%3B%0A++++++++++++++++%7D%0A++++++++++++%7D+else+%7B%0A++++++++++++++++%2F%2F+If+wallet+is+enabled%2C+ensure+that+the+wallet+has+been+made+aware%0A++++++++++++++++%2F%2F+of+the+new+transaction+prior+to+returning.+This+prevents+a+race%0A++++++++++++++++%2F%2F+where+a+user+might+call+sendrawtransaction+with+a+transaction%0A++++++++++++++++%2F%2F+to%2Ffrom+their+wallet%2C+immediately+call+some+wallet+RPC%2C+and+get%0A++++++++++++++++%2F%2F+a+stale+result+because+callbacks+have+not+yet+been+processed.%0A++++++++++++++++CallFunctionInValidationInterfaceQueue%28%5B%26amp%3Bpromise%5D+%7B%0A++++++++++++++++++++promise.set_value%28%29%3B%0A++++++++++++++++%7D%29%3B%0A++++++++++++%7D%0A++++++++%7D+else+if+%28fHaveChain%29+%7B%0A++++++++++++throw+JSONRPCError%28RPC_TRANSACTION_ALREADY_IN_CHAIN%2C+%22transaction+already+in+block+chain%22%29%3B%0A++++++++%7D+else+%7B%0A++++++++++++%2F%2F+Make+sure+we+don%27t+block+forever+if+re-sending%0A++++++++++++%2F%2F+a+transaction+already+in+mempool.%0A++++++++++++promise.set_value%28%29%3B%0A++++++++%7D%0A%0A++++%7D+%2F%2F+cs_main%0A%0A++++promise.get_future%28%29.wait%28%29%3B%0A%0A++++if%28%21g_connman%29%0A++++++++throw+JSONRPCError%28RPC_CLIENT_P2P_DISABLED%2C+%22Error%3A+Peer-to-peer+functionality+missing+or+disabled%22%29%3B%0A%0A++++%2F%2F%E5%8F%91%E9%80%81INV%E6%B6%88%E6%81%AF%EF%BC%8C%E5%B0%86%E4%BA%A4%E6%98%93%E5%B9%BF%E6%92%AD%E5%88%B0%E7%BD%91%E7%BB%9C%E4%B8%AD%0A++++CInv+inv%28MSG_TX%2C+hashTx%29%3B%0A++++g_connman-%26gt%3BForEachNode%28%5B%26amp%3Binv%5D%28CNode*+pnode%29%0A+++++++++++++++++++++++++++%7B%0A+++++++++++++++++++++++++++++++pnode-%26gt%3BPushInventory%28inv%29%3B%0A+++++++++++++++++++++++++++%7D%29%3B%0A%0A++++return+hashTx.GetHex%28%29%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%8F%AA%E6%9C%89%E4%BA%A4%E6%98%93%E5%9C%A8%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%B9%B6%E4%B8%94%E4%BA%A4%E6%98%93%E7%9A%84%E6%AF%8F%E4%B8%80%E7%AC%94%E8%BE%93%E5%87%BA%E9%83%BD%E6%9C%AA%E8%A2%AB%E8%8A%B1%E8%B4%B9%EF%BC%8C%E6%89%8D%E8%83%BD%E5%B0%86%E4%BA%A4%E6%98%93%E6%B7%BB%E5%8A%A0%E5%88%B0%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%9C%80%E5%90%8E%E4%BC%9A%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AAINV%E6%B6%88%E6%81%AF%E5%8A%A0%E5%85%A5%E5%88%B0%E9%9B%86%E5%90%88%E5%BD%93%E4%B8%AD%EF%BC%8C%E7%AD%89%E5%BE%85%E5%B9%BF%E6%92%AD%E5%88%B0%E7%BD%91%E7%BB%9C%E4%B8%AD%E3%80%82%3C%2Fp%3E+%0A++%3Ch2%3E5.2+%E6%8E%A5%E6%94%B6%E4%BA%A4%E6%98%93%3C%2Fh2%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%86%8D%E6%9D%A5%E7%9C%8B%E7%9C%8B%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%9A%84%E8%8A%82%E7%82%B9%E6%94%B6%E5%88%B0%E4%B8%80%E7%AC%94%E6%96%B0%E4%BA%A4%E6%98%93%E5%90%8E%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E3%80%82ProcessMessage%E4%B8%AD%E5%AF%B9INV%E6%B6%88%E6%81%AF%E7%9A%84%E5%A4%84%E7%90%86%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Eelse+if+%28strCommand+%3D%3D+NetMsgType%3A%3AINV%29%0A%7B%0A++++%2F%2F%E8%AF%BB%E5%87%BA%E6%95%B0%E6%8D%AE%0A++++std%3A%3Avector%26lt%3BCInv%26gt%3B+vInv%3B%0A++++vRecv+%26gt%3B%26gt%3B+vInv%3B%0A++++if+%28vInv.size%28%29+%26gt%3B+MAX_INV_SZ%29%0A++++%7B%0A++++++++LOCK%28cs_main%29%3B%0A++++++++Misbehaving%28pfrom-%26gt%3BGetId%28%29%2C+20%2C+strprintf%28%22message+inv+size%28%29+%3D+%25u%22%2C+vInv.size%28%29%29%29%3B%0A++++++++return+false%3B%0A++++%7D%0A%0A++++bool+fBlocksOnly+%3D+%21fRelayTxes%3B%0A%0A++++%2F%2F+Allow+whitelisted+peers+to+send+data+other+than+blocks+in+blocks+only+mode+if+whitelistrelay+is+true%0A++++if+%28pfrom-%26gt%3BfWhitelisted+%26amp%3B%26amp%3B+gArgs.GetBoolArg%28%22-whitelistrelay%22%2C+DEFAULT_WHITELISTRELAY%29%29%0A++++fBlocksOnly+%3D+false%3B%0A%0A++++LOCK%28cs_main%29%3B%0A%0A++++uint32_t+nFetchFlags+%3D+GetFetchFlags%28pfrom%29%3B%0A%0A++++%2F%2F%E5%A4%84%E7%90%86%E6%94%B6%E5%88%B0%E7%9A%84%E6%AF%8F%E4%B8%80%E4%B8%AAINV%E6%B6%88%E6%81%AF%0A++++for+%28CInv+%26amp%3Binv+%3A+vInv%29%0A++++%7B%0A++++++++if+%28interruptMsgProc%29%0A++++++++return+true%3B%0A%0A++++++++%2F%2F%E5%88%A4%E6%96%AD%E4%BA%A4%E6%98%93%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%E4%BA%8E%E5%8C%BA%E5%9D%97%E9%93%BE%E4%B8%8A%0A++++++++bool+fAlreadyHave+%3D+AlreadyHave%28inv%29%3B%0A++++++++LogPrint%28BCLog%3A%3ANET%2C+%22got+inv%3A+%25s++%25s+peer%3D%25d%5Cn%22%2C+inv.ToString%28%29%2C+fAlreadyHave+%3F+%22have%22+%3A+%22new%22%2C+pfrom-%26gt%3BGetId%28%29%29%3B%0A%0A++++++++if+%28inv.type+%3D%3D+MSG_TX%29+%7B%0A++++++++++++inv.type+%7C%3D+nFetchFlags%3B%0A++++++++%7D%0A%0A++++++++%2F%2F%E5%A6%82%E6%9E%9C%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8C%BA%E5%9D%97%0A++++++++if+%28inv.type+%3D%3D+MSG_BLOCK%29+%7B%0A++++++++++++UpdateBlockAvailability%28pfrom-%26gt%3BGetId%28%29%2C+inv.hash%29%3B%0A++++++++++++if+%28%21fAlreadyHave+%26amp%3B%26amp%3B+%21fImporting+%26amp%3B%26amp%3B+%21fReindex+%26amp%3B%26amp%3B+%21mapBlocksInFlight.count%28inv.hash%29%29+%7B%0A++++++++++++++++%2F%2F+We+used+to+request+the+full+block+here%2C+but+since+headers-announcements+are+now+the%0A++++++++++++++++%2F%2F+primary+method+of+announcement+on+the+network%2C+and+since%2C+in+the+case+that+a+node%0A++++++++++++++++%2F%2F+fell+back+to+inv+we+probably+have+a+reorg+which+we+should+get+the+headers+for+first%2C%0A++++++++++++++++%2F%2F+we+now+only+provide+a+getheaders+response+here.+When+we+receive+the+headers%2C+we+will%0A++++++++++++++++%2F%2F+then+ask+for+the+blocks+we+need.%0A++++++++++++++++connman-%26gt%3BPushMessage%28pfrom%2C+msgMaker.Make%28NetMsgType%3A%3AGETHEADERS%2C+chainActive.GetLocator%28pindexBestHeader%29%2C+inv.hash%29%29%3B%0A++++++++++++++++LogPrint%28BCLog%3A%3ANET%2C+%22getheaders+%28%25d%29+%25s+to+peer%3D%25d%5Cn%22%2C+pindexBestHeader-%26gt%3BnHeight%2C+inv.hash.ToString%28%29%2C+pfrom-%26gt%3BGetId%28%29%29%3B%0A++++++++++++%7D%0A++++++++%7D%0A++++++++%2F%2F%E5%A6%82%E6%9E%9C%E6%94%B6%E5%88%B0%E7%9A%84%E6%98%AF%E4%B8%80%E7%AC%94%E4%BA%A4%E6%98%93%0A++++++++else%0A++++++++%7B%0A++++++++++++pfrom-%26gt%3BAddInventoryKnown%28inv%29%3B%0A++++++++++++if+%28fBlocksOnly%29+%7B%0A++++++++++++++++LogPrint%28BCLog%3A%3ANET%2C+%22transaction+%28%25s%29+inv+sent+in+violation+of+protocol+peer%3D%25d%5Cn%22%2C+inv.hash.ToString%28%29%2C+pfrom-%26gt%3BGetId%28%29%29%3B%0A++++++++++++%7D+else+if+%28%21fAlreadyHave+%26amp%3B%26amp%3B+%21fImporting+%26amp%3B%26amp%3B+%21fReindex+%26amp%3B%26amp%3B+%21IsInitialBlockDownload%28%29%29+%7B%0A++++++++++++++++%2F%2F%E5%A6%82%E6%9E%9C%E4%BA%A4%E6%98%93%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%88%99%E5%B0%86%E8%AF%A5%E4%BA%A4%E6%98%93%E5%8A%A0%E5%85%A5%E5%88%B0%E8%AF%B7%E6%B1%82%E9%9B%86%E5%90%88%E4%B8%AD%0A++++++++++++++++pfrom-%26gt%3BAskFor%28inv%29%3B%0A++++++++++++%7D%0A++++++++%7D%0A%0A++++++++%2F%2F+Track+requests+for+our+stuff%0A++++++++GetMainSignals%28%29.Inventory%28inv.hash%29%3B%0A++++%7D%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%A6%82%E6%9E%9C%E8%8A%82%E7%82%B9%E4%B8%8D%E5%AD%98%E5%9C%A8%E6%94%B6%E5%88%B0%E7%9A%84%E4%BA%A4%E6%98%93hash%EF%BC%8C%E5%88%99%E4%BC%9A%E8%B0%83%E7%94%A8AskFor%E6%9D%A5%E8%AF%B7%E6%B1%82%E4%BA%A4%E6%98%93%E6%95%B0%E6%8D%AE%EF%BC%8CAskFor%E4%BC%9A%E5%B0%86%E8%AF%B7%E6%B1%82%E5%8A%A0%E5%85%A5%E5%88%B0%E9%98%9F%E5%88%97%E4%B8%AD%EF%BC%88mapAskFor%EF%BC%89%E3%80%82%E4%B9%8B%E5%90%8E%E4%BC%9A%E9%81%8D%E5%8E%86%E8%AF%A5%E9%98%9F%E5%88%97%EF%BC%8C%E7%94%9F%E6%88%90GETDATA%E6%B6%88%E6%81%AF%EF%BC%8C%E6%89%B9%E9%87%8F%E6%8B%89%E5%8F%96%E6%9C%AC%E5%9C%B0%E7%BC%BA%E5%A4%B1%E7%9A%84%E4%BA%A4%E6%98%93%EF%BC%88%E6%88%96%E5%8C%BA%E5%9D%97%EF%BC%89%E6%95%B0%E6%8D%AE%EF%BC%88%E5%8F%82%E8%80%83SendMessage%E5%87%BD%E6%95%B0%EF%BC%89%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3E%2F%2F%E9%81%8D%E5%8E%86%E9%98%9F%E5%88%97%0Awhile+%28%21pto-%26gt%3BmapAskFor.empty%28%29+%26amp%3B%26amp%3B+%28*pto-%26gt%3BmapAskFor.begin%28%29%29.first+%26lt%3B%3D+nNow%29%0A%7B%0A++++const+CInv%26amp%3B+inv+%3D+%28*pto-%26gt%3BmapAskFor.begin%28%29%29.second%3B%0A++++if+%28%21AlreadyHave%28inv%29%29%0A++++%7B%0A++++++++%2F%2F%E4%BA%A4%E6%98%93%EF%BC%88%E6%88%96%E8%80%85%E5%8C%BA%E5%9D%97%EF%BC%89%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%8C%E6%8F%92%E5%85%A5vGetData%E9%9B%86%E5%90%88%EF%BC%8C%E5%BD%93%E9%9B%86%E5%90%88%E4%B8%AD%E6%95%B0%E6%8D%AE%E8%BE%BE%E5%88%B01000%2B%E6%97%B6%EF%BC%8C%E5%8F%91%E9%80%81GETDATA%E6%B6%88%E6%81%AF%E6%89%B9%E9%87%8F%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%0A++++++++LogPrint%28BCLog%3A%3ANET%2C+%22Requesting+%25s+peer%3D%25d%5Cn%22%2C+inv.ToString%28%29%2C+pto-%26gt%3BGetId%28%29%29%3B%0A++++++++vGetData.push_back%28inv%29%3B%0A++++++++if+%28vGetData.size%28%29+%26gt%3B%3D+1000%29%0A++++++++%7B%0A++++++++++++connman-%26gt%3BPushMessage%28pto%2C+msgMaker.Make%28NetMsgType%3A%3AGETDATA%2C+vGetData%29%29%3B%0A++++++++++++vGetData.clear%28%29%3B%0A++++++++%7D%0A++++%7D+else+%7B%0A++++++++%2F%2FIf+we%27re+not+going+to+ask%2C+don%27t+expect+a+response.%0A++++++++%2F%2F%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%E4%BA%86%EF%BC%8C%E4%BB%8E%E9%9B%86%E5%90%88%E9%87%8C%E5%88%A0%E9%99%A4%0A++++++++pto-%26gt%3BsetAskFor.erase%28inv.hash%29%3B%0A++++%7D%0A++++%2F%2F%E4%BB%8E%E9%98%9F%E5%88%97%E4%B8%AD%E5%88%A0%E9%99%A4%0A++++pto-%26gt%3BmapAskFor.erase%28pto-%26gt%3BmapAskFor.begin%28%29%29%3B%0A%7D%0A%0A%2F%2F%E5%A6%82%E6%9E%9C%E9%9B%86%E5%90%88%E4%B8%8D%E7%A9%BA%0Aif+%28%21vGetData.empty%28%29%29%0A++++connman-%26gt%3BPushMessage%28pto%2C+msgMaker.Make%28NetMsgType%3A%3AGETDATA%2C+vGetData%29%29%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E9%95%BF%E8%AF%9D%E7%9F%AD%E8%AF%B4%E5%B0%B1%E6%98%AF%E7%AD%89%E9%98%9F%E5%88%97%E4%B8%AD%E9%9B%86%E9%BD%901000%E6%9D%A1%E6%88%96%E6%9B%B4%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%97%B6%EF%BC%8C%E5%8F%91%E9%80%81%E4%B8%80%E6%9D%A1GETDATA%E6%B6%88%E6%81%AF%EF%BC%8C%E6%89%B9%E9%87%8F%E6%8B%89%E5%8F%96%E6%95%B0%E6%8D%AE%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%86%8D%E6%9D%A5%E7%9C%8B%E7%9C%8B%E8%8A%82%E7%82%B9%E6%94%B6%E5%88%B0GETDATA%E6%B6%88%E6%81%AF%E5%90%8E%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Eelse+if+%28strCommand+%3D%3D+NetMsgType%3A%3AGETDATA%29%0A%7B%0A++++%2F%2F%E4%BB%8E%E6%B5%81%E4%B8%AD%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%0A++++std%3A%3Avector%26lt%3BCInv%26gt%3B+vInv%3B%0A++++vRecv+%26gt%3B%26gt%3B+vInv%3B%0A++++if+%28vInv.size%28%29+%26gt%3B+MAX_INV_SZ%29%0A++++%7B%0A++++++++LOCK%28cs_main%29%3B%0A++++++++Misbehaving%28pfrom-%26gt%3BGetId%28%29%2C+20%2C+strprintf%28%22message+getdata+size%28%29+%3D+%25u%22%2C+vInv.size%28%29%29%29%3B%0A++++++++return+false%3B%0A++++%7D%0A++++%0A++++LogPrint%28BCLog%3A%3ANET%2C+%22received+getdata+%28%25u+invsz%29+peer%3D%25d%5Cn%22%2C+vInv.size%28%29%2C+pfrom-%26gt%3BGetId%28%29%29%3B%0A++++%0A++++if+%28vInv.size%28%29+%26gt%3B+0%29+%7B%0A++++++++LogPrint%28BCLog%3A%3ANET%2C+%22received+getdata+for%3A+%25s+peer%3D%25d%5Cn%22%2C+vInv%5B0%5D.ToString%28%29%2C+pfrom-%26gt%3BGetId%28%29%29%3B%0A++++%7D%0A++++%0A++++%2F%2F%E5%B0%86%E6%89%80%E6%9C%89GETDATA%E8%AF%B7%E6%B1%82%E6%B7%BB%E5%8A%A0%E5%88%B0%E9%9B%86%E5%90%88%E4%B8%AD%0A++++pfrom-%26gt%3BvRecvGetData.insert%28pfrom-%26gt%3BvRecvGetData.end%28%29%2C+vInv.begin%28%29%2C+vInv.end%28%29%29%3B%0A++++%2F%2F%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%0A++++ProcessGetData%28pfrom%2C+chainparams.GetConsensus%28%29%2C+connman%2C+interruptMsgProc%29%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%8C%E4%B8%BB%E8%A6%81%E6%98%AF%E8%B0%83%E7%94%A8ProcessGetData%E6%9D%A5%E5%A4%84%E7%90%86%EF%BC%8C%E7%BB%A7%E7%BB%AD%E8%B7%9F%E8%BF%9B%E5%8E%BB%E4%B8%80%E6%8E%A2%E7%A9%B6%E7%AB%9F%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Evoid+static+ProcessGetData%28CNode*+pfrom%2C+const+Consensus%3A%3AParams%26amp%3B+consensusParams%2C+CConnman*+connman%2C+const+std%3A%3Aatomic%26lt%3Bbool%26gt%3B%26amp%3B+interruptMsgProc%29%0A%7B%0A++++AssertLockNotHeld%28cs_main%29%3B%0A%0A++++std%3A%3Adeque%26lt%3BCInv%26gt%3B%3A%3Aiterator+it+%3D+pfrom-%26gt%3BvRecvGetData.begin%28%29%3B%0A++++std%3A%3Avector%26lt%3BCInv%26gt%3B+vNotFound%3B%0A++++const+CNetMsgMaker+msgMaker%28pfrom-%26gt%3BGetSendVersion%28%29%29%3B%0A++++%7B%0A++++++++LOCK%28cs_main%29%3B%0A%0A++++++++%2F%2F%E9%81%8D%E5%8E%86%E9%9B%86%E5%90%88%0A++++++++while+%28it+%21%3D+pfrom-%26gt%3BvRecvGetData.end%28%29+%26amp%3B%26amp%3B+%28it-%26gt%3Btype+%3D%3D+MSG_TX+%7C%7C+it-%26gt%3Btype+%3D%3D+MSG_WITNESS_TX%29%29+%7B%0A++++++++++++if+%28interruptMsgProc%29%0A++++++++++++++++return%3B%0A++++++++++++%2F%2F+Don%27t+bother+if+send+buffer+is+too+full+to+respond+anyway%0A++++++++++++if+%28pfrom-%26gt%3BfPauseSend%29%0A++++++++++++++++break%3B%0A%0A++++++++++++const+CInv+%26amp%3Binv+%3D+*it%3B%0A++++++++++++it%2B%2B%3B%0A%0A++++++++++++%2F%2F+Send+stream+from+relay+memory%0A++++++++++++%2F%2F%E6%A3%80%E6%9F%A5mapRelay%E6%88%96%E8%80%85%E5%86%85%E5%AD%98%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E4%BA%A4%E6%98%93%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%AD%98%E5%9C%A8%E5%8F%91%E9%80%81TX%E6%B6%88%E6%81%AF%EF%BC%8C%E5%B0%86%E4%BA%A4%E6%98%93%E6%95%B0%E6%8D%AE%E5%8F%91%E9%80%81%E7%BB%99%E8%AF%B7%E6%B1%82%E6%96%B9%0A++++++++++++bool+push+%3D+false%3B%0A++++++++++++auto+mi+%3D+mapRelay.find%28inv.hash%29%3B%0A++++++++++++int+nSendFlags+%3D+%28inv.type+%3D%3D+MSG_TX+%3F+SERIALIZE_TRANSACTION_NO_WITNESS+%3A+0%29%3B%0A++++++++++++if+%28mi+%21%3D+mapRelay.end%28%29%29+%7B%0A++++++++++++++++connman-%26gt%3BPushMessage%28pfrom%2C+msgMaker.Make%28nSendFlags%2C+NetMsgType%3A%3ATX%2C+*mi-%26gt%3Bsecond%29%29%3B%0A++++++++++++++++push+%3D+true%3B%0A++++++++++++%7D+else+if+%28pfrom-%26gt%3BtimeLastMempoolReq%29+%7B%0A++++++++++++++++auto+txinfo+%3D+mempool.info%28inv.hash%29%3B%0A++++++++++++++++%2F%2F+To+protect+privacy%2C+do+not+answer+getdata+using+the+mempool+when%0A++++++++++++++++%2F%2F+that+TX+couldn%27t+have+been+INVed+in+reply+to+a+MEMPOOL+request.%0A++++++++++++++++if+%28txinfo.tx+%26amp%3B%26amp%3B+txinfo.nTime+%26lt%3B%3D+pfrom-%26gt%3BtimeLastMempoolReq%29+%7B%0A++++++++++++++++++++connman-%26gt%3BPushMessage%28pfrom%2C+msgMaker.Make%28nSendFlags%2C+NetMsgType%3A%3ATX%2C+*txinfo.tx%29%29%3B%0A++++++++++++++++++++push+%3D+true%3B%0A++++++++++++++++%7D%0A++++++++++++%7D%0A++++++++++++if+%28%21push%29+%7B%0A++++++++++++++++vNotFound.push_back%28inv%29%3B%0A++++++++++++%7D%0A%0A++++++++++++%2F%2F+Track+requests+for+our+stuff.%0A++++++++++++GetMainSignals%28%29.Inventory%28inv.hash%29%3B%0A++++++++%7D%0A++++%7D+%2F%2F+release+cs_main%0A%0A++++if+%28it+%21%3D+pfrom-%26gt%3BvRecvGetData.end%28%29+%26amp%3B%26amp%3B+%21pfrom-%26gt%3BfPauseSend%29+%7B%0A++++++++const+CInv+%26amp%3Binv+%3D+*it%3B%0A++++++++if+%28inv.type+%3D%3D+MSG_BLOCK+%7C%7C+inv.type+%3D%3D+MSG_FILTERED_BLOCK+%7C%7C+inv.type+%3D%3D+MSG_CMPCT_BLOCK+%7C%7C+inv.type+%3D%3D+MSG_WITNESS_BLOCK%29+%7B%0A++++++++++++it%2B%2B%3B%0A++++++++++++ProcessGetBlockData%28pfrom%2C+consensusParams%2C+inv%2C+connman%2C+interruptMsgProc%29%3B%0A++++++++%7D%0A++++%7D%0A%0A++++%2F%2F%E5%A4%84%E7%90%86%E5%AE%8C%E4%BB%A5%E5%90%8E%E4%BB%8E%E9%9B%86%E5%90%88%E4%B8%AD%E5%88%A0%E9%99%A4%E6%8E%89%0A++++pfrom-%26gt%3BvRecvGetData.erase%28pfrom-%26gt%3BvRecvGetData.begin%28%29%2C+it%29%3B%0A%0A++++if+%28%21vNotFound.empty%28%29%29+%7B%0A++++++++%2F%2F+Let+the+peer+know+that+we+didn%27t+find+what+it+asked+for%2C+so+it+doesn%27t%0A++++++++%2F%2F+have+to+wait+around+forever.+Currently+only+SPV+clients+actually+care%0A++++++++%2F%2F+about+this+message%3A+it%27s+needed+when+they+are+recursively+walking+the%0A++++++++%2F%2F+dependencies+of+relevant+unconfirmed+transactions.+SPV+clients+want+to%0A++++++++%2F%2F+do+that+because+they+want+to+know+about+%28and+store+and+rebroadcast+and%0A++++++++%2F%2F+risk+analyze%29+the+dependencies+of+transactions+relevant+to+them%2C+without%0A++++++++%2F%2F+having+to+download+the+entire+memory+pool.%0A++++++++connman-%26gt%3BPushMessage%28pfrom%2C+msgMaker.Make%28NetMsgType%3A%3ANOTFOUND%2C+vNotFound%29%29%3B%0A++++%7D%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E8%8A%82%E7%82%B9%E4%BC%9A%E4%BB%8ERelayMap%E5%92%8C%E5%86%85%E5%AD%98%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%E5%AF%BB%E6%89%BE%E8%AF%B7%E6%B1%82%E7%9A%84%E4%BA%A4%E6%98%93%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%89%BE%E5%88%B0%E5%B0%86%E5%90%91peer%E5%8F%91%E9%80%81TX%E6%B6%88%E6%81%AF%EF%BC%8C%E5%B0%86%E4%BA%A4%E6%98%93%E6%95%B0%E6%8D%AE%E5%8F%91%E9%80%81%E7%BB%99peer%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%9C%80%E5%90%8E%EF%BC%8Cpeer%E6%94%B6%E5%88%B0TX%E6%B6%88%E6%81%AF%EF%BC%8C%E6%8B%BF%E5%88%B0%E4%BA%A4%E6%98%93%EF%BC%8C%E7%84%B6%E5%90%8E%E5%AF%B9%E4%BA%A4%E6%98%93%E8%BF%9B%E8%A1%8C%E6%A0%A1%E9%AA%8C%EF%BC%8C%E9%AA%8C%E8%AF%81%E6%97%A0%E8%AF%AF%E5%90%8E%E5%B0%86%E4%BA%A4%E6%98%93%E5%8A%A0%E5%85%A5%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%EF%BC%8CTX%E6%B6%88%E6%81%AF%E7%9A%84%E5%A4%84%E7%90%86%E6%AF%94%E8%BE%83%E5%A4%8D%E6%9D%82%EF%BC%8C%E6%B6%89%E5%8F%8A%E5%88%B0%E5%AD%A4%E7%AB%8B%E4%BA%A4%E6%98%93%E7%9A%84%E5%A4%84%E7%90%86%EF%BC%88%E4%B8%A4%E7%A7%8D%E6%83%85%E5%86%B5%EF%BC%9A%E8%AF%A5%E4%BA%A4%E6%98%93%E4%BE%9D%E8%B5%96%E7%9A%84%E4%BA%A4%E6%98%93%E8%BF%98%E6%B2%A1%E6%94%B6%E5%88%B0%EF%BC%8C%E6%AD%A4%E6%97%B6%E6%94%B6%E5%88%B0%E7%9A%84%E4%BA%A4%E6%98%93%E6%88%90%E4%B8%BA%E5%AD%A4%E7%AB%8B%E4%BA%A4%E6%98%93%EF%BC%9B%E5%8F%A6%E5%A4%96%E4%B8%80%E7%A7%8D%E6%83%85%E5%86%B5%E6%98%AF%E5%AD%A4%E7%AB%8B%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%E6%9C%89%E4%BE%9D%E8%B5%96%E4%BA%8E%E8%AF%A5%E4%BA%A4%E6%98%93%E7%9A%84%E5%AD%A4%E7%AB%8B%E4%BA%A4%E6%98%93%EF%BC%8C%E5%BD%93%E8%AF%A5%E4%BA%A4%E6%98%93%E6%94%B6%E5%88%B0%E4%BB%A5%E5%90%8E%EF%BC%8C%E9%9C%80%E8%A6%81%E5%B0%86%E5%AD%A4%E7%AB%8B%E4%BA%A4%E6%98%93%E4%BB%8E%E9%BC%93%E5%8A%B1%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%E7%A7%BB%E8%B5%B0%E5%B9%B6%E5%8A%A0%E5%85%A5%E5%88%B0%E5%86%85%E5%AD%98%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%EF%BC%89%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AA%E6%88%AA%E5%8F%96%E4%B8%80%E9%83%A8%E5%88%86%E4%BB%A3%E7%A0%81%EF%BC%8C%E8%AF%A6%E7%BB%86%E7%9A%84%E5%A4%84%E7%90%86%E8%AF%BB%E8%80%85%E5%8F%AF%E8%87%AA%E8%A1%8C%E9%98%85%E8%AF%BB%E6%BA%90%E7%A0%81net_processing.cpp%E7%9A%84ProcessMessage%E6%96%B9%E6%B3%95%E3%80%82%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Eelse+if+%28strCommand+%3D%3D+NetMsgType%3A%3ATX%29%0A%7B%0A++++%2F%2F+Stop+processing+the+transaction+early+if%0A++++%2F%2F+We+are+in+blocks+only+mode+and+peer+is+either+not+whitelisted+or+whitelistrelay+is+off%0A++++if+%28%21fRelayTxes+%26amp%3B%26amp%3B+%28%21pfrom-%26gt%3BfWhitelisted+%7C%7C+%21gArgs.GetBoolArg%28%22-whitelistrelay%22%2C+DEFAULT_WHITELISTRELAY%29%29%29%0A++++%7B%0A++++++++LogPrint%28BCLog%3A%3ANET%2C+%22transaction+sent+in+violation+of+protocol+peer%3D%25d%5Cn%22%2C+pfrom-%26gt%3BGetId%28%29%29%3B%0A++++++++return+true%3B%0A++++%7D%0A%0A++++std%3A%3Adeque%26lt%3BCOutPoint%26gt%3B+vWorkQueue%3B%0A++++std%3A%3Avector%26lt%3Buint256%26gt%3B+vEraseQueue%3B%0A%0A++++%2F%2F%E4%BB%8E%E6%B5%81%E4%B8%AD%E8%AF%BB%E5%8F%96%E4%BA%A4%E6%98%93%0A++++CTransactionRef+ptx%3B%0A++++vRecv+%26gt%3B%26gt%3B+ptx%3B%0A++++const+CTransaction%26amp%3B+tx+%3D+*ptx%3B%0A%0A++++CInv+inv%28MSG_TX%2C+tx.GetHash%28%29%29%3B%0A++++pfrom-%26gt%3BAddInventoryKnown%28inv%29%3B%0A%0A++++LOCK2%28cs_main%2C+g_cs_orphans%29%3B%0A%0A++++bool+fMissingInputs+%3D+false%3B%0A++++CValidationState+state%3B%0A%0A++++%2F%2F%E4%BA%A4%E6%98%93%E5%B7%B2%E7%BB%8F%E8%8E%B7%E5%8F%96%EF%BC%8C%E4%BB%8E%E7%9B%B8%E5%85%B3%E9%9B%86%E5%90%88%E4%B8%AD%E5%88%A0%E9%99%A4%0A++++pfrom-%26gt%3BsetAskFor.erase%28inv.hash%29%3B%0A++++mapAlreadyAskedFor.erase%28inv.hash%29%3B%0A%0A++++std%3A%3Alist%26lt%3BCTransactionRef%26gt%3B+lRemovedTxn%3B%0A+%0A++++%2F%2F%E5%A6%82%E6%9E%9C%E4%BA%A4%E6%98%93%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%88%99%E8%B0%83%E7%94%A8AcceptToMemoryPool%E5%B0%86%E4%BA%A4%E6%98%93%E5%8A%A0%E5%85%A5%E5%88%B0%E5%86%85%E5%AD%98%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%0A++++if+%28%21AlreadyHave%28inv%29+%26amp%3B%26amp%3B%0A++++AcceptToMemoryPool%28mempool%2C+state%2C+ptx%2C+%26amp%3BfMissingInputs%2C+%26amp%3BlRemovedTxn%2C+false+%2F*+bypass_limits+*%2F%2C+0+%2F*+nAbsurdFee+*%2F%29%29+%7B%0A++++++++mempool.check%28pcoinsTip.get%28%29%29%3B%0A++++++++RelayTransaction%28tx%2C+connman%29%3B%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E6%9C%80%E7%BB%88%E5%90%8C%E6%A0%B7%E8%B0%83%E7%94%A8AcceptToMemoryPool%E5%B0%86%E4%BA%A4%E6%98%93%E6%B7%BB%E5%8A%A0%E5%88%B0%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%E3%80%82AcceptToMemoryPool%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E7%9A%84%E5%A4%84%E7%90%86%E9%80%BB%E8%BE%91%E9%9D%9E%E5%B8%B8%E5%A4%8D%E6%9D%82%EF%BC%8C%E4%BC%9A%E5%AF%B9%E4%BA%A4%E6%98%93%E8%BF%9B%E8%A1%8C%E5%90%84%E7%A7%8D%E6%A3%80%E6%9F%A5%EF%BC%8C%E5%8C%85%E6%8B%AC%E4%BA%A4%E6%98%93%E7%9A%84%E6%A0%BC%E5%BC%8F%EF%BC%8C%E4%BA%A4%E6%98%93%E6%98%AF%E5%90%A6%E6%98%AF%E6%9C%89%E5%8F%8C%E8%8A%B1%E9%97%AE%E9%A2%98%EF%BC%8C%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%E7%9A%84%E9%AA%8C%E8%AF%81%E7%AD%89%E7%AD%89%E3%80%82%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E9%9D%9E%E5%B8%B8%E9%87%8D%E8%A6%81%EF%BC%8C%E5%BB%BA%E8%AE%AE%E8%AF%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E4%BB%94%E7%BB%86%E9%98%85%E8%AF%BB%E8%AF%A5%E5%87%BD%E6%95%B0%E7%9A%84%E6%BA%90%E7%A0%81%E5%8A%A0%E6%B7%B1%E5%AF%B9%E4%BA%A4%E6%98%93%E7%9A%84%E7%90%86%E8%A7%A3%E3%80%82AcceptToMemoryPool%26nbsp%3B%E5%87%BD%E6%95%B0%E9%87%8C%E4%BC%9A%E8%B0%83%E7%94%A8CheckInputs%E6%A3%80%E6%9F%A5%E4%BA%A4%E6%98%93%E7%9A%84%E6%AF%8F%E4%B8%80%E7%AC%94%E8%BE%93%E5%85%A5%EF%BC%8C%E5%85%B6%E4%B8%AD%E5%B0%B1%E5%8C%85%E5%90%AB%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%E7%9A%84%E9%AA%8C%E8%AF%81%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3E%2F**%0A+*+Check+whether+all+inputs+of+this+transaction+are+valid+%28no+double+spends%2C+scripts+%26amp%3B+sigs%2C+amounts%29%0A+*+This+does+not+modify+the+UTXO+set.%0A+*%0A+*+If+pvChecks+is+not+nullptr%2C+script+checks+are+pushed+onto+it+instead+of+being+performed+inline.+Any%0A+*+script+checks+which+are+not+necessary+%28eg+due+to+script+execution+cache+hits%29+are%2C+obviously%2C%0A+*+not+pushed+onto+pvChecks%2Frun.%0A+*%0A+*+Setting+cacheSigStore%2FcacheFullScriptStore+to+false+will+remove+elements+from+the+corresponding+cache%0A+*+which+are+matched.+This+is+useful+for+checking+blocks+where+we+will+likely+never+need+the+cache%0A+*+entry+again.%0A+*%0A+*+Non-static+%28and+re-declared%29+in+src%2Ftest%2Ftxvalidationcache_tests.cpp%0A+*%2F%0Abool+CheckInputs%28const+CTransaction%26amp%3B+tx%2C+CValidationState+%26amp%3Bstate%2C+const+CCoinsViewCache+%26amp%3Binputs%2C+bool+fScriptChecks%2C+unsigned+int+flags%2C+bool+cacheSigStore%2C+bool+cacheFullScriptStore%2C+PrecomputedTransactionData%26amp%3B+txdata%2C+std%3A%3Avector%26lt%3BCScriptCheck%26gt%3B+*pvChecks%29%0A%7B%0A++++if+%28%21tx.IsCoinBase%28%29%29%0A++++%7B%0A++++++++if+%28pvChecks%29%0A++++++++++++pvChecks-%26gt%3Breserve%28tx.vin.size%28%29%29%3B%0A%0A++++++++%2F%2F+The+first+loop+above+does+all+the+inexpensive+checks.%0A++++++++%2F%2F+Only+if+ALL+inputs+pass+do+we+perform+expensive+ECDSA+signature+checks.%0A++++++++%2F%2F+Helps+prevent+CPU+exhaustion+attacks.%0A%0A++++++++%2F%2F+Skip+script+verification+when+connecting+blocks+under+the%0A++++++++%2F%2F+assumevalid+block.+Assuming+the+assumevalid+block+is+valid+this%0A++++++++%2F%2F+is+safe+because+block+merkle+hashes+are+still+computed+and+checked%2C%0A++++++++%2F%2F+Of+course%2C+if+an+assumed+valid+block+is+invalid+due+to+false+scriptSigs%0A++++++++%2F%2F+this+optimization+would+allow+an+invalid+chain+to+be+accepted.%0A++++++++if+%28fScriptChecks%29+%7B%0A++++++++++++%2F%2F+First+check+if+script+executions+have+been+cached+with+the+same%0A++++++++++++%2F%2F+flags.+Note+that+this+assumes+that+the+inputs+provided+are%0A++++++++++++%2F%2F+correct+%28ie+that+the+transaction+hash+which+is+in+tx%27s+prevouts%0A++++++++++++%2F%2F+properly+commits+to+the+scriptPubKey+in+the+inputs+view+of+that%0A++++++++++++%2F%2F+transaction%29.%0A++++++++++++uint256+hashCacheEntry%3B%0A++++++++++++%2F%2F+We+only+use+the+first+19+bytes+of+nonce+to+avoid+a+second+SHA%0A++++++++++++%2F%2F+round+-+giving+us+19+%2B+32+%2B+4+%3D+55+bytes+%28%2B+8+%2B+1+%3D+64%29%0A++++++++++++static_assert%2855+-+sizeof%28flags%29+-+32+%26gt%3B%3D+128%2F8%2C+%22Want+at+least+128+bits+of+nonce+for+script+execution+cache%22%29%3B%0A++++++++++++CSHA256%28%29.Write%28scriptExecutionCacheNonce.begin%28%29%2C+55+-+sizeof%28flags%29+-+32%29.Write%28tx.GetWitnessHash%28%29.begin%28%29%2C+32%29.Write%28%28unsigned+char*%29%26amp%3Bflags%2C+sizeof%28flags%29%29.Finalize%28hashCacheEntry.begin%28%29%29%3B%0A++++++++++++AssertLockHeld%28cs_main%29%3B+%2F%2FTODO%3A+Remove+this+requirement+by+making+CuckooCache+not+require+external+locks%0A++++++++++++if+%28scriptExecutionCache.contains%28hashCacheEntry%2C+%21cacheFullScriptStore%29%29+%7B%0A++++++++++++++++return+true%3B%0A++++++++++++%7D%0A%0A++++++++++++%2F%2F%E6%A3%80%E6%9F%A5%E4%BA%A4%E6%98%93%E7%9A%84%E6%AF%8F%E4%B8%80%E7%AC%94%E8%BE%93%E5%85%A5%0A++++++++++++for+%28unsigned+int+i+%3D+0%3B+i+%26lt%3B+tx.vin.size%28%29%3B+i%2B%2B%29+%7B%0A++++++++++++++++%2F%2F%E6%89%BE%E5%88%B0%E8%BE%93%E5%85%A5%E6%8C%87%E5%90%91%E7%9A%84UTXO%EF%BC%8C%E7%A1%AE%E4%BF%9D%E5%85%B6%E5%B9%B6%E6%9C%AA%E8%A2%AB%E8%8A%B1%E8%B4%B9%0A++++++++++++++++const+COutPoint+%26amp%3Bprevout+%3D+tx.vin%5Bi%5D.prevout%3B%0A++++++++++++++++const+Coin%26amp%3B+coin+%3D+inputs.AccessCoin%28prevout%29%3B%0A++++++++++++++++assert%28%21coin.IsSpent%28%29%29%3B%0A%0A++++++++++++++++%2F%2F+We+very+carefully+only+pass+in+things+to+CScriptCheck+which%0A++++++++++++++++%2F%2F+are+clearly+committed+to+by+tx%27+witness+hash.+This+provides%0A++++++++++++++++%2F%2F+a+sanity+check+that+our+caching+is+not+introducing+consensus%0A++++++++++++++++%2F%2F+failures+through+additional+data+in%2C+eg%2C+the+coins+being%0A++++++++++++++++%2F%2F+spent+being+checked+as+a+part+of+CScriptCheck.%0A%0A++++++++++++++++%2F%2F+Verify+signature%0A++++++++++++++++%2F%2F%E6%A0%A1%E9%AA%8C%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%0A++++++++++++++++CScriptCheck+check%28coin.out%2C+tx%2C+i%2C+flags%2C+cacheSigStore%2C+%26amp%3Btxdata%29%3B%0A++++++++++++++++if+%28pvChecks%29+%7B%0A++++++++++++++++++++pvChecks-%26gt%3Bpush_back%28CScriptCheck%28%29%29%3B%0A++++++++++++++++++++check.swap%28pvChecks-%26gt%3Bback%28%29%29%3B%0A++++++++++++++++%7D+else+if+%28%21check%28%29%29+%7B%0A++++++++++++++++++++if+%28flags+%26amp%3B+STANDARD_NOT_MANDATORY_VERIFY_FLAGS%29+%7B%0A++++++++++++++++++++++++%2F%2F+Check+whether+the+failure+was+caused+by+a%0A++++++++++++++++++++++++%2F%2F+non-mandatory+script+verification+check%2C+such+as%0A++++++++++++++++++++++++%2F%2F+non-standard+DER+encodings+or+non-null+dummy%0A++++++++++++++++++++++++%2F%2F+arguments%3B+if+so%2C+don%27t+trigger+DoS+protection+to%0A++++++++++++++++++++++++%2F%2F+avoid+splitting+the+network+between+upgraded+and%0A++++++++++++++++++++++++%2F%2F+non-upgraded+nodes.%0A++++++++++++++++++++++++CScriptCheck+check2%28coin.out%2C+tx%2C+i%2C%0A++++++++++++++++++++++++++++++++++++++++++++flags+%26amp%3B+%7ESTANDARD_NOT_MANDATORY_VERIFY_FLAGS%2C+cacheSigStore%2C+%26amp%3Btxdata%29%3B%0A++++++++++++++++++++++++if+%28check2%28%29%29%0A++++++++++++++++++++++++++++return+state.Invalid%28false%2C+REJECT_NONSTANDARD%2C+strprintf%28%22non-mandatory-script-verify-flag+%28%25s%29%22%2C+ScriptErrorString%28check.GetScriptError%28%29%29%29%29%3B%0A++++++++++++++++++++%7D%0A++++++++++++++++++++%2F%2F+Failures+of+other+flags+indicate+a+transaction+that+is%0A++++++++++++++++++++%2F%2F+invalid+in+new+blocks%2C+e.g.+an+invalid+P2SH.+We+DoS+ban%0A++++++++++++++++++++%2F%2F+such+nodes+as+they+are+not+following+the+protocol.+That%0A++++++++++++++++++++%2F%2F+said+during+an+upgrade+careful+thought+should+be+taken%0A++++++++++++++++++++%2F%2F+as+to+the+correct+behavior+-+we+may+want+to+continue%0A++++++++++++++++++++%2F%2F+peering+with+non-upgraded+nodes+even+after+soft-fork%0A++++++++++++++++++++%2F%2F+super-majority+signaling+has+occurred.%0A++++++++++++++++++++return+state.DoS%28100%2Cfalse%2C+REJECT_INVALID%2C+strprintf%28%22mandatory-script-verify-flag-failed+%28%25s%29%22%2C+ScriptErrorString%28check.GetScriptError%28%29%29%29%29%3B%0A++++++++++++++++%7D%0A++++++++++++%7D%0A%0A++++++++++++if+%28cacheFullScriptStore+%26amp%3B%26amp%3B+%21pvChecks%29+%7B%0A++++++++++++++++%2F%2F+We+executed+all+of+the+provided+scripts%2C+and+were+told+to%0A++++++++++++++++%2F%2F+cache+the+result.+Do+so+now.%0A++++++++++++++++scriptExecutionCache.insert%28hashCacheEntry%29%3B%0A++++++++++++%7D%0A++++++++%7D%0A++++%7D%0A%0A++++return+true%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%80%9A%E8%BF%87%E4%BB%BF%E5%87%BD%E6%95%B0CScriptCheck%E6%9D%A5%E5%AF%B9%E4%BA%A4%E6%98%93%E7%AD%BE%E5%90%8D%E8%BF%9B%E8%A1%8C%E6%A0%A1%E9%AA%8C%EF%BC%8C%E4%BB%A5%E4%BA%A4%E6%98%93%E3%80%81%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%9A%84%E7%B4%A2%E5%BC%95%E3%80%81%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E6%8C%87%E5%90%91%E7%9A%84UTXO%E7%AD%89%E4%BD%9C%E4%B8%BA%E5%8F%82%E6%95%B0%E6%9E%84%E5%BB%BACScriptCheck%E5%AF%B9%E8%B1%A1%EF%BC%8C%E6%89%A7%E8%A1%8C%E6%A0%A1%E9%AA%8C%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-cpp%22%3Ebool+CScriptCheck%3A%3Aoperator%28%29%28%29+%7B%0A++++const+CScript+%26amp%3BscriptSig+%3D+ptxTo-%26gt%3Bvin%5BnIn%5D.scriptSig%3B%0A++++const+CScriptWitness+*witness+%3D+%26amp%3BptxTo-%26gt%3Bvin%5BnIn%5D.scriptWitness%3B%0A++++return+VerifyScript%28scriptSig%2C+m_tx_out.scriptPubKey%2C+witness%2C+nFlags%2C+CachingTransactionSignatureChecker%28ptxTo%2C+nIn%2C+m_tx_out.nValue%2C+cacheStore%2C+*txdata%29%2C+%26amp%3Berror%29%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E8%BF%99%E9%87%8C%E6%9C%80%E7%BB%88%E8%BF%98%E6%98%AF%E8%B0%83%E7%94%A8%E4%BA%86%E6%88%91%E4%BB%AC%E5%9C%A8%E7%AC%AC4%E8%8A%82%E4%BB%8B%E7%BB%8D%E7%9A%84VerifyScript%E5%87%BD%E6%95%B0%E6%9D%A5%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E7%9A%84%E6%A0%A1%E9%AA%8C%EF%BC%8C%E8%BF%99%E9%87%8C%E5%B0%B1%E4%B8%8D%E5%9C%A8%E9%87%8D%E5%A4%8D%E4%BA%86%E3%80%82%3C%2Fp%3E+%0A++%3Ch2%3E5.3+%E6%97%B6%E5%BA%8F%3C%2Fh2%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%BB%A3%E7%A0%81%E8%B4%B4%E4%BA%86%E4%B8%80%E4%B8%B2%E5%8F%88%E4%B8%80%E4%B8%B2%EF%BC%8C%E5%8F%AF%E8%83%BD%E5%BE%88%E5%B0%91%E6%9C%89%E8%AF%BB%E8%80%85%E8%83%BD%E8%80%90%E7%9D%80%E6%80%A7%E5%AD%90%E7%9C%8B%E5%AE%8C%EF%BC%8C%E6%88%91%E4%BB%AC%E8%BF%99%E9%87%8C%E7%94%A8%E4%B8%80%E5%BC%A0%E7%AE%80%E5%8D%95%E7%9A%84%E5%9B%BE%E6%9D%A5%E8%AF%B4%E6%98%8E%E4%B8%80%E4%B8%8B%E6%95%B4%E4%B8%AA%E8%BF%87%E7%A8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180720203057309%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0ZW10X3N3Mg%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E9%98%85%E8%AF%BB%E6%BA%90%E4%BB%A3%E7%A0%81%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%8F%AA%E8%A6%81%E9%A1%BA%E7%9D%80%E5%9B%BE%E9%87%8C%E9%9D%A2%E7%9A%84%E8%BF%99%E6%9D%A1%E4%B8%BB%E7%BA%BF%E4%B8%80%E7%9B%B4%E5%BE%80%E4%B8%8B%E7%9C%8B%EF%BC%8C%E5%B0%B1%E8%83%BD%E6%8D%8B%E6%B8%85%E6%A5%9A%E4%BA%A4%E6%98%93%E4%BB%8E%E7%94%9F%E6%88%90%E3%80%81%E7%AD%BE%E5%90%8D%E3%80%81%E5%B9%BF%E6%92%AD%E3%80%81%E6%8E%A5%E6%94%B6%E7%9B%B4%E5%88%B0%E4%BA%A4%E6%98%93%E5%8A%A0%E5%85%A5%E4%BA%A4%E6%98%93%E6%B1%A0%E7%9A%84%E6%95%B4%E4%B8%AA%E8%BF%87%E7%A8%8B%E3%80%82%3C%2Fp%3E+%0A++%3Ch1%3E6+%E6%80%BB%E7%BB%93%3C%2Fh1%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%E4%BA%A4%E6%98%93%E6%98%AF%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%AD%E6%9C%80%E9%87%8D%E8%A6%81%E7%9A%84%E4%B8%80%E5%9D%97%E5%86%85%E5%AE%B9%E3%80%82%E6%9C%AC%E6%96%87%E4%BB%8E%E6%BA%90%E7%A0%81%E8%A7%92%E5%BA%A6%EF%BC%8C%E5%88%86%E6%9E%90%E4%BA%86%E6%AF%94%E7%89%B9%E5%B8%81%E4%BA%A4%E6%98%93%E7%9A%84%E5%88%9B%E5%BB%BA%E3%80%81%E4%BA%A4%E6%98%93%E7%9A%84%E7%AD%BE%E5%90%8D%E3%80%81%E2%80%98%E2%80%99%E4%BA%A4%E6%98%93%E8%84%9A%E6%9C%AC%E7%9A%84%E8%BF%90%E8%A1%8C%E3%80%81%E4%BA%A4%E6%98%93%E7%9A%84%E5%B9%BF%E6%92%AD%E5%92%8C%E6%8E%A5%E6%94%B6%E3%80%82%E8%AF%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E9%A1%BA%E7%9D%80%E6%9C%AC%E6%96%87%E4%B8%AD%E4%B8%BB%E7%BA%BF%E6%9D%A5%E9%98%85%E8%AF%BB%E4%BB%A3%E7%A0%81%EF%BC%8C%E4%B8%80%E6%97%A6%E6%90%9E%E6%87%82%E4%BA%86%E8%BF%99%E4%B8%80%E9%83%A8%E5%88%86%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%B0%B1%E8%83%BD%E6%9B%B4%E6%B7%B1%E5%88%BB%E7%9A%84%E7%90%86%E8%A7%A3%E6%AF%94%E7%89%B9%E5%B8%81%E4%BA%A4%E6%98%93%E3%80%82%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fztemt_sw2%2Farticle%2Fdetails%2F81101717%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fztemt_sw2%2Farticle%2Fdetails%2F81101717%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A+%3Ca+class%3D%22btn%22+href%3D%22https%3A%2F%2Fpassport.csdn.net%2Faccount%2Flogin%3Futm_source%3Dcsdn_blog_pc_more_login%22+target%3D%22_self%22+id%3D%22btn-lobinreadmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_557%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fztemt_sw2%2Farticle%2Fdetails%2F81101717%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_557%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fztemt_sw2%2Farticle%2Fdetails%2F81101717%2C%26quot%3B%7D%22%3E%E7%99%BB%E5%BD%95%E5%90%8E%E8%87%AA%E5%8A%A8%E5%B1%95%E5%BC%80%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}
---
layout: default
title: BTS的DPoS共识之代码实现概述
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Cdiv+class%3D%22markdown_views%22%3E+%0A++%3Cp%3E%E5%85%B3%E4%BA%8EBitShares%E7%9A%84DPoS%E5%85%B1%E8%AF%86%E7%9A%84%E6%A6%82%E8%BF%B0%E8%AF%B7%E5%8F%82%E8%80%83%EF%BC%9A%3Ca+href%3D%22https%3A%2F%2Fblog.csdn.net%2Fggq89%2Farticle%2Fdetails%2F80188930%22+rel%3D%22nofollow%22%3E%E8%82%A1%E4%BB%BD%E6%8E%88%E6%9D%83%E8%AF%81%E6%98%8E%28DPOS%29%E6%A6%82%E8%BF%B0%3C%2Fa%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%85%B3%E4%BA%8EBitShares%E7%9A%84DPoS%E5%85%B1%E8%AF%86%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E8%AF%B7%E5%8F%82%E8%80%83%EF%BC%9A%3Ca+href%3D%22https%3A%2F%2Fblog.csdn.net%2Fggq89%2Farticle%2Fdetails%2F80014631%22+rel%3D%22nofollow%22%3EBitShares%E7%9A%84DPoS%E5%85%B1%E8%AF%86%3C%2Fa%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%85%B3%E4%BA%8EBitShares%E7%9A%84DPoS%E5%85%B1%E8%AF%86%E7%9A%84%E7%AB%9E%E4%BA%89%E9%93%BE%E5%85%B1%E8%AF%86%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E%E8%AF%B7%E5%8F%82%E8%80%83%EF%BC%9A%3Ca+href%3D%22https%3A%2F%2Fblog.csdn.net%2Fggq89%2Farticle%2Fdetails%2F80072876%22+rel%3D%22nofollow%22%3EDPOS%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95+-+%E7%BC%BA%E5%A4%B1%E7%9A%84%E7%99%BD%E7%9A%AE%E4%B9%A6%3C%2Fa%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%85%B3%E4%BA%8EBitShares%E7%9A%84DPoS%E5%85%B1%E8%AF%86%E4%B9%8B%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E6%A6%82%E8%BF%B0%E8%AF%B7%E5%8F%82%E8%80%83%EF%BC%9A%3Ca+href%3D%22https%3A%2F%2Fblog.csdn.net%2Fggq89%2Farticle%2Fdetails%2F80068306%22+rel%3D%22nofollow%22%3EBTS%E7%9A%84DPoS%E5%85%B1%E8%AF%86%E4%B9%8B%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E6%A6%82%E8%BF%B0%3C%2Fa%3E%3C%2Fp%3E+%0A++%3Cp%3E%E6%9C%AC%E6%96%87%E5%9F%BA%E4%BA%8E%E7%9A%84BitShares%E6%BA%90%E4%BB%A3%E7%A0%81GitHub%E5%9C%B0%E5%9D%80%E5%A6%82%E4%B8%8B%EF%BC%9A%3Ca+href%3D%22https%3A%2F%2Fgithub.com%2Fbitshares%2Fbitshares-core%22+rel%3D%22nofollow%22%3Ehttps%3A%2F%2Fgithub.com%2Fbitshares%2Fbitshares-core%3C%2Fa%3E%3C%2Fp%3E+%0A++%3Cp%3E%3Cstrong%3E%E7%9B%AE%E5%BD%95%3C%2Fstrong%3E%3C%2Fp%3E+%0A++%3Cp%3E%3C%2Fp%3E%0A++%3Cdiv+class%3D%22toc%22%3E+%0A+++%3Cul%3E+%0A++++%3Cli%3E%3Ca+href%3D%22%231-dpos%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0%22+rel%3D%22nofollow%22%3E1.+DPoS%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0%3C%2Fa%3E%3C%2Fli%3E+%0A++++%3Cli%3E%3Ca+href%3D%22%232-%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%22+rel%3D%22nofollow%22%3E2.+%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%3C%2Fa%3E%3C%2Fli%3E+%0A++++%3Cli%3E%3Ca+href%3D%22%233-%E7%BB%9F%E8%AE%A1%E6%8A%95%E7%A5%A8%E5%92%8C%E9%80%89%E5%87%BA%E8%AF%81%E4%BA%BA%E9%9B%86%E5%90%88%22+rel%3D%22nofollow%22%3E3.+%E7%BB%9F%E8%AE%A1%E6%8A%95%E7%A5%A8%E5%92%8C%E9%80%89%E5%87%BA%E8%AF%81%E4%BA%BA%E9%9B%86%E5%90%88%3C%2Fa%3E%3C%2Fli%3E+%0A++++%3Cli%3E%3Ca+href%3D%22%234-%E8%B0%83%E5%BA%A6%E8%AF%81%E4%BA%BA%E5%92%8C%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%22+rel%3D%22nofollow%22%3E4.+%E8%B0%83%E5%BA%A6%E8%AF%81%E4%BA%BA%E5%92%8C%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%3C%2Fa%3E%3C%2Fli%3E+%0A++++%3Cli%3E%3Ca+href%3D%22%235-%E8%AF%81%E4%BA%BA%E8%8A%82%E7%82%B9%E5%88%9D%E5%A7%8B%E5%8C%96%22+rel%3D%22nofollow%22%3E5.+%E8%AF%81%E4%BA%BA%E8%8A%82%E7%82%B9%E5%88%9D%E5%A7%8B%E5%8C%96%3C%2Fa%3E%3C%2Fli%3E+%0A++++%3Cli%3E%3Ca+href%3D%22%236-%E5%88%9B%E5%BB%BAgenesisjson%E6%96%87%E4%BB%B6%22+rel%3D%22nofollow%22%3E6.+%E5%88%9B%E5%BB%BAgenesis.json%E6%96%87%E4%BB%B6%3C%2Fa%3E%3C%2Fli%3E+%0A++++%3Cli%3E%3Ca+href%3D%22%237-dpos%E5%85%B1%E8%AF%86%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E5%9B%BE%22+rel%3D%22nofollow%22%3E7.+DPoS%E5%85%B1%E8%AF%86%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E5%9B%BE%3C%2Fa%3E%3C%2Fli%3E+%0A+++%3C%2Ful%3E+%0A++%3C%2Fdiv%3E+%0A++%3Cp%3E%3C%2Fp%3E+%0A++%3Ch1+id%3D%221-dpos%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0%22%3E1.+DPoS%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0%3C%2Fh1%3E+%0A++%3Cp%3E%E4%BB%BB%E4%BD%95%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6%E9%83%BD%E5%BF%85%E9%A1%BB%E8%A7%A3%E5%86%B3%E5%8C%85%E6%8B%AC%E4%BD%86%E4%B8%8D%E9%99%90%E4%BA%8E%E4%BB%A5%E4%B8%8B5%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%9A%3C%2Fp%3E+%0A++%3Col%3E+%0A+++%3Cli%3E%E4%B8%8B%E4%B8%80%E4%B8%AA%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%96%B0%E5%8C%BA%E5%9D%97%E5%BA%94%E8%AF%A5%E7%94%B1%E8%B0%81%E6%9D%A5%E7%94%9F%E6%88%90%EF%BC%9F%3C%2Fli%3E+%0A+++%3Cli%3E%E4%B8%8B%E4%B8%80%E4%B8%AA%E5%9D%97%E5%BA%94%E8%AF%A5%E4%BD%95%E6%97%B6%E4%BA%A7%E7%94%9F%EF%BC%9F%3C%2Fli%3E+%0A+++%3Cli%3E%E8%AF%A5%E5%8C%BA%E5%9D%97%E5%BA%94%E5%8C%85%E5%90%AB%E5%93%AA%E4%BA%9B%E4%BA%A4%E6%98%93%EF%BC%9F%3C%2Fli%3E+%0A+++%3Cli%3E%E6%80%8E%E6%A0%B7%E5%AF%B9%E6%9C%AC%E5%8D%8F%E8%AE%AE%E8%BF%9B%E8%A1%8C%E4%BF%AE%E6%94%B9%EF%BC%9F%3C%2Fli%3E+%0A+++%3Cli%3E%E8%AF%A5%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E4%BA%A4%E6%98%93%E5%8E%86%E5%8F%B2%E7%9A%84%E7%AB%9E%E4%BA%89%E9%97%AE%E9%A2%98%EF%BC%9F%3C%2Fli%3E+%0A++%3C%2Fol%3E+%0A++%3Cp%3E%E6%9C%AC%E6%96%87%E4%B8%BB%E8%A6%81%E8%AE%A8%E8%AE%BA%E5%89%8D3%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8C%E7%AC%AC4%E4%B8%AA%E9%97%AE%E9%A2%98%E6%9C%AC%E6%96%87%E4%B8%8D%E5%81%9A%E8%AE%A8%E8%AE%BA%EF%BC%9B%E5%85%B3%E4%BA%8E%E7%AC%AC5%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8C%E5%8D%B3%E4%BA%A4%E6%98%93%E6%95%B0%E6%8D%AE%E5%88%86%E5%8F%89%E5%92%8C%E5%8F%8C%E8%8A%B1%E7%AD%89%E9%97%AE%E9%A2%98%E7%9A%84%E7%A0%94%E7%A9%B6%E5%88%86%E6%9E%90%E5%8F%AF%E5%8F%82%E8%80%83%EF%BC%9A%3Ca+href%3D%22https%3A%2F%2Fblog.csdn.net%2Fggq89%2Farticle%2Fdetails%2F80072876%22+rel%3D%22nofollow%22%3EDPOS%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95+-+%E7%BC%BA%E5%A4%B1%E7%9A%84%E7%99%BD%E7%9A%AE%E4%B9%A6%3C%2Fa%3E%3C%2Fp%3E+%0A++%3Cp%3E%E6%80%BB%E4%BD%93%E6%9D%A5%E8%AF%B4%EF%BC%8C%E4%B8%BA%E4%BA%86%E8%A7%A3%E5%86%B3PoW%E5%92%8CPoS%E5%85%B1%E8%AF%86%E5%85%B6%E4%BA%A4%E6%98%93%E6%80%A7%E8%83%BD%E4%BD%8E%E4%B8%8B%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%8CDPoS%E4%BD%BF%E7%94%A8%E8%A7%81%E8%AF%81%E4%BA%BA%E6%9C%BA%E5%88%B6%EF%BC%88witness%EF%BC%89%E8%A7%A3%E5%86%B3%E8%AF%A5%E9%97%AE%E9%A2%98%E3%80%82%E9%80%9A%E8%BF%87%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E7%9A%84%E6%8A%95%E7%A5%A8%E6%9C%BA%E5%88%B6%E9%80%89%E5%87%BA%E5%89%8DN%E4%B8%AA%E8%AF%81%E4%BA%BA%E6%9D%A5%E4%BF%9D%E8%AF%81%E4%BF%A1%E4%BB%BB%E9%97%AE%E9%A2%98%EF%BC%9B%E9%80%9A%E8%BF%87%E8%BD%AE%E6%B5%81%E5%AE%89%E6%8E%92%E8%AF%81%E4%BA%BA%E6%89%93%E5%8C%85%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%E6%9D%A5%E6%8F%90%E9%AB%98%E5%87%BA%E5%9D%97%E9%80%9F%E5%BA%A6%E4%BB%A5%E5%8F%8A%E5%87%8F%E5%B0%91%E8%83%BD%E8%80%97%E9%97%AE%E9%A2%98%EF%BC%9B%E9%80%9A%E8%BF%87%E8%AF%81%E4%BA%BA%E5%AF%B9%E5%8C%BA%E5%9D%97%E8%BF%9B%E8%A1%8C%E9%AA%8C%E8%AF%81%E4%BB%8E%E8%80%8C%E5%87%8F%E5%B0%91%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%AC%A1%E6%95%B0%EF%BC%8C%E4%BB%8E%E8%80%8C%E5%8A%A0%E5%BF%AB%E5%85%B1%E8%AF%86%E7%9A%84%E8%BF%87%E7%A8%8B%E5%92%8C%E6%8F%90%E9%AB%98%E4%BA%A4%E6%98%93%E7%BB%93%E7%AE%97%E7%9A%84%E9%80%9F%E5%BA%A6%E3%80%82%E6%80%BB%E4%B9%8B%EF%BC%8CDPoS%E5%85%B1%E8%AF%86%E9%80%9A%E8%BF%87%E9%97%B4%E6%8E%A5%E6%B0%91%E4%B8%BB%E7%9A%84%E6%96%B9%E5%BC%8F%E6%97%A2%E4%BF%9D%E8%AF%81%E4%BA%86%E6%9C%80%E5%A4%A7%E9%99%90%E5%BA%A6%E7%9A%84%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%8F%88%E6%9E%81%E5%A4%A7%E7%9A%84%E6%8F%90%E9%AB%98%E4%BA%86%E6%80%A7%E8%83%BD%E5%90%8C%E6%97%B6%E9%99%8D%E4%BD%8E%E4%BA%86%E7%94%B5%E5%8A%9B%E7%AD%89%E6%88%90%E6%9C%AC%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3EDPoS%E7%9A%84%E4%BC%AA%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%A6%82%E4%B8%8B%EF%BC%88%E4%BC%AA%E4%BB%A3%E7%A0%81%E5%8F%82%E8%80%83%E4%BA%86%3Ca+href%3D%22https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMjM5ODIzNDQ3Mw%3D%3D%26amp%3Bmid%3D2649967768%26amp%3Bidx%3D1%26amp%3Bsn%3D596fe0f892aa64b3b948ac629067dc51%26amp%3Bchksm%3Dbeca3c9e89bdb5882a7de2c678a23b3e67d7ca478cc0a183eefba0c6523d79e63d4ab6357fd6%26amp%3Bmpshare%3D1%26amp%3Bscene%3D1%26amp%3Bsrcid%3D02282VSyPVH3qoV99lWkkoWY%23rd%22+rel%3D%22nofollow%22%3E%E7%94%A8%E4%BC%AA%E4%BB%A3%E7%A0%81%E7%90%86%E8%A7%A3DPoS%3C%2Fa%3E%EF%BC%89%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+livecodeserver%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-built_in%22%3Eround%3C%2Fspan%3E+i%3Cspan+class%3D%22hljs-comment%22%3E+%2F%2F%E5%88%86%E6%88%90%E5%BE%88%E5%A4%9A%E4%B8%AAround%EF%BC%8Cround%E6%97%A0%E9%99%90%E6%8C%81%E7%BB%AD%3C%2Fspan%3E%0A++++dlist_i+%3D+%3Cspan+class%3D%22hljs-built_in%22%3Eget%3C%2Fspan%3E+N+witnesses+%3Cspan+class%3D%22hljs-built_in%22%3Esort%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eby%3C%2Fspan%3E+votes%3Cspan+class%3D%22hljs-comment%22%3E+%2F%2F%E6%A0%B9%E6%8D%AE%E6%8A%95%E7%A5%A8%E7%BB%93%E6%9E%9C%E9%80%89%E5%87%BA%E5%BE%97%E7%A5%A8%E7%8E%87%E6%9C%80%E9%AB%98%E7%9A%84N%E4%B8%AA%E8%AF%81%E4%BA%BA%3C%2Fspan%3E%0A++++dlist_i+%3D+shuffle%28dlist_i%29%3Cspan+class%3D%22hljs-comment%22%3E+%2F%2F%E9%9A%8F%E6%9C%BA%E6%94%B9%E5%8F%98%E9%A1%BA%E5%BA%8F%3C%2Fspan%3E%0A++++loop%3Cspan+class%3D%22hljs-comment%22%3E+%2F%2Fround%E5%AE%8C%E4%BA%86%EF%BC%8C%E9%80%80%E5%87%BA%E5%BE%AA%E7%8E%AF%3C%2Fspan%3E%0A++++++++slot+%3D+global_time_offset+%2F+block_interval%0A++++++++pos+%3D+slot+%25+N%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+dlist_i%5Bpos%5D+exists+%3Cspan+class%3D%22hljs-operator%22%3Ein%3C%2Fspan%3E+this+node%3Cspan+class%3D%22hljs-comment%22%3E+%2F%2Fwitness%E5%9C%A8%E8%BF%99%E4%B8%AA%E8%8A%82%E7%82%B9%3C%2Fspan%3E%0A++++++++++++generateBlock%28keypair+%3Cspan+class%3D%22hljs-operator%22%3Eof%3C%2Fspan%3E+dlist_i%5Bpos%5D%29%3Cspan+class%3D%22hljs-comment%22%3E+%2F%2F%E7%94%9F%E4%BA%A7block%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%0A++++++++++++skip%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%EF%BC%8C%E5%9C%A8%E6%AF%8F%E4%B8%80%E8%BD%AE%EF%BC%88round%EF%BC%89%E5%BE%AA%E7%8E%AF%E9%87%8C%EF%BC%8C%E7%B3%BB%E7%BB%9F%E4%BC%9A%E9%87%8D%E6%96%B0%E7%BB%9F%E8%AE%A1%E5%BE%97%E7%A5%A8%E6%8E%92%E5%90%8D%E3%80%82%E5%9C%A8%E9%80%89%E5%87%BA%E6%9C%80%E9%AB%98%E7%9A%84N%E4%B8%AA%E8%AF%81%E4%BA%BA%E9%87%8C%EF%BC%8C%E7%B3%BB%E7%BB%9F%E9%87%87%E7%94%A8%E5%85%88%E6%89%93%E4%B9%B1%E9%A1%BA%E5%BA%8F%EF%BC%8C%E7%84%B6%E5%90%8E%E8%AF%81%E4%BA%BA%E8%BD%AE%E6%B5%81%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%E3%80%82%E4%B8%80%E8%BD%AE%E5%8C%BA%E5%9D%97%E7%94%9F%E4%BA%A7%E5%AE%8C%E6%AF%95%E5%90%8E%E8%BF%9B%E5%85%A5%E4%B8%8B%E4%B8%80%E4%B8%AA%E5%91%A8%E6%9C%9F%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%E5%9C%A8BitShares%E5%AE%9E%E9%99%85%E7%9A%84%E4%BB%A3%E7%A0%81%E4%B8%AD%EF%BC%8C%E8%BF%87%E7%A8%8B%E6%AF%94%E4%B8%8A%E8%BF%B0%E4%BC%AA%E4%BB%A3%E7%A0%81%E5%A4%8D%E6%9D%82%E5%BE%97%E5%A4%9A%EF%BC%8C%E4%B8%8B%E9%9D%A2%E6%9C%AC%E6%96%87%E4%BB%8E3%E4%B8%AA%E6%96%B9%E5%90%91%E8%AE%B2%E8%A7%A3BTS%E4%B8%ADDPoS%E5%85%B1%E8%AF%86%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Col%3E+%0A+++%3Cli%3E%E6%89%93%E4%B9%B1%E8%AF%81%E4%BA%BA%E8%B0%83%E5%BA%A6%E9%A1%BA%E5%BA%8F%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%8C%E5%8D%B3%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%EF%BC%9B%3C%2Fli%3E+%0A+++%3Cli%3E%E7%BB%9F%E8%AE%A1%E6%8A%95%E7%A5%A8%E5%92%8C%E9%80%89%E5%87%BA%E8%AF%81%E4%BA%BA%E9%9B%86%E5%90%88%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%9B%3C%2Fli%3E+%0A+++%3Cli%3E%E8%B0%83%E5%BA%A6%E8%AF%81%E4%BA%BA%E5%92%8C%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%9B%3C%2Fli%3E+%0A++%3C%2Fol%3E+%0A++%3Ch1+id%3D%222-%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%22%3E2.+%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%3C%2Fh1%3E+%0A++%3Cp%3E%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%E7%9A%84%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E5%9B%BE%EF%BC%9A+%3Cbr%3E+%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F2018051717510184%22+alt%3D%22%E8%BF%99%E9%87%8C%E5%86%99%E5%9B%BE%E7%89%87%E6%8F%8F%E8%BF%B0%22+title%3D%22%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E9%A6%96%E5%85%88%EF%BC%8C%E4%B8%BA%E4%BA%86%E5%AD%98%E5%82%A8%E8%AF%81%E4%BA%BA%E7%9A%84%E8%B0%83%E5%BA%A6%E9%A1%BA%E5%BA%8F%EF%BC%8CBTS%E5%AE%9A%E4%B9%89%E4%BA%86%E4%B8%80%E4%B8%AA%E5%90%8D%E5%8F%AB%3Ccode%3Ewitness_schedule_object%3C%2Fcode%3E%E7%9A%84%E7%B1%BB%EF%BC%8C%E5%9C%A8%E8%AF%A5%E7%B1%BB%E4%B8%AD%E7%94%A8%E4%BA%86%E4%B8%80%E4%B8%AA%E5%90%8D%E4%B8%BA%3Ccode%3Ecurrent_shuffled_witnesses%3C%2Fcode%3E%E7%9A%84%3Ccode%3Evector%3C%2Fcode%3E%E9%9B%86%E5%90%88%E6%9D%A5%E5%AD%98%E5%82%A8%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Eclass%3C%2Fspan%3E+witness_schedule_object+%3A+%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Epublic%3C%2Fspan%3E+graphene%3A%3Adb%3A%3Aabstract_object%26lt%3Bwitness_schedule_object%26gt%3B%0A%7B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Epublic%3C%2Fspan%3E%3A%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Estatic%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+uint8_t+space_id+%3D+implementation_ids%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Estatic%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+uint8_t+type_id+%3D+impl_witness_schedule_object_type%3B%0A%0A++++++%3Cspan+class%3D%22hljs-stl_container%22%3E%3Cspan+class%3D%22hljs-built_in%22%3Evector%3C%2Fspan%3E%26lt%3B+witness_id_type+%26gt%3B%3C%2Fspan%3E+current_shuffled_witnesses%3B++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E7%94%A8%E4%BA%8E%E5%AD%98%E5%82%A8%E8%AF%81%E4%BA%BA%E7%9A%84%E8%B0%83%E5%BA%A6%E9%A1%BA%E5%BA%8F%3C%2Fspan%3E%0A%7D%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E6%9C%89%E4%BA%86%E4%B8%8A%E9%9D%A2%E7%9A%84%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%EF%BC%8C%E4%B8%8B%E9%9D%A2%E6%9D%A5%E5%86%8D%E7%9C%8B%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%3Ccode%3Eupdate_witness_schedule%28%29%3C%2Fcode%3E%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+database%3A%3Aupdate_witness_schedule%28%29%0A%7B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+witness_schedule_object%26amp%3B+wso+%3D+witness_schedule_id_type%28%29%28*%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%29%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+global_property_object%26amp%3B+gpo+%3D+get_global_properties%28%29%3B%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AF%A5%E6%9D%A1%E4%BB%B6%E6%8E%A7%E5%88%B6%E4%BA%86%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%E8%A2%AB%E8%B0%83%E7%94%A8%E7%9A%84%E6%97%B6%E6%9C%BA%EF%BC%8C%E5%BF%85%E9%A1%BB%E6%98%AF%E8%AF%81%E4%BA%BA%E5%AE%8C%E6%95%B4%E7%9A%84%E8%BD%AE%E8%BD%AC%E5%AE%8C%E4%B8%80%E5%9C%88%E5%90%8E%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+head_block_num%28%29+%25+gpo.active_witnesses.size%28%29+%3D%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E+%29%0A+++%7B%0A++++++modify%28+wso%2C+%5B%26amp%3B%5D%28+witness_schedule_object%26amp%3B+_wso+%29%0A++++++%7B%0A+++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E6%B8%85%E7%A9%BA%E8%AF%81%E4%BA%BA%E9%9B%86%E5%90%88%3C%2Fspan%3E%0A+++++++++_wso.current_shuffled_witnesses.clear%28%29%3B%0A+++++++++_wso.current_shuffled_witnesses.reserve%28+gpo.active_witnesses.size%28%29+%29%3B%0A%0A+++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%9D%E5%A7%8B%E5%8C%96%E8%AF%81%E4%BA%BA%E9%9B%86%E5%90%88%E6%95%B0%E6%8D%AE%3C%2Fspan%3E%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E%28+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+witness_id_type%26amp%3B+w+%3A+gpo.active_witnesses+%29%0A++++++++++++_wso.current_shuffled_witnesses.push_back%28+w+%29%3B%0A%0A+++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E6%89%93%E4%B9%B1%E8%AF%81%E4%BA%BA%E7%9A%84%E8%B0%83%E5%BA%A6%E9%A1%BA%E5%BA%8F%3C%2Fspan%3E%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+now_hi+%3D+uint64_t%28head_block_time%28%29.sec_since_epoch%28%29%29+%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-number%22%3E32%3C%2Fspan%3E%3B%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E%28+uint32_t+i+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3B+i+%26lt%3B+_wso.current_shuffled_witnesses.size%28%29%3B+%2B%2Bi+%29%0A+++++++++%7B%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%2F+%E6%AD%A4%E5%A4%84%E4%BD%BF%E7%94%A8%E4%BA%86%E9%9A%8F%E6%9C%BA%E5%87%BD%E6%95%B0%EF%BC%8C%E5%85%B7%E4%BD%93%E5%8E%9F%E7%90%86%E8%AF%B7%E5%8F%82%E7%9C%8B%EF%BC%9Ahttp%3A%2F%2Fxorshift.di.unimi.it%2F%3C%2Fspan%3E%0A++++++++++++uint64_t+k+%3D+now_hi+%2B+uint64_t%28i%29*%3Cspan+class%3D%22hljs-number%22%3E2685821657736338717U%3C%2Fspan%3ELL%3B%0A++++++++++++k+%5E%3D+%28k+%26gt%3B%26gt%3B+%3Cspan+class%3D%22hljs-number%22%3E12%3C%2Fspan%3E%29%3B%0A++++++++++++k+%5E%3D+%28k+%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-number%22%3E25%3C%2Fspan%3E%29%3B%0A++++++++++++k+%5E%3D+%28k+%26gt%3B%26gt%3B+%3Cspan+class%3D%22hljs-number%22%3E27%3C%2Fspan%3E%29%3B%0A++++++++++++k+*%3D+%3Cspan+class%3D%22hljs-number%22%3E2685821657736338717U%3C%2Fspan%3ELL%3B%0A%0A++++++++++++uint32_t+jmax+%3D+_wso.current_shuffled_witnesses.size%28%29+-+i%3B%0A++++++++++++uint32_t+j+%3D+i+%2B+k%25jmax%3B%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%BF%9B%E8%A1%8CN%E6%AC%A1%E9%9A%8F%E6%9C%BA%E4%BA%A4%E6%8D%A2%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Aswap%28+_wso.current_shuffled_witnesses%5Bi%5D%2C%0A+++++++++++++++++++++++_wso.current_shuffled_witnesses%5Bj%5D+%29%3B%0A+++++++++%7D%0A++++++%7D%29%3B%0A+++%7D%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E9%82%A3%E4%B9%88%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%E6%98%AF%E5%9C%A8%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E7%94%B1%E5%93%AA%E4%B8%AA%E8%8A%82%E7%82%B9%E8%B0%83%E7%94%A8%E5%91%A2%3F+%3Cbr%3E+%E5%AE%9E%E9%99%85%E4%B8%8A%3Ccode%3Eupdate_witness_schedule%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E5%8F%AA%E5%9C%A8%3Ccode%3E_apply_block%28%29%3C%2Fcode%3E%E4%B8%AD%E8%B0%83%E7%94%A8%3A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%B0%86%E4%B8%80%E4%B8%AA%E7%AD%BE%E5%90%8D%E5%90%8E%E7%9A%84%E5%8C%BA%E5%9D%97%E6%B7%BB%E5%8A%A0%E5%88%B0%E9%93%BE%E4%B8%8A%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+database%3A%3A_apply_block%28+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+signed_block%26amp%3B+next_block+%29%0A%7B+%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A++++update_witness_schedule%28%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%85%B3%E4%BA%8E%E8%AF%A5%E6%96%B9%E6%B3%95%E7%9A%84%E5%8F%88%E6%98%AF%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E8%B0%83%E7%94%A8%E4%BC%9A%E5%9C%A8%E5%90%8E%E6%96%87%E4%BB%8B%E7%BB%8D%EF%BC%8C%E6%80%BB%E4%B9%8B%EF%BC%8C%E8%AF%81%E4%BA%BA%E8%8A%82%E7%82%B9%E6%AF%8F%E6%AC%A1%E5%B0%86%E4%B8%80%E4%B8%AA%E7%AD%BE%E5%90%8D%E5%8C%BA%E5%9D%97%E6%B7%BB%E5%8A%A0%E5%88%B0%E9%93%BE%E4%B8%8A%E4%B9%8B%E5%90%8E%E8%B0%83%E7%94%A8%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%EF%BC%8C%E8%80%8C%E5%9C%A8%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%E5%86%85%E9%83%A8%E4%BC%9A%E5%9C%A8%E8%AF%81%E4%BA%BA%E8%BD%AE%E8%BD%AC%E5%AE%8C%E4%B8%80%E5%9C%88%E6%97%B6%E6%89%8D%E7%9C%9F%E6%AD%A3%E6%B4%97%E7%89%8C%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%E8%BF%99%E9%87%8C%E8%A6%81%E5%BC%BA%E8%B0%83%E4%B8%80%E4%B8%8B%EF%BC%8C%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%E5%8F%AA%E6%98%AF%E6%89%93%E4%B9%B1%E4%BA%86%E8%AF%81%E4%BA%BA%E7%9A%84%E8%B0%83%E5%BA%A6%E9%A1%BA%E5%BA%8F%EF%BC%8C%E4%BD%86%E5%8F%AF%E8%83%BD%E8%BF%98%E6%98%AF%E5%8E%9F%E6%9D%A5%E9%82%A3%E4%BA%9B%E8%AF%81%E4%BA%BA%E3%80%82%E9%82%A3%E4%B9%88%E8%AF%81%E4%BA%BA%E6%88%90%E5%91%98%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E6%9B%B4%E6%96%B0%E5%91%A2%EF%BC%9F%E7%8E%B0%E5%9C%A8%E5%9B%9E%E5%88%B0%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%3Ccode%3Eupdate_witness_schedule%28%29%3C%2Fcode%3E%E4%B8%AD%EF%BC%8C%3Ccode%3Ecurrent_shuffled_witnesses%3C%2Fcode%3E%E6%98%AF%E4%BB%8E%3Ccode%3Egpo.active_witnesses%3C%2Fcode%3E%E4%B8%AD%E8%8E%B7%E5%BE%97%E6%B4%BB%E8%B7%83%E8%AF%81%E4%BA%BA%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E7%9A%84%EF%BC%8C%E5%8F%AA%E6%9C%89%E5%BD%93%3Ccode%3Egpo.active_witnesses%3C%2Fcode%3E%E4%B8%AD%E7%9A%84%E7%9A%84%E6%88%90%E5%91%98%E5%8F%91%E7%94%9F%E5%8F%98%E5%8C%96%E6%97%B6%EF%BC%8C%3Ccode%3Ecurrent_shuffled_witnesses%3C%2Fcode%3E%E4%B8%AD%E7%9A%84%E6%88%90%E5%91%98%E6%89%8D%E5%8F%91%E7%94%9F%E5%8F%98%E5%8C%96%EF%BC%8C%E9%82%A3%E4%B9%88%3Ccode%3Egpo.active_witnesses%3C%2Fcode%3E%E5%8F%88%E6%98%AF%E6%80%8E%E4%B9%88%E6%9B%B4%E6%96%B0%E7%9A%84%E5%91%A2%EF%BC%9F%3C%2Fp%3E+%0A++%3Ch1+id%3D%223-%E7%BB%9F%E8%AE%A1%E6%8A%95%E7%A5%A8%E5%92%8C%E9%80%89%E5%87%BA%E8%AF%81%E4%BA%BA%E9%9B%86%E5%90%88%22%3E3.+%E7%BB%9F%E8%AE%A1%E6%8A%95%E7%A5%A8%E5%92%8C%E9%80%89%E5%87%BA%E8%AF%81%E4%BA%BA%E9%9B%86%E5%90%88%3C%2Fh1%3E+%0A++%3Cp%3E%E7%BB%9F%E8%AE%A1%E6%8A%95%E7%A5%A8%E5%92%8C%E9%80%89%E5%87%BA%E8%AF%81%E4%BA%BA%E9%9B%86%E5%90%88%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E5%9B%BE%EF%BC%9A+%3Cbr%3E+%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180517190637334%22+alt%3D%22%E8%BF%99%E9%87%8C%E5%86%99%E5%9B%BE%E7%89%87%E6%8F%8F%E8%BF%B0%22+title%3D%22%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E9%A6%96%E5%85%88%E4%BB%8B%E7%BB%8D%E5%92%8C%E6%B4%BB%E8%B7%83%E8%AF%81%E4%BA%BA%E9%9B%86%E5%90%88%E7%9B%B8%E5%85%B3%E7%9A%84%E7%B1%BB%EF%BC%8C%E5%85%A8%E5%B1%80%E5%B1%9E%E6%80%A7%E7%B1%BB%3Ccode%3Eglobal_property_object%3C%2Fcode%3E%EF%BC%8C%E8%AF%A5%E7%B1%BB%E4%B8%AD%E4%BD%BF%E7%94%A8%E4%BA%86%E5%90%8D%E4%B8%BA%3Ccode%3Eactive_witnesses%3C%2Fcode%3E%E7%9A%84%3Ccode%3Eflat_set%3C%2Fcode%3E%E4%BF%9D%E5%AD%98%E6%B4%BB%E8%B7%83%E8%AF%81%E4%BA%BA%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%85%A8%E5%B1%80%E5%B1%9E%E6%80%A7%E7%B1%BB%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Eclass%3C%2Fspan%3E+global_property_object+%3A+%3Cspan+class%3D%22hljs-keyword%22%3Epublic%3C%2Fspan%3E+graphene%3A%3Adb%3A%3Aabstract_object%26lt%3Bglobal_property_object%26gt%3B%0A+++%7B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Epublic%3C%2Fspan%3E%3A%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Estatic%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+uint8_t+space_id+%3D+implementation_ids%3B%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Estatic%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+uint8_t+type_id++%3D+impl_global_property_object_type%3B%0A%0A+++++++++chain_parameters+++++++++++parameters%3B%0A+++++++++optional%26lt%3Bchain_parameters%26gt%3B+pending_parameters%3B%0A%0A+++++++++uint32_t+++++++++++++++++++++++++++next_available_vote_id+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3B%0A+++++++++%3Cspan+class%3D%22hljs-stl_container%22%3E%3Cspan+class%3D%22hljs-built_in%22%3Evector%3C%2Fspan%3E%26lt%3Bcommittee_member_id_type%26gt%3B%3C%2Fspan%3E+++active_committee_members%3B%0A+++++++++flat_set%26lt%3Bwitness_id_type%26gt%3B++++++++++active_witnesses%3B+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E6%B4%BB%E8%B7%83%E8%AF%81%E4%BA%BA%E9%9B%86%E5%90%88%EF%BC%8C%E6%AF%8F%E4%B8%AA%E7%BB%B4%E6%8A%A4%E9%97%B4%E9%9A%94%E6%9B%B4%E6%96%B0%E4%B8%80%E6%AC%A1%3C%2Fspan%3E%0A+++%7D%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E6%9C%89%E4%BA%86%E4%B8%8A%E9%9D%A2%E7%B1%BB%E7%9A%84%E9%93%BA%E5%9E%AB%EF%BC%8C%E4%B8%8B%E6%9D%A5%E5%86%8D%E6%9D%A5%E8%AE%B2%E6%B4%BB%E8%B7%83%E8%AF%81%E4%BA%BA%E9%9B%86%E5%90%88%E6%9B%B4%E6%96%B0%E7%9A%84%E4%BA%8B%E6%83%85%E3%80%82%E5%9C%A8BitShares%E7%9A%84%E6%BA%90%E4%BB%A3%E7%A0%81%E4%B8%AD%EF%BC%8C%3Ccode%3Egpo.active_witnesses%3C%2Fcode%3E%E7%9A%84%E6%9B%B4%E6%96%B0%E6%98%AF%E9%80%9A%E8%BF%87%3Ccode%3Eupdate_active_witnesses%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E6%9B%B4%E6%96%B0%E6%B4%BB%E8%B7%83%E8%AF%81%E4%BA%BA%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+database%3A%3Aupdate_active_witnesses%28%29%0A%7B+%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E7%BB%9F%E8%AE%A1%E6%8A%95%E7%A5%A8%E7%9A%84%E8%AF%81%E4%BA%BA%E4%B8%AA%E6%95%B0%3C%2Fspan%3E%0A++++assert%28+_witness_count_histogram_buffer.size%28%29+%26gt%3B+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E+%29%3B%0A++++share_type+stake_target+%3D+%28_total_voting_stake-_witness_count_histogram_buffer%5B%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%5D%29+%2F+%3Cspan+class%3D%22hljs-number%22%3E2%3C%2Fspan%3E%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%2F+%E4%B8%BA0%E6%88%961%E4%B8%AA%E8%AF%81%E4%BA%BA%E6%8A%95%E7%A5%A8%E7%9A%84%E8%B4%A6%E6%88%B7%E4%B8%8D%E4%BC%9A%E5%B0%B1%E8%AF%81%E4%BA%BA%E6%95%B0%E9%87%8F%E5%8F%91%E8%A1%A8%E6%84%8F%E8%A7%81%EF%BC%88%E4%BB%96%E4%BB%AC%E5%BC%83%E6%9D%83%E5%B9%B6%E4%B8%94%E6%98%AF%E6%97%A0%E6%8A%95%E7%A5%A8%E6%9D%83%E7%9A%84%E8%B4%A6%E6%88%B7%EF%BC%89%3C%2Fspan%3E%0A%0A++++share_type+stake_tally+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3B+%0A%0A++++size_t+witness_count+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3B%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+stake_target+%26gt%3B+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E+%29%0A++++%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ewhile%3C%2Fspan%3E%28+%28witness_count+%26lt%3B+_witness_count_histogram_buffer.size%28%29+-+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29%0A+++++++++++++%26amp%3B%26amp%3B+%28stake_tally+%26lt%3B%3D+stake_target%29+%29%0A++++++++%7B%0A++++++++++++stake_tally+%2B%3D+_witness_count_histogram_buffer%5B%2B%2Bwitness_count%5D%3B%0A++++++++%7D%0A++++%7D%0A%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+chain_property_object%26amp%3B+cpo+%3D+get_chain_properties%28%29%3B%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E6%8E%92%E5%BA%8F%E9%80%89%E5%87%BA%E5%89%8D%E6%8E%92%E5%90%8D%E5%89%8DN%E7%9A%84%E8%AF%81%E4%BA%BA%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+wits+%3D+sort_votable_objects%26lt%3Bwitness_index%26gt%3B%28%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Amax%28witness_count*%3Cspan+class%3D%22hljs-number%22%3E2%3C%2Fspan%3E%2B%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%2C+%28size_t%29cpo.immutable_parameters.min_witness_count%29%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%B0%86%E8%AF%81%E4%BA%BA%E5%AD%98%E5%85%A5active_witnesses%E4%B8%AD%3C%2Fspan%3E%0A++++modify%28gpo%2C+%5B%26amp%3B%5D%28+global_property_object%26amp%3B+gp+%29%7B%0A++++++++gp.active_witnesses.clear%28%29%3B%0A++++++++gp.active_witnesses.reserve%28wits.size%28%29%29%3B%0A++++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Atransform%28wits.begin%28%29%2C+%0A+++++++++++++++++++++++wits.end%28%29%2C%0A+++++++++++++++++++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Ainserter%28gp.active_witnesses%2C+gp.active_witnesses.end%28%29%29%2C%0A+++++++++++++++++++++++%5B%5D%28%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+witness_object%26amp%3B+w%29+%7B%0A+++++++++++++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+w.id%3B%0A+++++++++++++++++++++++%7D%29%3B%0A++++%7D%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......+%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%9C%A8%3Ccode%3Eupdate_active_witnesses%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E4%B8%AD%E9%A6%96%E5%85%88%E7%BB%9F%E8%AE%A1%E5%87%BA%E6%8A%95%E7%A5%A8%E7%9A%84%E8%AF%81%E4%BA%BA%E4%B8%AA%E6%95%B0N%EF%BC%8C%E7%84%B6%E5%90%8E%E6%8E%92%E5%BA%8F%E9%80%89%E5%87%BA%E5%BE%97%E7%A5%A8%E7%8E%87%E6%9C%80%E9%AB%98%E7%9A%84N%E4%B8%AA%E8%AF%81%E4%BA%BA%EF%BC%8C%E5%86%8D%E6%9B%B4%E6%96%B0%E5%88%B0%3Ccode%3Eactive_witnesses%3C%2Fcode%3E%E4%B8%AD%E5%8E%BB%E3%80%82%E4%B8%8B%E9%9D%A2%E6%98%AF%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%3Ccode%3Esort_votable_objects%3C%2Fcode%3E%E7%9A%84%E4%BB%8B%E7%BB%8D%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E4%BB%8E%E9%AB%98%E5%88%B0%E4%BD%8E%E6%8E%92%E5%88%97%E5%87%BA%E5%89%8DN%E4%B8%AA%E6%8C%87%E5%AE%9A%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%AF%E6%8A%95%E7%A5%A8%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%B9%B6%E4%BB%A5vector%E7%9A%84%E5%BD%A2%E5%BC%8F%E8%BF%94%E5%9B%9E%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Etemplate%3C%2Fspan%3E%26lt%3B%3Cspan+class%3D%22hljs-keyword%22%3Eclass%3C%2Fspan%3E+Index%26gt%3B%0A%3Cspan+class%3D%22hljs-stl_container%22%3E%3Cspan+class%3D%22hljs-built_in%22%3Evector%3C%2Fspan%3E%26lt%3B%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Areference_wrapper%26lt%3B%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Etypename%3C%2Fspan%3E+Index%3A%3Aobject_type%26gt%3B%3C%2Fspan%3E%26gt%3B+database%3A%3Asort_votable_objects%28size_t+count%29+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E%0A%7B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eusing%3C%2Fspan%3E+ObjectType+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Etypename%3C%2Fspan%3E+Index%3A%3Aobject_type%3B%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E5%AF%B9%E8%B1%A1%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E%26amp%3B+all_objects+%3D+get_index_type%26lt%3BIndex%26gt%3B%28%29.indices%28%29%3B%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AE%A1%E7%AE%97%E5%AE%9E%E9%99%85%E4%B8%AA%E6%95%B0%3C%2Fspan%3E%0A+++count+%3D+%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Amin%28count%2C+all_objects.size%28%29%29%3B%0A+++%3Cspan+class%3D%22hljs-stl_container%22%3E%3Cspan+class%3D%22hljs-built_in%22%3Evector%3C%2Fspan%3E%26lt%3B%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Areference_wrapper%26lt%3B%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+ObjectType%26gt%3B%3C%2Fspan%3E%26gt%3B+refs%3B%0A+++refs.reserve%28all_objects.size%28%29%29%3B%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%9D%E5%A7%8B%E5%8C%96refs%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Atransform%28all_objects.begin%28%29%2C+all_objects.end%28%29%2C%0A++++++++++++++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Aback_inserter%28refs%29%2C%0A++++++++++++++++++%5B%5D%28%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+ObjectType%26amp%3B+o%29+%7B+%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Acref%28o%29%3B+%7D%29%3B%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E6%8E%92%E5%BA%8F%EF%BC%88%E4%BB%8E%E9%AB%98%E5%88%B0%E4%BD%8E%EF%BC%89%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Apartial_sort%28refs.begin%28%29%2C+refs.begin%28%29+%2B+count%2C+refs.end%28%29%2C%0A+++++++++++++++++++%5B%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%5D%28%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+ObjectType%26amp%3B+a%2C+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+ObjectType%26amp%3B+b%29-%26gt%3B%3Cspan+class%3D%22hljs-keyword%22%3Ebool%3C%2Fspan%3E+%7B%0A++++++share_type+oa_vote+%3D+_vote_tally_buffer%5Ba.vote_id%5D%3B%0A++++++share_type+ob_vote+%3D+_vote_tally_buffer%5Bb.vote_id%5D%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+oa_vote+%21%3D+ob_vote+%29%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+oa_vote+%26gt%3B+ob_vote%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+a.vote_id+%26lt%3B+b.vote_id%3B%0A+++%7D%29%3B%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E6%88%AA%E5%8F%96%EF%BC%8C%E8%BF%94%E5%9B%9E%3C%2Fspan%3E%0A+++refs.resize%28count%2C+refs.front%28%29%29%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+refs%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%86%8D%E6%9D%A5%E7%9C%8B%E5%9C%A8%3Ccode%3Eupdate_active_witnesses%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E8%AF%81%E4%BA%BA%E7%9A%84%E6%8A%95%E7%A5%A8%E6%95%B0%E6%8D%AE%E6%98%AF%E4%BB%8E%3Ccode%3E_witness_count_histogram_buffer%3C%2Fcode%3E%E4%B8%AD%E8%8E%B7%E5%8F%96%E7%9A%84%EF%BC%8C%E8%80%8C%E8%AF%A5%E9%9B%86%E5%90%88%E5%8F%88%E6%98%AF%E5%9C%A8%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E6%9B%B4%E6%96%B0%E5%91%A2%EF%BC%9F%E8%BF%98%E6%9C%89%3Ccode%3Eupdate_active_witnesses%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E5%8F%88%E6%98%AF%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E8%B0%83%E7%94%A8%E5%91%A2%EF%BC%9F%E8%BF%99%E4%BA%9B%E9%97%AE%E9%A2%98%E7%9A%84%E7%AD%94%E6%A1%88%E9%83%BD%E5%9C%A8%3Ccode%3Eperform_chain_maintenance%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E4%B8%AD%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%8C%BA%E5%9D%97%E9%93%BE%E7%BB%B4%E6%8A%A4%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+database%3A%3Aperform_chain_maintenance%28%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+signed_block%26amp%3B+next_block%2C+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+global_property_object%26amp%3B+global_props%29%0A%7B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E%26amp%3B+gpo+%3D+get_global_properties%28%29%3B%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A+++......%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E7%BB%9F%E8%AE%A1%E6%89%80%E6%9C%89%E8%B4%A6%E6%88%B7%E7%9A%84%E6%8A%95%E7%A5%A8%EF%BC%8C%E6%B3%A8%E6%84%8F%EF%BC%9A%E6%AD%A4%E5%A4%84%E6%98%AF%E7%AC%94%E8%80%85%E4%B8%BA%E4%BA%86%E4%BE%BF%E4%BA%8E%E7%90%86%E8%A7%A3%EF%BC%8C%E8%AE%B2%E5%8E%9F%E4%BB%A3%E7%A0%81%E4%B8%AD%E7%9A%84%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B%E6%94%B9%E5%86%99%E8%80%8C%E6%88%90%E7%9A%84%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E%26amp%3B+idx+%3D+get_index_type%26lt%3Baccount_index%26gt%3B%28%29.indices%28%29.get%26lt%3Bby_name%26gt%3B%28%29%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E%28+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+account_object%26amp%3B+a+%3A+idx+%29%0A+++%7B++++++%0A+++++++database%26amp%3B+d+%3D+*%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%3B%0A+++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+global_property_object%26amp%3B+props+%3D+gpo%3B%0A%0A+++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A+++++++......%0A%0A+++++++d._witness_count_histogram_buffer.resize%28props.parameters.maximum_witness_count+%2F+%3Cspan+class%3D%22hljs-number%22%3E2%3C%2Fspan%3E+%2B+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29%3B%0A%0A+++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+account_object%26amp%3B+stake_account+%3D+a%3B%0A%0A+++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%8E%B7%E5%8F%96%E5%AE%9E%E9%99%85%E6%8A%95%E7%A5%A8%E8%B4%A6%E6%88%B7%3C%2Fspan%3E%0A+++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+account_object%26amp%3B+opinion_account+%3D%0A++++++++++%28stake_account.options.voting_account+%3D%3D%0A+++++++++++GRAPHENE_PROXY_TO_SELF_ACCOUNT%29%3F+stake_account%0A+++++++++++++%3A+d.get%28stake_account.options.voting_account%29%3B%0A%0A+++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%8E%B7%E5%8F%96%E5%AE%9E%E9%99%85%E6%8A%95%E7%A5%A8%E6%95%B0%E9%87%8F%3C%2Fspan%3E%0A+++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E%26amp%3B+stats+%3D+stake_account.statistics%28d%29%3B%0A+++++++uint64_t+voting_stake+%3D+stats.total_core_in_orders.value%0A+++++++++++++%2B+%28stake_account.cashback_vb.valid%28%29+%3F+%28*stake_account.cashback_vb%29%28d%29.balance.amount.value%3A+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%29%0A+++++++++++++%2B+d.get_balance%28stake_account.get_id%28%29%2C+asset_id_type%28%29%29.amount.value%3B%0A%0A+++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A+++++++......%0A%0A+++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E7%BB%9F%E8%AE%A1%E6%8A%95%E7%A5%A8%3C%2Fspan%3E%0A+++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+opinion_account.options.num_witness+%26lt%3B%3D+props.parameters.maximum_witness_count+%29%0A+++++++%7B%0A++++++++++uint16_t+offset+%3D+%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Amin%28size_t%28opinion_account.options.num_witness%2F%3Cspan+class%3D%22hljs-number%22%3E2%3C%2Fspan%3E%29%2C+d._witness_count_histogram_buffer.size%28%29+-+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29%3B%0A++++++++++d._witness_count_histogram_buffer%5Boffset%5D+%2B%3D+voting_stake%3B%0A+++++++%7D%0A+++%7D%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A+++......%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E6%B3%A8%E6%84%8F%EF%BC%9A%E5%9C%A8%E8%BF%99%E9%87%8C%E6%9B%B4%E6%96%B0%E6%B4%BB%E8%B7%83%E8%AF%81%E4%BA%BA%3C%2Fspan%3E%0A+++update_active_witnesses%28%29%3B%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A+++......%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E4%BB%A5%E4%B8%8B%E8%AE%A1%E7%AE%97%E5%87%BA%E4%B8%8B%E4%B8%80%E6%AC%A1%E5%8C%BA%E5%9D%97%E9%93%BE%E7%BB%B4%E6%8A%A4%E6%97%B6%E9%97%B4%EF%BC%8C%E5%B9%B6%E6%9B%B4%E6%96%B0%E5%88%B0%E5%85%A8%E5%B1%80%E6%95%B0%E6%8D%AE%E5%BA%93%3C%2Fspan%3E%0A%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+next_maintenance_time+%3D+get%26lt%3Bdynamic_global_property_object%26gt%3B%28dynamic_global_property_id_type%28%29%29.next_maintenance_time%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+maintenance_interval+%3D+gpo.parameters.maintenance_interval%3B%0A%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+next_maintenance_time+%26lt%3B%3D+next_block.timestamp+%29%0A+++%7B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+next_block.block_num%28%29+%3D%3D+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E+%29%0A+++++++++next_maintenance_time+%3D+time_point_sec%28%29+%2B%0A+++++++++++++++%28%28%28next_block.timestamp.sec_since_epoch%28%29+%2F+maintenance_interval%29+%2B+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29+*+maintenance_interval%29%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%0A++++++%7B%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+y+%3D+%28head_block_time%28%29+-+next_maintenance_time%29.to_seconds%28%29+%2F+maintenance_interval%3B%0A+++++++++next_maintenance_time+%2B%3D+%28y%2B%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29+*+maintenance_interval%3B%0A++++++%7D%0A+++%7D%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A+++......%0A%0A+++d.next_maintenance_time+%3D+next_maintenance_time%3B%0A%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A+++......%0A%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B%EF%BC%8C%E5%9C%A8%3Ccode%3Eperform_chain_maintenance%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E4%B8%AD%EF%BC%8C%E9%A6%96%E5%85%88%E7%BB%9F%E8%AE%A1%E5%87%BA%E6%AF%8F%E4%B8%AA%E8%B4%A6%E6%88%B7%E5%AE%9E%E9%99%85%E7%9A%84%E6%8A%95%E7%A5%A8%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%8E%A5%E7%9D%80%E8%AE%A1%E7%AE%97%E5%87%BA%E6%8A%95%E5%87%BA%E7%9A%84%E8%AF%81%E4%BA%BA%E6%95%B0%E9%87%8FN%E5%92%8C%E5%BE%97%E7%A5%A8%E7%8E%87%E5%89%8DN%E7%9A%84%E8%AF%81%E4%BA%BA%EF%BC%8C%E5%86%8D%E8%B0%83%E7%94%A8%3Ccode%3Eupdate_active_witnesses%28%29%3C%2Fcode%3E%E6%9B%B4%E6%96%B0%E6%B4%BB%E8%B7%83%E8%AF%81%E4%BA%BA%EF%BC%8C%E6%9C%80%E5%90%8E%E8%AE%A1%E7%AE%97%E5%87%BA%E4%B8%8B%E4%B8%80%E6%AC%A1%E7%9A%84%E5%8C%BA%E5%9D%97%E9%93%BE%E7%BB%B4%E6%8A%A4%E6%97%B6%E9%97%B4%E3%80%82%E9%82%A3%E4%B9%88%3Ccode%3Eperform_chain_maintenance%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E5%8F%88%E6%98%AF%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E8%B0%83%E7%94%A8%E5%91%A2%EF%BC%9F%E4%B8%94%E7%9C%8B%3Ccode%3E_apply_block%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%B0%86%E4%B8%80%E4%B8%AA%E7%AD%BE%E5%90%8D%E5%90%8E%E7%9A%84%E5%8C%BA%E5%9D%97%E6%B7%BB%E5%8A%A0%E5%88%B0%E9%93%BE%E4%B8%8A%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+database%3A%3A_apply_block%28+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+signed_block%26amp%3B+next_block+%29%0A%7B+%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ebool%3C%2Fspan%3E+maint_needed+%3D+%28dynamic_global_props.next_maintenance_time+%26lt%3B%3D+next_block.timestamp%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%BD%93%E5%88%B0%E4%BA%86%E5%8C%BA%E5%9D%97%E9%93%BE%E7%BB%B4%E6%8A%A4%E6%97%B6%E9%97%B4%E6%97%B6%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+maint_needed+%29%0A++++++perform_chain_maintenance%28next_block%2C+global_props%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E6%B3%A8%E6%84%8F%E4%BA%86%EF%BC%8C%E8%BF%99%E9%87%8C%E8%B0%83%E7%94%A8%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%EF%BC%88%E5%89%8D%E9%9D%A2%E8%AE%B2%E8%BF%87%EF%BC%89%3C%2Fspan%3E%0A++++update_witness_schedule%28%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E5%9C%A8%3Ccode%3E_apply_block%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E4%B8%AD%E9%A6%96%E5%85%88%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%88%B0%E4%BA%86%E7%BB%B4%E6%8A%A4%E6%97%B6%E9%97%B4%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%88%B0%E4%BA%86%E7%BB%B4%E6%8A%A4%E6%97%B6%E9%97%B4%E5%B0%B1%E9%87%8D%E6%96%B0%E7%BB%9F%E8%AE%A1%E6%8A%95%E7%A5%A8%EF%BC%8C%E5%BE%97%E5%88%B0%E6%96%B0%E7%9A%84%E6%B4%BB%E8%B7%83%E8%AF%81%E4%BA%BA%E3%80%82%E8%BF%99%E9%87%8C%E5%B0%B1%E9%9C%80%E8%A6%81%E5%BC%BA%E8%B0%83%E7%9A%84%E6%98%AF%EF%BC%8C%E5%9C%A8%E4%B8%8A%E4%B8%80%E8%8A%82%E8%AE%B2%E7%9A%84%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%E4%B9%9F%E6%98%AF%E5%9C%A8%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%E8%B0%83%E7%94%A8%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E8%AF%B4%E6%AF%8F%E6%AC%A1%E5%B0%86%E4%B8%80%E4%B8%AA%E5%8C%BA%E5%9D%97%E6%B7%BB%E5%8A%A0%E7%9A%84%E9%93%BE%E4%B8%8A%E5%90%8E%EF%BC%8C%E9%A6%96%E5%85%88%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%88%B0%E4%BA%86%E5%8C%BA%E5%9D%97%E9%93%BE%E7%BB%B4%E6%8A%A4%E6%97%B6%E9%97%B4%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%98%AF%E5%B0%B1%E7%BB%9F%E8%AE%A1%E6%8A%95%E7%A5%A8%E9%80%89%E5%87%BA%E8%AF%81%E4%BA%BA%E5%B9%B6%E6%9B%B4%E6%96%B0%EF%BC%8C%E7%84%B6%E5%90%8E%E4%BC%9A%E8%B0%83%E7%94%A8%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%EF%BC%8C%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%88%B0%E4%BA%86%E6%B4%97%E7%89%8C%E7%9A%84%E6%97%B6%E5%88%BB%EF%BC%8C%E5%86%8D%E6%B4%97%E7%89%8C%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%E9%82%A3%E4%B9%88%3Ccode%3E_apply_block%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E5%8F%88%E6%98%AF%E4%BB%80%E4%B9%88%E8%B0%83%E7%94%A8%E5%91%A2%EF%BC%9F%E6%88%96%E8%80%85%E8%AF%B4%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E8%B0%83%E5%BA%A6%E8%AF%81%E4%BA%BA%E5%92%8C%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%E5%91%A2%EF%BC%9F%3C%2Fp%3E+%0A++%3Ch1+id%3D%224-%E8%B0%83%E5%BA%A6%E8%AF%81%E4%BA%BA%E5%92%8C%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%22%3E4.+%E8%B0%83%E5%BA%A6%E8%AF%81%E4%BA%BA%E5%92%8C%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%3C%2Fh1%3E+%0A++%3Cp%3E%E8%B0%83%E5%BA%A6%E8%AF%81%E4%BA%BA%E5%92%8C%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%E7%9A%84%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E5%9B%BE%EF%BC%9A+%3Cbr%3E+%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180517190802263%22+alt%3D%22%E8%BF%99%E9%87%8C%E5%86%99%E5%9B%BE%E7%89%87%E6%8F%8F%E8%BF%B0%22+title%3D%22%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E8%BF%99%E4%B8%80%E6%AC%A1%EF%BC%8C%E6%88%91%E4%BB%AC%E4%BB%8E%3Ccode%3Emain%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E5%BC%80%E5%A7%8B%E8%AE%B2%E8%A7%A3%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Eint%3C%2Fspan%3E+main%28%3Cspan+class%3D%22hljs-keyword%22%3Eint%3C%2Fspan%3E+argc%2C+%3Cspan+class%3D%22hljs-keyword%22%3Echar%3C%2Fspan%3E**+argv%29+%7B%0A+++app%3A%3Aapplication*+node+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+app%3A%3Aapplication%28%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%90%AF%E5%8A%A8%E6%89%80%E6%9C%89%E6%8F%92%E4%BB%B6%3C%2Fspan%3E%0A++++++node-%26gt%3Bstartup_plugins%28%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%9C%A8main%E6%96%B9%E6%B3%95%E4%B8%AD%EF%BC%8C%E8%B0%83%E7%94%A8%E5%90%AF%E5%8A%A8%E6%8F%92%E4%BB%B6%E6%8E%A5%E5%8F%A3%3Ccode%3Estartup_plugins%28%29%3C%2Fcode%3E%EF%BC%8C%E5%90%AF%E5%8A%A8%E6%89%80%E6%9C%89%E6%8F%92%E4%BB%B6%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+application%3A%3Astartup_plugins%28%29%0A%7B%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E9%81%8D%E5%8E%86map%EF%BC%8C%E5%90%AF%E5%8A%A8%E6%89%80%E6%9C%89%E6%9C%89%E6%95%88%E7%9A%84%E6%8F%92%E4%BB%B6%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E%28+%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E%26amp%3B+entry+%3A+my-%26gt%3B_active_plugins+%29%0A++++++entry.second-%26gt%3Bplugin_startup%28%29%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%9C%A8%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%EF%BC%8C%E4%BC%9A%E5%90%AF%E5%8A%A8%E6%89%80%E6%9C%89%E6%9C%89%E6%95%88%E7%9A%84%E6%8F%92%E4%BB%B6%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%8A%82%E7%82%B9%E8%A6%81%E8%BF%90%E8%A1%8C%E8%AF%81%E4%BA%BA%E8%8A%82%E7%82%B9%E7%9A%84%E8%AF%9D%E9%9C%80%E8%A6%81%E7%89%B9%E6%AE%8A%E9%85%8D%E7%BD%AE%EF%BC%8C%E8%AF%B7%E5%8F%82%E8%80%83BitShares%E5%AE%98%E7%BD%91%E8%AF%B4%E6%98%8E%3A+%3Ca+href%3D%22http%3A%2F%2Fdocs.bitshares.org%2Fbitshares%2Ftutorials%2Fwitness-howto.html%22+rel%3D%22nofollow%22%3EHowto+Run+a+Block-producing+Witness%3C%2Fa%3E%EF%BC%8C%E6%9C%AC%E6%96%87%E4%B8%8D%E5%81%9A%E4%BB%8B%E7%BB%8D%E3%80%82%E5%9C%A8%E6%89%80%E6%9C%89%E6%8F%92%E4%BB%B6%E4%B8%AD%EF%BC%8C%E5%B0%B1%E5%8C%85%E6%8B%AC%3Ccode%3Ewitness_plugin%3C%2Fcode%3E%E6%8F%92%E4%BB%B6%EF%BC%8C%E5%85%B6%E5%90%AF%E5%8A%A8%E5%AE%9E%E7%8E%B0%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AF%81%E4%BA%BA%E6%8F%92%E4%BB%B6%E5%90%AF%E5%8A%A8%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+witness_plugin%3A%3Aplugin_startup%28%29%0A%7B+%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E+%7B%0A+++ilog%28%3Cspan+class%3D%22hljs-string%22%3E%22witness+plugin%3A+plugin_startup%28%29+begin%22%3C%2Fspan%3E%29%3B%0A+++chain%3A%3Adatabase%26amp%3B+d+%3D+database%28%29%3B%0A%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+%21_witnesses.empty%28%29+%29%0A+++%7B%0A++++++ilog%28%3Cspan+class%3D%22hljs-string%22%3E%22Launching+block+production+for+%24%7Bn%7D+witnesses.%22%3C%2Fspan%3E%2C+%28%3Cspan+class%3D%22hljs-string%22%3E%22n%22%3C%2Fspan%3E%2C+_witnesses.size%28%29%29%29%3B%0A++++++app%28%29.set_block_production%28%3Cspan+class%3D%22hljs-keyword%22%3Etrue%3C%2Fspan%3E%29%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+_production_enabled+%29%0A++++++%7B%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+d.head_block_num%28%29+%3D%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E+%29%0A++++++++++++new_chain_banner%28d%29%3B%0A+++++++++_production_skip_flags+%7C%3D+graphene%3A%3Achain%3A%3Adatabase%3A%3Askip_undo_history_check%3B%0A++++++%7D%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%BC%80%E5%90%AF%E8%B0%83%E5%BA%A6%E7%94%9F%E4%BA%A7%E5%BE%AA%E7%8E%AF%3C%2Fspan%3E%0A++++++schedule_production_loop%28%29%3B%0A+++%7D+%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%0A++++++elog%28%3Cspan+class%3D%22hljs-string%22%3E%22No+witnesses+configured%21+Please+add+witness+IDs+and+private+keys+to+configuration.%22%3C%2Fspan%3E%29%3B%0A+++ilog%28%3Cspan+class%3D%22hljs-string%22%3E%22witness+plugin%3A+plugin_startup%28%29+end%22%3C%2Fspan%3E%29%3B%0A%7D+FC_CAPTURE_AND_RETHROW%28%29+%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%9C%A8%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%EF%BC%8C%E8%BF%9B%E8%A1%8C%E8%8B%A5%E5%B9%B2%E5%88%A4%E6%96%AD%E5%92%8C%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%8C%E7%84%B6%E5%90%8E%E8%B0%83%E7%94%A8%3Ccode%3Eschedule_production_loop%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%EF%BC%8C%E5%BC%80%E5%90%AF%E8%B0%83%E5%BA%A6%E7%94%9F%E4%BA%A7%E5%BE%AA%E7%8E%AF%EF%BC%8C%E5%85%B6%E5%AE%9E%E7%8E%B0%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%B0%83%E5%BA%A6%E7%94%9F%E4%BA%A7%E5%BE%AA%E7%8E%AF%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+witness_plugin%3A%3Aschedule_production_loop%28%29%0A%7B%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AE%A1%E7%AE%97%E4%B8%8B%E4%B8%80%E7%A7%92%E7%9A%84%E6%BB%B4%E7%AD%94%E6%97%B6%E5%88%BB%EF%BC%8C%E4%B8%8D%E5%B0%91%E4%BA%8E50%E6%AF%AB%E7%A7%92%3C%2Fspan%3E%0A+++fc%3A%3Atime_point+now+%3D+fc%3A%3Atime_point%3A%3Anow%28%29%3B%0A+++int64_t+time_to_next_second+%3D+%3Cspan+class%3D%22hljs-number%22%3E1000000%3C%2Fspan%3E+-+%28now.time_since_epoch%28%29.count%28%29+%25+%3Cspan+class%3D%22hljs-number%22%3E1000000%3C%2Fspan%3E%29%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+time_to_next_second+%26lt%3B+%3Cspan+class%3D%22hljs-number%22%3E50000%3C%2Fspan%3E+%29%0A+++++++time_to_next_second+%2B%3D+%3Cspan+class%3D%22hljs-number%22%3E1000000%3C%2Fspan%3E%3B%0A%0A+++fc%3A%3Atime_point+next_wakeup%28+now+%2B+fc%3A%3Amicroseconds%28+time_to_next_second+%29+%29%3B%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%B0%83%E5%BA%A6%E5%8C%BA%E5%9D%97%E7%94%9F%E4%BA%A7%E5%BE%AA%E7%8E%AF%3C%2Fspan%3E%0A+++_block_production_task+%3D+fc%3A%3Aschedule%28%5B%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%5D%7Bblock_production_loop%28%29%3B%7D%2C%0A+++++++++++++++++++++++++++++++++++++++++next_wakeup%2C+%3Cspan+class%3D%22hljs-string%22%3E%22Witness+Block+Production%22%3C%2Fspan%3E%29%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%9C%A8%3Ccode%3Eschedule_production_loop%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E9%87%8C%EF%BC%8C%E8%AE%A1%E7%AE%97%E6%97%B6%E9%92%9F%EF%BC%8C%E8%B0%83%E5%BA%A6%E5%8C%BA%E5%9D%97%E7%94%9F%E4%BA%A7%E5%BE%AA%E7%8E%AF%E6%96%B9%E6%B3%95%3Ccode%3Eblock_production_loop%28%29%3C%2Fcode%3E%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%8C%BA%E5%9D%97%E7%94%9F%E4%BA%A7%E5%BE%AA%E7%8E%AF%3C%2Fspan%3E%0Ablock_production_condition%3A%3Ablock_production_condition_enum+witness_plugin%3A%3Ablock_production_loop%28%29%0A%7B%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%A4%E6%96%AD%E5%8C%BA%E5%9D%97%E7%94%9F%E4%BA%A7%E7%9A%84%E6%9D%A1%E4%BB%B6%E6%98%AF%E5%90%A6%E6%BB%A1%E8%B6%B3%EF%BC%8C%E5%B9%B6%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%3C%2Fspan%3E%0A++++result+%3D+maybe_produce_block%28capture%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%BE%AA%E7%8E%AF%E8%B0%83%E5%BA%A6%E7%94%9F%E4%BA%A7%3C%2Fspan%3E%0A++++schedule_production_loop%28%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%9C%A8%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%EF%BC%8C%E8%B0%83%E7%94%A8%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%E7%9A%84%E5%85%A5%E5%8F%A3%E6%96%B9%E6%B3%95%EF%BC%8C%E7%84%B6%E5%90%8E%E7%BB%A7%E7%BB%AD%E6%89%A7%E8%A1%8C%E5%BE%AA%E7%8E%AF%EF%BC%8C%E5%85%B6%3Ccode%3Emaybe_produce_block%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%A4%E6%96%AD%E5%8C%BA%E5%9D%97%E7%94%9F%E4%BA%A7%E7%9A%84%E6%9D%A1%E4%BB%B6%E6%98%AF%E5%90%A6%E6%BB%A1%E8%B6%B3%EF%BC%8C%E5%B9%B6%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%3C%2Fspan%3E%0Ablock_production_condition%3A%3Ablock_production_condition_enum+witness_plugin%3A%3Amaybe_produce_block%28+fc%3A%3Alimited_mutable_variant_object%26amp%3B+capture+%29%0A%7B%0A+++chain%3A%3Adatabase%26amp%3B+db+%3D+database%28%29%3B%0A+++fc%3A%3Atime_point+now_fine+%3D+fc%3A%3Atime_point%3A%3Anow%28%29%3B%0A+++fc%3A%3Atime_point_sec+now+%3D+now_fine+%2B+fc%3A%3Amicroseconds%28+%3Cspan+class%3D%22hljs-number%22%3E500000%3C%2Fspan%3E+%29%3B%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%A4%E6%96%AD%E7%94%9F%E4%BA%A7%E6%97%B6%E9%92%9F%E6%98%AF%E5%90%A6%E5%90%8C%E6%AD%A5%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+%21_production_enabled+%29%0A+++%7B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+db.get_slot_time%28%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29+%26gt%3B%3D+now+%29%0A+++++++++_production_enabled+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Etrue%3C%2Fspan%3E%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+block_production_condition%3A%3Anot_synced%3B%0A+++%7D%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%A4%E6%96%AD%E7%94%9F%E4%BA%A7%E6%97%B6%E9%97%B4%E6%A7%BD%E5%B7%B2%E7%BB%8F%E5%BC%80%E5%A7%8B%3C%2Fspan%3E%0A+++uint32_t+slot+%3D+db.get_slot_at_time%28+now+%29%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+slot+%3D%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E+%29%0A+++%7B%0A++++++capture%28%3Cspan+class%3D%22hljs-string%22%3E%22next_time%22%3C%2Fspan%3E%2C+db.get_slot_time%28%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29%29%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+block_production_condition%3A%3Anot_time_yet%3B%0A+++%7D%0A%0A+++assert%28+now+%26gt%3B+db.head_block_time%28%29+%29%3B%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E8%BD%AE%E8%BD%AC%E5%88%B0%E5%BD%93%E5%89%8D%E8%AF%81%E4%BA%BA%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%3C%2Fspan%3E%0A+++graphene%3A%3Achain%3A%3Awitness_id_type+scheduled_witness+%3D+db.get_scheduled_witness%28+slot+%29%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+_witnesses.find%28+scheduled_witness+%29+%3D%3D+_witnesses.end%28%29+%29%0A+++%7B%0A++++++capture%28%3Cspan+class%3D%22hljs-string%22%3E%22scheduled_witness%22%3C%2Fspan%3E%2C+scheduled_witness%29%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+block_production_condition%3A%3Anot_my_turn%3B%0A+++%7D%0A%0A+++fc%3A%3Atime_point_sec+scheduled_time+%3D+db.get_slot_time%28+slot+%29%3B%0A+++graphene%3A%3Achain%3A%3Apublic_key_type+scheduled_key+%3D+scheduled_witness%28+db+%29.signing_key%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+private_key_itr+%3D+_private_keys.find%28+scheduled_key+%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%A4%E6%96%AD%E7%A7%81%E9%92%A5%E6%98%AF%E5%90%A6%E6%9C%89%E6%95%88%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+private_key_itr+%3D%3D+_private_keys.end%28%29+%29%0A+++%7B%0A++++++capture%28%3Cspan+class%3D%22hljs-string%22%3E%22scheduled_key%22%3C%2Fspan%3E%2C+scheduled_key%29%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+block_production_condition%3A%3Ano_private_key%3B%0A+++%7D%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E8%BE%BE%E5%88%B0%E6%9C%80%E4%BD%8E%E5%8F%82%E4%B8%8E%E7%8E%87%3C%2Fspan%3E%0A+++uint32_t+prate+%3D+db.witness_participation_rate%28%29%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+prate+%26lt%3B+_required_witness_participation+%29%0A+++%7B%0A++++++capture%28%3Cspan+class%3D%22hljs-string%22%3E%22pct%22%3C%2Fspan%3E%2C+uint32_t%28%3Cspan+class%3D%22hljs-number%22%3E100%3C%2Fspan%3E*uint64_t%28prate%29+%2F+GRAPHENE_1_PERCENT%29%29%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+block_production_condition%3A%3Alow_participation%3B%0A+++%7D%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%A4%E6%96%AD%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94%E6%98%AF%E5%90%A6%E4%BD%8E%E4%BA%8E50%E6%AF%AB%E7%A7%92%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+llabs%28%28scheduled_time+-+now%29.count%28%29%29+%26gt%3B+fc%3A%3Amilliseconds%28+%3Cspan+class%3D%22hljs-number%22%3E500%3C%2Fspan%3E+%29.count%28%29+%29%0A+++%7B%0A++++++capture%28%3Cspan+class%3D%22hljs-string%22%3E%22scheduled_time%22%3C%2Fspan%3E%2C+scheduled_time%29%28%3Cspan+class%3D%22hljs-string%22%3E%22now%22%3C%2Fspan%3E%2C+now%29%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+block_production_condition%3A%3Alag%3B%0A+++%7D%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+block+%3D+db.generate_block%28%0A++++++scheduled_time%2C%0A++++++scheduled_witness%2C%0A++++++private_key_itr-%26gt%3Bsecond%2C%0A++++++_production_skip_flags%0A++++++%29%3B%0A+++capture%28%3Cspan+class%3D%22hljs-string%22%3E%22n%22%3C%2Fspan%3E%2C+block.block_num%28%29%29%28%3Cspan+class%3D%22hljs-string%22%3E%22t%22%3C%2Fspan%3E%2C+block.timestamp%29%28%3Cspan+class%3D%22hljs-string%22%3E%22c%22%3C%2Fspan%3E%2C+now%29%3B%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%B0%86%E7%94%9F%E4%BA%A7%E7%9A%84%E5%8C%BA%E5%9D%97%E5%90%8C%E6%AD%A5%E5%B9%BF%E6%92%AD%E5%88%B0%E7%BD%91%E7%BB%9C%E4%B8%AD%3C%2Fspan%3E%0A+++fc%3A%3Aasync%28+%5B%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%2Cblock%5D%28%29%7B+p2p_node%28%29.broadcast%28net%3A%3Ablock_message%28block%29%29%3B+%7D+%29%3B%0A%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+block_production_condition%3A%3Aproduced%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E5%9C%A8%3Ccode%3Emaybe_produce_block%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E4%B8%AD%EF%BC%8C%E8%BF%9B%E8%A1%8C%E4%BA%86%E5%90%84%E7%A7%8D%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%EF%BC%8C%E5%8F%AA%E6%9C%89%E6%BB%A1%E8%B6%B3%E4%BA%86%E6%89%80%E6%9C%89%E6%9D%A1%E4%BB%B6%E6%89%8D%E5%BC%80%E5%A7%8B%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%EF%BC%8C%E5%B9%B6%E5%B0%86%E7%94%9F%E4%BA%A7%E5%90%8E%E5%8C%BA%E5%9D%97%E5%B9%BF%E6%92%AD%E5%90%8C%E6%AD%A5%E5%88%B0%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%9A%84%E5%85%B6%E4%BB%96%E8%8A%82%E7%82%B9%E3%80%82%E8%BF%99%E9%87%8C%E5%85%88%E4%BB%8B%E7%BB%8D3%E4%B8%AA%E6%96%B9%E6%B3%95%3Ccode%3Eget_slot_time%28%29%3C%2Fcode%3E%E3%80%81%3Ccode%3Eget_slot_at_time%28%29%3C%2Fcode%3E%E5%92%8C%3Ccode%3Eget_scheduled_witness%28%29%3C%2Fcode%3E%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%3Ccode%3Eget_slot_time%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%EF%BC%8C%E8%8E%B7%E5%BE%97%E6%9C%AA%E6%9D%A5%E7%9A%84%E7%AC%ACn%E4%B8%AA%E5%8C%BA%E5%9D%97%E7%94%9F%E4%BA%A7%E6%97%B6%E9%97%B4%E6%A7%BD%E7%9A%84%E6%97%B6%E5%88%BB%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3Efc%3A%3Atime_point_sec+database%3A%3Aget_slot_time%28uint32_t+slot_num%29%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E%0A%7B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+slot_num+%3D%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E+%29%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+fc%3A%3Atime_point_sec%28%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%8C%BA%E5%9D%97%E7%94%9F%E4%BA%A7%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+interval+%3D+block_interval%28%29%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+dynamic_global_property_object%26amp%3B+dpo+%3D+get_dynamic_global_properties%28%29%3B%0A%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+head_block_num%28%29+%3D%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E+%29%0A+++%7B%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5%EF%BC%8C%E7%94%9F%E4%BA%A7%E5%88%9B%E4%B8%96%E5%8C%BA%E5%9D%97%E7%9A%84%E6%97%B6%E5%88%BB%3C%2Fspan%3E%0A++++++fc%3A%3Atime_point_sec+genesis_time+%3D+dpo.time%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+genesis_time+%2B+slot_num+*+interval%3B%0A+++%7D%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%8E%B7%E5%8F%96%E5%89%8D%E4%B8%80%E4%B8%AA%E5%8C%BA%E5%9D%97%E7%94%9F%E4%BA%A7%E6%97%B6%E9%97%B4%E6%A7%BD%E6%97%B6%E5%88%BB%3C%2Fspan%3E%0A+++int64_t+head_block_abs_slot+%3D+head_block_time%28%29.sec_since_epoch%28%29+%2F+interval%3B%0A+++fc%3A%3Atime_point_sec+head_slot_time%28head_block_abs_slot+*+interval%29%3B%0A%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+global_property_object%26amp%3B+gpo+%3D+get_global_properties%28%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%A6%82%E6%9E%9C%E5%BD%93%E5%89%8D%E4%B8%BA%E5%8C%BA%E5%9D%97%E9%93%BE%E7%BB%B4%E6%8A%A4%E6%97%B6%E5%88%BB%EF%BC%8C%E5%88%99%E8%B7%B3%E8%BF%87%E6%8C%87%E5%AE%9A%E4%B8%AA%E6%97%B6%E9%97%B4%E6%A7%BD%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+dpo.dynamic_flags+%26amp%3B+dynamic_global_property_object%3A%3Amaintenance_flag+%29%0A++++++slot_num+%2B%3D+gpo.parameters.maintenance_skip_slots%3B%0A%0A++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%89%8D%E4%B8%80%E4%B8%AA%E7%94%9F%E4%BA%A7%E6%97%B6%E9%97%B4%2B%E8%8B%A5%E5%B9%B2%E7%94%9F%E4%BA%A7%E9%97%B4%E9%9A%94%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+head_slot_time+%2B+%28slot_num+*+interval%29%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%3Ccode%3Eget_slot_at_time%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E4%B8%BB%E8%A6%81%E6%98%AF%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E6%97%B6%E9%97%B4%E5%B1%9E%E4%BA%8E%E6%9C%AA%E6%9D%A5%E5%93%AA%E4%B8%AA%E6%97%B6%E9%97%B4%E6%A7%BD%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3Euint32_t+database%3A%3Aget_slot_at_time%28fc%3A%3Atime_point_sec+when%29%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E%0A%7B%0A+++fc%3A%3Atime_point_sec+first_slot_time+%3D+get_slot_time%28+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E+%29%3B%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%A4%E6%96%AD%E6%8C%87%E5%AE%9A%E7%9A%84%E6%97%B6%E9%97%B4%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E8%BF%87%E6%97%B6%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+when+%26lt%3B+first_slot_time+%29%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%28when+-+first_slot_time%29.to_seconds%28%29+%2F+block_interval%28%29+%2B+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%3Ccode%3Eget_scheduled_witness%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0%E4%BA%86%E8%8E%B7%E5%8F%96%E6%8C%87%E5%AE%9A%E6%97%B6%E9%97%B4%E6%A7%BD%E7%9A%84%E5%8C%BA%E5%9D%97%E7%94%9F%E4%BA%A7%E8%B0%83%E5%BA%A6%E8%AF%81%E4%BA%BA%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3Ewitness_id_type+database%3A%3Aget_scheduled_witness%28+uint32_t+slot_num+%29%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E%0A%7B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+dynamic_global_property_object%26amp%3B+dpo+%3D+get_dynamic_global_properties%28%29%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+witness_schedule_object%26amp%3B+wso+%3D+witness_schedule_id_type%28%29%28*%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%29%3B%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AE%A1%E7%AE%97%E8%B0%83%E5%BA%A6%E5%81%8F%E7%A7%BB%E9%87%8F%3C%2Fspan%3E%0A+++uint64_t+current_aslot+%3D+dpo.current_aslot+%2B+slot_num%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+wso.current_shuffled_witnesses%5B+current_aslot+%25+wso.current_shuffled_witnesses.size%28%29+%5D%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E8%BF%99%E9%87%8C%E5%B0%B1%E5%92%8C%E5%89%8D%E9%9D%A2%E8%AE%B2%E7%9A%84%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95%E8%A1%94%E6%8E%A5%E4%B8%8A%E4%BA%86%EF%BC%8C%3Ccode%3Eget_scheduled_witness%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E6%98%AF%E4%BB%8E%E6%B4%97%E7%89%8C%E5%90%8E%E7%9A%84%E9%9B%86%E5%90%88%3Ccode%3Ecurrent_shuffled_witnesses%3C%2Fcode%3E%E4%B8%AD%E8%8E%B7%E5%8F%96%E8%AF%81%E4%BA%BA%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%E4%B8%8B%E9%9D%A2%E5%86%8D%E5%9B%9E%E5%88%B0%3Ccode%3Emaybe_produce_block%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E4%B8%AD%E6%9D%A5%EF%BC%8C%E5%9C%A8%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%E8%B0%83%E7%94%A8%E4%BA%86%3Ccode%3Egenerate_block%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%EF%BC%8C%E5%85%B6%E5%AE%9E%E7%8E%B0%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3Esigned_block+database%3A%3Agenerate_block%28%0A+++fc%3A%3Atime_point_sec+when%2C%0A+++witness_id_type+witness_id%2C%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+fc%3A%3Aecc%3A%3Aprivate_key%26amp%3B+block_signing_private_key%2C%0A+++uint32_t+skip+%3Cspan+class%3D%22hljs-comment%22%3E%2F*+%3D+0+*%2F%3C%2Fspan%3E%0A+++%29%0A%7B+%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E+%7B%0A+++signed_block+result%3B%0A+++detail%3A%3Awith_skip_flags%28+*%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%2C+skip%2C+%5B%26amp%3B%5D%28%29%0A+++%7B%0A+++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%B0%83%E7%94%A8%E5%AE%9E%E9%99%85%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%E6%96%B9%E6%B3%95%3C%2Fspan%3E%0A++++++result+%3D+_generate_block%28+when%2C+witness_id%2C+block_signing_private_key+%29%3B%0A+++%7D+%29%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+result%3B%0A%7D+FC_CAPTURE_AND_RETHROW%28%29+%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%9C%A8%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%E6%89%8D%E8%B0%83%E7%94%A8%E7%94%A8%E5%AE%9E%E9%99%85%E7%94%9F%E4%BA%A7%E5%8C%BA%E5%9D%97%E7%9A%84%E6%96%B9%E6%B3%95%3Ccode%3E_generate_block%28%29%3C%2Fcode%3E%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3Esigned_block+database%3A%3A_generate_block%28%0A+++fc%3A%3Atime_point_sec+when%2C%0A+++witness_id_type+witness_id%2C%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+fc%3A%3Aecc%3A%3Aprivate_key%26amp%3B+block_signing_private_key%0A+++%29%0A%7B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E+%7B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Estatic%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+size_t+max_block_header_size+%3D+fc%3A%3Araw%3A%3Apack_size%28+signed_block_header%28%29+%29+%2B+%3Cspan+class%3D%22hljs-number%22%3E4%3C%2Fspan%3E%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+maximum_block_size+%3D+get_global_properties%28%29.parameters.maximum_block_size%3B%0A+++size_t+total_block_size+%3D+max_block_header_size%3B%0A%0A+++signed_block+pending_block%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E%28+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+processed_transaction%26amp%3B+tx+%3A+_pending_tx+%29%0A+++%7B%0A++++++size_t+new_total_size+%3D+total_block_size+%2B+fc%3A%3Araw%3A%3Apack_size%28+tx+%29%3B%0A%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AE%A1%E7%AE%97%E4%BA%A4%E6%98%93%E5%A4%A7%E5%B0%8F%EF%BC%8C%E9%98%B2%E6%AD%A2%E8%B6%85%E8%BF%87%E6%9C%80%E5%A4%A7%E9%99%90%E5%BA%A6%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+new_total_size+%26gt%3B%3D+maximum_block_size+%29%0A++++++%7B%0A+++++++++postponed_tx_count%2B%2B%3B%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Econtinue%3C%2Fspan%3E%3B%0A++++++%7D%0A%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E%0A++++++%7B%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+temp_session+%3D+_undo_db.start_undo_session%28%29%3B%0A+++++++++processed_transaction+ptx+%3D+_apply_transaction%28+tx+%29%3B%0A+++++++++temp_session.merge%28%29%3B%0A%0A+++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%B0%86%E4%BA%A4%E6%98%93%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%8C%BA%E5%9D%97%E4%B8%AD%3C%2Fspan%3E%0A+++++++++total_block_size+%2B%3D+fc%3A%3Araw%3A%3Apack_size%28+ptx+%29%3B%0A+++++++++pending_block.transactions.push_back%28+ptx+%29%3B%0A++++++%7D%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A+++%7D%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A+++pending_block.previous+%3D+head_block_id%28%29%3B+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E6%B7%BB%E5%8A%A0%E4%B8%8A%E4%B8%80%E4%B8%AA%E5%8C%BA%E5%9D%97id%3C%2Fspan%3E%0A+++pending_block.timestamp+%3D+when%3B+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%B7%BB%E5%8A%A0%E6%97%B6%E9%97%B4%E6%88%B3%3C%2Fspan%3E%0A+++pending_block.transaction_merkle_root+%3D+pending_block.calculate_merkle_root%28%29%3B+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%B7%BB%E5%8A%A0%E4%BA%A4%E6%98%93%E6%A0%91%E6%A0%B9%3C%2Fspan%3E%0A+++pending_block.witness+%3D+witness_id%3B+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%9B%B4%E6%96%B0%E8%AF%81%E4%BA%BAid%3C%2Fspan%3E%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E7%AD%BE%E5%90%8D%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+%21%28skip+%26amp%3B+skip_witness_signature%29+%29%0A++++++pending_block.sign%28+block_signing_private_key+%29%3B%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E6%A3%80%E6%9F%A5%E5%8C%BA%E5%9D%97%E5%A4%A7%E5%B0%8F%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+%21%28skip+%26amp%3B+skip_block_size_check%29+%29%0A+++%7B%0A++++++FC_ASSERT%28+fc%3A%3Araw%3A%3Apack_size%28pending_block%29+%26lt%3B%3D+get_global_properties%28%29.parameters.maximum_block_size+%29%3B%0A+++%7D%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%B0%83%E7%94%A8%E6%8E%A8%E5%9D%97%E6%96%B9%E6%B3%95%3C%2Fspan%3E%0A+++push_block%28+pending_block%2C+skip+%29%3B%0A%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+pending_block%3B%0A%7D+FC_CAPTURE_AND_RETHROW%28+%28witness_id%29+%29+%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%86%8D%E6%9D%A5%E7%9C%8B%E5%B0%86%E5%BE%85%E5%AE%9A%E5%8C%BA%E5%9D%97%E6%B7%BB%E5%8A%A0%E5%88%B0%E9%93%BE%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B%3Ccode%3Epush_block%28%29%3C%2Fcode%3E%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Ebool%3C%2Fspan%3E+database%3A%3Apush_block%28%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+signed_block%26amp%3B+new_block%2C+uint32_t+skip%29%0A%7B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Ebool%3C%2Fspan%3E+result%3B%0A+++detail%3A%3Awith_skip_flags%28+*%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%2C+skip%2C+%5B%26amp%3B%5D%28%29%0A+++%7B%0A++++++detail%3A%3Awithout_pending_transactions%28+*%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Amove%28_pending_tx%29%2C%0A++++++%5B%26amp%3B%5D%28%29%0A++++++%7B%0A++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%B0%83%E7%94%A8%E5%AE%9E%E9%99%85%E7%9A%84%E6%8E%A8%E5%9D%97%E6%96%B9%E6%B3%95%3C%2Fspan%3E%0A+++++++++result+%3D+_push_block%28new_block%29%3B%0A++++++%7D%29%3B%0A+++%7D%29%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+result%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%9C%A8%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%E8%B0%83%E7%94%A8%E5%AE%9E%E9%99%85%E7%9A%84%E6%8E%A8%E5%9D%97%E7%9A%84%E6%96%B9%E6%B3%95%3Ccode%3E_push_block%28%29%3C%2Fcode%3E%EF%BC%8C%E5%85%B6%E5%AE%9E%E7%8E%B0%E5%A6%82%E4%B8%8B%3A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Ebool%3C%2Fspan%3E+database%3A%3A_push_block%28%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+signed_block%26amp%3B+new_block%29%0A%7B+%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E+%7B%0A+++uint32_t+skip+%3D+get_node_properties%28%29.skip_flags%3B%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%9C%A8%E6%AD%A4%E5%A4%84%E7%90%86%E5%8C%BA%E5%9D%97%E9%93%BE%E7%AB%9E%E4%BA%89%E5%88%86%E5%8F%89%E9%97%AE%E9%A2%98%EF%BC%8C%E7%90%86%E8%AE%BA%E8%AE%B2%E8%A7%A3%E8%AF%B7%E5%8F%82%E7%9C%8B%E6%9C%AC%E4%BA%BA%E7%BF%BB%E8%AF%91%E7%9A%84%E5%8F%A6%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%EF%BC%9A%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+https%3A%2F%2Fblog.csdn.net%2Fggq89%2Farticle%2Fdetails%2F80072876%3C%2Fspan%3E%0A%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E+%7B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+session+%3D+_undo_db.start_undo_session%28%29%3B%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%B0%86%E6%96%B0%E5%8C%BA%E5%9D%97%E6%B7%BB%E5%8A%A0%E5%88%B0%E9%93%BE%E4%B8%8A%3C%2Fspan%3E%0A++++++apply_block%28new_block%2C+skip%29%3B%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%AD%98%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93%3C%2Fspan%3E%0A++++++_block_id_to_block.store%28new_block.id%28%29%2C+new_block%29%3B%0A++++++session.commit%28%29%3B%0A+++%7D+%3Cspan+class%3D%22hljs-keyword%22%3Ecatch%3C%2Fspan%3E+%28+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+fc%3A%3Aexception%26amp%3B+e+%29+%7B%0A++++++elog%28%3Cspan+class%3D%22hljs-string%22%3E%22Failed+to+push+new+block%3A%5Cn%24%7Be%7D%22%3C%2Fspan%3E%2C+%28%3Cspan+class%3D%22hljs-string%22%3E%22e%22%3C%2Fspan%3E%2C+e.to_detail_string%28%29%29%29%3B%0A++++++_fork_db.remove%28new_block.id%28%29%29%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethrow%3C%2Fspan%3E%3B%0A+++%7D%0A%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Efalse%3C%2Fspan%3E%3B%0A%7D+FC_CAPTURE_AND_RETHROW%28+%28new_block%29+%29+%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E4%B8%8B%E9%9D%A2%E5%86%8D%E7%9C%8B%3Ccode%3Eapply_block%28%29%3C%2Fcode%3E%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+database%3A%3Aapply_block%28+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+signed_block%26amp%3B+next_block%2C+uint32_t+skip+%29%0A%7B%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A+++detail%3A%3Awith_skip_flags%28+*%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%2C+skip%2C+%5B%26amp%3B%5D%28%29%0A+++%7B%0A+++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%9C%A8%E6%AD%A4%E8%B0%83%E7%94%A8%E5%AE%9E%E9%99%85%E7%9A%84%E6%B7%BB%E5%8A%A0%E5%8C%BA%E5%9D%97%E6%96%B9%E6%B3%95%3C%2Fspan%3E%0A++++++_apply_block%28+next_block+%29%3B%0A+++%7D+%29%3B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%88%B0%E8%BF%99%E9%87%8C%E5%B0%B1%E5%92%8C%E5%89%8D%E9%9D%A2%E6%89%80%E8%AE%B2%E7%9A%84%E5%85%A8%E9%83%A8%E5%86%85%E5%AE%B9%E8%A1%94%E6%8E%A5%E5%9C%A8%E4%B8%80%E8%B5%B7%E4%BA%86%EF%BC%8C%E8%BF%99%E4%B8%AA%E7%AC%AC%E4%B8%89%E6%AC%A1%E4%BB%A3%E7%A0%81%E8%B7%9F%E8%B8%AA%E5%88%B0%3Ccode%3E_apply_block%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%EF%BC%8C%E8%87%B3%E6%AD%A4%E6%95%B4%E4%B8%AAdpos%E5%85%B1%E8%AF%86%E8%BF%87%E7%A8%8B%E5%9F%BA%E6%9C%AC%E8%AE%B2%E8%A7%A3%E5%AE%8C%E6%AF%95%E3%80%82%E6%9C%80%E5%90%8E%E5%8F%AA%E5%89%A9%E4%B8%8B%E6%95%B4%E4%B8%AA%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E7%A8%8B%E4%BA%86%3C%2Fp%3E+%0A++%3Ch1+id%3D%225-%E8%AF%81%E4%BA%BA%E8%8A%82%E7%82%B9%E5%88%9D%E5%A7%8B%E5%8C%96%22%3E5.+%E8%AF%81%E4%BA%BA%E8%8A%82%E7%82%B9%E5%88%9D%E5%A7%8B%E5%8C%96%3C%2Fh1%3E+%0A++%3Cp%3E%E8%AF%81%E4%BA%BA%E8%8A%82%E7%82%B9%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E5%9B%BE%EF%BC%9A+%3Cbr%3E+%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180517201622875%22+alt%3D%22%E8%BF%99%E9%87%8C%E5%86%99%E5%9B%BE%E7%89%87%E6%8F%8F%E8%BF%B0%22+title%3D%22%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E7%95%99%E4%B8%8B%E6%9C%89%E4%B8%AA%E7%96%91%E9%97%AE%EF%BC%8C%E6%95%B4%E4%B8%AA%E7%A8%8B%E5%BA%8F%E6%9C%80%E5%BC%80%E5%A7%8B%E8%BF%90%E8%A1%8C%E6%97%B6%EF%BC%8C%E8%AF%81%E4%BA%BA%E8%8A%82%E7%82%B9%E6%98%AF%E5%A6%82%E4%BD%95%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E5%91%A2%EF%BC%9F%E5%AE%9E%E9%99%85%E4%B8%8A%E5%88%9D%E5%A7%8B%E6%95%B0%E6%8D%AE%E6%98%AF%E5%9C%A8%3Ccode%3Einit_genesis%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E4%B8%AD%E5%88%9D%E5%A7%8B%E7%9A%84%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%9D%E5%A7%8B%E5%88%9B%E4%B8%96%E6%95%B0%E6%8D%AE%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+database%3A%3Ainit_genesis%28%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+genesis_state_type%26amp%3B+genesis_state%29%0A%7B+%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E+%7B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%9B%E5%BB%BA%E5%88%9D%E5%A7%8B%E8%B4%A6%E6%88%B7%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E%28+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E%26amp%3B+account+%3A+genesis_state.initial_accounts+%29%0A+++%7B%0A++++++account_create_operation+cop%3B%0A++++++cop.name+%3D+account.name%3B%0A++++++cop.registrar+%3D+GRAPHENE_TEMP_ACCOUNT%3B%0A++++++cop.owner+%3D+authority%28%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%2C+account.owner_key%2C+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+account.active_key+%3D%3D+public_key_type%28%29+%29%0A++++++%7B%0A+++++++++cop.active+%3D+cop.owner%3B%0A+++++++++cop.options.memo_key+%3D+account.owner_key%3B%0A++++++%7D%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%0A++++++%7B%0A+++++++++cop.active+%3D+authority%28%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%2C+account.active_key%2C+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29%3B%0A+++++++++cop.options.memo_key+%3D+account.active_key%3B%0A++++++%7D%0A++++++account_id_type+account_id%28apply_operation%28genesis_eval_state%2C+cop%29.get%26lt%3Bobject_id_type%26gt%3B%28%29%29%3B%0A%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+account.is_lifetime_member+%29%0A++++++%7B%0A++++++++++account_upgrade_operation+op%3B%0A++++++++++op.account_to_upgrade+%3D+account_id%3B%0A++++++++++op.upgrade_to_lifetime_member+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Etrue%3C%2Fspan%3E%3B%0A++++++++++apply_operation%28genesis_eval_state%2C+op%29%3B%0A++++++%7D%0A+++%7D%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%9B%E5%BB%BA%E5%88%9D%E5%A7%8B%E8%AF%81%E4%BA%BA%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Afor_each%28genesis_state.initial_witness_candidates.begin%28%29%2C+genesis_state.initial_witness_candidates.end%28%29%2C%0A+++++++++++++++++%5B%26amp%3B%5D%28%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+genesis_state_type%3A%3Ainitial_witness_type%26amp%3B+witness%29+%7B%0A++++++witness_create_operation+op%3B%0A++++++op.witness_account+%3D+get_account_id%28witness.owner_name%29%3B%0A++++++op.block_signing_key+%3D+witness.block_signing_key%3B%0A++++++apply_operation%28genesis_eval_state%2C+op%29%3B%0A+++%7D%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AE%BE%E7%BD%AE%E6%B4%BB%E8%B7%83%E8%AF%81%E4%BA%BA%3C%2Fspan%3E%0A+++modify%28get_global_properties%28%29%2C+%5B%26amp%3B%5D%28global_property_object%26amp%3B+p%29+%7B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E%28+uint32_t+i+%3D+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%3B+i+%26lt%3B%3D+genesis_state.initial_active_witnesses%3B+%2B%2Bi+%29%0A++++++%7B%0A+++++++++p.active_witnesses.insert%28witness_id_type%28i%29%29%3B%0A++++++%7D%0A+++%7D%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%9B%E5%BB%BA%E8%AF%81%E4%BA%BA%E8%B0%83%E5%BA%A6%E9%A1%BA%E5%BA%8F%3C%2Fspan%3E%0A+++create%26lt%3Bwitness_schedule_object%26gt%3B%28%5B%26amp%3B%5D%28+witness_schedule_object%26amp%3B+wso+%29%0A+++%7B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E%28+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+witness_id_type%26amp%3B+wid+%3A+get_global_properties%28%29.active_witnesses+%29%0A+++++++++wso.current_shuffled_witnesses.push_back%28+wid+%29%3B%0A+++%7D%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A%7D+FC_CAPTURE_AND_RETHROW%28%29+%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E6%95%B4%E4%B8%AA%3Ccode%3Einit_genesis%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E9%83%BD%E5%9C%A8%E8%BF%9B%E8%A1%8C%E5%90%84%E7%A7%8D%E5%B1%9E%E6%80%A7%E5%80%BC%E7%9A%84%E5%88%9D%E5%A7%8B%EF%BC%8C%E4%B8%94%E5%88%9B%E4%B8%96%E6%95%B0%E6%8D%AE%E6%98%AF%E9%80%9A%E8%BF%87%E5%8F%82%E6%95%B0%3Ccode%3Egenesis_state%3C%2Fcode%3E%E4%BC%A0%E5%85%A5%EF%BC%8C%E8%80%8C%E8%AF%A5%E6%96%B9%E6%B3%95%E5%8F%88%E5%9C%A8%3Ccode%3Eopen%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E4%B8%AD%E8%B0%83%E7%94%A8%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E6%89%93%E5%BC%80%E6%8C%87%E5%AE%9A%E8%B7%AF%E5%BE%84%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%AD%98%E5%9C%A8%E5%B0%B1%E6%96%B0%E5%BB%BA%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+database%3A%3Aopen%28%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+fc%3A%3Apath%26amp%3B+data_dir%2C%0A+++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3Afunction%26lt%3Bgenesis_state_type%28%29%26gt%3B+genesis_loader%2C%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3A%3Cspan+class%3D%22hljs-built_in%22%3Estring%3C%2Fspan%3E%26amp%3B+db_version%29%0A%7B%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E%0A+++%7B%0A%0A+++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%A6%82%E6%9E%9C%E5%85%A8%E5%B1%80%E5%B1%9E%E6%80%A7%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%88%99%E5%88%9D%E5%A7%8B%E5%88%9B%E4%B8%96%E6%95%B0%E6%8D%AE%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+%21find%28global_property_id_type%28%29%29+%29%0A+++++++++init_genesis%28genesis_loader%28%29%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A+++%7D%0A+++FC_CAPTURE_LOG_AND_RETHROW%28+%28data_dir%29+%29%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E5%9C%A8%3Ccode%3Eopen%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E4%B8%AD%E8%B0%83%E7%94%A8%3Ccode%3Einit_genesis%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E6%97%B6%EF%BC%8C%E5%85%B6%E5%8F%82%E6%95%B0%E6%98%AF%E9%80%9A%E8%BF%87%E8%B0%83%E7%94%A8%3Ccode%3Egenesis_loader%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC%E5%AF%B9%3Ccode%3Einit_genesis%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E7%9A%84%E5%AE%9E%E5%8F%82%E8%BF%9B%E8%A1%8C%E8%B5%8B%E5%80%BC%E3%80%82%E8%80%8C%3Ccode%3Einit_genesis%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E4%B9%9F%E6%98%AF%3Ccode%3Eopen%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E7%9A%84%E5%8F%82%E6%95%B0%E4%B9%8B%E4%B8%80%EF%BC%8C%E8%80%8C%3Ccode%3Eopen%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E5%8F%88%E6%98%AF%E5%9C%A8%3Ccode%3Estartup%28%29%3C%2Fcode%3E%E4%B8%AD%E8%B0%83%E7%94%A8%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+startup%28%29%0A++++++%7B+%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E+%7B%0A%0A+++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+initial_state+%3D+%5B%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%5D+%7B%0A++++++++++++ilog%28%3Cspan+class%3D%22hljs-string%22%3E%22Initializing+database...%22%3C%2Fspan%3E%29%3B%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E6%8C%87%E5%AE%9Agenesis.json%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+_options-%26gt%3Bcount%28%3Cspan+class%3D%22hljs-string%22%3E%22genesis-json%22%3C%2Fspan%3E%29+%29%0A++++++++++++%7B%0A+++++++++++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3A%3Cspan+class%3D%22hljs-built_in%22%3Estring%3C%2Fspan%3E+genesis_str%3B%0A+++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+1.+%E8%AF%BB%E5%8F%96genesis.json%E6%96%87%E4%BB%B6%3C%2Fspan%3E%0A+++++++++++++++fc%3A%3Aread_file_contents%28+_options-%26gt%3Bat%28%3Cspan+class%3D%22hljs-string%22%3E%22genesis-json%22%3C%2Fspan%3E%29.as%26lt%3Bboost%3A%3Afilesystem%3A%3Apath%26gt%3B%28%29%2C+genesis_str+%29%3B%0A+++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+2.+%E4%BB%8Ejson%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%88%9B%E4%B8%96%E7%8A%B6%E6%80%81%E6%95%B0%E6%8D%AE%3C%2Fspan%3E%0A+++++++++++++++genesis_state_type+genesis+%3D+fc%3A%3Ajson%3A%3Afrom_string%28+genesis_str+%29.as%26lt%3Bgenesis_state_type%26gt%3B%28+%3Cspan+class%3D%22hljs-number%22%3E20%3C%2Fspan%3E+%29%3B%0A+++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ebool%3C%2Fspan%3E+modified_genesis+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Efalse%3C%2Fspan%3E%3B%0A+++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+_options-%26gt%3Bcount%28%3Cspan+class%3D%22hljs-string%22%3E%22genesis-timestamp%22%3C%2Fspan%3E%29+%29%0A+++++++++++++++%7B%0A++++++++++++++++++genesis.initial_timestamp+%3D+fc%3A%3Atime_point_sec%28+fc%3A%3Atime_point%3A%3Anow%28%29+%29%0A++++++++++++++++++++++++++++++++++++++++++++%2B+genesis.initial_parameters.block_interval%0A++++++++++++++++++++++++++++++++++++++++++++%2B+_options-%26gt%3Bat%28%3Cspan+class%3D%22hljs-string%22%3E%22genesis-timestamp%22%3C%2Fspan%3E%29.as%26lt%3Buint32_t%26gt%3B%28%29%3B%0A++++++++++++++++++genesis.initial_timestamp+-%3D+%28+genesis.initial_timestamp.sec_since_epoch%28%29%0A+++++++++++++++++++++++++++++++++++++++++++++++++%25+genesis.initial_parameters.block_interval+%29%3B%0A++++++++++++++++++modified_genesis+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Etrue%3C%2Fspan%3E%3B%0A++++++++++++++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3A%3Cspan+class%3D%22hljs-built_in%22%3Ecerr%3C%2Fspan%3E+%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-string%22%3E%22Used+genesis+timestamp%3A+%22%3C%2Fspan%3E+%26lt%3B%26lt%3B+genesis.initial_timestamp.to_iso_string%28%29%0A++++++++++++++++++++++++++++%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-string%22%3E%22+%28PLEASE+RECORD+THIS%29%5Cn%22%3C%2Fspan%3E%3B%0A+++++++++++++++%7D%0A+++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+_options-%26gt%3Bcount%28%3Cspan+class%3D%22hljs-string%22%3E%22dbg-init-key%22%3C%2Fspan%3E%29+%29%0A+++++++++++++++%7B%0A++++++++++++++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3A%3Cspan+class%3D%22hljs-built_in%22%3Estring%3C%2Fspan%3E+init_key+%3D+_options-%26gt%3Bat%28+%3Cspan+class%3D%22hljs-string%22%3E%22dbg-init-key%22%3C%2Fspan%3E+%29.as%26lt%3B%3Cspan+class%3D%22hljs-built_in%22%3Estring%3C%2Fspan%3E%26gt%3B%28%29%3B%0A++++++++++++++++++FC_ASSERT%28+genesis.initial_witness_candidates.size%28%29+%26gt%3B%3D+genesis.initial_active_witnesses+%29%3B%0A++++++++++++++++++set_dbg_init_key%28+genesis%2C+init_key+%29%3B%0A++++++++++++++++++modified_genesis+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Etrue%3C%2Fspan%3E%3B%0A++++++++++++++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3A%3Cspan+class%3D%22hljs-built_in%22%3Ecerr%3C%2Fspan%3E+%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-string%22%3E%22Set+init+witness+key+to+%22%3C%2Fspan%3E+%26lt%3B%26lt%3B+init_key+%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-string%22%3E%22%5Cn%22%3C%2Fspan%3E%3B%0A+++++++++++++++%7D%0A+++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+modified_genesis+%29%0A+++++++++++++++%7B%0A++++++++++++++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3A%3Cspan+class%3D%22hljs-built_in%22%3Ecerr%3C%2Fspan%3E+%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-string%22%3E%22WARNING%3A+GENESIS+WAS+MODIFIED%2C+YOUR+CHAIN+ID+MAY+BE+DIFFERENT%5Cn%22%3C%2Fspan%3E%3B%0A++++++++++++++++++genesis_str+%2B%3D+%3Cspan+class%3D%22hljs-string%22%3E%22BOGUS%22%3C%2Fspan%3E%3B%0A++++++++++++++++++genesis.initial_chain_id+%3D+fc%3A%3Asha256%3A%3Ahash%28+genesis_str+%29%3B%0A+++++++++++++++%7D%0A+++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%0A++++++++++++++++++genesis.initial_chain_id+%3D+fc%3A%3Asha256%3A%3Ahash%28+genesis_str+%29%3B%0A+++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+genesis%3B%0A++++++++++++%7D%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%8C%87%E5%AE%9Agenesis.json%E6%96%87%E4%BB%B6%EF%BC%8C%E5%88%99%E5%88%9D%E5%A7%8B%E4%B8%BA%E7%A9%BA%E4%B8%B2%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%0A++++++++++++%7B%0A+++++++++++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3A%3Cspan+class%3D%22hljs-built_in%22%3Estring%3C%2Fspan%3E+egenesis_json%3B%0A+++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%9D%E5%A7%8Bjson%E6%96%87%E4%BB%B6%E4%B8%BA%E7%A9%BA%E4%B8%B2%3C%2Fspan%3E%0A+++++++++++++++graphene%3A%3Aegenesis%3A%3Acompute_egenesis_json%28+egenesis_json+%29%3B%0A+++++++++++++++FC_ASSERT%28+egenesis_json+%21%3D+%3Cspan+class%3D%22hljs-string%22%3E%22%22%3C%2Fspan%3E+%29%3B%0A+++++++++++++++FC_ASSERT%28+graphene%3A%3Aegenesis%3A%3Aget_egenesis_json_hash%28%29+%3D%3D+fc%3A%3Asha256%3A%3Ahash%28+egenesis_json+%29+%29%3B%0A+++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+genesis+%3D+fc%3A%3Ajson%3A%3Afrom_string%28+egenesis_json+%29.as%26lt%3Bgenesis_state_type%26gt%3B%28+%3Cspan+class%3D%22hljs-number%22%3E20%3C%2Fspan%3E+%29%3B%0A+++++++++++++++genesis.initial_chain_id+%3D+fc%3A%3Asha256%3A%3Ahash%28+egenesis_json+%29%3B%0A+++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+genesis%3B%0A++++++++++++%7D%0A+++++++++%7D%3B%0A%0A+++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E%0A+++++++++%7B%0A+++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E6%89%93%E5%BC%80%E6%95%B0%E6%8D%AE%E5%BA%93%3C%2Fspan%3E%0A++++++++++++_chain_db-%26gt%3Bopen%28+_data_dir+%2F+%3Cspan+class%3D%22hljs-string%22%3E%22blockchain%22%3C%2Fspan%3E%2C+initial_state%2C+GRAPHENE_CURRENT_DB_VERSION+%29%3B%0A+++++++++%7D%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ecatch%3C%2Fspan%3E%28+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+fc%3A%3Aexception%26amp%3B+e+%29%0A+++++++++%7B%0A++++++++++++elog%28+%3Cspan+class%3D%22hljs-string%22%3E%22Caught+exception+%24%7Be%7D+in+open%28%29%2C+you+might+want+to+force+a+replay%22%3C%2Fspan%3E%2C+%28%3Cspan+class%3D%22hljs-string%22%3E%22e%22%3C%2Fspan%3E%2C+e.to_detail_string%28%29%29+%29%3B%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethrow%3C%2Fspan%3E%3B%0A+++++++++%7D%0A%0A+++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A++++++%7D+FC_LOG_AND_RETHROW%28%29+%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%9C%A8%3Ccode%3Estartup%28%29%3C%2Fcode%3E%E4%B8%AD%E5%8C%85%E5%90%AB%E4%BA%86%E5%88%9B%E4%B8%96%E7%8A%B6%E6%80%81%E7%9A%84%E5%AE%9E%E9%99%85%E5%88%9D%E5%A7%8B%E8%BF%87%E7%A8%8B%3Ccode%3Einitial_state%3C%2Fcode%3E%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%EF%BC%88%E5%8D%B3%3Ccode%3Egenesis_loader%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E5%AE%9E%E9%99%85%E6%89%A7%E8%A1%8C%E7%9A%84%E6%98%AF%3Ccode%3Einitial_state%3C%2Fcode%3E%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E6%8C%87%E5%90%91%E7%9A%84%E4%BB%A3%E7%A0%81%EF%BC%89%EF%BC%8C%E5%9C%A8%3Ccode%3Einitial_state%3C%2Fcode%3E%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%3Ccode%3E_options%3C%2Fcode%3E%E8%AF%BB%E5%8F%96%E6%8C%87%E5%AE%9A%3Ccode%3Egenesis.json%3C%2Fcode%3E%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86%EF%BC%8C%E8%80%8C%3Ccode%3E_options%3C%2Fcode%3E%E7%9A%84%E8%B5%8B%E5%80%BC%E5%92%8C%3Ccode%3Estartup%28%29%3C%2Fcode%3E%E7%9A%84%E8%B0%83%E7%94%A8%E9%83%BD%E6%98%AF%E5%9C%A8%3Ccode%3Emain%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E4%B8%AD%E8%BF%9B%E8%A1%8C%E7%9A%84%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AF%81%E4%BA%BA%E8%8A%82%E7%82%B9%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Eint%3C%2Fspan%3E+main%28%3Cspan+class%3D%22hljs-keyword%22%3Eint%3C%2Fspan%3E+argc%2C+%3Cspan+class%3D%22hljs-keyword%22%3Echar%3C%2Fspan%3E**+argv%29+%7B%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8%3C%2Fspan%3E%0A+++app%3A%3Aapplication*+node+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+app%3A%3Aapplication%28%29%3B%0A%0A+++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E5%8F%98%E9%87%8F%3C%2Fspan%3E%0A++++++bpo%3A%3Avariables_map+options%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E6%B3%A8%E5%86%8C%E8%AF%81%E4%BA%BA%E6%8F%92%E4%BB%B6%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+witness_plug+%3D+node-%26gt%3Bregister_plugin%26lt%3Bwitness_plugin%3A%3Awitness_plugin%26gt%3B%28%29%3B%0A%0A+++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E%0A++++++%7B%0A+++++++++bpo%3A%3Aoptions_description+cli%2C+cfg%3B%0A+++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AE%BE%E7%BD%AE%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%3C%2Fspan%3E%0A+++++++++node-%26gt%3Bset_program_options%28cli%2C+cfg%29%3B%0A+++++++++app_options.add%28cli%29%3B%0A+++++++++cfg_options.add%28cfg%29%3B%0A+++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%A7%A3%E6%9E%90%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%3C%2Fspan%3E%0A+++++++++bpo%3A%3Astore%28bpo%3A%3Aparse_command_line%28argc%2C+argv%2C+app_options%29%2C+options%29%3B%0A++++++%7D%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ecatch%3C%2Fspan%3E+%28%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+boost%3A%3Aprogram_options%3A%3Aerror%26amp%3B+e%29%0A++++++%7B%0A++++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3A%3Cspan+class%3D%22hljs-built_in%22%3Ecerr%3C%2Fspan%3E+%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-string%22%3E%22Error+parsing+command+line%3A+%22%3C%2Fspan%3E+%26lt%3B%26lt%3B+e.what%28%29+%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-string%22%3E%22%5Cn%22%3C%2Fspan%3E%3B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%3B%0A++++++%7D%0A%0A+++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E7%A8%8B%E5%BA%8F%E5%88%9D%E5%A7%8B%E5%8C%96%3C%2Fspan%3E%0A++++++node-%26gt%3Binitialize%28data_dir%2C+options%29%3B%0A++++++node-%26gt%3Binitialize_plugins%28+options+%29%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%90%AF%E5%8A%A8%E7%A8%8B%E5%BA%8F%3C%2Fspan%3E%0A++++++node-%26gt%3Bstartup%28%29%3B%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%90%AF%E5%8A%A8%E7%9B%B8%E5%85%B3%E6%8F%92%E4%BB%B6%3C%2Fspan%3E%0A++++++node-%26gt%3Bstartup_plugins%28%29%3B%0A%0A+++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%88%B0%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E5%8F%88%E8%B7%9F%E8%B8%AA%E4%BB%A3%E7%A0%81%E5%88%B0%3Ccode%3Emain%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%EF%BC%8C%E8%87%B3%E6%AD%A4%E5%8C%85%E6%8B%AC%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E5%85%B1%E8%AF%86%E7%9A%84%E4%B8%BB%E8%A6%81%E8%BF%87%E7%A8%8B%E5%85%A8%E9%83%A8%E8%AE%B2%E8%A7%A3%E5%AE%8C%E6%AF%95%E3%80%82%3C%2Fp%3E+%0A++%3Ch1+id%3D%226-%E5%88%9B%E5%BB%BAgenesisjson%E6%96%87%E4%BB%B6%22%3E6.+%E5%88%9B%E5%BB%BAgenesis.json%E6%96%87%E4%BB%B6%3C%2Fh1%3E+%0A++%3Cp%3E%E5%88%9B%E5%BB%BA%3Ccode%3Egenesis.json%3C%2Fcode%3E%E6%96%87%E4%BB%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E5%9B%BE%E5%A6%82%E4%B8%8B%EF%BC%9A+%3Cbr%3E+%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180517174434967%22+alt%3D%22%E8%BF%99%E9%87%8C%E5%86%99%E5%9B%BE%E7%89%87%E6%8F%8F%E8%BF%B0%22+title%3D%22%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E6%9C%80%E5%90%8E%EF%BC%8C%E8%AE%B2%E8%A7%A3%E4%B8%80%E4%B8%AA%3Cstrong%3EBitShares%3C%2Fstrong%3E%E4%B8%AD%E6%9C%89%E6%84%8F%E6%80%9D%E4%BA%8B%E6%83%85%EF%BC%8C%E4%B9%9F%E6%98%AF%E4%B8%8A%E4%B8%80%E8%8A%82%E7%95%99%E7%9A%84%E4%B8%80%E7%82%B9%E5%B0%BE%E5%B7%B4%EF%BC%8C%E5%B0%B1%E6%98%AF%3Cstrong%3EBitShares%3C%2Fstrong%3E%E7%9A%84%3Ccode%3Egenesis.json%3C%2Fcode%3E%E6%96%87%E4%BB%B6%E5%85%B6%E5%AE%9E%E4%B8%8D%E7%94%A8%E6%89%8B%E5%8A%A8%E7%BC%96%E5%86%99%EF%BC%8C%E8%80%8C%E6%98%AF%E8%B0%83%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%9A%84%EF%BC%8C%E8%BF%99%E4%B8%80%E7%82%B9%E7%9A%84%3Cstrong%3EEthereum%3C%2Fstrong%3E%E4%B8%8D%E4%B8%80%E6%A0%B7%E3%80%82%E4%B9%8B%E5%89%8D%E5%AD%A6%E4%B9%A0%3Cstrong%3EEthereum%3C%2Fstrong%3E%E6%97%B6%EF%BC%8C%3Ccode%3Egenesis.json%3C%2Fcode%3E%E5%BC%84%E5%A5%BD%E5%A5%BD%E4%B9%85%E6%89%8D%E5%BC%84%E5%A5%BD%EF%BC%8C%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BB%99%E7%9A%84%E5%AE%9E%E4%BE%8B%E7%A1%AE%E5%AE%9A%E5%87%A0%E4%B8%AA%E6%A0%B8%E5%BF%83%E5%AD%97%E6%AE%B5%EF%BC%8C%E6%9C%80%E5%90%8E%E5%9C%A8%E8%AE%BA%E5%9D%9B%E4%B8%AD%E6%89%8D%E6%89%BE%E5%88%B0%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cstrong%3EBitShares%3C%2Fstrong%3E%E7%9A%84%3Ccode%3Egenesis.json%3C%2Fcode%3E%E6%96%87%E4%BB%B6%E6%98%AF%E9%80%9A%E8%BF%87%E8%BF%90%E8%A1%8C%E4%BB%A5%E4%B8%8B%E6%8C%87%E4%BB%A4%E5%88%9B%E5%BB%BA%E7%9A%84%EF%BC%88%E8%AF%B7%E5%8F%82%E8%80%83%E5%AE%98%E7%BD%91%EF%BC%9A%3Ca+href%3D%22http%3A%2F%2Fdocs.bitshares.org%2Ftestnet%2F2-genesis.html%22+rel%3D%22nofollow%22%3EGENESIS+CONFIGURATION%3C%2Fa%3E%EF%BC%89%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+lasso%22%3Eprograms%2Fwitness_node%2Fwitness_node+%3Cspan+class%3D%22hljs-subst%22%3E--%3C%2Fspan%3Ecreate%3Cspan+class%3D%22hljs-attribute%22%3E-genesis%3C%2Fspan%3E%3Cspan+class%3D%22hljs-attribute%22%3E-json%3C%2Fspan%3E+genesis%2Fmy%3Cspan+class%3D%22hljs-attribute%22%3E-genesis%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Ejson%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E8%80%8C%E5%9C%A8%E7%A8%8B%E5%BA%8F%E4%B8%AD%EF%BC%8C%E5%8F%88%E6%98%AF%E6%80%8E%E4%B9%88%E6%89%A7%E8%A1%8C%EF%BC%8C%E8%AF%B7%E5%9B%9E%E5%A4%B4%E7%9C%8B%3Ccode%3Emain%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%EF%BC%8C%E5%9C%A8%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%E8%B0%83%E7%94%A8%E4%BA%86%3Ccode%3Einitialize%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E7%A8%8B%E5%BA%8F%E5%88%9D%E5%A7%8B%E5%8C%96%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+application%3A%3Ainitialize%28%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+fc%3A%3Apath%26amp%3B+data_dir%2C+%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+boost%3A%3Aprogram_options%3A%3Avariables_map%26amp%3B+options%29%0A%7B%0A+++my-%26gt%3B_data_dir+%3D+data_dir%3B%0A+++my-%26gt%3B_options+%3D+%26amp%3Boptions%3B%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%A6%82%E6%9E%9C%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F%E6%9C%89%22create-genesis-json%22%E5%8F%82%E6%95%B0%3C%2Fspan%3E%0A+++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+options.count%28%3Cspan+class%3D%22hljs-string%22%3E%22create-genesis-json%22%3C%2Fspan%3E%29+%29%0A+++%7B%0A++++++fc%3A%3Apath+genesis_out+%3D+options.at%28%3Cspan+class%3D%22hljs-string%22%3E%22create-genesis-json%22%3C%2Fspan%3E%29.as%26lt%3Bboost%3A%3Afilesystem%3A%3Apath%26gt%3B%28%29%3B%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%9B%E5%BB%BAgenesis.json%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%3C%2Fspan%3E%0A++++++genesis_state_type+genesis_state+%3D+detail%3A%3Acreate_example_genesis%28%29%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+fc%3A%3Aexists%28genesis_out%29+%29%0A++++++%7B%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E+%7B%0A++++++++++++genesis_state+%3D+fc%3A%3Ajson%3A%3Afrom_file%28genesis_out%29.as%26lt%3Bgenesis_state_type%26gt%3B%28+%3Cspan+class%3D%22hljs-number%22%3E20%3C%2Fspan%3E+%29%3B%0A+++++++++%7D+%3Cspan+class%3D%22hljs-keyword%22%3Ecatch%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+fc%3A%3Aexception%26amp%3B+e%29+%7B%0A++++++++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3A%3Cspan+class%3D%22hljs-built_in%22%3Ecerr%3C%2Fspan%3E+%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-string%22%3E%22Unable+to+parse+existing+genesis+file%3A%5Cn%22%3C%2Fspan%3E+%26lt%3B%26lt%3B+e.to_string%28%29%0A++++++++++++++++++++++%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-string%22%3E%22%5CnWould+you+like+to+replace+it%3F+%5By%2FN%5D+%22%3C%2Fspan%3E%3B%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Echar%3C%2Fspan%3E+response+%3D+%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3A%3Cspan+class%3D%22hljs-built_in%22%3Ecin%3C%2Fspan%3E.get%28%29%3B%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E%28+%3Cspan+class%3D%22hljs-built_in%22%3Etoupper%3C%2Fspan%3E%28response%29+%21%3D+%3Cspan+class%3D%22hljs-string%22%3E%27Y%27%3C%2Fspan%3E+%29%0A+++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E%3B%0A+++++++++%7D%0A%0A+++++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3A%3Cspan+class%3D%22hljs-built_in%22%3Ecerr%3C%2Fspan%3E+%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-string%22%3E%22Updating+genesis+state+in+file+%22%3C%2Fspan%3E+%26lt%3B%26lt%3B+genesis_out.generic_string%28%29+%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-string%22%3E%22%5Cn%22%3C%2Fspan%3E%3B%0A++++++%7D+%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E+%7B%0A+++++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3A%3Cspan+class%3D%22hljs-built_in%22%3Ecerr%3C%2Fspan%3E+%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-string%22%3E%22Creating+example+genesis+state+in+file+%22%3C%2Fspan%3E+%26lt%3B%26lt%3B+genesis_out.generic_string%28%29+%26lt%3B%26lt%3B+%3Cspan+class%3D%22hljs-string%22%3E%22%5Cn%22%3C%2Fspan%3E%3B%0A++++++%7D%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E4%BF%9D%E5%AD%98%E5%88%B0genesis.json%E6%96%87%E4%BB%B6%3C%2Fspan%3E%0A++++++fc%3A%3Ajson%3A%3Asave_to_file%28genesis_state%2C+genesis_out%29%3B%0A%0A++++++%3Cspan+class%3D%22hljs-built_in%22%3Estd%3C%2Fspan%3E%3A%3A%3Cspan+class%3D%22hljs-built_in%22%3Eexit%3C%2Fspan%3E%28EXIT_SUCCESS%29%3B%0A+++%7D%0A%0A+++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%85%B6%E4%BB%96%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++......%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%9C%A8%3Ccode%3Einitialize%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E4%B8%AD%EF%BC%8C%E8%B0%83%E7%94%A8%E4%BA%86%3Ccode%3Ecreate_example_genesis%28%29%3C%2Fcode%3E%E6%96%B9%E6%B3%95%E5%88%9B%E5%BB%BA%3Ccode%3Egenesis.json%3C%2Fcode%3E%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%EF%BC%8C%E5%85%B6%E5%AE%9E%E7%8E%B0%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-cpp+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%88%9B%E5%BB%BAgenesis.json%E5%AE%9E%E4%BE%8B%E6%96%87%E4%BB%B6%3C%2Fspan%3E%0Agenesis_state_type+create_example_genesis%28%29+%7B%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E7%94%9F%E6%88%90%E5%AF%86%E9%92%A5%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+nathan_key+%3D+fc%3A%3Aecc%3A%3Aprivate_key%3A%3Aregenerate%28fc%3A%3Asha256%3A%3Ahash%28%3Cspan+class%3D%22hljs-built_in%22%3Estring%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-string%22%3E%22nathan%22%3C%2Fspan%3E%29%29%29%3B%0A++++++dlog%28%3Cspan+class%3D%22hljs-string%22%3E%22Allocating+all+stake+to+%24%7Bkey%7D%22%3C%2Fspan%3E%2C+%28%3Cspan+class%3D%22hljs-string%22%3E%22key%22%3C%2Fspan%3E%2C+utilities%3A%3Akey_to_wif%28nathan_key%29%29%29%3B%0A++++++genesis_state_type+initial_state%3B%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AE%BE%E7%BD%AE%E5%90%84%E7%A7%8D%E5%88%9B%E5%A7%8B%E5%80%BC%3C%2Fspan%3E%0A++++++initial_state.initial_parameters.current_fees+%3D+fee_schedule%3A%3Aget_default%28%29%3B%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F-%26gt%3Bset_all_fees%28GRAPHENE_BLOCKCHAIN_PRECISION%29%3B%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AE%BE%E7%BD%AE%E5%88%9D%E5%A7%8B%E6%B4%BB%E8%B7%83%E8%AF%81%E4%BA%BA%E6%95%B0%E9%87%8F%3C%2Fspan%3E%0A++++++initial_state.initial_active_witnesses+%3D+GRAPHENE_DEFAULT_MIN_WITNESS_COUNT%3B%0A++++++initial_state.initial_timestamp+%3D+time_point_sec%28time_point%3A%3Anow%28%29.sec_since_epoch%28%29+%2F%0A++++++++++++initial_state.initial_parameters.block_interval+*%0A++++++++++++initial_state.initial_parameters.block_interval%29%3B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E%28+uint64_t+i+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3B+i+%26lt%3B+initial_state.initial_active_witnesses%3B+%2B%2Bi+%29%0A++++++%7B%0A+++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eauto%3C%2Fspan%3E+name+%3D+%3Cspan+class%3D%22hljs-string%22%3E%22init%22%3C%2Fspan%3E%2Bfc%3A%3Ato_string%28i%29%3B%0A+++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AE%BE%E7%BD%AE%E5%88%9D%E5%A7%8B%E8%B4%A6%E6%88%B7%3C%2Fspan%3E%0A+++++++++initial_state.initial_accounts.emplace_back%28name%2C%0A+++++++++++++++++++++++++++++++++++++++++++++++++++++nathan_key.get_public_key%28%29%2C%0A+++++++++++++++++++++++++++++++++++++++++++++++++++++nathan_key.get_public_key%28%29%2C%0A+++++++++++++++++++++++++++++++++++++++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Etrue%3C%2Fspan%3E%29%3B%0A+++++++++initial_state.initial_committee_candidates.push_back%28%7Bname%7D%29%3B%0A+++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AE%BE%E7%BD%AE%E5%88%9D%E5%A7%8B%E8%AF%81%E4%BA%BA%E6%9B%BF%E8%A1%A5%3C%2Fspan%3E%0A+++++++++initial_state.initial_witness_candidates.push_back%28%7Bname%2C+nathan_key.get_public_key%28%29%7D%29%3B%0A++++++%7D%0A%0A++++++initial_state.initial_accounts.emplace_back%28%3Cspan+class%3D%22hljs-string%22%3E%22nathan%22%3C%2Fspan%3E%2C+nathan_key.get_public_key%28%29%29%3B%0A++++++initial_state.initial_balances.push_back%28%7Bnathan_key.get_public_key%28%29%2C%0A++++++++++++++++++++++++++++++++++++++++++++++++GRAPHENE_SYMBOL%2C%0A++++++++++++++++++++++++++++++++++++++++++++++++GRAPHENE_MAX_SHARE_SUPPLY%7D%29%3B%0A++++++initial_state.initial_chain_id+%3D+fc%3A%3Asha256%3A%3Ahash%28+%3Cspan+class%3D%22hljs-string%22%3E%22BOGUS%22%3C%2Fspan%3E+%29%3B%0A%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+initial_state%3B%0A+++%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Ch1+id%3D%227-dpos%E5%85%B1%E8%AF%86%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E5%9B%BE%22%3E7.+DPoS%E5%85%B1%E8%AF%86%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E5%9B%BE%3C%2Fh1%3E+%0A++%3Cp%3E%E6%9C%AC%E4%BA%BA+ProcessOn+%E4%B8%8A+BTS%E7%9A%84DPoS%E5%85%B1%E8%AF%86%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E5%9B%BE+%E5%8E%9F%E5%9B%BE%E9%93%BE%E6%8E%A5%E8%AF%B7%E7%82%B9%E5%87%BB%EF%BC%9A%3Ca+href%3D%22https%3A%2F%2Fwww.processon.com%2Fview%2Flink%2F5af01c73e4b001f7e0c5fdc6%22+rel%3D%22nofollow%22%3EBTS%E7%9A%84DPoS%E5%85%B1%E8%AF%86%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E5%9B%BE%3C%2Fa%3E%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180517201710210%22+alt%3D%22BTS%E7%9A%84DPoS%E5%85%B1%E8%AF%86%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E5%9B%BE%22+title%3D%22%22%3E%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fmarkdown_views-ea0013b516.css%22%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn+btn-red-hollow%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fggq89%2Farticle%2Fdetails%2F80068306%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fggq89%2Farticle%2Fdetails%2F80068306%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}
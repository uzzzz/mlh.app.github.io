---
layout: default
title: 以太坊智能合约solidity去中心化投票系统
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Cdiv+class%3D%22markdown_views%22%3E+%0A++%3Cp%3E%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%94%B5%E5%AD%90%E6%8A%95%E7%A5%A8%E7%B3%BB%E7%BB%9F%EF%BC%8C%E5%9F%BA%E4%BA%8E%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E8%AF%A5%E7%94%B5%E5%AD%90%E6%8A%95%E7%A5%A8%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%B8%80%E4%B8%AA%E4%B8%BB%E8%A6%81%E9%97%AE%E9%A2%98%E6%98%AF%E5%A6%82%E4%BD%95%E5%88%86%E9%85%8D%E5%90%88%E7%90%86%E7%9A%84%E6%9D%83%E9%99%90%E7%BB%99%E6%AD%A3%E7%A1%AE%E7%9A%84%E4%BA%BA%EF%BC%8C%E5%B9%B6%E4%B8%94%E8%A6%81%E9%98%B2%E6%AD%A2%E7%AF%A1%E6%94%B9%E3%80%82%E8%BF%99%E4%B8%AA%E4%BE%8B%E5%AD%90%E4%B8%8D%E8%83%BD%E8%A7%A3%E5%86%B3%E6%89%80%E6%9C%89%E9%97%AE%E9%A2%98%EF%BC%8C%E4%BD%86%E6%98%AF%E5%AE%9E%E7%8E%B0%E4%BA%86%E5%A6%82%E4%BD%95%E5%8E%BB%E5%A7%94%E6%89%98%E6%8A%95%E7%A5%A8%EF%BC%8C%E6%95%B4%E4%B8%AA%E6%8A%95%E7%A5%A8%E8%AE%A1%E6%95%B0%E8%BF%87%E7%A8%8B%E6%98%AF%E8%87%AA%E5%8A%A8%E4%B8%94%E5%AE%8C%E5%85%A8%E9%80%8F%E6%98%8E%E7%9A%84%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%E5%8A%9F%E8%83%BD%E4%B8%8A%E9%A6%96%E5%85%88%E8%A6%81%E4%B8%BA%E6%8A%95%E7%A5%A8%E8%AE%BE%E7%AB%8B%E4%B8%80%E4%B8%AA%E7%AE%80%E7%A7%B0%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%90%88%E7%BA%A6%EF%BC%8C%E5%8F%91%E8%B5%B7%E8%80%85%E4%BD%9C%E4%B8%BA%E4%B8%BB%E5%B8%AD%E6%9D%A5%E7%BB%99%E6%AF%8F%E4%B8%80%E4%B8%AA%E7%8B%AC%E7%AB%8B%E7%9A%84%E5%9C%B0%E5%9D%80%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90%E3%80%82%E6%AF%8F%E4%B8%80%E4%B8%AA%E5%8F%82%E4%B8%8E%E8%80%85%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%B7%B1%E6%8A%95%E7%A5%A8%E6%88%96%E8%80%85%E5%A7%94%E6%89%98%E7%BB%99%E4%BF%A1%E4%BB%BB%E7%9A%84%E4%BA%BA%E3%80%82%E7%A8%8B%E5%BA%8F%E6%9C%80%E5%90%8E%E4%BC%9A%E8%BF%94%E5%9B%9E%E5%BE%97%E7%A5%A8%E6%95%B0%E6%9C%80%E5%A4%9A%E7%9A%84%E9%82%A3%E4%B8%AA%E6%8F%90%E8%AE%AE%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%E7%A8%8B%E5%BA%8F%E6%9E%84%E9%80%A0%E4%BA%86voter%E5%92%8Ccandidate%E4%B8%A4%E7%A7%8D%E7%BB%93%E6%9E%84%EF%BC%8C%E5%9C%A8voter%E4%B8%AD%E5%90%AB%E6%9C%89%E6%8A%95%E7%A5%A8%E8%80%85%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%88address%EF%BC%89%EF%BC%8C%E6%98%AF%E5%90%A6%E5%AE%8C%E6%88%90%E6%8A%95%E7%A5%A8%EF%BC%88bool%EF%BC%89%E5%92%8C%E7%A5%A8%E6%95%B0%EF%BC%88uint%EF%BC%89%EF%BC%88%E6%9C%AC%E6%9D%A5%E6%83%B3%E5%AE%8C%E6%88%90%E5%A7%94%E6%89%98%E6%8A%95%E7%A5%A8%E7%9A%84%EF%BC%89%EF%BC%8Ccandidate%E4%B8%AD%E5%88%99%E5%90%AB%E6%9C%89%E5%9C%B0%E5%9D%80%EF%BC%88address%EF%BC%89%EF%BC%8C%E6%98%AF%E5%90%A6%E8%8E%B7%E8%83%9C%EF%BC%88bool%EF%BC%89%E5%92%8C%E5%BE%97%E5%88%B0%E7%A5%A8%E6%95%B0%EF%BC%88uint%EF%BC%89%EF%BC%8C%E4%B8%8B%E4%B8%80%E6%AD%A5%E6%98%AF%E5%AE%8C%E6%88%90%E6%8A%95%E7%A5%A8%E4%BA%BA%E5%92%8C%E5%80%99%E9%80%89%E4%BA%BA%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%8C%E5%87%BD%E6%95%B0vote%E5%88%99%E6%98%AF%E5%AE%8C%E6%88%90%E6%8A%95%E7%A5%A8%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%8C%E5%85%B6%E4%B8%AD%E5%80%BC%E5%BE%97%E6%B3%A8%E6%84%8F%E7%9A%84%E6%98%AF%E5%BA%94%E8%AF%A5%E6%8E%92%E9%99%A4%E6%97%A0%E6%95%88%E7%9A%84%E5%80%99%E9%80%89%E4%BA%BA%EF%BC%8C%E6%9C%80%E5%90%8E%E5%88%99%E6%98%AF%E8%BF%94%E5%9B%9E%E8%83%9C%E5%88%A9%E7%9A%84%E5%9C%B0%E5%9D%80%E9%80%89%E5%87%BA%E6%8A%95%E7%A5%A8%E7%9A%84%E8%83%9C%E5%88%A9%E8%80%85%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3Epragma+solidity+%5E0.4.22%3B%3C%2Fp%3E+%0A++%3Cp%3E%2F%2F%2F+%40title+Voting+with+delegation.+%3Cbr%3E+contract+Ballot+%7B+%3Cbr%3E+%2F%2F+This+declares+a+new+complex+type+which+will+%3Cbr%3E+%2F%2F+be+used+for+variables+later.+%3Cbr%3E+%2F%2F+It+will+represent+a+single+voter.+%3Cbr%3E+struct+Voter+%7B+%3Cbr%3E+uint+weight%3B+%2F%2F+weight+is+accumulated+by+delegation+%3Cbr%3E+bool+voted%3B+%2F%2F+if+true%2C+that+person+already+voted+%3Cbr%3E+address+delegate%3B+%2F%2F+person+delegated+to+%3Cbr%3E+uint+vote%3B+%2F%2F+index+of+the+voted+proposal+%3Cbr%3E+%7D%3C%2Fp%3E+%0A++%3Cpre%3E%3Ccode%3E%2F%2F+This+is+a+type+for+a+single+proposal.%0Astruct+Proposal+%7B%0A++++bytes32+name%3B+++%2F%2F+short+name+%28up+to+32+bytes%29%0A++++uint+voteCount%3B+%2F%2F+number+of+accumulated+votes%0A%7D%0A%0Aaddress+public+chairperson%3B%0A%0A%2F%2F+This+declares+a+state+variable+that%0A%2F%2F+stores+a+%60Voter%60+struct+for+each+possible+address.%0Amapping%28address+%3D%26gt%3B+Voter%29+public+voters%3B%0A%0A%2F%2F+A+dynamically-sized+array+of+%60Proposal%60+structs.%0AProposal%5B%5D+public+proposals%3B%0A%0A%2F%2F%2F+Create+a+new+ballot+to+choose+one+of+%60proposalNames%60.%0Aconstructor%28bytes32%5B%5D+memory+proposalNames%29+public+%7B%0A++++chairperson+%3D+msg.sender%3B%0A++++voters%5Bchairperson%5D.weight+%3D+1%3B%0A%0A++++%2F%2F+For+each+of+the+provided+proposal+names%2C%0A++++%2F%2F+create+a+new+proposal+object+and+add+it%0A++++%2F%2F+to+the+end+of+the+array.%0A++++for+%28uint+i+%3D+0%3B+i+%26lt%3B+proposalNames.length%3B+i%2B%2B%29+%7B%0A++++++++%2F%2F+%60Proposal%28%7B...%7D%29%60+creates+a+temporary%0A++++++++%2F%2F+Proposal+object+and+%60proposals.push%28...%29%60%0A++++++++%2F%2F+appends+it+to+the+end+of+%60proposals%60.%0A++++++++proposals.push%28Proposal%28%7B%0A++++++++++++name%3A+proposalNames%5Bi%5D%2C%0A++++++++++++voteCount%3A+0%0A++++++++%7D%29%29%3B%0A++++%7D%0A%7D%0A%0A%2F%2F+Give+%60voter%60+the+right+to+vote+on+this+ballot.%0A%2F%2F+May+only+be+called+by+%60chairperson%60.%0Afunction+giveRightToVote%28address+voter%29+public+%7B%0A++++%2F%2F+If+the+first+argument+of+%60require%60+evaluates%0A++++%2F%2F+to+%60false%60%2C+execution+terminates+and+all%0A++++%2F%2F+changes+to+the+state+and+to+Ether+balances%0A++++%2F%2F+are+reverted.%0A++++%2F%2F+This+used+to+consume+all+gas+in+old+EVM+versions%2C+but%0A++++%2F%2F+not+anymore.%0A++++%2F%2F+It+is+often+a+good+idea+to+use+%60require%60+to+check+if%0A++++%2F%2F+functions+are+called+correctly.%0A++++%2F%2F+As+a+second+argument%2C+you+can+also+provide+an%0A++++%2F%2F+explanation+about+what+went+wrong.%0A++++require%28%0A++++++++msg.sender+%3D%3D+chairperson%2C%0A++++++++%22Only+chairperson+can+give+right+to+vote.%22%0A++++%29%3B%0A++++require%28%0A++++++++%21voters%5Bvoter%5D.voted%2C%0A++++++++%22The+voter+already+voted.%22%0A++++%29%3B%0A++++require%28voters%5Bvoter%5D.weight+%3D%3D+0%29%3B%0A++++voters%5Bvoter%5D.weight+%3D+1%3B%0A%7D%0A%0A%2F%2F%2F+Delegate+your+vote+to+the+voter+%60to%60.%0Afunction+delegate%28address+to%29+public+%7B%0A++++%2F%2F+assigns+reference%0A++++Voter+storage+sender+%3D+voters%5Bmsg.sender%5D%3B%0A++++require%28%21sender.voted%2C+%22You+already+voted.%22%29%3B%0A%0A++++require%28to+%21%3D+msg.sender%2C+%22Self-delegation+is+disallowed.%22%29%3B%0A%0A++++%2F%2F+Forward+the+delegation+as+long+as%0A++++%2F%2F+%60to%60+also+delegated.%0A++++%2F%2F+In+general%2C+such+loops+are+very+dangerous%2C%0A++++%2F%2F+because+if+they+run+too+long%2C+they+might%0A++++%2F%2F+need+more+gas+than+is+available+in+a+block.%0A++++%2F%2F+In+this+case%2C+the+delegation+will+not+be+executed%2C%0A++++%2F%2F+but+in+other+situations%2C+such+loops+might%0A++++%2F%2F+cause+a+contract+to+get+%22stuck%22+completely.%0A++++while+%28voters%5Bto%5D.delegate+%21%3D+address%280%29%29+%7B%0A++++++++to+%3D+voters%5Bto%5D.delegate%3B%0A%0A++++++++%2F%2F+We+found+a+loop+in+the+delegation%2C+not+allowed.%0A++++++++require%28to+%21%3D+msg.sender%2C+%22Found+loop+in+delegation.%22%29%3B%0A++++%7D%0A%0A++++%2F%2F+Since+%60sender%60+is+a+reference%2C+this%0A++++%2F%2F+modifies+%60voters%5Bmsg.sender%5D.voted%60%0A++++sender.voted+%3D+true%3B%0A++++sender.delegate+%3D+to%3B%0A++++Voter+storage+delegate_+%3D+voters%5Bto%5D%3B%0A++++if+%28delegate_.voted%29+%7B%0A++++++++%2F%2F+If+the+delegate+already+voted%2C%0A++++++++%2F%2F+directly+add+to+the+number+of+votes%0A++++++++proposals%5Bdelegate_.vote%5D.voteCount+%2B%3D+sender.weight%3B%0A++++%7D+else+%7B%0A++++++++%2F%2F+If+the+delegate+did+not+vote+yet%2C%0A++++++++%2F%2F+add+to+her+weight.%0A++++++++delegate_.weight+%2B%3D+sender.weight%3B%0A++++%7D%0A%7D%0A%0A%2F%2F%2F+Give+your+vote+%28including+votes+delegated+to+you%29%0A%2F%2F%2F+to+proposal+%60proposals%5Bproposal%5D.name%60.%0Afunction+vote%28uint+proposal%29+public+%7B%0A++++Voter+storage+sender+%3D+voters%5Bmsg.sender%5D%3B%0A++++require%28%21sender.voted%2C+%22Already+voted.%22%29%3B%0A++++sender.voted+%3D+true%3B%0A++++sender.vote+%3D+proposal%3B%0A%0A++++%2F%2F+If+%60proposal%60+is+out+of+the+range+of+the+array%2C%0A++++%2F%2F+this+will+throw+automatically+and+revert+all%0A++++%2F%2F+changes.%0A++++proposals%5Bproposal%5D.voteCount+%2B%3D+sender.weight%3B%0A%7D%0A%0A%2F%2F%2F+%40dev+Computes+the+winning+proposal+taking+all%0A%2F%2F%2F+previous+votes+into+account.%0Afunction+winningProposal%28%29+public+view%0A++++++++returns+%28uint+winningProposal_%29%0A%7B%0A++++uint+winningVoteCount+%3D+0%3B%0A++++for+%28uint+p+%3D+0%3B+p+%26lt%3B+proposals.length%3B+p%2B%2B%29+%7B%0A++++++++if+%28proposals%5Bp%5D.voteCount+%26gt%3B+winningVoteCount%29+%7B%0A++++++++++++winningVoteCount+%3D+proposals%5Bp%5D.voteCount%3B%0A++++++++++++winningProposal_+%3D+p%3B%0A++++++++%7D%0A++++%7D%0A%7D%0A%0A%2F%2F+Calls+winningProposal%28%29+function+to+get+the+index%0A%2F%2F+of+the+winner+contained+in+the+proposals+array+and+then%0A%2F%2F+returns+the+name+of+the+winner%0Afunction+winnerName%28%29+public+view%0A++++++++returns+%28bytes32+winnerName_%29%0A%7B%0A++++winnerName_+%3D+proposals%5BwinningProposal%28%29%5D.name%3B%0A%7D%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%7D%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fmarkdown_views-ea0013b516.css%22%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn+btn-red-hollow%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fqq_30505673%2Farticle%2Fdetails%2F81707460%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fqq_30505673%2Farticle%2Fdetails%2F81707460%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}
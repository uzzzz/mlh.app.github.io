---
layout: default
title: fabric-1.0.6，多通道实现
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-e2445db1a8.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22%3E+%0A++%3Cp%3E%E5%8E%9F%E5%88%9B%E6%96%87%E7%AB%A0%EF%BC%8C%E6%9C%AA%E7%BB%8F%E5%90%8C%E6%84%8F%E4%B8%8D%E5%BE%97%E8%BD%AC%E8%BD%BD%3C%2Fp%3E%0A++%3Cp%3Efabric%E4%BB%8E1.0.0%E8%B5%B7%E5%B0%B1%E6%94%AF%E6%8C%81%E5%A4%9A%E9%80%9A%E9%81%93%E6%8A%80%E6%9C%AF%EF%BC%8C%E5%85%B3%E4%BA%8E%E5%A4%9A%E9%80%9A%E9%81%93%E7%9A%84%E8%A7%A3%E9%87%8A%EF%BC%8C%E6%9C%AC%E6%96%87%E4%B8%8D%E5%A4%9A%E8%B5%98%E8%BF%B0%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%87%AA%E8%A1%8Cgoogle%E3%80%82%3C%2Fp%3E%0A++%3Cp%3E%E6%9C%AC%E6%96%87%E4%BB%A5+example%E7%9A%84e2e_cli+%E4%B8%BA%E5%9F%BA%E7%A1%80%EF%BC%8C%E5%9C%A8%E6%AD%A4%E4%B8%8A%E8%BF%9B%E8%A1%8C%E4%BF%AE%E6%94%B9%3C%2Fp%3E%0A++%3Cp%3E%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E6%98%AF%EF%BC%8C%E6%88%91%E5%9C%A8e2e_cli%E7%9A%84%E5%9F%BA%E7%A1%80%E4%B8%8A%E5%81%9A%E4%BA%86%E4%B8%80%E5%AE%9A%E4%BF%AE%E6%94%B9%E6%9D%A5%E5%90%AF%E5%8A%A8fabric%EF%BC%8C%E5%A6%82%E6%9E%9C%E7%85%A7%E6%90%AC%E4%B8%80%E4%B8%8B%E8%84%9A%E6%9C%AC%EF%BC%8C%E6%98%AF%E8%BF%90%E8%A1%8C%E4%B8%8D%E8%B5%B7%E6%9D%A5%E7%9A%84%EF%BC%8C%E4%BB%A5%E4%B8%8B%E4%BB%85%E4%BE%9B%E5%8F%82%E8%80%83%3C%2Fp%3E%0A++%3Cp%3E%3Cbr%3E%3C%2Fp%3E%0A++%3Cp%3E%E8%AF%B4%E6%98%8E%E4%B8%80%E4%B8%8B%E6%80%9D%E8%B7%AF%EF%BC%9A%3C%2Fp%3E%0A++%3Cp%3E1%E3%80%81%E4%B8%80%E6%9D%A1%E9%93%BE%E5%AF%B9%E5%BA%94%EF%BC%9A%E8%87%B3%E5%B0%91%E4%B8%80%E4%B8%AAorg%EF%BC%8C%E8%87%B3%E5%B0%91%E4%B8%80%E4%B8%AApeer%EF%BC%8C%E8%87%B3%E5%B0%91%E4%B8%80%E4%B8%AAchaincode%3C%2Fp%3E%0A++%3Cp%3E2%E3%80%81%E5%9C%A8%E4%B8%80%E6%9D%A1%E9%93%BE%E5%AF%B9%E5%BA%94%E7%9A%84%E5%9F%BA%E7%A1%80%E4%B8%8A%EF%BC%8C%E5%AF%B9script.sh%E8%84%9A%E6%9C%AC%E8%BF%9B%E8%A1%8C%E4%BF%AE%E6%94%B9%3C%2Fp%3E%0A++%3Cp%3E%3Cbr%3E%3C%2Fp%3E%0A++%3Cp%3E%E6%AD%A5%E9%AA%A4%EF%BC%9A%3C%2Fp%3E%0A++%3Cp%3E1%E3%80%81%E5%B7%B2%E7%BB%8F%E6%89%A7%E8%A1%8C+.%2Fnetwork_setup.sh+up%3C%2Fp%3E%0A++%3Cp%3E2%E3%80%81%E4%BF%AE%E6%94%B9+e2e_cli%E4%B8%8B%26nbsp%3BgenerateArtifacts.sh+%E4%B8%BA+generateNewChannel.sh%EF%BC%88%E8%A7%81%E4%B8%8B%E6%96%87%EF%BC%89%3C%2Fp%3E%0A++%3Cp%3E3%E3%80%81%E4%BF%AE%E6%94%B9+e2e_cli%E4%B8%8Bscript%E6%96%87%E4%BB%B6%E5%A4%B9%E5%86%85%E7%9A%84script.sh+%E4%B8%BA+script_new_channel.sh%EF%BC%88%E8%A7%81%E4%B8%8B%E6%96%87%EF%BC%89%3C%2Fp%3E%0A++%3Cp%3E4%E3%80%81%E5%85%88%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E7%9B%B4%E6%8E%A5%E8%BF%90%E8%A1%8C%26nbsp%3B+.%2FgenerateNewChannel.sh+%5B%E6%96%B0%E9%80%9A%E9%81%93%E5%90%8D%5D%3C%2Fp%3E%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%E5%90%8E%E8%BF%9B%E5%85%A5cli%E5%AE%B9%E5%99%A8%E6%89%A7%E8%A1%8C+.%2Fscript%2Fscript_new_channel.sh%26nbsp%3B%5B%E6%96%B0%E9%80%9A%E9%81%93%E5%90%8D%5D+%5B%E6%96%B0%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%90%8D%5D%3C%2Fp%3E%0A++%3Cp%3E%3Cbr%3E%3C%2Fp%3E%0A++%3Cp%3EgenerateNewChannel.sh%3Cbr%3E%3C%2Fp%3E%0A++%3Cpre%3E%3Ccode+class%3D%22language-plain%22%3E%23+author%3A+Logan+Tang+20180607-11%3A37+mail%3A39522361%40qq.com%0A%23+usage%3A+Generate+configuration+for+new+channel%0A%0ACHANNEL_NAME%3D%241%0ADATE%3D%60date+%27%2B%25Y%25m%25d_%25H%25M%25S%27%60%0A%0Aecho%0Aecho+%22+***+start+create+new+channel+configuration%2Ctime%3A+%24DATE%2CCHANNEL_NAME%3A%24CHANNEL_NAME+***%22%0Aecho%0A%0Aexport+FABRIC_ROOT%3D%24PWD%2F..%2F..%0Aexport+FABRIC_CFG_PATH%3D%24PWD%0A%0A%0AOS_ARCH%3D%24%28echo+%22%24%28uname+-s%7Ctr+%27%5B%3Aupper%3A%5D%27+%27%5B%3Alower%3A%5D%27%7Csed+%27s%2Fmingw64_nt.*%2Fwindows%2F%27%29-%24%28uname+-m+%7C+sed+%27s%2Fx86_64%2Famd64%2Fg%27%29%22+%7C+awk+%27%7Bprint+tolower%28%240%29%7D%27%29%0A%0Afunction+printHelp+%28%29+%7B%0A%09echo+%22params+error%3A+arg1+should+not+be+empty%2Carg1+for+channel+name%22%0A%7D%0A%0Afunction+validateArgs+%28%29+%7B%0A%09if+%5B+-z+%22%24%7BCHANNEL_NAME%7D%22+%5D%3B+then%0A%09%09%09%09printHelp%0A%09%09exit+1%0A%09fi%0A%7D%0A%0A%0A%23%23+Generate+orderer+genesis+block+%2C+channel+configuration+transaction+and+anchor+peer+update+transactions%0Afunction+generateChannelArtifacts%28%29+%7B%0A%0A%09CONFIGTXGEN%3D%24FABRIC_ROOT%2Frelease%2F%24OS_ARCH%2Fbin%2Fconfigtxgen%0A%09if+%5B+-f+%22%24CONFIGTXGEN%22+%5D%3B+then%0A++++++++++++echo+%22Using+configtxgen+-%26gt%3B+%24CONFIGTXGEN%22%0A%09else%0A%09++++echo+%22Building+configtxgen%22%0A%09++++make+-C+%24FABRIC_ROOT+release%0A%09fi%0A%0A%09echo+%22%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%22%0A%09echo+%22%23%23%23%23%23%23%23%23%23++Generating+Orderer+Genesis+block+%23%23%23%23%23%23%23%23%23%23%23%23%23%23%22%0A%09echo+%22%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%22%0A%09%23+Note%3A+For+some+unknown+reason+%28at+least+for+now%29+the+block+file+can%27t+be%0A%09%23+named+orderer.genesis.block+or+the+orderer+will+fail+to+launch%21%0A%09%24CONFIGTXGEN+-profile+TwoOrgsOrdererGenesis+-outputBlock+.%2Fchannel-artifacts%2Fgenesis.block%0A%0A%09echo%0A%09echo+%22%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%22%0A%09echo+%22%23%23%23+Generating+channel+configuration+transaction+%27channel.tx%27+%23%23%23%22%0A%09echo+%22%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%22%0A%09%24CONFIGTXGEN+-profile+TwoOrgsChannel+-outputCreateChannelTx+.%2Fchannel-artifacts%2Fchannel.tx+-channelID+%24CHANNEL_NAME%0A%0A%09echo%0A%09echo+%22%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%22%0A%09echo+%22%23%23%23%23%23%23%23++++Generating+anchor+peer+update+for+HealthMSP+++%23%23%23%23%23%23%23%23%23%23%22%0A%09echo+%22%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%22%0A%09%24CONFIGTXGEN+-profile+TwoOrgsChannel+-outputAnchorPeersUpdate+.%2Fchannel-artifacts%2FHealthMSPanchors.tx+-channelID+%24CHANNEL_NAME+-asOrg+HealthMSP%0A%0A%09echo%0A%09echo+%22%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%22%0A%09echo+%22%23%23%23%23%23%23%23++++Generating+anchor+peer+update+for+Org2MSP+++%23%23%23%23%23%23%23%23%23%23%22%0A%09echo+%22%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%22%0A%09echo%0A%7D%0A%0AvalidateArgs%0AgenerateChannelArtifacts%0A%0Aecho%0Aecho+%22+***+create+new+channel+configuration+success+***+%22%0Aecho%3C%2Fcode%3E%3C%2Fpre%3E%0A++%3Cp%3Escript_new_channel.sh%3C%2Fp%3E%0A++%3Cpre%3E%3Ccode+class%3D%22language-plain%22%3E%23+author%3A+Logan+Tang+20180607-11%3A37+mail%3A39522361%40qq.com%0A%23+usage%3A+Create+new+channel+to+container%0A%0ACHANNEL_NAME%3D%22%241%22%0ACHAINCODE_NAME%3D%22%242%22%0A%23%3A+%24%7BCHANNEL_NAME%3A%3D%22bgilifechain%22%7D%0A%3A+%24%7BTIMEOUT%3A%3D%2260%22%7D%0ACOUNTER%3D1%0AMAX_RETRY%3D5%0AORDERER_CA%3D%2Fopt%2Fgopath%2Fsrc%2Fgithub.com%2Fhyperledger%2Ffabric%2Fpeer%2Fcrypto%2FordererOrganizations%2Fbgiblockchain.com%2Forderers%2Forderer.bgiblockchain.com%2Fmsp%2Ftlscacerts%2Ftlsca.bgiblockchain.com-cert.pem%0A%0Aecho%0Aecho+%22%3D%3D%3D%3D%3D%3D+start+create+new+channel+%3D%3D%3D%3D%3D%3D%22%0Aecho+%22CHANNEL_NAME+name+%3A+%22%24CHANNEL_NAME%0Aecho+%22CHAINCODE_NAME+name+%3A+%22%24CHAINCODE_NAME%0Aecho%0A%0Afunction+printHelp+%28%29+%7B%0A%09echo+%22arg1%2Farg2+should+not+be+empty%2Carg1+for+channel+name%2Carg2+for+chaincode+name%22%0A%7D%0A%0Afunction+validateArgs+%28%29+%7B%0A%09if+%5B+-z+%22%24%7BCHANNEL_NAME%7D%22+%5D%3B+then%0A%09%09%09%09printHelp%0A%09%09exit+1%0A%09fi%0A%09if+%5B+-z+%22%24%7BCHAINCODE_NAME%7D%22+%5D%3B+then%0A%09%09%09%09printHelp%0A%09%09exit+1%0A%09fi%0A%7D%0A%0AverifyResult+%28%29+%7B%0A%09if+%5B+%241+-ne+0+%5D+%3B+then%0A%09%09echo+%22%21%21%21%21%21%21%21%21%21%21%21%21%21%21%21+%22%242%22+%21%21%21%21%21%21%21%21%21%21%21%21%21%21%21%21%22%0A++++++++++++++++echo+%22%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+ERROR+%21%21%21+FAILED+to+execute+End-2-End+Scenario+%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%22%0A%09%09echo%0A+++%09%09exit+1%0A%09fi%0A%7D%0A%0AsetGlobals+%28%29+%7B%0A%09%09CORE_PEER_LOCALMSPID%3D%22HealthMSP%22%0A%09%09CORE_PEER_TLS_ROOTCERT_FILE%3D%2Fopt%2Fgopath%2Fsrc%2Fgithub.com%2Fhyperledger%2Ffabric%2Fpeer%2Fcrypto%2FpeerOrganizations%2Fhealth.bgiblockchain.com%2Fpeers%2Fpeer0.health.bgiblockchain.com%2Ftls%2Fca.crt%0A%09%09CORE_PEER_MSPCONFIGPATH%3D%2Fopt%2Fgopath%2Fsrc%2Fgithub.com%2Fhyperledger%2Ffabric%2Fpeer%2Fcrypto%2FpeerOrganizations%2Fhealth.bgiblockchain.com%2Fusers%2FAdmin%40health.bgiblockchain.com%2Fmsp%0A%09%09if+%5B+%241+-eq+0+%5D%3B+then+%0A%09%09%09CORE_PEER_ADDRESS%3Dpeer0.health.bgiblockchain.com%3A7051%0A%09%09elif+%5B+%241+-eq+1+%5D%3B+then%0A%09%09%09CORE_PEER_ADDRESS%3Dpeer1.health.bgiblockchain.com%3A7051%0A%09%09elif+%5B+%241+-eq+2+%5D%3B+then%0A%09%09%09CORE_PEER_ADDRESS%3Dpeer2.health.bgiblockchain.com%3A7151%0A%09%09elif+%5B+%241+-eq+3+%5D%3B+then%0A%09%09%09CORE_PEER_ADDRESS%3Dpeer3.health.bgiblockchain.com%3A7151%0A%09%09elif+%5B+%241+-eq+4+%5D%3B+then%0A%09%09%09CORE_PEER_ADDRESS%3Dpeer4.health.bgiblockchain.com%3A7251%0A%09%09elif+%5B+%241+-eq+5+%5D%3B+then%0A%09%09%09CORE_PEER_ADDRESS%3Dpeer5.health.bgiblockchain.com%3A7251%0A%09%09elif+%5B+%241+-eq+6+%5D%3B+then%0A%09%09%09CORE_PEER_ADDRESS%3Dpeer6.health.bgiblockchain.com%3A7351%0A%09%09else%0A%09%09%09CORE_PEER_ADDRESS%3Dpeer7.health.bgiblockchain.com%3A7351%0A%09%09fi%0A%09env+%7Cgrep+CORE%0A%7D%0A%0AcreateChannel%28%29+%7B%0A%09setGlobals+0%0A++++if+%5B+-z+%22%24CORE_PEER_TLS_ENABLED%22+-o+%22%24CORE_PEER_TLS_ENABLED%22+%3D+%22false%22+%5D%3B+then%0A%09%09peer+channel+create+-o+orderer.bgiblockchain.com%3A7050+-c+%24CHANNEL_NAME+-f+.%2Fchannel-artifacts%2Fchannel.tx+%26gt%3B%26amp%3Blog.txt%0A%09else%0A%09%09peer+channel+create+-o+orderer.bgiblockchain.com%3A7050+-c+%24CHANNEL_NAME+-f+.%2Fchannel-artifacts%2Fchannel.tx+--tls+%24CORE_PEER_TLS_ENABLED+--cafile+%24ORDERER_CA+%26gt%3B%26amp%3Blog.txt%0A%09fi%0A%09res%3D%24%3F%0A%09cat+log.txt%0A%09verifyResult+%24res+%22Channel+creation+failed%22%0A%09echo+%22%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+Channel+%5C%22%24CHANNEL_NAME%5C%22+is+created+successfully+%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+%22%0A%09echo%0A%7D%0A%0AupdateAnchorPeers%28%29+%7B%0A++++PEER%3D%241%0A++++setGlobals+%24PEER%0A++++if+%5B+-z+%22%24CORE_PEER_TLS_ENABLED%22+-o+%22%24CORE_PEER_TLS_ENABLED%22+%3D+%22false%22+%5D%3B+then%0A%09%09peer+channel+update+-o+orderer.bgiblockchain.com%3A7050+-c+%24CHANNEL_NAME+-f+.%2Fchannel-artifacts%2F%24%7BCORE_PEER_LOCALMSPID%7Danchors.tx+%26gt%3B%26amp%3Blog.txt%0A%09else%0A%09%09peer+channel+update+-o+orderer.bgiblockchain.com%3A7050+-c+%24CHANNEL_NAME+-f+.%2Fchannel-artifacts%2F%24%7BCORE_PEER_LOCALMSPID%7Danchors.tx+--tls+%24CORE_PEER_TLS_ENABLED+--cafile+%24ORDERER_CA+%26gt%3B%26amp%3Blog.txt%0A%09fi%0A%09res%3D%24%3F%0A%09cat+log.txt%0A%09verifyResult+%24res+%22Anchor+peer+update+failed%22%0A%09echo+%22%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+Anchor+peers+for+org+%5C%22%24CORE_PEER_LOCALMSPID%5C%22+on+%5C%22%24CHANNEL_NAME%5C%22+is+updated+successfully+%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+%22%0A%09sleep+5%0A%09echo%0A%7D%0A%0A%23%23+Sometimes+Join+takes+time+hence+RETRY+atleast+for+5+times%0AjoinWithRetry+%28%29+%7B%0A%09peer+channel+join+-b+%24CHANNEL_NAME.block++%26gt%3B%26amp%3Blog.txt%0A%09res%3D%24%3F%0A%09cat+log.txt%0A%09if+%5B+%24res+-ne+0+-a+%24COUNTER+-lt+%24MAX_RETRY+%5D%3B+then%0A%09%09COUNTER%3D%60+expr+%24COUNTER+%2B+1%60%0A%09%09echo+%22PEER%241+failed+to+join+the+channel%2C+Retry+after+2+seconds%22%0A%09%09sleep+2%0A%09%09joinWithRetry+%241%0A%09else%0A%09%09COUNTER%3D1%0A%09fi%0A++++++++verifyResult+%24res+%22After+%24MAX_RETRY+attempts%2C+PEER%24ch+has+failed+to+Join+the+Channel%22%0A%7D%0A%0AjoinChannel+%28%29+%7B%0A%09for+ch+in+0+1+2+3+4+5+6+7%3B+do%0A%09%09setGlobals+%24ch%0A%09%09joinWithRetry+%24ch%0A%09%09echo+%22%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+PEER%24ch+joined+on+the+channel+%5C%22%24CHANNEL_NAME%5C%22+%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+%22%0A%09%09sleep+2%0A%09%09echo%0A%09done%0A%7D%0A%0AinstallChaincode+%28%29+%7B%0A%09PEER%3D%241%0A%09setGlobals+%24PEER%0A%09peer+chaincode+install+-n+%24CHAINCODE_NAME+-v+1.0+-p+github.com%2Fhyperledger%2Ffabric%2Fexamples%2Fchaincode%2Fgo%2Fchaincode_example02+%26gt%3B%26amp%3Blog.txt%0A%09res%3D%24%3F%0A%09cat+log.txt%0A++++++++verifyResult+%24res+%22Chaincode+installation+on+remote+peer+PEER%24PEER+has+Failed%22%0A%09echo+%22%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+Chaincode+is+installed+on+remote+peer+PEER%24PEER+%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+%22%0A%09echo%0A%7D%0A%0AinstantiateChaincode+%28%29+%7B%0A%09PEER%3D%241%0A%09setGlobals+%24PEER%0A%09%23+while+%27peer+chaincode%27+command+can+get+the+orderer+endpoint+from+the+peer+%28if+join+was+successful%29%2C%0A%09%23+lets+supply+it+directly+as+we+know+it+using+the+%22-o%22+option%0A%09if+%5B+-z+%22%24CORE_PEER_TLS_ENABLED%22+-o+%22%24CORE_PEER_TLS_ENABLED%22+%3D+%22false%22+%5D%3B+then%0A%09%09peer+chaincode+instantiate+-o+orderer.bgiblockchain.com%3A7050+-C+%24CHANNEL_NAME+-n+%24CHAINCODE_NAME+-v+1.0+-c+%27%7B%22Args%22%3A%5B%22init%22%2C%22a%22%2C%22100%22%2C%22b%22%2C%22200%22%5D%7D%27+-P+%22OR%09%28%27HealthMSP.member%27%29%22+%26gt%3B%26amp%3Blog.txt%0A%09else%0A%09%09peer+chaincode+instantiate+-o+orderer.bgiblockchain.com%3A7050+--tls+%24CORE_PEER_TLS_ENABLED+--cafile+%24ORDERER_CA+-C+%24CHANNEL_NAME+-n+%24CHAINCODE_NAME+-v+1.0+-c+%27%7B%22Args%22%3A%5B%22init%22%2C%22a%22%2C%22100%22%2C%22b%22%2C%22200%22%5D%7D%27+-P+%22OR%09%28%27HealthMSP.member%27%29%22+%26gt%3B%26amp%3Blog.txt%0A%09fi%0A%09res%3D%24%3F%0A%09cat+log.txt%0A%09verifyResult+%24res+%22Chaincode+instantiation+on+PEER%24PEER+on+channel+%27%24CHANNEL_NAME%27+failed%22%0A%09echo+%22%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+Chaincode+Instantiation+on+PEER%24PEER+on+channel+%27%24CHANNEL_NAME%27+is+successful+%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+%22%0A%09echo%0A%7D%0A%0AchaincodeQuery+%28%29+%7B%0A++PEER%3D%241%0A++echo+%22%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+Querying+on+PEER%24PEER+on+channel+%27%24CHANNEL_NAME%27...+%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+%22%0A++setGlobals+%24PEER%0A++local+rc%3D1%0A++local+starttime%3D%24%28date+%2B%25s%29%0A%0A++%23+continue+to+poll%0A++%23+we+either+get+a+successful+response%2C+or+reach+TIMEOUT%0A++while+test+%22%24%28%28%24%28date+%2B%25s%29-starttime%29%29%22+-lt+%22%24TIMEOUT%22+-a+%24rc+-ne+0%0A++do%0A+++++sleep+3%0A+++++echo+%22Attempting+to+Query+PEER%24PEER+...%24%28%28%24%28date+%2B%25s%29-starttime%29%29+secs%22%0A+++++peer+chaincode+query+-C+%24CHANNEL_NAME+-n+%24CHAINCODE_NAME+-c+%27%7B%22Args%22%3A%5B%22query%22%2C%22a%22%5D%7D%27+%26gt%3B%26amp%3Blog.txt%0A+++++test+%24%3F+-eq+0+%26amp%3B%26amp%3B+VALUE%3D%24%28cat+log.txt+%7C+awk+%27%2FQuery+Result%2F+%7Bprint+%24NF%7D%27%29%0A+++++test+%22%24VALUE%22+%3D+%22%242%22+%26amp%3B%26amp%3B+let+rc%3D0%0A++done%0A++echo%0A++cat+log.txt%0A++if+test+%24rc+-eq+0+%3B+then%0A%09echo+%22%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+Query+on+PEER%24PEER+on+channel+%27%24CHANNEL_NAME%27+is+successful+%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+%22%0A++else%0A%09echo+%22%21%21%21%21%21%21%21%21%21%21%21%21%21%21%21+Query+result+on+PEER%24PEER+is+INVALID+%21%21%21%21%21%21%21%21%21%21%21%21%21%21%21%21%22%0A++++++++echo+%22%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+ERROR+%21%21%21+FAILED+to+execute+End-2-End+Scenario+%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%22%0A%09echo%0A%09exit+1%0A++fi%0A%7D%0A%0AchaincodeInvoke+%28%29+%7B%0A%09PEER%3D%241%0A%09setGlobals+%24PEER%0A%09%23+while+%27peer+chaincode%27+command+can+get+the+orderer+endpoint+from+the+peer+%28if+join+was+successful%29%2C%0A%09%23+lets+supply+it+directly+as+we+know+it+using+the+%22-o%22+option%0A%09if+%5B+-z+%22%24CORE_PEER_TLS_ENABLED%22+-o+%22%24CORE_PEER_TLS_ENABLED%22+%3D+%22false%22+%5D%3B+then%0A%09%09peer+chaincode+invoke+-o+orderer.bgiblockchain.com%3A7050+-C+%24CHANNEL_NAME+-n+%24CHAINCODE_NAME+-c+%27%7B%22Args%22%3A%5B%22invoke%22%2C%22a%22%2C%22b%22%2C%2210%22%5D%7D%27+%26gt%3B%26amp%3Blog.txt%0A%09else%0A%09%09peer+chaincode+invoke+-o+orderer.bgiblockchain.com%3A7050++--tls+%24CORE_PEER_TLS_ENABLED+--cafile+%24ORDERER_CA+-C+%24CHANNEL_NAME+-n+%24CHAINCODE_NAME+-c+%27%7B%22Args%22%3A%5B%22invoke%22%2C%22a%22%2C%22b%22%2C%2210%22%5D%7D%27+%26gt%3B%26amp%3Blog.txt%0A%09fi%0A%09res%3D%24%3F%0A%09cat+log.txt%0A%09verifyResult+%24res+%22Invoke+execution+on+PEER%24PEER+failed+%22%0A%09echo+%22%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+Invoke+transaction+on+PEER%24PEER+on+channel+%27%24CHANNEL_NAME%27+is+successful+%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+%22%0A%09echo%0A%7D%0A%0AvalidateArgs%0A%0A%23%23+Create+channel%0Aecho+%22Creating+channel...%22%0AcreateChannel%0A%0A%23%23+Join+all+the+peers+to+the+channel%0Aecho+%22Having+all+peers+join+the+channel...%22%0AjoinChannel%0A%0A%23%23+Set+the+anchor+peers+for+each+org+in+the+channel%0Aecho+%22Updating+anchor+peers+for+org1...%22%0AupdateAnchorPeers+0%0Aecho+%22Updating+anchor+peers+for+org2...%22%0A%23updateAnchorPeers+2%0A%0A%23%23+Install+chaincode+on+Peer0%2FHealth+and+Peer2%2FOrg2%0Aecho+%22Installing+chaincode+on+org1%2Fpeer0...%22%0AinstallChaincode+0%0Aecho+%22Install+chaincode+on+org2%2Fpeer2...%22%0AinstallChaincode+2%0A%0A%23Instantiate+chaincode+on+Peer2%2FOrg2%0Aecho+%22Instantiating+chaincode+on+org2%2Fpeer2...%22%0AinstantiateChaincode+2%0A%0A%23Query+on+chaincode+on+Peer0%2FHealth%0Aecho+%22Querying+chaincode+on+org1%2Fpeer0...%22%0AchaincodeQuery+0+100%0A%0A%23Invoke+on+chaincode+on+Peer0%2FHealth%0Aecho+%22Sending+invoke+transaction+on+org1%2Fpeer0...%22%0AchaincodeInvoke+0%0A%0A%23%23+Install+chaincode+on+Peer3%2FOrg2%0Aecho+%22Installing+chaincode+on+org2%2Fpeer3...%22%0AinstallChaincode+1%0AinstallChaincode+3%0AinstallChaincode+4%0AinstallChaincode+5%0AinstallChaincode+6%0AinstallChaincode+7%0A%0A%23Query+on+chaincode+on+Peer3%2FOrg2%2C+check+if+the+result+is+90%0Aecho+%22Querying+chaincode+on+org2%2Fpeer3...%22%0AchaincodeQuery+1+90%0A%0A%0Aecho%0Aecho+%22%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+All+GOOD+%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D+%22%0Aecho%0A%0Aexit+0%3C%2Fcode%3E%3C%2Fpre%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn+btn-red-hollow%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fkidoo1012%2Farticle%2Fdetails%2F80607546%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fkidoo1012%2Farticle%2Fdetails%2F80607546%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}
---
layout: default
title: 超级账本hyperledger fabric第五集：共识排序及源码阅读
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-d7e2a68c7c.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22+id%3D%22content_views%22%3E+%0A++%3Ch2%3E%3Cstrong%3E%3Cstrong%3E%3Cspan+style%3D%22color%3A%23ff0000%3B%22%3E%3Cstrong%3E%E4%B8%80.%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6%3C%2Fstrong%3E%3C%2Fspan%3E%3C%2Fstrong%3E%3C%2Fstrong%3E%3C%2Fh2%3E+%0A++%3Cp%3E%E8%BE%BE%E6%88%90%E5%85%B1%E8%AF%86%E9%9C%80%E8%A6%813%E4%B8%AA%E9%98%B6%E6%AE%B5%EF%BC%8C%E4%BA%A4%E6%98%93%E8%83%8C%E4%B9%A6%EF%BC%8C%E4%BA%A4%E6%98%93%E6%8E%92%E5%BA%8F%EF%BC%8C%E4%BA%A4%E6%98%93%E9%AA%8C%E8%AF%81%3C%2Fp%3E+%0A++%3Cul%3E%0A+++%3Cli%3E%E4%BA%A4%E6%98%93%E8%83%8C%E4%B9%A6%EF%BC%9A%E6%A8%A1%E6%8B%9F%E7%9A%84%3C%2Fli%3E+%0A+++%3Cli%3E%E4%BA%A4%E6%98%93%E6%8E%92%E5%BA%8F%EF%BC%9A%E7%A1%AE%E5%AE%9A%E4%BA%A4%E6%98%93%E9%A1%BA%E5%BA%8F%EF%BC%8C%E6%9C%80%E7%BB%88%E5%B0%86%E6%8E%92%E5%BA%8F%E5%A5%BD%E7%9A%84%E4%BA%A4%E6%98%93%E6%89%93%E5%8C%85%E5%8C%BA%E5%9D%97%E5%88%86%E5%8F%91%3C%2Fli%3E+%0A+++%3Cli%3E%E4%BA%A4%E6%98%93%E9%AA%8C%E8%AF%81%EF%BC%9A%E5%8C%BA%E5%9D%97%E5%AD%98%E5%82%A8%E5%89%8D%E8%A6%81%E8%BF%9B%E8%A1%8C%E4%B8%80%E4%B8%8B%E4%BA%A4%E6%98%93%E9%AA%8C%E8%AF%81%3C%2Fli%3E+%0A++%3C%2Ful%3E%0A++%3Ch2%3E%3Cstrong%3E%3Cstrong%3E%3Cspan+style%3D%22color%3A%23ff0000%3B%22%3E%3Cstrong%3E%E4%BA%8C.o%3C%2Fstrong%3E%3C%2Fspan%3E%3C%2Fstrong%3E%3Cstrong%3E%3Cspan+style%3D%22color%3A%23ff0000%3B%22%3E%3Cstrong%3Erderer%3C%2Fstrong%3E%3C%2Fspan%3E%3C%2Fstrong%3E%3Cstrong%3E%3Cspan+style%3D%22color%3A%23ff0000%3B%22%3E%3Cstrong%3E%E8%8A%82%E7%82%B9%E7%9A%84%E4%BD%9C%E7%94%A8%3C%2Fstrong%3E%3C%2Fspan%3E%3C%2Fstrong%3E%3C%2Fstrong%3E%3C%2Fh2%3E+%0A++%3Cul%3E%0A+++%3Cli%3E%E4%BA%A4%E6%98%93%E6%8E%92%E5%BA%8F+%0A++++%3Col%3E%0A+++++%3Cli%3E%E7%9B%AE%E7%9A%84%EF%BC%9A%E4%BF%9D%E8%AF%81%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%88%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%EF%BC%89%3C%2Fli%3E+%0A+++++%3Cli%3Esolo%EF%BC%9A%E5%8D%95%E8%8A%82%E7%82%B9%E6%8E%92%E5%BA%8F%3C%2Fli%3E+%0A+++++%3Cli%3Ekafka%EF%BC%9A%E5%A4%96%E7%BD%AE%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%3C%2Fli%3E+%0A++++%3C%2Fol%3E%3C%2Fli%3E+%0A+++%3Cli%3E%E5%8C%BA%E5%9D%97%E5%88%86%E5%8F%91+%0A++++%3Col%3E%0A+++++%3Cli%3Eorderer%E4%B8%AD%E7%9A%84%E5%8C%BA%E5%9D%97%E5%B9%B6%E4%B8%8D%E6%98%AF%E6%9C%80%E7%BB%88%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E5%8C%BA%E5%9D%97%3C%2Fli%3E+%0A+++++%3Cli%3E%E6%98%AF%E4%B8%80%E4%B8%AA%E4%B8%AD%E9%97%B4%E7%8A%B6%E6%80%81%E7%9A%84%E5%8C%BA%E5%9D%97%3C%2Fli%3E+%0A+++++%3Cli%3E%E5%8C%85%E5%90%AB%E4%BA%86%E6%89%80%E6%9C%89%E4%BA%A4%E6%98%93%EF%BC%8C%E4%B8%8D%E7%AE%A1%E6%98%AF%E6%9C%89%E6%95%88%E8%BF%98%E6%98%AF%E6%97%A0%E6%95%88%EF%BC%8C%E9%83%BD%E4%BC%9A%E6%89%93%E5%8C%85%E4%BC%A0%E7%BB%99%E7%BB%84%E7%BB%87%E7%9A%84%E9%94%9A%E8%8A%82%E7%82%B9%3C%2Fli%3E+%0A++++%3C%2Fol%3E%3C%2Fli%3E+%0A+++%3Cli%3E%E5%A4%9A%E9%80%9A%E9%81%93%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9A%94%E7%A6%BB+%0A++++%3Col%3E%0A+++++%3Cli%3E%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E6%9F%90%E4%B8%AA%E9%80%9A%E9%81%93%EF%BC%8C%E5%8F%91%E9%80%81%E4%BA%A4%E6%98%93%3C%2Fli%3E+%0A++++%3C%2Fol%3E%3C%2Fli%3E+%0A++%3C%2Ful%3E%0A++%3Cp+style%3D%22text-align%3Acenter%3B%22%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+height%3D%22392%22+src%3D%22https%3A%2F%2Fimg-blog.csdnimg.cn%2F20181107144701284.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1cGVyX2xpeGlhbmc%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70%22+width%3D%22741%22%3E%3C%2Fp%3E+%0A++%3Ch2%3E%3Cstrong%3E%3Cstrong%3E%3Cspan+style%3D%22color%3A%23ff0000%3B%22%3E%3Cstrong%3E%E4%B8%89.%E6%BA%90%E7%A0%81%E7%9B%AE%E5%BD%95%3C%2Fstrong%3E%3C%2Fspan%3E%3C%2Fstrong%3E%3C%2Fstrong%3E%3C%2Fh2%3E+%0A++%3Cul%3E%0A+++%3Cli%3E%E4%BB%8Egoland%E4%B8%AD%E9%98%85%E8%AF%BB%3C%2Fli%3E+%0A++%3C%2Ful%3E%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+height%3D%22559%22+src%3D%22https%3A%2F%2Fimg-blog.csdnimg.cn%2F2018110714510229.jpeg%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1cGVyX2xpeGlhbmc%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70%22+width%3D%22350%22%3E%3C%2Fp%3E+%0A++%3Cul%3E%0A+++%3Cli%3E%E6%BA%90%E7%A0%81%E7%9B%AE%E5%BD%95+%0A++++%3Col%3E%0A+++++%3Cli%3Ebccsp%EF%BC%9A%E4%B8%8E%E5%AF%86%E7%A0%81%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%EF%BC%8C%E5%8A%A0%E5%AF%86%EF%BC%8C%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%EF%BC%8C%E8%AF%81%E4%B9%A6%EF%BC%8C%E5%B0%86%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0%E6%8A%BD%E8%B1%A1%E6%88%90%E4%BA%86%E6%8E%A5%E5%8F%A3%EF%BC%8C%E6%96%B9%E4%BE%BF%E8%B0%83%E7%94%A8%E5%92%8C%E6%89%A9%E5%B1%95%3C%2Fli%3E+%0A+++++%3Cli%3Ebddtests%EF%BC%9A%E8%A1%8C%E4%B8%BA%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%EF%BC%8C%E4%BB%8E%E9%9C%80%E6%B1%82%E7%9B%B4%E6%8E%A5%E5%88%B0%E5%BC%80%E5%8F%91%3C%2Fli%3E+%0A+++++%3Cli%3Ecommon%EF%BC%9A%E5%85%AC%E5%85%B1%E5%BA%93%E3%80%81%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E3%80%81%E6%97%A5%E5%BF%97%E5%87%BA%E9%A1%B9%EF%BC%8C%E8%B4%A6%E6%9C%AC%E5%AD%98%E5%82%A8%EF%BC%8C%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7%3C%2Fli%3E+%0A+++++%3Cli%3Ecore%EF%BC%9A%E6%98%AFfabric%E7%9A%84%E6%A0%B8%E5%BF%83%E5%BA%93%EF%BC%8C%E5%AD%90%E7%9B%AE%E5%BD%95%E6%98%AF%E5%90%84%E4%B8%AA%E6%A8%A1%E5%9D%97%E7%9A%84%E7%9B%AE%E5%BD%95+%2F%26nbsp%3B+comm%EF%BC%9A%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E7%9B%B8%E5%85%B3%3C%2Fli%3E+%0A+++++%3Cli%3Edevenv%EF%BC%9A%E5%AE%98%E6%96%B9%E6%8F%90%E4%BE%9B%E7%9A%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%EF%BC%8C%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AFVagrant%3C%2Fli%3E+%0A+++++%3Cli%3Edocs%EF%BC%9A%E6%96%87%E6%A1%A3%3C%2Fli%3E+%0A+++++%3Cli%3Eevents%EF%BC%9A%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E6%9C%BA%E5%88%B6%3C%2Fli%3E+%0A+++++%3Cli%3Eexamples%EF%BC%9A%E4%BE%8B%E5%AD%90%E7%A8%8B%E5%BA%8F%3C%2Fli%3E+%0A+++++%3Cli%3Egossip%EF%BC%9A%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%EF%BC%8C%E7%BB%84%E7%BB%87%E5%86%85%E9%83%A8%E7%9A%84%E9%80%9A%E4%BF%A1%EF%BC%8C%E5%8C%BA%E5%9D%97%E5%90%8C%E6%AD%A5%3C%2Fli%3E+%0A+++++%3Cli%3Egotools%EF%BC%9A%E7%94%A8%E4%BA%8E%E7%BC%96%E8%AF%91%3C%2Fli%3E+%0A+++++%3Cli%3Eimages%EF%BC%9Adocker%E9%95%9C%E5%83%8F%E7%9B%B8%E5%85%B3%3C%2Fli%3E+%0A+++++%3Cli%3Emsp%EF%BC%9A%E6%88%90%E5%91%98%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86%EF%BC%8Cmember+serivce+provider%EF%BC%8C%E8%AF%BB%E5%8F%96%E8%AF%81%E4%B9%A6%E5%81%9A%E7%AD%BE%E5%90%8D%3C%2Fli%3E+%0A+++++%3Cli%3Eorderer%EF%BC%9A%E6%8E%92%E5%BA%8F%E8%8A%82%E7%82%B9%3C%2Fli%3E+%0A+++++%3Cli%3Epeer%EF%BC%9Apeer%E8%8A%82%E7%82%B9%3C%2Fli%3E+%0A+++++%3Cli%3Eproposals%EF%BC%9A%E7%94%A8%E4%BA%8E%E6%89%A9%E5%B1%95%EF%BC%8C%E6%96%B0%E5%8A%9F%E8%83%BD%E7%9A%84%E6%8F%90%E6%A1%88%3C%2Fli%3E+%0A+++++%3Cli%3Eprotos%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%9A%84%E5%AE%9A%E4%B9%89%3C%2Fli%3E+%0A++++%3C%2Fol%3E%3C%2Fli%3E+%0A++%3C%2Ful%3E%0A++%3Chr%3E%0A++%3Ch2%3E%3Cstrong%3E%3Cstrong%3E%3Cspan+style%3D%22color%3A%23ff0000%3B%22%3E%3Cstrong%3E%E5%9B%9B.%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6%E6%BA%90%E7%A0%81%3C%2Fstrong%3E%3C%2Fspan%3E%3C%2Fstrong%3E%3C%2Fstrong%3E%3C%2Fh2%3E+%0A++%3Ch3%3Eorderer%E8%8A%82%E7%82%B9%E7%9A%84%E6%BA%90%E7%A0%81%3C%2Fh3%3E+%0A++%3Cul%3E%0A+++%3Cli%3E%E9%A6%96%E5%85%88%E7%9C%8Borderer%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84main.go+%EF%BC%8Cmain.go%E9%87%8C%E6%9C%89%E4%B8%80%E4%B8%AANewServer%E5%8F%AF%E4%BB%A5%E8%BF%9B%E5%85%A5server.go%3C%2Fli%3E+%0A++%3C%2Ful%3E%0A++%3Cp%3Emain.go%E4%B8%ADfunc+main%28%29%26nbsp%3B%E4%B8%BB%E8%A6%81%E8%B5%B7%E5%88%B0%E5%88%A4%E6%96%AD%E4%BD%9C%E7%94%A8%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%8E%A5%E6%94%B6%E5%88%B0%E7%9A%84%E6%98%AFstart%E5%91%BD%E4%BB%A4%EF%BC%8C%E5%B0%B1%E5%8A%A0%E8%BD%BD%E5%92%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E5%90%84%E7%A7%8D%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%8E%A5%E6%94%B6%E5%88%B0%E7%9A%84%E6%98%AFversion%E6%8C%87%E4%BB%A4%EF%BC%8C%E5%B0%B1%E6%89%93%E5%8D%B0%E7%89%88%E6%9C%AC%E5%8F%B7%EF%BC%9B%E4%B9%8B%E5%90%8E%E5%9C%A8%E4%B8%8B%E9%9D%A2%E5%AE%9A%E4%B9%89%E4%BA%86%E4%B8%8A%E9%9D%A2%E7%9A%84%E5%90%84%E7%A7%8D%E6%96%B9%E6%B3%95%E3%80%82%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Efunc+main%28%29+%7B%0A%0A%09kingpin.Version%28%220.0.1%22%29%0A%09%2F%2F%E5%88%A4%E6%96%AD%E6%8E%A5%E5%8F%97%E5%88%B0%E7%9A%84%E5%8F%82%E6%95%B0Args%0A%09switch+kingpin.MustParse%28app.Parse%28os.Args%5B1%3A%5D%29%29+%7B%0A%0A%09%2F%2F+%E5%A6%82%E6%9E%9C%E6%8E%A5%E5%8F%97%E5%88%B0%22start%22+command%0A%09case+start.FullCommand%28%29%3A%0A%09%09logger.Infof%28%22Starting+%25s%22%2C+metadata.GetVersionInfo%28%29%29%0A%09%09%2F%2F%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%0A%09%09conf+%3A%3D+config.Load%28%29%0A%09%09%2F%2F%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB%0A%09%09%2F%2F%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB%E8%B0%83%E9%AB%98%0A%09%09initializeLoggingLevel%28conf%29%0A%09%09%2F%2F%E5%88%9D%E5%A7%8B%E5%8C%96profile%EF%BC%8Cgo%E5%86%85%E7%BD%AE%E7%9A%84%E8%A7%82%E5%AF%9F%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E7%9A%84%E5%B7%A5%E5%85%B7%0A%09%09%2F%2F%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87http%E8%B0%83%E7%94%A8%0A%09%09initializeProfilingService%28conf%29%0A%09%09%2F%2F%E5%88%9D%E5%A7%8B%E5%8C%96grpc%E6%9C%8D%E5%8A%A1%E7%AB%AF%0A%09%09grpcServer+%3A%3D+initializeGrpcServer%28conf%29%0A%09%09%2F%2F%E5%8A%A0%E8%BD%BDmsp%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6%0A%09%09initializeLocalMsp%28conf%29%0A%09%09%2F%2Fmsp%E8%AF%81%E4%B9%A6%E7%BB%99%E7%AD%BE%E5%90%8D%E8%80%85%E5%AE%9E%E4%BE%8B%E5%8C%96%0A%09%09signer+%3A%3D+localmsp.NewSigner%28%29%0A%09%09%2F%2F%E5%88%9D%E5%A7%8B%E5%8C%96%E9%93%BE%E7%9A%84%E7%AE%A1%E7%90%86%E8%80%85%EF%BC%88%E4%B9%9F%E5%B0%B1%E6%98%AF%E4%B8%BB%E8%8A%82%E7%82%B9%EF%BC%89%0A%09%09manager+%3A%3D+initializeMultiChainManager%28conf%2C+signer%29%0A%09%09%2F%2F%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%9C%8D%E5%8A%A1%0A%09%09server+%3A%3D+NewServer%28manager%2C+signer%29%0A%09%09%2F%2F%E7%BB%91%E5%AE%9A%E6%9C%8D%E5%8A%A1%0A%09%09ab.RegisterAtomicBroadcastServer%28grpcServer.Server%28%29%2C+server%29%0A%09%09logger.Info%28%22Beginning+to+serve+requests%22%29%0A%09%09%2F%2F%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%0A%09%09grpcServer.Start%28%29%0A%09%2F%2F+%E5%A6%82%E6%9E%9C%E6%8E%A5%E5%8F%97%E5%88%B0%22version%22+command%0A%09case+version.FullCommand%28%29%3A%0A%09%09%2F%2F%E6%89%93%E5%8D%B0%E7%89%88%E6%9C%AC%E5%8F%B7%0A%09%09fmt.Println%28metadata.GetVersionInfo%28%29%29%0A%09%7D%0A%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E6%88%91%E4%BB%AC%E6%9D%A5%E7%9C%8B%E4%B8%8B%E5%88%9D%E5%A7%8B%E5%8C%96%E7%AE%A1%E7%90%86%E8%80%85%E7%9A%84%E4%BB%A3%E7%A0%81%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Efunc+initializeMultiChainManager%28conf+*config.TopLevel%2C+signer+crypto.LocalSigner%29+multichain.Manager+%7B%0A%09%2F%2F%E5%88%9B%E5%BB%BA%E8%B4%A6%E6%9C%AC%E5%B7%A5%E5%8E%82%EF%BC%8C%E4%BA%A7%E7%94%9F%E4%B8%B4%E6%97%B6%E5%8C%BA%E5%9D%97%0A%09lf%2C+_+%3A%3D+createLedgerFactory%28conf%29%0A%09%2F%2F%E5%88%A4%E6%96%AD%E9%93%BE%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%0A%09if+len%28lf.ChainIDs%28%29%29+%3D%3D+0+%7B%0A%09%09%2F%2F%E9%93%BE%E4%B8%8D%E5%AD%98%E5%9C%A8%0A%09%09%2F%2F%E5%90%AF%E5%8A%A8%E5%BC%95%E5%AF%BC%E9%93%BE%0A%09%09initializeBootstrapChannel%28conf%2C+lf%29%0A%09%7D+else+%7B%0A%09%09logger.Info%28%22Not+bootstrapping+because+of+existing+chains%22%29%0A%09%7D%0A%09%2F%2F%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6%0A%09%2F%2F%E6%9C%89solo%E5%92%8Ckafka%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F%0A%09consenters+%3A%3D+make%28map%5Bstring%5Dmultichain.Consenter%29%0A%09consenters%5B%22solo%22%5D+%3D+solo.New%28%29%0A%09consenters%5B%22kafka%22%5D+%3D+kafka.New%28conf.Kafka.TLS%2C+conf.Kafka.Retry%2C+conf.Kafka.Version%29%0A%0A%09return+multichain.NewManagerImpl%28lf%2C+consenters%2C+signer%29%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cul%3E%0A+++%3Cli%3Eorderer%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%9C%A8orderer.yaml%E4%B8%AD%EF%BC%8C%E7%9B%91%E5%90%AC%E7%9A%84%E5%9C%B0%E5%9D%80%E6%98%AF127.0.0.1%EF%BC%9B%E7%9B%91%E5%90%AC%E7%9A%84%E7%AB%AF%E5%8F%A3%E6%98%AF7050%EF%BC%9BBCCSP%E6%98%AF%E5%AF%86%E7%A0%81%E5%AD%A6%EF%BC%8C%E8%B4%A6%E6%9C%AC%E5%AD%98%E5%82%A8%E6%9C%80%E7%BB%88%E8%BF%98%E6%98%AF%E5%AD%98%E5%82%A8%E5%88%B0%E7%A1%AC%E7%9B%98%E4%B8%AD%E3%80%82%3C%2Fli%3E+%0A++%3C%2Ful%3E%0A++%3Cul%3E%0A+++%3Cli%3E%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%92%B1%E4%BB%AC%E7%9C%8B%E4%B8%8B%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%9C%8D%E5%8A%A1server.go%EF%BC%8C%E8%BF%99%E9%87%8C%E9%9D%A2%E5%AE%9A%E4%B9%89%E4%BA%86%E4%BA%A4%E6%98%93%E6%94%B6%E9%9B%86%E5%92%8C%E5%B9%BF%E6%92%AD%E5%8C%BA%E5%9D%97%E3%80%82%3C%2Fli%3E+%0A++%3C%2Ful%3E%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Etype+server+struct+%7B%0A%09%2F%2F%E4%BA%A4%E6%98%93%E6%94%B6%E9%9B%86%0A%09bh+broadcast.Handler%0A%09%2F%2F%E5%B9%BF%E6%92%AD%E5%8C%BA%E5%9D%97%0A%09dh+deliver.Handler%0A%7D%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E6%88%91%E4%BB%AC%E5%85%B7%E4%BD%93%E7%9C%8B%E4%B8%8B%E4%BA%A4%E6%98%93%E6%94%B6%E9%9B%86%EF%BC%9Abroadcast.go%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Efunc+%28bh+*handlerImpl%29+Handle%28srv+ab.AtomicBroadcast_BroadcastServer%29+error+%7B%0A%09logger.Debugf%28%22Starting+new+broadcast+loop%22%29%0A%09for+%7B%0A%09%09%2F%2F%E6%8E%A5%E6%94%B6%E4%BA%A4%E6%98%93%0A%09%09msg%2C+err+%3A%3D+srv.Recv%28%29%0A%09%09if+err+%3D%3D+io.EOF+%7B%0A%09%09%09logger.Debugf%28%22Received+EOF%2C+hangup%22%29%0A%09%09%09return+nil%0A%09%09%7D%0A%09%09if+err+%21%3D+nil+%7B%0A%09%09%09logger.Warningf%28%22Error+reading+from+stream%3A+%25s%22%2C+err%29%0A%09%09%09return+err%0A%09%09%7D%0A%0A%09%09payload%2C+err+%3A%3D+utils.UnmarshalPayload%28msg.Payload%29%0A%09%09if+err+%21%3D+nil+%7B%0A%09%09%09logger.Warningf%28%22Received+malformed+message%2C+dropping+connection%3A+%25s%22%2C+err%29%0A%09%09%09return+srv.Send%28%26amp%3Bab.BroadcastResponse%7BStatus%3A+cb.Status_BAD_REQUEST%7D%29%0A%09%09%7D%0A%0A%09%09%2F%2F%E9%AA%8C%E8%AF%81%E6%B6%88%E6%81%AF%E4%BD%93%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%8C%E6%9C%89%E9%94%99%E8%AF%AF%E5%88%99%E8%BF%94%E5%9B%9EStatus_BAD_REQUEST%0A%09%09if+payload.Header+%3D%3D+nil+%7B%0A%09%09%09logger.Warningf%28%22Received+malformed+message%2C+with+missing+header%2C+dropping+connection%22%29%0A%09%09%09return+srv.Send%28%26amp%3Bab.BroadcastResponse%7BStatus%3A+cb.Status_BAD_REQUEST%7D%29%0A%09%09%7D%0A%0A%09%09chdr%2C+err+%3A%3D+utils.UnmarshalChannelHeader%28payload.Header.ChannelHeader%29%0A%09%09if+err+%21%3D+nil+%7B%0A%09%09%09logger.Warningf%28%22Received+malformed+message+%28bad+channel+header%29%2C+dropping+connection%3A+%25s%22%2C+err%29%0A%09%09%09return+srv.Send%28%26amp%3Bab.BroadcastResponse%7BStatus%3A+cb.Status_BAD_REQUEST%7D%29%0A%09%09%7D%0A%0A%09%09if+chdr.Type+%3D%3D+int32%28cb.HeaderType_CONFIG_UPDATE%29+%7B%0A%09%09%09logger.Debugf%28%22Preprocessing+CONFIG_UPDATE%22%29%0A%09%09%09msg%2C+err+%3D+bh.sm.Process%28msg%29%0A%09%09%09if+err+%21%3D+nil+%7B%0A%09%09%09%09logger.Warningf%28%22Rejecting+CONFIG_UPDATE+because%3A+%25s%22%2C+err%29%0A%09%09%09%09return+srv.Send%28%26amp%3Bab.BroadcastResponse%7BStatus%3A+cb.Status_BAD_REQUEST%7D%29%0A%09%09%09%7D%0A%0A%09%09%09err+%3D+proto.Unmarshal%28msg.Payload%2C+payload%29%0A%09%09%09if+err+%21%3D+nil+%7C%7C+payload.Header+%3D%3D+nil+%7B%0A%09%09%09%09logger.Criticalf%28%22Generated+bad+transaction+after+CONFIG_UPDATE+processing%22%29%0A%09%09%09%09return+srv.Send%28%26amp%3Bab.BroadcastResponse%7BStatus%3A+cb.Status_INTERNAL_SERVER_ERROR%7D%29%0A%09%09%09%7D%0A%0A%09%09%09chdr%2C+err+%3D+utils.UnmarshalChannelHeader%28payload.Header.ChannelHeader%29%0A%09%09%09if+err+%21%3D+nil+%7B%0A%09%09%09%09logger.Criticalf%28%22Generated+bad+transaction+after+CONFIG_UPDATE+processing+%28bad+channel+header%29%3A+%25s%22%2C+err%29%0A%09%09%09%09return+srv.Send%28%26amp%3Bab.BroadcastResponse%7BStatus%3A+cb.Status_INTERNAL_SERVER_ERROR%7D%29%0A%09%09%09%7D%0A%0A%09%09%09if+chdr.ChannelId+%3D%3D+%22%22+%7B%0A%09%09%09%09logger.Criticalf%28%22Generated+bad+transaction+after+CONFIG_UPDATE+processing+%28empty+channel+ID%29%22%29%0A%09%09%09%09return+srv.Send%28%26amp%3Bab.BroadcastResponse%7BStatus%3A+cb.Status_INTERNAL_SERVER_ERROR%7D%29%0A%09%09%09%7D%0A%09%09%7D%0A%0A%09%09%2F%2F%E8%8E%B7%E5%8F%96support%E5%AF%B9%E8%B1%A1%0A%09%09support%2C+ok+%3A%3D+bh.sm.GetChain%28chdr.ChannelId%29%0A%09%09if+%21ok+%7B%0A%09%09%09logger.Warningf%28%22Rejecting+broadcast+because+channel+%25s+was+not+found%22%2C+chdr.ChannelId%29%0A%09%09%09return+srv.Send%28%26amp%3Bab.BroadcastResponse%7BStatus%3A+cb.Status_NOT_FOUND%7D%29%0A%09%09%7D%0A%0A%09%09logger.Debugf%28%22%5Bchannel%3A+%25s%5D+Broadcast+is+filtering+message+of+type+%25s%22%2C+chdr.ChannelId%2C+cb.HeaderType_name%5Bchdr.Type%5D%29%0A%0A%09%09%2F%2F%E5%B0%86%E6%B6%88%E6%81%AF%E4%BC%A0%E5%88%B0support%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8%E4%B8%AD%E8%BF%87%E6%BB%A4%0A%09%09%2F%2F%E6%98%AF%E5%8C%BA%E5%9D%97%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%BF%87%E6%BB%A4%EF%BC%8C%E7%AC%AC%E4%BA%8C%E6%AC%A1%E6%98%AF%E5%9C%A8%E5%8C%BA%E5%9D%97%E5%88%87%E5%89%B2%E6%97%B6%E8%BF%87%E6%BB%A4%E7%9A%84%0A%09%09_%2C+filterErr+%3A%3D+support.Filters%28%29.Apply%28msg%29%0A%0A%09%09if+filterErr+%21%3D+nil+%7B%0A%09%09%09logger.Warningf%28%22%5Bchannel%3A+%25s%5D+Rejecting+broadcast+message+because+of+filter+error%3A+%25s%22%2C+chdr.ChannelId%2C+filterErr%29%0A%09%09%09return+srv.Send%28%26amp%3Bab.BroadcastResponse%7BStatus%3A+cb.Status_BAD_REQUEST%7D%29%0A%09%09%7D%0A%09%09%2F%2F%E6%B6%88%E6%81%AF%E5%85%A5%E5%88%97%EF%BC%8C%E7%84%B6%E5%90%8E%E8%A2%ABsolo%E6%88%96kafka%E5%A4%84%E7%90%86%0A%09%09if+%21support.Enqueue%28msg%29+%7B%0A%09%09%09return+srv.Send%28%26amp%3Bab.BroadcastResponse%7BStatus%3A+cb.Status_SERVICE_UNAVAILABLE%7D%29%0A%09%09%7D%0A%0A%09%09if+logger.IsEnabledFor%28logging.DEBUG%29+%7B%0A%09%09%09logger.Debugf%28%22%5Bchannel%3A+%25s%5D+Broadcast+has+successfully+enqueued+message+of+type+%25s%22%2C+chdr.ChannelId%2C+cb.HeaderType_name%5Bchdr.Type%5D%29%0A%09%09%7D%0A%09%09%2F%2F%E8%BF%94%E5%9B%9E%E6%AD%A3%E7%A1%AE%E7%9A%84200%E7%A0%81%0A%09%09err+%3D+srv.Send%28%26amp%3Bab.BroadcastResponse%7BStatus%3A+cb.Status_SUCCESS%7D%29%0A%09%09if+err+%21%3D+nil+%7B%0A%09%09%09logger.Warningf%28%22%5Bchannel%3A+%25s%5D+Error+sending+to+stream%3A+%25s%22%2C+chdr.ChannelId%2C+err%29%0A%09%09%09return+err%0A%09%09%7D%0A%09%7D%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E6%88%91%E4%BB%AC%E5%85%B7%E4%BD%93%E7%9C%8B%E4%B8%8B%E5%B9%BF%E6%92%AD%E5%8C%BA%E5%9D%97%EF%BC%9Adeliver.go%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Efunc+%28ds+*deliverServer%29+Handle%28srv+ab.AtomicBroadcast_DeliverServer%29+error+%7B%0A%09logger.Debugf%28%22Starting+new+deliver+loop%22%29%0A%09for+%7B%0A%09%09logger.Debugf%28%22Attempting+to+read+seek+info+message%22%29%0A%09%09%2F%2F%E6%8E%A5%E6%94%B6%E8%AF%B7%E6%B1%82%0A%09%09envelope%2C+err+%3A%3D+srv.Recv%28%29%0A%09%09if+err+%3D%3D+io.EOF+%7B%0A%09%09%09logger.Debugf%28%22Received+EOF%2C+hangup%22%29%0A%09%09%09return+nil%0A%09%09%7D%0A%0A%09%09if+err+%21%3D+nil+%7B%0A%09%09%09logger.Warningf%28%22Error+reading+from+stream%3A+%25s%22%2C+err%29%0A%09%09%09return+err%0A%09%09%7D%0A%09%09%2F%2F%E5%81%9A%E6%A0%A1%E9%AA%8C%0A%09%09payload%2C+err+%3A%3D+utils.UnmarshalPayload%28envelope.Payload%29%0A%09%09if+err+%21%3D+nil+%7B%0A%09%09%09logger.Warningf%28%22Received+an+envelope+with+no+payload%3A+%25s%22%2C+err%29%0A%09%09%09return+sendStatusReply%28srv%2C+cb.Status_BAD_REQUEST%29%0A%09%09%7D%0A%0A%09%09if+payload.Header+%3D%3D+nil+%7B%0A%09%09%09logger.Warningf%28%22Malformed+envelope+received+with+bad+header%22%29%0A%09%09%09return+sendStatusReply%28srv%2C+cb.Status_BAD_REQUEST%29%0A%09%09%7D%0A%0A%09%09chdr%2C+err+%3A%3D+utils.UnmarshalChannelHeader%28payload.Header.ChannelHeader%29%0A%09%09if+err+%21%3D+nil+%7B%0A%09%09%09logger.Warningf%28%22Failed+to+unmarshal+channel+header%3A+%25s%22%2C+err%29%0A%09%09%09return+sendStatusReply%28srv%2C+cb.Status_BAD_REQUEST%29%0A%09%09%7D%0A%09%09%2F%2F%E8%8E%B7%E5%8F%96chain%E5%AF%B9%E8%B1%A1%0A%09%09chain%2C+ok+%3A%3D+ds.sm.GetChain%28chdr.ChannelId%29%0A%09%09if+%21ok+%7B%0A%09%09%09%2F%2F+Note%2C+we+log+this+at+DEBUG+because+SDKs+will+poll+waiting+for+channels+to+be+created%0A%09%09%09%2F%2F+So+we+would+expect+our+log+to+be+somewhat+flooded+with+these%0A%09%09%09logger.Debugf%28%22Rejecting+deliver+because+channel+%25s+not+found%22%2C+chdr.ChannelId%29%0A%09%09%09return+sendStatusReply%28srv%2C+cb.Status_NOT_FOUND%29%0A%09%09%7D%0A%09%09%2F%2F%E7%9B%91%E5%90%AC%E6%98%AF%E5%90%A6%E6%9C%89%E9%94%99%E8%AF%AF%E5%8F%91%E7%94%9F%0A%09%09%2F%2F%E6%9C%89%E9%94%99%E8%AF%AF%EF%BC%8C%E8%BF%94%E5%9B%9E503%0A%09%09erroredChan+%3A%3D+chain.Errored%28%29%0A%09%09select+%7B%0A%09%09case+%26lt%3B-erroredChan%3A%0A%09%09%09logger.Warningf%28%22%5Bchannel%3A+%25s%5D+Rejecting+deliver+request+because+of+consenter+error%22%2C+chdr.ChannelId%29%0A%09%09%09return+sendStatusReply%28srv%2C+cb.Status_SERVICE_UNAVAILABLE%29%0A%09%09default%3A%0A%0A%09%09%7D%0A%0A%09%09lastConfigSequence+%3A%3D+chain.Sequence%28%29%0A%09%09%2F%2F%E5%AF%B9%E9%93%BE%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E6%A0%A1%E9%AA%8C%0A%09%09sf+%3A%3D+sigfilter.New%28policies.ChannelReaders%2C+chain.PolicyManager%28%29%29%0A%09%09result%2C+_+%3A%3D+sf.Apply%28envelope%29%0A%09%09if+result+%21%3D+filter.Forward+%7B%0A%09%09%09logger.Warningf%28%22%5Bchannel%3A+%25s%5D+Received+unauthorized+deliver+request%22%2C+chdr.ChannelId%29%0A%09%09%09return+sendStatusReply%28srv%2C+cb.Status_FORBIDDEN%29%0A%09%09%7D%0A%09%09%2F%2F%E8%A7%A3%E6%9E%90%E8%AF%B7%E6%B1%82%E6%B6%88%E6%81%AF%E5%86%85%E5%AE%B9%0A%09%09seekInfo+%3A%3D+%26amp%3Bab.SeekInfo%7B%7D%0A%09%09if+err+%3D+proto.Unmarshal%28payload.Data%2C+seekInfo%29%3B+err+%21%3D+nil+%7B%0A%09%09%09logger.Warningf%28%22%5Bchannel%3A+%25s%5D+Received+a+signed+deliver+request+with+malformed+seekInfo+payload%3A+%25s%22%2C+chdr.ChannelId%2C+err%29%0A%09%09%09return+sendStatusReply%28srv%2C+cb.Status_BAD_REQUEST%29%0A%09%09%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cul%3E%0A+++%3Cli%3E%E5%9C%A8server.go%E4%B8%AD%E4%BC%9A%E9%81%87%E5%88%B0chain%E8%B0%83%E7%94%A8Manager%26nbsp%3B+%26nbsp%3B+Manage.go%3C%2Fli%3E+%0A++%3C%2Ful%3E%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3E%0Atype+Manager+interface+%7B%0A%09%2F%2F%E8%8E%B7%E5%8F%96%E9%93%BE%E5%AF%B9%E8%B1%A1%0A%09GetChain%28chainID+string%29+%28ChainSupport%2C+bool%29%0A%0A%09%2F%2F%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E9%93%BE%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%BC%95%E5%AF%BC%E5%85%B6%E4%BB%96%E9%93%BE%E7%9A%84%E7%94%9F%E6%88%90%0A%09SystemChannelID%28%29+string%0A%0A%09%2F%2F%E7%94%9F%E6%88%90%E6%88%96%E6%9B%B4%E6%96%B0%E9%93%BE%E7%9A%84%E9%85%8D%E7%BD%AE%0A%09NewChannelConfig%28envConfigUpdate+*cb.Envelope%29+%28configtxapi.Manager%2C+error%29%0A%7D%0A%0A%2F%2F%E9%85%8D%E7%BD%AE%E8%B5%84%E6%BA%90%0Atype+configResources+struct+%7B%0A%09configtxapi.Manager%0A%7D%0A%0A%2F%2F%E8%8E%B7%E5%8F%96orderer%E7%9B%B8%E5%85%B3%E7%9A%84%E9%85%8D%E7%BD%AE%0A%2F%2F%E7%82%B9%E8%BF%9BOrderer%E5%8F%AF%E4%BB%A5%E7%9C%8B%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%0Afunc+%28cr+*configResources%29+SharedConfig%28%29+config.Orderer+%7B%0A%09oc%2C+ok+%3A%3D+cr.OrdererConfig%28%29%0A%09if+%21ok+%7B%0A%09%09logger.Panicf%28%22%5Bchannel+%25s%5D+has+no+orderer+configuration%22%2C+cr.ChainID%28%29%29%0A%09%7D%0A%09return+oc%0A%7D%0A%0A%2F%2F%E5%AE%9A%E4%B9%89%E8%B4%A6%E6%9C%AC%E8%B5%84%E6%BA%90%0Atype+ledgerResources+struct+%7B%0A%09%2F%2F%E9%85%8D%E7%BD%AE%E8%B5%84%E6%BA%90%0A%09*configResources%0A%09%2F%2F%E8%B4%A6%E6%9C%AC%E7%9A%84%E8%AF%BB%E5%86%99%E5%AF%B9%E8%B1%A1%0A%09%2F%2F%E5%AF%B9%E8%B4%A6%E6%9C%AC%E6%93%8D%E4%BD%9C%E7%9A%84%E5%85%A5%E5%8F%A3%0A%09ledger+ledger.ReadWriter%0A%7D%0A%0A%2F%2Fmanager%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%B1%BB%0Atype+multiLedger+struct+%7B%0A%09%2F%2F%E9%93%BE%0A%09chains++++++++++map%5Bstring%5D*chainSupport%0A%09%2F%2F%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6%0A%09consenters++++++map%5Bstring%5DConsenter%0A%09%2F%2F%E8%B4%A6%E6%9C%AC%E8%AF%BB%E5%86%99%E5%B7%A5%E5%8E%82%0A%09ledgerFactory+++ledger.Factory%0A%09%2F%2F%E7%AD%BE%E5%90%8D%E5%AF%B9%E8%B1%A1%0A%09signer++++++++++crypto.LocalSigner%0A%09%2F%2F%E7%B3%BB%E7%BB%9F%E9%93%BE%E7%9A%84%E6%A0%87%E8%AF%86%0A%09systemChannelID+string%0A%09%2F%2F%E5%AE%9A%E4%B9%89%E7%B3%BB%E7%BB%9F%E9%93%BE%0A%09systemChannel+++*chainSupport%0A%7D%0A%0A%2F%2F%E8%8E%B7%E5%8F%96%E6%9F%90%E6%9D%A1%E9%93%BE%E6%9B%B4%E6%96%B0%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BA%A4%E6%98%93%0Afunc+getConfigTx%28reader+ledger.Reader%29+*cb.Envelope+%7B%0A%09%2F%2F%E8%8E%B7%E5%8F%96%E9%93%BE%E4%B8%8A%E6%9C%80%E6%96%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E5%8C%BA%E5%9D%97%0A%09lastBlock+%3A%3D+ledger.GetBlock%28reader%2C+reader.Height%28%29-1%29%0A%09%2F%2F%E6%A0%B9%E6%8D%AE%E6%9C%80%E6%96%B0%E7%9A%84%E5%8C%BA%E5%9D%97%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%89%BE%E5%88%B0%E6%9C%80%E6%96%B0%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BA%A4%E6%98%93%E7%9A%84%E5%8C%BA%E5%9D%97%0A%09index%2C+err+%3A%3D+utils.GetLastConfigIndexFromBlock%28lastBlock%29%0A%09if+err+%21%3D+nil+%7B%0A%09%09logger.Panicf%28%22Chain+did+not+have+appropriately+encoded+last+config+in+its+latest+block%3A+%25s%22%2C+err%29%0A%09%7D%0A%09%2F%2F%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E5%8C%BA%E5%9D%97%0A%09configBlock+%3A%3D+ledger.GetBlock%28reader%2C+index%29%0A%09if+configBlock+%3D%3D+nil+%7B%0A%09%09logger.Panicf%28%22Config+block+does+not+exist%22%29%0A%09%7D%0A%09%2F%2F%E8%AF%BB%E5%8F%96%E6%9C%80%E6%96%B0%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BA%A4%E6%98%93%0A%09return+utils.ExtractEnvelopeOrPanic%28configBlock%2C+0%29%0A%7D%0A%0A%2F%2Fmanager%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96%0Afunc+NewManagerImpl%28ledgerFactory+ledger.Factory%2C+consenters+map%5Bstring%5DConsenter%2C+signer+crypto.LocalSigner%29+Manager+%7B%0A%09%2F%2F%E6%8E%A5%E6%94%B6%E4%BC%A0%E6%9D%A5%E7%9A%84%E5%8F%82%E6%95%B0%0A%09%2F%2F%E7%9B%B4%E6%8E%A5%E8%B5%8B%E5%80%BC%EF%BC%8C%E4%B8%8A%E9%9D%A2%E5%AE%9A%E4%B9%89%E7%9A%84%0A%09ml+%3A%3D+%26amp%3BmultiLedger%7B%0A%09%09chains%3A++++++++make%28map%5Bstring%5D*chainSupport%29%2C%0A%09%09ledgerFactory%3A+ledgerFactory%2C%0A%09%09consenters%3A++++consenters%2C%0A%09%09signer%3A++++++++signer%2C%0A%09%7D%0A%0A%09%2F%2F%E8%AF%BB%E5%8F%96%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E7%9A%84%E9%93%BE%E7%9A%84ID%0A%09existingChains+%3A%3D+ledgerFactory.ChainIDs%28%29%0A%09%2F%2F%E5%BE%AA%E7%8E%AF%0A%09for+_%2C+chainID+%3A%3D+range+existingChains+%7B%0A%09%09%2F%2F%E6%A0%B9%E6%8D%AE%E8%B4%A6%E6%9C%AC%E5%B7%A5%E5%8E%82%E5%AE%9E%E4%BE%8B%E5%8C%96%E8%B4%A6%E6%9C%AC%E8%AF%BB%E7%9A%84%E5%AF%B9%E8%B1%A1%0A%09%09%2F%2Frl%EF%BC%9Aread+ledger%0A%09%09rl%2C+err+%3A%3D+ledgerFactory.GetOrCreate%28chainID%29%0A%09%09if+err+%21%3D+nil+%7B%0A%09%09%09logger.Panicf%28%22Ledger+factory+reported+chainID+%25s+but+could+not+retrieve+it%3A+%25s%22%2C+chainID%2C+err%29%0A%09%09%7D%0A%09%09%2F%2F%E8%8E%B7%E5%8F%96%E6%9C%80%E6%96%B0%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BA%A4%E6%98%93%0A%09%09configTx+%3A%3D+getConfigTx%28rl%29%0A%09%09if+configTx+%3D%3D+nil+%7B%0A%09%09%09logger.Panic%28%22Programming+error%2C+configTx+should+never+be+nil+here%22%29%0A%09%09%7D%0A%09%09%2F%2F%E5%B0%86%E9%85%8D%E7%BD%AE%E4%BA%A4%E6%98%93%E5%92%8Cledger%E5%AF%B9%E8%B1%A1%E7%BB%91%E5%AE%9A%0A%09%09ledgerResources+%3A%3D+ml.newLedgerResources%28configTx%29%0A%09%09chainID+%3A%3D+ledgerResources.ChainID%28%29%0A%0A%09%09%2F%2F%E8%AF%BB%E5%8F%96%E9%93%BE%E6%98%AF%E5%90%A6%E6%9C%89%E8%81%94%E7%9B%9F%E9%85%8D%E7%BD%AE%0A%09%09%2F%2F%E8%81%94%E7%9B%9F%E9%85%8D%E7%BD%AE%EF%BC%9A%E6%98%AF%E5%90%A6%E6%9C%89%E5%88%9B%E5%BB%BA%E5%85%B6%E4%BB%96%E9%93%BE%E7%9A%84%E6%9D%83%E9%99%90%0A%09%09%2F%2F%E4%B8%80%E8%88%AC%E5%8F%AA%E6%9C%89%E7%B3%BB%E7%BB%9F%E9%93%BE%E6%9C%89%E8%81%94%E7%9B%9F%E9%85%8D%E7%BD%AE%0A%09%09if+_%2C+ok+%3A%3D+ledgerResources.ConsortiumsConfig%28%29%3B+ok+%7B%0A%09%09%09%2F%2F%E6%9C%89%E8%81%94%E7%9B%9F%E9%85%8D%E7%BD%AE%0A%09%09%09if+ml.systemChannelID+%21%3D+%22%22+%7B%0A%09%09%09%09%2F%2F%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%E7%B3%BB%E7%BB%9F%E9%93%BE%EF%BC%8C%E6%8A%A5%E9%94%99%0A%09%09%09%09logger.Panicf%28%22There+appear+to+be+two+system+chains+%25s+and+%25s%22%2C+ml.systemChannelID%2C+chainID%29%0A%09%09%09%7D%0A%09%09%09%2F%2F%E5%AE%9E%E4%BE%8B%E5%8C%96ChainSupport%EF%BC%8C%E4%BE%9D%E6%AC%A1%E8%B5%8B%E5%80%BC%0A%09%09%09chain+%3A%3D+newChainSupport%28createSystemChainFilters%28ml%2C+ledgerResources%29%2C%0A%09%09%09%09ledgerResources%2C%0A%09%09%09%09consenters%2C%0A%09%09%09%09signer%29%0A%09%09%09logger.Infof%28%22Starting+with+system+channel+%25s+and+orderer+type+%25s%22%2C+chainID%2C+chain.SharedConfig%28%29.ConsensusType%28%29%29%0A%09%09%09ml.chains%5BchainID%5D+%3D+chain%0A%09%09%09ml.systemChannelID+%3D+chainID%0A%09%09%09ml.systemChannel+%3D+chain%0A%09%09%09%2F%2F+We+delay+starting+this+chain%2C+as+it+might+try+to+copy+and+replace+the+chains+map+via+newChain+before+the+map+is+fully+built%0A%09%09%09%2F%2F%E5%BB%B6%E8%BF%9F%E5%90%AF%E5%8A%A8%0A%09%09%09%2F%2F%E5%85%B6%E4%BB%96%E9%93%BE%E5%AE%8C%E6%88%90%E5%90%8E%EF%BC%8C%E5%90%AF%E5%8A%A8%E7%B3%BB%E7%BB%9F%E9%93%BE%0A%09%09%09defer+chain.start%28%29%0A%09%09%7D+else+%7B%0A%09%09%09logger.Debugf%28%22Starting+chain%3A+%25s%22%2C+chainID%29%0A%09%09%09chain+%3A%3D+newChainSupport%28createStandardFilters%28ledgerResources%29%2C%0A%09%09%09%09ledgerResources%2C%0A%09%09%09%09consenters%2C%0A%09%09%09%09signer%29%0A%09%09%09%2F%2F%E5%88%9B%E5%BB%BA%E6%A0%87%E5%87%86%E9%93%BE%0A%09%09%09ml.chains%5BchainID%5D+%3D+chain%0A%09%09%09%2F%2F%E5%90%AF%E5%8A%A8%0A%09%09%09chain.start%28%29%0A%09%09%7D%0A%0A%09%7D%0A%09%2F%2F%E7%B3%BB%E7%BB%9F%E9%93%BE%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%88%99%E6%8A%A5%E9%94%99%0A%09if+ml.systemChannelID+%3D%3D+%22%22+%7B%0A%09%09logger.Panicf%28%22No+system+chain+found.++If+bootstrapping%2C+does+your+system+channel+contain+a+consortiums+group+definition%3F%22%29%0A%09%7D%0A%09%2F%2F%E8%BF%94%E5%9B%9Eml%0A%09return+ml%0A%7D%0A%0A%2F%2F%E8%BF%94%E5%9B%9E%E7%B3%BB%E7%BB%9F%E9%93%BEid%0Afunc+%28ml+*multiLedger%29+SystemChannelID%28%29+string+%7B%0A%09return+ml.systemChannelID%0A%7D%0A%0A%2F%2F+GetChain+retrieves+the+chain+support+for+a+chain+%28and+whether+it+exists%29%0A%2F%2F%E5%BE%97%E5%88%B0%E9%93%BE%0Afunc+%28ml+*multiLedger%29+GetChain%28chainID+string%29+%28ChainSupport%2C+bool%29+%7B%0A%09cs%2C+ok+%3A%3D+ml.chains%5BchainID%5D%0A%09return+cs%2C+ok%0A%7D%0A%0A%2F%2F%E5%AE%9E%E4%BE%8B%E5%8C%96%E4%B8%80%E4%B8%AA%E8%B4%A6%E6%9C%AC%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%0Afunc+%28ml+*multiLedger%29+newLedgerResources%28configTx+*cb.Envelope%29+*ledgerResources+%7B%0A%09%2F%2F%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE%E4%BA%A4%E6%98%93%0A%09initializer+%3A%3D+configtx.NewInitializer%28%29%0A%09%2F%2F%E7%94%9F%E6%88%90%E9%85%8D%E7%BD%AEmanager%0A%09configManager%2C+err+%3A%3D+configtx.NewManagerImpl%28configTx%2C+initializer%2C+nil%29%0A%09if+err+%21%3D+nil+%7B%0A%09%09logger.Panicf%28%22Error+creating+configtx+manager+and+handlers%3A+%25s%22%2C+err%29%0A%09%7D%0A%09%2F%2F%E5%BE%97%E5%88%B0chainID%0A%09chainID+%3A%3D+configManager.ChainID%28%29%0A%09%2F%2F%E6%A0%B9%E6%8D%AEchainID%EF%BC%8C%E5%AE%9E%E4%BE%8B%E5%8C%96%E8%B4%A6%E6%9C%AC%E5%AF%B9%E8%B1%A1%0A%09ledger%2C+err+%3A%3D+ml.ledgerFactory.GetOrCreate%28chainID%29%0A%09if+err+%21%3D+nil+%7B%0A%09%09logger.Panicf%28%22Error+getting+ledger+for+%25s%22%2C+chainID%29%0A%09%7D%0A%09%2F%2F%E6%9C%80%E7%BB%88%E8%BF%94%E5%9B%9E%E8%B5%8B%E5%80%BC%E5%90%8E%E7%9A%84%E8%B4%A6%E6%9C%AC%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%0A%09return+%26amp%3BledgerResources%7B%0A%09%09configResources%3A+%26amp%3BconfigResources%7BManager%3A+configManager%7D%2C%0A%09%09ledger%3A++++++++++ledger%2C%0A%09%7D%0A%7D%0A%0A%2F%2F%E7%94%9F%E6%88%90%E4%B8%80%E6%9D%A1%E6%96%B0%E9%93%BE%0Afunc+%28ml+*multiLedger%29+newChain%28configtx+*cb.Envelope%29+%7B%0A%09%2F%2F%E5%88%9B%E5%BB%BA%E8%B4%A6%E6%9C%AC%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%0A%09ledgerResources+%3A%3D+ml.newLedgerResources%28configtx%29%0A%09%2F%2F%E7%BB%84%E8%A3%85%E5%8C%BA%E5%9D%97%EF%BC%8C%E9%80%9A%E8%BF%87Append%E5%8A%A0%E5%88%B0%E9%93%BE%E4%B8%8A%0A%09ledgerResources.ledger.Append%28ledger.CreateNextBlock%28ledgerResources.ledger%2C+%5B%5D*cb.Envelope%7Bconfigtx%7D%29%29%0A%0A%09%2F%2F+Copy+the+map+to+allow+concurrent+reads+from+broadcast%2Fdeliver+while+the+new+chainSupport+is%0A%09%2F%2F%E5%BE%97%E5%88%B0%E6%96%B0%E7%9A%84%E9%93%BE%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%8A%A0%E9%94%81%0A%09newChains+%3A%3D+make%28map%5Bstring%5D*chainSupport%29%0A%09for+key%2C+value+%3A%3D+range+ml.chains+%7B%0A%09%09newChains%5Bkey%5D+%3D+value%0A%09%7D%0A%0A%09cs+%3A%3D+newChainSupport%28createStandardFilters%28ledgerResources%29%2C+ledgerResources%2C+ml.consenters%2C+ml.signer%29%0A%09chainID+%3A%3D+ledgerResources.ChainID%28%29%0A%0A%09logger.Infof%28%22Created+and+starting+new+chain+%25s%22%2C+chainID%29%0A%0A%09newChains%5Bstring%28chainID%29%5D+%3D+cs%0A%09cs.start%28%29%0A%0A%09ml.chains+%3D+newChains%0A%7D%0A%0Afunc+%28ml+*multiLedger%29+channelsCount%28%29+int+%7B%0A%09return+len%28ml.chains%29%0A%7D%0A%0A%2F%2F%E7%94%9F%E6%88%90%E6%96%B0%E7%9A%84%E9%93%BE%E7%9A%84%E9%85%8D%E7%BD%AE%0Afunc+%28ml+*multiLedger%29+NewChannelConfig%28envConfigUpdate+*cb.Envelope%29+%28configtxapi.Manager%2C+error%29+%7B%0A%0A%09%2F%2F%E4%B8%8B%E9%9D%A2%E6%98%AF%E7%94%9F%E6%88%90%E6%96%B0%E9%93%BE%E5%89%8D%EF%BC%8C%E5%81%9A%E5%90%84%E7%A7%8D%E6%A0%A1%E9%AA%8C%0A%09configUpdatePayload%2C+err+%3A%3D+utils.UnmarshalPayload%28envConfigUpdate.Payload%29%0A%09if+err+%21%3D+nil+%7B%0A%09%09return+nil%2C+fmt.Errorf%28%22Failing+initial+channel+config+creation+because+of+payload+unmarshaling+error%3A+%25s%22%2C+err%29%0A%09%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cul%3E%0A+++%3Cli%3E%E6%8E%A5%E4%B8%8B%E6%9D%A5%E7%9C%8Bchainsupport.go%3C%2Fli%3E+%0A++%3C%2Ful%3E%0A++%3Cp+style%3D%22text-align%3Acenter%3B%22%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+height%3D%22124%22+src%3D%22https%3A%2F%2Fimg-blog.csdnimg.cn%2F20181107181323872.jpeg%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1cGVyX2xpeGlhbmc%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70%22+width%3D%22451%22%3E%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3E%2F%2F%E5%AE%9A%E4%B9%89%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6%E7%9A%84%E6%8E%A5%E5%8F%A3%0Atype+ConsenterSupport+interface+%7B%0A%09%2F%2F%E6%9C%AC%E5%9C%B0%E7%AD%BE%E5%90%8D%0A%09crypto.LocalSigner%0A%09%2F%2F%E5%8C%BA%E5%9D%97%E5%88%87%E5%89%B2%E5%AF%B9%E8%B1%A1%0A%09BlockCutter%28%29+blockcutter.Receiver%0A%09%2F%2F%E9%85%8D%E7%BD%AE%0A%09SharedConfig%28%29+config.Orderer%0A%09%2F%2F%E5%88%87%E5%89%B2%E5%A5%BD%E7%9A%84%E4%BA%A4%E6%98%93%E6%89%93%E5%8C%85%E6%88%90%E5%8C%BA%E5%9D%97%0A%09CreateNextBlock%28messages+%5B%5D*cb.Envelope%29+*cb.Block%0A%09%2F%2F%E5%B0%86%E5%8C%BA%E5%9D%97%E5%86%99%E5%85%A5%0A%09WriteBlock%28block+*cb.Block%2C+committers+%5B%5Dfilter.Committer%2C+encodedMetadataValue+%5B%5Dbyte%29+*cb.Block%0A%09%2F%2F%E8%8E%B7%E5%8F%96%E9%93%BE%E7%9A%84ID%0A%09ChainID%28%29+string+%0A%09%2F%2F%E8%8E%B7%E5%8F%96%E9%93%BE%E5%BD%93%E5%89%8D%E7%9A%84%E5%8C%BA%E5%9D%97%E9%AB%98%E5%BA%A6%0A%09Height%28%29+uint64++%2F%2F+Returns+the+number+of+blocks+on+the+chain+this+specific+consenter+instance+is+associated+with%0A%7D%0A%0Atype+ChainSupport+interface+%7B%0A%09%2F%2F%E8%83%8C%E4%B9%A6%E7%AD%96%E7%95%A5%0A%09PolicyManager%28%29+policies.Manager%0A%0A%09%2F%2F%E8%AF%BB%E5%8F%96%E8%B4%A6%E6%9C%AC%E7%9A%84%E6%8E%A5%E5%8F%A3%0A%09Reader%28%29+ledger.Reader%0A%0A%09%2F%2F%E5%A4%84%E7%90%86%E8%B4%A6%E6%9C%AC%E7%9A%84%E9%94%99%E8%AF%AF%0A%09Errored%28%29+%26lt%3B-chan+struct%7B%7D%0A%0A%09%2F%2F%E5%A4%84%E7%90%86%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%9A%84%E6%8E%A5%E5%8F%A3%0A%09broadcast.Support%0A%09%2F%2F%E5%AE%9A%E4%B9%89%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6%E7%9A%84%E6%8E%A5%E5%8F%A3%0A%09ConsenterSupport%0A%0A%09%2F%2F%E5%BA%8F%E5%88%97%0A%09%2F%2F%E6%AF%8F%E6%AC%A1%E5%AF%B9%E9%93%BE%E8%BF%9B%E8%A1%8C%E4%BF%AE%E6%94%B9%EF%BC%8CSequence%E6%98%AF%E5%8A%A01%E7%9A%84%0A%09Sequence%28%29+uint64%0A%0A%09%2F%2F%E5%B0%86%E4%B8%80%E4%B8%AA%E4%BA%A4%E6%98%93%E8%BD%AC%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%BA%A4%E6%98%93%0A%09%2F%2FEnvelope%EF%BC%9A%E5%8F%AF%E4%BB%A5%E7%90%86%E8%A7%A3%E4%B8%BA%E4%BA%A4%E6%98%93%0A%09ProposeConfigUpdate%28env+*cb.Envelope%29+%28*cb.ConfigEnvelope%2C+error%29%0A%7D%0A%0Atype+chainSupport+struct+%7B%0A%09%2F%2F%E9%93%BE%E7%9A%84%E8%B5%84%E6%BA%90%E4%BF%A1%E6%81%AF%EF%BC%8C%E9%93%BE%E7%9A%84%E9%85%8D%E7%BD%AE%E5%92%8C%E8%B4%A6%E6%9C%AC%E8%AF%BB%E5%86%99%E5%AF%B9%E8%B1%A1%0A%09*ledgerResources%0A%09%2F%2F%E9%93%BE%0A%09chain+++++++++Chain%0A%09%2F%2F%E5%8C%BA%E5%9D%97%E5%88%87%E5%89%B2%0A%09cutter++++++++blockcutter.Receiver%0A%09%2F%2F%E8%BF%87%E6%BB%A4%E5%99%A8%0A%09%2F%2Forderer%E8%BF%87%E6%BB%A4%E4%B8%80%E4%BA%9B%E4%BA%A4%E6%98%93%E4%B8%BA%E7%A9%BA%E7%9A%84%E6%95%B0%E6%8D%AE%0A%09filters+++++++*filter.RuleSet%0A%09%2F%2F%E7%AD%BE%E5%90%8D%0A%09signer++++++++crypto.LocalSigner%0A%09%2F%2F%E6%9C%80%E6%96%B0%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E6%89%80%E5%9C%A8%E7%9A%84%E5%8C%BA%E5%9D%97%E9%AB%98%E5%BA%A6%0A%09lastConfig++++uint64%0A%09%2F%2F%E6%9C%80%E6%96%B0%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E6%89%80%E5%9C%A8%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%0A%09lastConfigSeq+uint64%0A%7D%0A%0Afunc+newChainSupport%28%0A%09filters+*filter.RuleSet%2C%0A%09ledgerResources+*ledgerResources%2C%0A%09consenters+map%5Bstring%5DConsenter%2C%0A%09signer+crypto.LocalSigner%2C%0A%29+*chainSupport+%7B%0A%09%2F%2F%E5%88%9B%E5%BB%BA%E5%8C%BA%E5%9D%97%E5%88%87%E5%89%B2%E5%AF%B9%E8%B1%A1%0A%09cutter+%3A%3D+blockcutter.NewReceiverImpl%28ledgerResources.SharedConfig%28%29%2C+filters%29%0A%09%2F%2F%E6%A0%B9%E6%8D%AE%E9%85%8D%E7%BD%AE%E6%9F%A5%E8%AF%A2orderer%E4%BD%BF%E7%94%A8%E7%9A%84%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6%0A%09consenterType+%3A%3D+ledgerResources.SharedConfig%28%29.ConsensusType%28%29%0A%09%2F%2F%E5%BE%97%E5%88%B0%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6%0A%09consenter%2C+ok+%3A%3D+consenters%5BconsenterType%5D%0A%09if+%21ok+%7B%0A%09%09logger.Fatalf%28%22Error+retrieving+consenter+of+type%3A+%25s%22%2C+consenterType%29%0A%09%7D%0A%0A%09%2F%2F%E8%B5%8B%E5%80%BC%0A%09cs+%3A%3D+%26amp%3BchainSupport%7B%0A%09%09ledgerResources%3A+ledgerResources%2C%0A%09%09cutter%3A++++++++++cutter%2C%0A%09%09filters%3A+++++++++filters%2C%0A%09%09signer%3A++++++++++signer%2C%0A%09%7D%0A%09%2F%2F%E5%BA%8F%E5%88%97%E5%8F%B7%0A%09cs.lastConfigSeq+%3D+cs.Sequence%28%29%0A%0A%09var+err+error%0A%09%2F%2F%E6%9C%80%E6%96%B0%E5%8C%BA%E5%9D%97%0A%09lastBlock+%3A%3D+ledger.GetBlock%28cs.Reader%28%29%2C+cs.Reader%28%29.Height%28%29-1%29%0A%0A%09if+lastBlock.Header.Number+%21%3D+0+%7B%0A%09%09%2F%2F%E8%8E%B7%E5%8F%96%E6%9C%80%E6%96%B0%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E6%89%80%E5%9C%A8%E7%9A%84%E5%8C%BA%E5%9D%97%E9%AB%98%E5%BA%A6%0A%09%09cs.lastConfig%2C+err+%3D+utils.GetLastConfigIndexFromBlock%28lastBlock%29%0A%09%09if+err+%21%3D+nil+%7B%0A%09%09%09logger.Fatalf%28%22%5Bchannel%3A+%25s%5D+Error+extracting+last+config+block+from+block+metadata%3A+%25s%22%2C+cs.ChainID%28%29%2C+err%29%0A%09%09%7D%0A%09%7D%0A%09%2F%2F%E8%8E%B7%E5%8F%96%E5%8C%BA%E5%9D%97%E5%85%83%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF%0A%09metadata%2C+err+%3A%3D+utils.GetMetadataFromBlock%28lastBlock%2C+cb.BlockMetadataIndex_ORDERER%29%0A%09if+err+%21%3D+nil+%7B%0A%09%09logger.Fatalf%28%22%5Bchannel%3A+%25s%5D+Error+extracting+orderer+metadata%3A+%25s%22%2C+cs.ChainID%28%29%2C+err%29%0A%09%7D%0A%09logger.Debugf%28%22%5Bchannel%3A+%25s%5D+Retrieved+metadata+for+tip+of+chain+%28blockNumber%3D%25d%2C+lastConfig%3D%25d%2C+lastConfigSeq%3D%25d%29%3A+%25%2Bv%22%2C+cs.ChainID%28%29%2C+lastBlock.Header.Number%2C+cs.lastConfig%2C+cs.lastConfigSeq%2C+metadata%29%0A%09%2F%2F%E7%94%A8%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6%E6%93%8D%E4%BD%9CChain%0A%09cs.chain%2C+err+%3D+consenter.HandleChain%28cs%2C+metadata%29%0A%09if+err+%21%3D+nil+%7B%0A%09%09logger.Fatalf%28%22%5Bchannel%3A+%25s%5D+Error+creating+consenter%3A+%25s%22%2C+cs.ChainID%28%29%2C+err%29%0A%09%7D%0A%0A%09return+cs%0A%7D%0A%0A%2F%2F%E5%AE%9E%E4%BE%8B%E5%8C%96%E8%BF%87%E6%BB%A4%E5%99%A8%0Afunc+createStandardFilters%28ledgerResources+*ledgerResources%29+*filter.RuleSet+%7B%0A%09return+filter.NewRuleSet%28%5B%5Dfilter.Rule%7B%0A%09%09filter.EmptyRejectRule%2C%0A%09%09sizefilter.MaxBytesRule%28ledgerResources.SharedConfig%28%29%29%2C%0A%09%09sigfilter.New%28policies.ChannelWriters%2C+ledgerResources.PolicyManager%28%29%29%2C%0A%09%09configtxfilter.NewFilter%28ledgerResources%29%2C%0A%09%09filter.AcceptRule%2C%0A%09%7D%29%0A%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Efunc+%28cs+*chainSupport%29+WriteBlock%28block+*cb.Block%2C+committers+%5B%5Dfilter.Committer%2C+encodedMetadataValue+%5B%5Dbyte%29+*cb.Block+%7B%0A%09%2F%2F%E9%81%8D%E5%8E%86%E6%89%80%E6%9C%89%E6%8F%90%E4%BA%A4%E7%9A%84%E4%BA%A4%E6%98%93%0A%09for+_%2C+committer+%3A%3D+range+committers+%7B%0A%09%09committer.Commit%28%29%0A%09%7D%0A%09%2F%2F+Set+the+orderer-related+metadata+field%0A%09%2F%2F%E5%88%A4%E6%96%AD%E5%85%83%E6%95%B0%E6%8D%AE%0A%09if+encodedMetadataValue+%21%3D+nil+%7B%0A%09%09block.Metadata.Metadata%5Bcb.BlockMetadataIndex_ORDERER%5D+%3D+utils.MarshalOrPanic%28%26amp%3Bcb.Metadata%7BValue%3A+encodedMetadataValue%7D%29%0A%09%7D%0A%09%2F%2F%E8%BF%9B%E8%A1%8C%E5%8C%BA%E5%9D%97%E7%AD%BE%E5%90%8D%0A%09cs.addBlockSignature%28block%29%0A%09%2F%2F%E9%85%8D%E7%BD%AE%E7%AD%BE%E5%90%8D%0A%09cs.addLastConfigSignature%28block%29%0A%0A%09%2F%2F%E5%B0%86%E5%8C%BA%E5%9D%97%E5%86%99%E5%85%A5%E8%B4%A6%E6%9C%AC%E4%B8%AD%0A%09err+%3A%3D+cs.ledger.Append%28block%29%0A%09if+err+%21%3D+nil+%7B%0A%09%09logger.Panicf%28%22%5Bchannel%3A+%25s%5D+Could+not+append+block%3A+%25s%22%2C+cs.ChainID%28%29%2C+err%29%0A%09%7D%0A%09logger.Debugf%28%22%5Bchannel%3A+%25s%5D+Wrote+block+%25d%22%2C+cs.ChainID%28%29%2C+block.GetHeader%28%29.Number%29%0A%0A%09return+block%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cul%3E%0A+++%3Cli%3E%E7%82%B9Receiver%E8%BF%9B%E5%8E%BB%EF%BC%8C%E7%9C%8B%E5%8C%BA%E5%9D%97%E5%88%87%E5%89%B2%EF%BC%8C%E5%9C%A8blockcutter.go%E4%B8%AD%EF%BC%9A%3C%2Fli%3E+%0A++%3C%2Ful%3E%0A++%3Cp+style%3D%22text-align%3Acenter%3B%22%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+height%3D%22167%22+src%3D%22https%3A%2F%2Fimg-blog.csdnimg.cn%2F20181107181600448.jpeg%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1cGVyX2xpeGlhbmc%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70%22+width%3D%22416%22%3E%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Efunc+%28r+*receiver%29+Ordered%28msg+*cb.Envelope%29+%28messageBatches+%5B%5D%5B%5D*cb.Envelope%2C+committerBatches+%5B%5D%5B%5Dfilter.Committer%2C+validTx+bool%2C+pending+bool%29+%7B%0A%09%2F%2F%E5%B0%86%E4%BA%A4%E6%98%93%E4%BF%A1%E6%81%AF%E5%86%8D%E6%AC%A1%E8%BF%87%E6%BB%A4%0A%09%2F%2F%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%BF%87%E6%BB%A4%E6%98%AForderer%E6%8E%A5%E6%94%B6%E5%88%B0%E4%BA%A4%E6%98%93%E8%AF%B7%E6%B1%82%E6%97%B6%0A%09committer%2C+err+%3A%3D+r.filters.Apply%28msg%29%0A%09if+err+%21%3D+nil+%7B%0A%09%09logger.Debugf%28%22Rejecting+message%3A+%25s%22%2C+err%29%0A%09%09return+%2F%2F+We+don%27t+bother+to+determine+%60pending%60+here+as+it%27s+not+processed+in+error+case%0A%09%7D%0A%0A%09%2F%2F+message+is+valid%0A%09%2F%2F%E5%B0%86%E4%BA%A4%E6%98%93%E6%A0%87%E8%AE%B0%E4%B8%BA%E6%9C%89%E6%95%88%0A%09validTx+%3D+true%0A%0A%09%2F%2F%E8%AE%A1%E7%AE%97%E4%BA%A4%E6%98%93%E4%BD%93%E7%9A%84%E5%A4%A7%E5%B0%8F%0A%09messageSizeBytes+%3A%3D+messageSizeBytes%28msg%29%0A%0A%09%2F%2F%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E4%BA%A4%E6%98%93%E9%9A%94%E7%A6%BB%EF%BC%8C%E9%85%8D%E7%BD%AE%E4%BA%A4%E6%98%93%E8%BF%9B%E8%A1%8C%E9%9A%94%E7%A6%BB%0A%09%2F%2F%E4%BA%A4%E6%98%93%E4%BD%93%E7%9A%84%E5%A4%A7%E5%B0%8F%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%AF%94%E6%9C%80%E5%A4%A7%E4%BA%A4%E6%98%93%E4%BD%93%E5%A4%A7%E5%B0%8F%E5%A4%A7%EF%BC%8C%E8%AE%A4%E4%B8%BA%E4%BA%A4%E6%98%93%E5%86%85%E5%AE%B9%E8%BF%87%E5%A4%A7%EF%BC%8C%E8%BF%9B%E8%A1%8C%E5%8D%95%E7%8B%AC%E5%88%87%E5%9D%97%0A%09if+committer.Isolated%28%29+%7C%7C+messageSizeBytes+%26gt%3B+r.sharedConfigManager.BatchSize%28%29.PreferredMaxBytes+%7B%0A%0A%09%09if+committer.Isolated%28%29+%7B%0A%09%09%09logger.Debugf%28%22Found+message+which+requested+to+be+isolated%2C+cutting+into+its+own+batch%22%29%0A%09%09%7D+else+%7B%0A%09%09%09logger.Debugf%28%22The+current+message%2C+with+%25v+bytes%2C+is+larger+than+the+preferred+batch+size+of+%25v+bytes+and+will+be+isolated.%22%2C+messageSizeBytes%2C+r.sharedConfigManager.BatchSize%28%29.PreferredMaxBytes%29%0A%09%09%7D%0A%0A%09%09%2F%2F%E8%8B%A5%E5%AD%98%E5%9C%A8%E6%AF%8F%E8%A2%AB%E4%B8%83%E4%B8%AA%E7%9A%84%E4%BA%A4%E6%98%93%0A%09%09%2F%2F%E5%B0%86%E6%9C%AA%E8%A2%AB%E5%88%87%E5%89%B2%E7%9A%84%E4%BA%A4%E6%98%93%E5%AD%98%E6%94%BE%E5%88%B0%E5%8C%BA%E5%9D%97%0A%09%09if+len%28r.pendingBatch%29+%26gt%3B+0+%7B%0A%09%09%09messageBatch%2C+committerBatch+%3A%3D+r.Cut%28%29%0A%09%09%09messageBatches+%3D+append%28messageBatches%2C+messageBatch%29%0A%09%09%09committerBatches+%3D+append%28committerBatches%2C+committerBatch%29%0A%09%09%7D%0A%0A%09%09%2F%2F%E5%8D%95%E7%8B%AC%E5%88%87%E5%89%B2%E5%BD%93%E5%89%8D%E4%BA%A4%E6%98%93%0A%09%09messageBatches+%3D+append%28messageBatches%2C+%5B%5D*cb.Envelope%7Bmsg%7D%29%0A%09%09committerBatches+%3D+append%28committerBatches%2C+%5B%5Dfilter.Committer%7Bcommitter%7D%29%0A%0A%09%09return%0A%09%7D%0A%09%2F%2F%E4%B8%8D%E9%9A%94%E7%A6%BB%E7%9A%84%E4%BA%A4%E6%98%93%EF%BC%8C%E8%BF%99%E9%87%8C%E5%A4%84%E7%90%86%0A%09%2F%2F%E5%88%A4%E6%96%AD%E5%8A%A0%E4%B8%8A%E5%BD%93%E5%89%8D%E4%BA%A4%E6%98%93%E5%90%8E%EF%BC%8C%E5%8C%BA%E5%9D%97%E5%A4%A7%E5%B0%8F%E6%98%AF%E5%90%A6%E8%B6%85%E5%87%BA%E9%A2%84%E5%85%88%E8%AE%BE%E5%AE%9A%E7%9A%84%E5%A4%A7%E5%B0%8F%0A%09messageWillOverflowBatchSizeBytes+%3A%3D+r.pendingBatchSizeBytes%2BmessageSizeBytes+%26gt%3B+r.sharedConfigManager.BatchSize%28%29.PreferredMaxBytes%0A%0A%09%2F%2F%E5%A6%82%E6%9E%9C%E8%B6%85%E5%87%BA%E4%BA%86%E9%A2%84%E5%AE%9A%E5%A4%A7%E5%B0%8F%EF%BC%8C%E8%BF%9B%E5%85%A5if%0A%09if+messageWillOverflowBatchSizeBytes+%7B%0A%09%09logger.Debugf%28%22The+current+message%2C+with+%25v+bytes%2C+will+overflow+the+pending+batch+of+%25v+bytes.%22%2C+messageSizeBytes%2C+r.pendingBatchSizeBytes%29%0A%09%09logger.Debugf%28%22Pending+batch+would+overflow+if+current+message+is+added%2C+cutting+batch+now.%22%29%0A%09%09%2F%2F%E8%BF%9B%E8%A1%8C%E5%88%87%E5%89%B2%0A%09%09messageBatch%2C+committerBatch+%3A%3D+r.Cut%28%29%0A%09%09messageBatches+%3D+append%28messageBatches%2C+messageBatch%29%0A%09%09committerBatches+%3D+append%28committerBatches%2C+committerBatch%29%0A%09%7D%0A%0A%09logger.Debugf%28%22Enqueuing+message+into+batch%22%29%0A%09r.pendingBatch+%3D+append%28r.pendingBatch%2C+msg%29%0A%09r.pendingBatchSizeBytes+%2B%3D+messageSizeBytes%0A%09r.pendingCommitters+%3D+append%28r.pendingCommitters%2C+committer%29%0A%09pending+%3D+true%0A%0A%09%2F%2F%E8%8B%A5%E5%8C%BA%E5%9D%97%E9%98%9F%E5%88%97%E8%B6%85%E5%87%BA%E9%98%88%E5%80%BC%E8%8C%83%E5%9B%B4%EF%BC%8C%E8%BF%9B%E8%A1%8C%E5%88%87%E5%89%B2%0A%09if+uint32%28len%28r.pendingBatch%29%29+%26gt%3B%3D+r.sharedConfigManager.BatchSize%28%29.MaxMessageCount+%7B%0A%09%09logger.Debugf%28%22Batch+size+met%2C+cutting+batch%22%29%0A%09%09messageBatch%2C+committerBatch+%3A%3D+r.Cut%28%29%0A%09%09messageBatches+%3D+append%28messageBatches%2C+messageBatch%29%0A%09%09committerBatches+%3D+append%28committerBatches%2C+committerBatch%29%0A%09%09pending+%3D+false%0A%09%7D%0A%0A%09return%0A%7D%0A%0A%2F%2F%E5%AE%8C%E6%88%90%E5%88%87%E5%89%B2%E8%BF%99%E4%B8%AA%E5%8A%A8%E4%BD%9C%0Afunc+%28r+*receiver%29+Cut%28%29+%28%5B%5D*cb.Envelope%2C+%5B%5Dfilter.Committer%29+%7B%0A%09batch+%3A%3D+r.pendingBatch%0A%09r.pendingBatch+%3D+nil%0A%09committers+%3A%3D+r.pendingCommitters%0A%09r.pendingCommitters+%3D+nil%0A%09r.pendingBatchSizeBytes+%3D+0%0A%09return+batch%2C+committers%0A%7D%0A%0Afunc+messageSizeBytes%28message+*cb.Envelope%29+uint32+%7B%0A%09%2F%2F%E5%B0%86%E6%B6%88%E6%81%AF%E4%BD%93%E5%92%8C%E7%AD%BE%E5%90%8D%E5%8A%A0%E8%B5%B7%E6%9D%A5%E6%B1%82%E9%95%BF%E5%BA%A6%0A%09return+uint32%28len%28message.Payload%29+%2B+len%28message.Signature%29%29%0A%7D%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cul%3E%0A+++%3Cli%3E%E5%9C%A8consensus.go%E4%B8%AD%E6%98%AF%E5%85%B1%E8%AF%86%EF%BC%9A%3C%2Fli%3E+%0A++%3C%2Ful%3E%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-Go%22%3Efunc+%28ch+*chain%29+main%28%29+%7B%0A%09%2F%2F%E5%AE%9A%E4%B9%89%E5%AE%9A%E6%97%B6%E5%99%A8%0A%09var+timer+%26lt%3B-chan+time.Time%0A%09%2F%2F%E5%BE%AA%E7%8E%AF%0A%09for+%7B%0A%09%09select+%7B%0A%09%09%2F%2F%E4%B8%8D%E5%81%9C%E7%9A%84%E4%BB%8E%E4%BA%A4%E6%98%93%E7%9A%84channel%E4%B8%AD%E8%8E%B7%E5%8F%96%E4%BA%A4%E6%98%93%0A%09%09%2F%2F%E5%B0%86%E8%8E%B7%E5%8F%96%E5%88%B0%E7%9A%84%E4%BA%A4%E6%98%93%EF%BC%8C%E5%8F%91%E9%80%81%E7%BB%99%E5%8C%BA%E5%9D%97%E5%88%87%E5%89%B2%E5%AF%B9%E8%B1%A1%0A%09%09%2F%2F%E8%BF%94%E5%9B%9E%E9%9C%80%E8%A6%81%E5%88%87%E5%89%B2%E7%9A%84%E5%8C%BA%E5%9D%97%0A%09%09case+msg+%3A%3D+%26lt%3B-ch.sendChan%3A%0A%09%09%09%2F%2F%E5%8C%BA%E5%9D%97%E5%88%87%E5%89%B2%0A%09%09%09batches%2C+committers%2C+ok%2C+_+%3A%3D+ch.support.BlockCutter%28%29.Ordered%28msg%29%0A%09%09%09%2F%2F%E5%88%A4%E6%96%AD%E4%BA%A4%E6%98%93%E6%98%AF%E5%90%A6%E6%9C%89%E6%95%88%0A%09%09%09%2F%2F%E5%88%A4%E6%96%AD%E5%AE%9A%E6%97%B6%E5%99%A8%E6%98%AF%E5%90%A6%E6%9C%AA%E7%A9%BA%0A%09%09%09if+ok+%26amp%3B%26amp%3B+len%28batches%29+%3D%3D+0+%26amp%3B%26amp%3B+timer+%3D%3D+nil+%7B%0A%09%09%09%09%2F%2F%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%AE%9A%E6%97%B6%E5%99%A8%0A%09%09%09%09timer+%3D+time.After%28ch.support.SharedConfig%28%29.BatchTimeout%28%29%29%0A%09%09%09%09continue%0A%09%09%09%7D%0A%09%09%09%2F%2F%E5%88%9B%E5%BB%BA%E5%8C%BA%E5%9D%97%0A%09%09%09%2F%2F%E6%9C%80%E7%BB%88%E4%BF%9D%E5%AD%98%E5%88%B0orderer%E8%8A%82%E7%82%B9%E7%9A%84%E4%B8%B4%E6%97%B6%E8%B4%A6%E6%9C%AC%E4%B8%AD%0A%09%09%09for+i%2C+batch+%3A%3D+range+batches+%7B%0A%09%09%09%09block+%3A%3D+ch.support.CreateNextBlock%28batch%29%0A%09%09%09%09ch.support.WriteBlock%28block%2C+committers%5Bi%5D%2C+nil%29%0A%09%09%09%7D%0A%09%09%09%2F%2F%E5%88%A4%E6%96%AD%E4%BA%A4%E6%98%93%E7%9A%84%E6%9C%89%E6%95%88%E6%80%A7%0A%09%09%09if+len%28batches%29+%26gt%3B+0+%7B%0A%09%09%09%09%2F%2F%E5%AE%9A%E6%97%B6%E5%99%A8%E9%87%8D%E6%96%B0%E8%AE%A1%E6%97%B6%0A%09%09%09%09timer+%3D+nil%0A%09%09%09%7D%0A%09%09%09%2F%2F%E5%AE%9A%E6%97%B6%E5%99%A8%E8%A7%A6%E5%8F%91%0A%09%09%09%2F%2F%E9%A9%AC%E4%B8%8A%E8%BF%9B%E8%A1%8C%E5%8C%BA%E5%9D%97%E5%88%87%E5%89%B2%0A%09%09case+%26lt%3B-timer%3A%0A%09%09%09%2F%2Fclear+the+timer%0A%09%09%09timer+%3D+nil%0A%09%09%09%2F%2F%E5%8C%BA%E5%9D%97%E5%88%87%E5%89%B2%0A%09%09%09batch%2C+committers+%3A%3D+ch.support.BlockCutter%28%29.Cut%28%29%0A%09%09%09if+len%28batch%29+%3D%3D+0+%7B%0A%09%09%09%09logger.Warningf%28%22Batch+timer+expired+with+no+pending+requests%2C+this+might+indicate+a+bug%22%29%0A%09%09%09%09continue%0A%09%09%09%7D%0A%09%09%09logger.Debugf%28%22Batch+timer+expired%2C+creating+block%22%29%0A%09%09%09%2F%2F%E5%88%9B%E5%BB%BA%E5%8C%BA%E5%9D%97%0A%09%09%09block+%3A%3D+ch.support.CreateNextBlock%28batch%29%0A%09%09%09%2F%2F%E5%86%99%E5%8C%BA%E5%9D%97%0A%09%09%09ch.support.WriteBlock%28block%2C+committers%2C+nil%29%0A%09%09case+%26lt%3B-ch.exitChan%3A%0A%09%09%09logger.Debugf%28%22Exiting%22%29%0A%09%09%2F%2F%E7%9B%B4%E6%8E%A5%E9%80%80%E5%87%BA%0A%09%09%09return%0A%09%09%7D%0A%09%7D%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fsuper_lixiang%2Farticle%2Fdetails%2F83823796%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fsuper_lixiang%2Farticle%2Fdetails%2F83823796%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E+%0A%3Cscript%3E%0A%09%09%09%09%09%09%28function%28%29%7B%0A%09%09%09%09%09%09%09function+setArticleH%28btnReadmore%2Cposi%29%7B%0A%09%09%09%09%09%09%09%09var+winH+%3D+%24%28window%29.height%28%29%3B%0A%09%09%09%09%09%09%09%09var+articleBox+%3D+%24%28%22div.article_content%22%29%3B%0A%09%09%09%09%09%09%09%09var+artH+%3D+articleBox.height%28%29%3B%0A%09%09%09%09%09%09%09%09if%28artH+%3E+winH*posi%29%7B%0A%09%09%09%09%09%09%09%09%09articleBox.css%28%7B%0A%09%09%09%09%09%09%09%09%09%09%27height%27%3AwinH*posi%2B%27px%27%2C%0A%09%09%09%09%09%09%09%09%09%09%27overflow%27%3A%27hidden%27%0A%09%09%09%09%09%09%09%09%09%7D%29%0A%09%09%09%09%09%09%09%09%09btnReadmore.click%28function%28%29%7B%0A%09%09%09%09%09%09%09%09%09%09if%28typeof+window.localStorage+%3D%3D%3D+%22object%22+%26%26+typeof+window.csdn.anonymousUserLimit+%3D%3D%3D+%22object%22%29%7B%0A%09%09%09%09%09%09%09%09%09%09%09if%28%21window.csdn.anonymousUserLimit.judgment%28%29%29%7B%0A%09%09%09%09%09%09%09%09%09%09%09%09window.csdn.anonymousUserLimit.Jumplogin%28%29%3B%0A%09%09%09%09%09%09%09%09%09%09%09%09return+false%3B%0A%09%09%09%09%09%09%09%09%09%09%09%7Delse+if%28%21currentUserName%29%7B%0A%09%09%09%09%09%09%09%09%09%09%09%09window.csdn.anonymousUserLimit.updata%28%29%3B%0A%09%09%09%09%09%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09%09%09%09%09%0A%09%09%09%09%09%09%09%09%09%09articleBox.removeAttr%28%22style%22%29%3B%0A%09%09%09%09%09%09%09%09%09%09%24%28this%29.parent%28%29.remove%28%29%3B%0A%09%09%09%09%09%09%09%09%09%7D%29%0A%09%09%09%09%09%09%09%09%7Delse%7B%0A%09%09%09%09%09%09%09%09%09btnReadmore.parent%28%29.remove%28%29%3B%0A%09%09%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09%09var+btnReadmore+%3D+%24%28%22%23btn-readmore%22%29%3B%0A%09%09%09%09%09%09%09if%28btnReadmore.length%3E0%29%7B%0A%09%09%09%09%09%09%09%09if%28currentUserName%29%7B%0A%09%09%09%09%09%09%09%09%09setArticleH%28btnReadmore%2C3%29%3B%0A%09%09%09%09%09%09%09%09%7Delse%7B%0A%09%09%09%09%09%09%09%09%09setArticleH%28btnReadmore%2C1.2%29%3B%0A%09%09%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09%09%7D%0A%09%09%09%09%09%09%7D%29%28%29%0A%09%09%09%09%09%3C%2Fscript%3E" | url_decode}}
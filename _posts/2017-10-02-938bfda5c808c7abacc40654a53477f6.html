---
layout: default
title: clique的挖矿的信任节点
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Cdiv+class%3D%22markdown_views%22%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-go+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Snapshot+is+the+state+of+the+authorization+voting+at+a+given+point+in+time.%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Etype%3C%2Fspan%3E+Snapshot+%3Cspan+class%3D%22hljs-keyword%22%3Estruct%3C%2Fspan%3E+%7B%0A++++config+++*params.CliqueConfig+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Consensus+engine+parameters+to+fine+tune+behavior%3C%2Fspan%3E%0A++++sigcache+*lru.ARCCache++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Cache+of+recent+block+signatures+to+speed+up+ecrecover%3C%2Fspan%3E%0A%0A++++Number++%3Cspan+class%3D%22hljs-typename%22%3Euint64%3C%2Fspan%3E++++++++++++++++++++++%3Cspan+class%3D%22hljs-string%22%3E%60json%3A%22number%22%60%3C%2Fspan%3E++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Block+number+where+the+snapshot+was+created%3C%2Fspan%3E%0A++++Hash++++common.Hash+++++++++++++++++%3Cspan+class%3D%22hljs-string%22%3E%60json%3A%22hash%22%60%3C%2Fspan%3E++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Block+hash+where+the+snapshot+was+created%3C%2Fspan%3E%0A++++Signers+%3Cspan+class%3D%22hljs-keyword%22%3Emap%3C%2Fspan%3E%5Bcommon.Address%5D%3Cspan+class%3D%22hljs-keyword%22%3Estruct%3C%2Fspan%3E%7B%7D+%3Cspan+class%3D%22hljs-string%22%3E%60json%3A%22signers%22%60%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Set+of+authorized+signers+at+this+moment%3C%2Fspan%3E%0A++++Recents+%3Cspan+class%3D%22hljs-keyword%22%3Emap%3C%2Fspan%3E%5B%3Cspan+class%3D%22hljs-typename%22%3Euint64%3C%2Fspan%3E%5Dcommon.Address+++%3Cspan+class%3D%22hljs-string%22%3E%60json%3A%22recents%22%60%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Set+of+recent+signers+for+spam+protections%3C%2Fspan%3E%0A++++Votes+++%5B%5D*Vote+++++++++++++++++++++%3Cspan+class%3D%22hljs-string%22%3E%60json%3A%22votes%22%60%3C%2Fspan%3E+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+List+of+votes+cast+in+chronological+order%3C%2Fspan%3E%0A++++Tally+++%3Cspan+class%3D%22hljs-keyword%22%3Emap%3C%2Fspan%3E%5Bcommon.Address%5DTally++++%3Cspan+class%3D%22hljs-string%22%3E%60json%3A%22tally%22%60%3C%2Fspan%3E+++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Current+vote+tally+to+avoid+recalculating%3C%2Fspan%3E%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-go+hljs+%22%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Efunc%3C%2Fspan%3E+%28c+*Clique%29+Seal%28chain+consensus.ChainReader%2C+block+*types.Block%2C+stop+%26lt%3B-%3Cspan+class%3D%22hljs-keyword%22%3Echan%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Estruct%3C%2Fspan%3E%7B%7D%29+%28*types.Block%2C+error%29+%7B%0A++++...%0A++++number+%3A%3D+header.Number.Uint64%28%29%0A++++...%0A++++signer%2C+signFn+%3A%3D+c.signer%2C+c.signFn%0A++++...%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Bail+out+if+we%27re+unauthorized+to+sign+a+block%3C%2Fspan%3E%0A++++snap%2C+err+%3A%3D+c.snapshot%28chain%2C+number%3Cspan+class%3D%22hljs-number%22%3E-1%3C%2Fspan%3E%2C+header.ParentHash%2C+%3Cspan+class%3D%22hljs-constant%22%3Enil%3C%2Fspan%3E%29%0A++++...%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+If+we%27re+amongst+the+recent+signers%2C+wait+for+the+next+block%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+seen%2C+recent+%3A%3D+%3Cspan+class%3D%22hljs-keyword%22%3Erange%3C%2Fspan%3E+snap.Recents+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+recent+%3D%3D+signer+%7B%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Signer+is+among+recents%2C+only+wait+if+the+current+block+doesn%27t+shift+it+out%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+limit+%3A%3D+%3Cspan+class%3D%22hljs-typename%22%3Euint64%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-built_in%22%3Elen%3C%2Fspan%3E%28snap.Signers%29%3Cspan+class%3D%22hljs-number%22%3E%2F2%3C%2Fspan%3E+%2B%3Cspan+class%3D%22hljs-number%22%3E+1%3C%2Fspan%3E%29%3B+number+%26lt%3B+limit+%7C%7C+seen+%26gt%3B+number-limit+%7B%0A++++++++++++++++log.Info%28%3Cspan+class%3D%22hljs-string%22%3E%22Signed+recently%2C+must+wait+for+others%22%3C%2Fspan%3E%29%0A++++++++++++++++%26lt%3B-stop%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-constant%22%3Enil%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-constant%22%3Enil%3C%2Fspan%3E%0A++++++++++++%7D%0A++++++++%7D%0A++++%7D%0A++++...%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-go+hljs+%22%3E%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+validVote+returns+whether+it+makes+sense+to+cast+the+specified+vote+in+the%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+given+snapshot+context+%28e.g.+don%27t+try+to+add+an+already+authorized+signer%29.%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Efunc%3C%2Fspan%3E+%28s+*Snapshot%29+validVote%28address+common.Address%2C+authorize+%3Cspan+class%3D%22hljs-typename%22%3Ebool%3C%2Fspan%3E%29+%3Cspan+class%3D%22hljs-typename%22%3Ebool%3C%2Fspan%3E+%7B%0A++++_%2C+signer+%3A%3D+s.Signers%5Baddress%5D%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%28signer+%26amp%3B%26amp%3B+%21authorize%29+%7C%7C+%28%21signer+%26amp%3B%26amp%3B+authorize%29%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-go+hljs+%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Efunc%3C%2Fspan%3E+%28s+*Snapshot%29+apply%28headers+%5B%5D*types.Header%29+%28*Snapshot%2C+error%29+%7B%0A++++...%0A++++snap+%3A%3D+s.%3Cspan+class%3D%22hljs-built_in%22%3Ecopy%3C%2Fspan%3E%28%29%0A%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+_%2C+header+%3A%3D+%3Cspan+class%3D%22hljs-keyword%22%3Erange%3C%2Fspan%3E+headers+%7B%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Remove+any+votes+on+checkpoint+blocks%3C%2Fspan%3E%0A++++++++number+%3A%3D+header.Number.Uint64%28%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+number%25s.config.Epoch+%3D%3D%3Cspan+class%3D%22hljs-number%22%3E+0%3C%2Fspan%3E+%7B%0A++++++++++++snap.Votes+%3D+%3Cspan+class%3D%22hljs-constant%22%3Enil%3C%2Fspan%3E%0A++++++++++++snap.Tally+%3D+%3Cspan+class%3D%22hljs-built_in%22%3Emake%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-keyword%22%3Emap%3C%2Fspan%3E%5Bcommon.Address%5DTally%29%0A++++++++%7D%0A++++++++...%0A++++++++signer%2C+err+%3A%3D+ecrecover%28header%2C+s.sigcache%29%0A++++++++...%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+If+the+vote+passed%2C+update+the+list+of+signers%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+tally+%3A%3D+snap.Tally%5Bheader.Coinbase%5D%3B+tally.Votes+%26gt%3B+%3Cspan+class%3D%22hljs-built_in%22%3Elen%3C%2Fspan%3E%28snap.Signers%29%3Cspan+class%3D%22hljs-number%22%3E%2F2%3C%2Fspan%3E+%7B%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+tally.Authorize+%7B%0A++++++++++++++++snap.Signers%5Bheader.Coinbase%5D+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Estruct%3C%2Fspan%3E%7B%7D%7B%7D%0A++++++++++++%7D+%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E+%7B%0A++++++++++++++++%3Cspan+class%3D%22hljs-built_in%22%3Edelete%3C%2Fspan%3E%28snap.Signers%2C+header.Coinbase%29%0A++++++++++++++++...%0A++++++++++++%7D%0A%0A++++++++%7D%0A++++%7D%0A++++...%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A+%3C%2Fdiv%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fmarkdown_views-ea0013b516.css%22%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn+btn-red-hollow%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fcode_segment%2Farticle%2Fdetails%2F78150163%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fcode_segment%2Farticle%2Fdetails%2F78150163%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}
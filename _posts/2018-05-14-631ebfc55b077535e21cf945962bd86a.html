---
layout: default
title: 以太坊源码分析(37)eth以太坊协议分析
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-e2445db1a8.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22%3E+%0A++%3Cdiv+style%3D%22color%3Argb%28212%2C212%2C212%29%3Bbackground-color%3Argb%2830%2C30%2C30%29%3Bfont-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3Bfont-size%3A14px%3Bline-height%3A19px%3B%22%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++node%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AE%9A%E4%B9%89%EF%BC%8C+eth%E5%85%B6%E5%AE%9E%E5%B0%B1%E6%98%AF%E5%AE%9E%E7%8E%B0%E4%BA%86%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btype+Service+interface+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Protocols+retrieves+the+P2P+protocols+the+service+wishes+to+start.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BProtocols%28%29+%5B%5Dp2p.Protocol%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+APIs+retrieves+the+list+of+RPC+descriptors+the+service+provides%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BAPIs%28%29+%5B%5Drpc.API%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Start+is+called+after+all+services+have+been+constructed+and+the+networking%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+layer+was+also+initialized+to+spawn+any+goroutines+required+by+the+service.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BStart%28server+*p2p.Server%29+error%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Stop+terminates+all+goroutines+belonging+to+the+service%2C+blocking+until+they%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+are+all+terminated.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BStop%28%29+error%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++go+ethereum+%E7%9A%84eth%E7%9B%AE%E5%BD%95%E6%98%AF%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AE%9E%E7%8E%B0%E3%80%82+%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%8D%8F%E8%AE%AE%E6%98%AF%E9%80%9A%E8%BF%87node%E7%9A%84Register%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5%E7%9A%84%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+RegisterEthService+adds+an+Ethereum+client+to+the+stack.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+RegisterEthService%28stack+*node.Node%2C+cfg+*eth.Config%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+err+error%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+cfg.SyncMode+%3D%3D+downloader.LightSync+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Berr+%3D+stack.Register%28func%28ctx+*node.ServiceContext%29+%28node.Service%2C+error%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+les.New%28ctx%2C+cfg%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Berr+%3D+stack.Register%28func%28ctx+*node.ServiceContext%29+%28node.Service%2C+error%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BfullNode%2C+err+%3A%3D+eth.New%28ctx%2C+cfg%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+fullNode+%21%3D+nil+%26amp%3B%26amp%3B+cfg.LightServ+%26gt%3B+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bls%2C+_+%3A%3D+les.NewLesServer%28fullNode%2C+cfg%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BfullNode.AddLesServer%28ls%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+fullNode%2C+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BFatalf%28%22Failed+to+register+the+Ethereum+service%3A+%25v%22%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Ethereum+implements+the+Ethereum+full+node+service.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btype+Ethereum+struct+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bconfig+*Config%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%E9%85%8D%E7%BD%AE%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BchainConfig+*params.ChainConfig%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%E9%93%BE%E9%85%8D%E7%BD%AE%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Channel+for+shutting+down+the+service%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BshutdownChan+chan+bool+%2F%2F+Channel+for+shutting+down+the+ethereum%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BstopDbUpgrade+func%28%29+error+%2F%2F+stop+chain+db+sequential+key+upgrade%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Handlers%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtxPool+*core.TxPool%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%E4%BA%A4%E6%98%93%E6%B1%A0%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bblockchain+*core.BlockChain%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%E5%8C%BA%E5%9D%97%E9%93%BE%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BprotocolManager+*ProtocolManager%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%E5%8D%8F%E8%AE%AE%E7%AE%A1%E7%90%86%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BlesServer+LesServer%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+DB+interfaces%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BchainDb+ethdb.Database+%2F%2F+Block+chain+database%26nbsp%3B%26nbsp%3B%E5%8C%BA%E5%9D%97%E9%93%BE%E6%95%B0%E6%8D%AE%E5%BA%93%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BeventMux+*event.TypeMux%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bengine+consensus.Engine%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%E4%B8%80%E8%87%B4%E6%80%A7%E5%BC%95%E6%93%8E%E3%80%82+%E5%BA%94%E8%AF%A5%E6%98%AFPow%E9%83%A8%E5%88%86%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BaccountManager+*accounts.Manager%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%E8%B4%A6%E5%8F%B7%E7%AE%A1%E7%90%86%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BbloomRequests+chan+chan+*bloombits.Retrieval+%2F%2F+Channel+receiving+bloom+data+retrieval+requests%26nbsp%3B%E6%8E%A5%E6%94%B6bloom%E8%BF%87%E6%BB%A4%E5%99%A8%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82%E7%9A%84%E9%80%9A%E9%81%93%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BbloomIndexer+*core.ChainIndexer+%2F%2F+Bloom+indexer+operating+during+block+imports+%2F%2F%E5%9C%A8%E5%8C%BA%E5%9D%97import%E7%9A%84%E6%97%B6%E5%80%99%E6%89%A7%E8%A1%8CBloom+indexer%E6%93%8D%E4%BD%9C+%E6%9A%82%E6%97%B6%E4%B8%8D%E6%B8%85%E6%A5%9A%E6%98%AF%E4%BB%80%E4%B9%88%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BApiBackend+*EthApiBackend%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F%E6%8F%90%E4%BE%9B%E7%BB%99RPC%E6%9C%8D%E5%8A%A1%E4%BD%BF%E7%94%A8%E7%9A%84API%E5%90%8E%E7%AB%AF%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bminer+*miner.Miner%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F%E7%9F%BF%E5%B7%A5%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BgasPrice+*big.Int%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F%E8%8A%82%E7%82%B9%E6%8E%A5%E6%94%B6%E7%9A%84gasPrice%E7%9A%84%E6%9C%80%E5%B0%8F%E5%80%BC%E3%80%82+%E6%AF%94%E8%BF%99%E4%B8%AA%E5%80%BC%E6%9B%B4%E5%B0%8F%E7%9A%84%E4%BA%A4%E6%98%93%E4%BC%9A%E8%A2%AB%E6%9C%AC%E8%8A%82%E7%82%B9%E6%8B%92%E7%BB%9D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Betherbase+common.Address%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F%E7%9F%BF%E5%B7%A5%E5%9C%B0%E5%9D%80%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnetworkId+uint64%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F%E7%BD%91%E7%BB%9CID+testnet%E6%98%AF0+mainnet%E6%98%AF1+%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnetRPCService+*ethapi.PublicNetAPI%26nbsp%3B%26nbsp%3B%2F%2FRPC%E7%9A%84%E6%9C%8D%E5%8A%A1%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Block+sync.RWMutex+%2F%2F+Protects+the+variadic+fields+%28e.g.+gas+price+and+etherbase%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%9B%E5%BB%BANew.+%E6%9A%82%E6%97%B6%E5%85%88%E4%B8%8D%E6%B6%89%E5%8F%8Acore%E7%9A%84%E5%86%85%E5%AE%B9%E3%80%82+%E5%8F%AA%E6%98%AF%E5%A4%A7%E6%A6%82%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E3%80%82+core%E9%87%8C%E9%9D%A2%E7%9A%84%E5%86%85%E5%AE%B9%E5%90%8E%E7%BB%AD%E4%BC%9A%E5%88%86%E6%9E%90%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+New+creates+a+new+Ethereum+object+%28including+the%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+initialisation+of+the+common+Ethereum+object%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+New%28ctx+*node.ServiceContext%2C+config+*Config%29+%28*Ethereum%2C+error%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+config.SyncMode+%3D%3D+downloader.LightSync+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%2C+errors.New%28%22can%27t+run+eth.Ethereum+in+light+sync+mode%2C+use+les.LightEthereum%22%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+%21config.SyncMode.IsValid%28%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%2C+fmt.Errorf%28%22invalid+sync+mode+%25d%22%2C+config.SyncMode%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%88%9B%E5%BB%BAleveldb%E3%80%82+%E6%89%93%E5%BC%80%E6%88%96%E8%80%85%E6%96%B0%E5%BB%BA+chaindata%E7%9B%AE%E5%BD%95%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BchainDb%2C+err+%3A%3D+CreateDB%28ctx%2C+config%2C+%22chaindata%22%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%2C+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A0%BC%E5%BC%8F%E5%8D%87%E7%BA%A7%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BstopDbUpgrade+%3A%3D+upgradeDeduplicateData%28chainDb%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%AE%BE%E7%BD%AE%E5%88%9B%E4%B8%96%E5%8C%BA%E5%9D%97%E3%80%82+%E5%A6%82%E6%9E%9C%E6%95%B0%E6%8D%AE%E5%BA%93%E9%87%8C%E9%9D%A2%E5%B7%B2%E7%BB%8F%E6%9C%89%E5%88%9B%E4%B8%96%E5%8C%BA%E5%9D%97%E9%82%A3%E4%B9%88%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E9%87%8C%E9%9D%A2%E5%8F%96%E5%87%BA%28%E7%A7%81%E9%93%BE%29%E3%80%82%E6%88%96%E8%80%85%E6%98%AF%E4%BB%8E%E4%BB%A3%E7%A0%81%E9%87%8C%E9%9D%A2%E8%8E%B7%E5%8F%96%E9%BB%98%E8%AE%A4%E5%80%BC%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BchainConfig%2C+genesisHash%2C+genesisErr+%3A%3D+core.SetupGenesisBlock%28chainDb%2C+config.Genesis%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+ok+%3A%3D+genesisErr.%28*params.ConfigCompatError%29%3B+genesisErr+%21%3D+nil+%26amp%3B%26amp%3B+%21ok+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%2C+genesisErr%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Info%28%22Initialised+chain+configuration%22%2C+%22config%22%2C+chainConfig%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Beth+%3A%3D+%26amp%3BEthereum%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bconfig%3A+config%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BchainDb%3A+chainDb%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BchainConfig%3A+chainConfig%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BeventMux%3A+ctx.EventMux%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BaccountManager%3A+ctx.AccountManager%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bengine%3A+CreateConsensusEngine%28ctx%2C+config%2C+chainConfig%2C+chainDb%29%2C+%2F%2F+%E4%B8%80%E8%87%B4%E6%80%A7%E5%BC%95%E6%93%8E%E3%80%82+%E8%BF%99%E9%87%8C%E6%88%91%E7%90%86%E8%A7%A3%E6%98%AFPow%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BshutdownChan%3A+make%28chan+bool%29%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BstopDbUpgrade%3A+stopDbUpgrade%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnetworkId%3A+config.NetworkId%2C+%2F%2F+%E7%BD%91%E7%BB%9CID%E7%94%A8%E6%9D%A5%E5%8C%BA%E5%88%AB%E7%BD%91%E8%B7%AF%E3%80%82+%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E6%98%AF0.%E4%B8%BB%E7%BD%91%E6%98%AF1%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BgasPrice%3A+config.GasPrice%2C+%2F%2F+%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E9%85%8D%E7%BD%AE+--gasprice+%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%8E%A5%E7%BA%B3%E7%9A%84%E4%BA%A4%E6%98%93%E7%9A%84gasprice%E6%9C%80%E5%B0%8F%E5%80%BC%E3%80%82%E5%A6%82%E6%9E%9C%E5%B0%8F%E4%BA%8E%E8%BF%99%E4%B8%AA%E5%80%BC%E9%82%A3%E4%B9%88%E4%BC%9A%E8%A2%AB%E8%8A%82%E7%82%B9%E4%B8%A2%E5%BC%83%E3%80%82+%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Betherbase%3A+config.Etherbase%2C+%2F%2F%E6%8C%96%E7%9F%BF%E7%9A%84%E5%8F%97%E7%9B%8A%E8%80%85%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BbloomRequests%3A+make%28chan+chan+*bloombits.Retrieval%29%2C+%2F%2Fbloom%E7%9A%84%E8%AF%B7%E6%B1%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BbloomIndexer%3A+NewBloomIndexer%28chainDb%2C+params.BloomBitsBlocks%29%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Info%28%22Initialising+Ethereum+protocol%22%2C+%22versions%22%2C+ProtocolVersions%2C+%22network%22%2C+config.NetworkId%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+%21config.SkipBcVersionCheck+%7B+%2F%2F+%E6%A3%80%E6%9F%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E9%87%8C%E9%9D%A2%E5%AD%98%E5%82%A8%E7%9A%84BlockChainVersion%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84BlockChainVersion%E7%9A%84%E7%89%88%E6%9C%AC%E6%98%AF%E5%90%A6%E4%B8%80%E8%87%B4%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BbcVersion+%3A%3D+core.GetBlockChainVersion%28chainDb%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+bcVersion+%21%3D+core.BlockChainVersion+%26amp%3B%26amp%3B+bcVersion+%21%3D+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%2C+fmt.Errorf%28%22Blockchain+DB+version+mismatch+%28%25d+%2F+%25d%29.+Run+geth+upgradedb.%5Cn%22%2C+bcVersion%2C+core.BlockChainVersion%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcore.WriteBlockChainVersion%28chainDb%2C+core.BlockChainVersion%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BvmConfig+%3A%3D+vm.Config%7BEnablePreimageRecording%3A+config.EnablePreimageRecording%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%9B%E5%BB%BA%E4%BA%86%E5%8C%BA%E5%9D%97%E9%93%BE%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Beth.blockchain%2C+err+%3D+core.NewBlockChain%28chainDb%2C+eth.chainConfig%2C+eth.engine%2C+vmConfig%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%2C+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Rewind+the+chain+in+case+of+an+incompatible+config+upgrade.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+compat%2C+ok+%3A%3D+genesisErr.%28*params.ConfigCompatError%29%3B+ok+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Warn%28%22Rewinding+chain+to+upgrade+configuration%22%2C+%22err%22%2C+compat%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Beth.blockchain.SetHead%28compat.RewindTo%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcore.WriteChainConfig%28chainDb%2C+genesisHash%2C+chainConfig%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+bloomIndexer+%E6%9A%82%E6%97%B6%E4%B8%8D%E7%9F%A5%E9%81%93%E6%98%AF%E4%BB%80%E4%B9%88%E4%B8%9C%E8%A5%BF+%E8%BF%99%E9%87%8C%E9%9D%A2%E6%B6%89%E5%8F%8A%E5%BE%97%E4%B9%9F%E4%B8%8D%E6%98%AF%E5%BE%88%E5%A4%9A%E3%80%82+%E6%9A%82%E6%97%B6%E5%85%88%E4%B8%8D%E7%AE%A1%E4%BA%86%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Beth.bloomIndexer.Start%28eth.blockchain.CurrentHeader%28%29%2C+eth.blockchain.SubscribeChainEvent%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+config.TxPool.Journal+%21%3D+%22%22+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bconfig.TxPool.Journal+%3D+ctx.ResolvePath%28config.TxPool.Journal%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%88%9B%E5%BB%BA%E4%BA%A4%E6%98%93%E6%B1%A0%E3%80%82+%E7%94%A8%E6%9D%A5%E5%AD%98%E5%82%A8%E6%9C%AC%E5%9C%B0%E6%88%96%E8%80%85%E5%9C%A8%E7%BD%91%E7%BB%9C%E4%B8%8A%E6%8E%A5%E6%94%B6%E5%88%B0%E7%9A%84%E4%BA%A4%E6%98%93%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Beth.txPool+%3D+core.NewTxPool%28config.TxPool%2C+eth.chainConfig%2C+eth.blockchain%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%88%9B%E5%BB%BA%E5%8D%8F%E8%AE%AE%E7%AE%A1%E7%90%86%E5%99%A8%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+eth.protocolManager%2C+err+%3D+NewProtocolManager%28eth.chainConfig%2C+config.SyncMode%2C+config.NetworkId%2C+eth.eventMux%2C+eth.txPool%2C+eth.engine%2C+eth.blockchain%2C+chainDb%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%2C+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%88%9B%E5%BB%BA%E7%9F%BF%E5%B7%A5%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Beth.miner+%3D+miner.New%28eth%2C+eth.chainConfig%2C+eth.EventMux%28%29%2C+eth.engine%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Beth.miner.SetExtra%28makeExtraData%28config.ExtraData%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+ApiBackend+%E7%94%A8%E4%BA%8E%E7%BB%99RPC%E8%B0%83%E7%94%A8%E6%8F%90%E4%BE%9B%E5%90%8E%E7%AB%AF%E6%94%AF%E6%8C%81%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Beth.ApiBackend+%3D+%26amp%3BEthApiBackend%7Beth%2C+nil%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+gpoParams+GPO+Gas+Price+Oracle+%E7%9A%84%E7%BC%A9%E5%86%99%E3%80%82+GasPrice%E9%A2%84%E6%B5%8B%E3%80%82+%E9%80%9A%E8%BF%87%E6%9C%80%E8%BF%91%E7%9A%84%E4%BA%A4%E6%98%93%E6%9D%A5%E9%A2%84%E6%B5%8B%E5%BD%93%E5%89%8D%E7%9A%84GasPrice%E7%9A%84%E5%80%BC%E3%80%82%E8%BF%99%E4%B8%AA%E5%80%BC%E5%8F%AF%E4%BB%A5%E4%BD%9C%E4%B8%BA%E4%B9%8B%E5%90%8E%E5%8F%91%E9%80%81%E4%BA%A4%E6%98%93%E7%9A%84%E8%B4%B9%E7%94%A8%E7%9A%84%E5%8F%82%E8%80%83%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BgpoParams+%3A%3D+config.GPO%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+gpoParams.Default+%3D%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BgpoParams.Default+%3D+config.GasPrice%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Beth.ApiBackend.gpo+%3D+gasprice.NewOracle%28eth.ApiBackend%2C+gpoParams%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+eth%2C+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++ApiBackend+%E5%AE%9A%E4%B9%89%E5%9C%A8+api_backend.go%E6%96%87%E4%BB%B6%E4%B8%AD%E3%80%82+%E5%B0%81%E8%A3%85%E4%BA%86%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+EthApiBackend+implements+ethapi.Backend+for+full+nodes%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btype+EthApiBackend+struct+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Beth+*Ethereum%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgpo+*gasprice.Oracle%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28b+*EthApiBackend%29+SetHead%28number+uint64%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bb.eth.protocolManager.downloader.Cancel%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bb.eth.blockchain.SetHead%28number%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++New%E6%96%B9%E6%B3%95%E4%B8%AD%E9%99%A4%E4%BA%86core%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E6%96%B9%E6%B3%95%EF%BC%8C+%E6%9C%89%E4%B8%80%E4%B8%AAProtocolManager%E7%9A%84%E5%AF%B9%E8%B1%A1%E5%9C%A8%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%8D%8F%E8%AE%AE%E4%B8%AD%E6%AF%94%E8%BE%83%E9%87%8D%E8%A6%81%EF%BC%8C+%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%9C%AC%E6%9D%A5%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8D%8F%E8%AE%AE%E3%80%82ProtocolManager%E4%B8%AD%E5%8F%88%E5%8F%AF%E4%BB%A5%E7%AE%A1%E7%90%86%E5%A4%9A%E4%B8%AA%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%9A%84%E5%AD%90%E5%8D%8F%E8%AE%AE%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+NewProtocolManager+returns+a+new+ethereum+sub+protocol+manager.+The+Ethereum+sub+protocol+manages+peers+capable%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+with+the+ethereum+network.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+NewProtocolManager%28config+*params.ChainConfig%2C+mode+downloader.SyncMode%2C+networkId+uint64%2C+mux+*event.TypeMux%2C+txpool+txPool%2C+engine+consensus.Engine%2C+blockchain+*core.BlockChain%2C+chaindb+ethdb.Database%29+%28*ProtocolManager%2C+error%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Create+the+protocol+manager+with+the+base+fields%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager+%3A%3D+%26amp%3BProtocolManager%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnetworkId%3A+networkId%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BeventMux%3A+mux%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btxpool%3A+txpool%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bblockchain%3A+blockchain%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bchaindb%3A+chaindb%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bchainconfig%3A+config%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeers%3A+newPeerSet%28%29%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnewPeerCh%3A+make%28chan+*peer%29%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnoMorePeers%3A+make%28chan+struct%7B%7D%29%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtxsyncCh%3A+make%28chan+*txsync%29%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BquitSync%3A+make%28chan+struct%7B%7D%29%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Figure+out+whether+to+allow+fast+sync+or+not%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+mode+%3D%3D+downloader.FastSync+%26amp%3B%26amp%3B+blockchain.CurrentBlock%28%29.NumberU64%28%29+%26gt%3B+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Warn%28%22Blockchain+not+empty%2C+fast+sync+disabled%22%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmode+%3D+downloader.FullSync%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+mode+%3D%3D+downloader.FastSync+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.fastSync+%3D+uint32%281%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Initiate+a+sub-protocol+for+every+implemented+version+we+can+handle%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.SubProtocols+%3D+make%28%5B%5Dp2p.Protocol%2C+0%2C+len%28ProtocolVersions%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i%2C+version+%3A%3D+range+ProtocolVersions+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Skip+protocol+version+if+incompatible+with+the+mode+of+operation%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+mode+%3D%3D+downloader.FastSync+%26amp%3B%26amp%3B+version+%26lt%3B+eth63+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcontinue%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Compatible%3B+initialise+the+sub-protocol%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bversion+%3A%3D+version+%2F%2F+Closure+for+the+run%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.SubProtocols+%3D+append%28manager.SubProtocols%2C+p2p.Protocol%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BName%3A+ProtocolName%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BVersion%3A+version%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BLength%3A+ProtocolLengths%5Bi%5D%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%BF%98%E8%AE%B0%E5%BE%97p2p%E9%87%8C%E9%9D%A2%E7%9A%84Protocol%E4%B9%88%E3%80%82+p2p%E7%9A%84peer%E8%BF%9E%E6%8E%A5%E6%88%90%E5%8A%9F%E4%B9%8B%E5%90%8E%E4%BC%9A%E8%B0%83%E7%94%A8Run%E6%96%B9%E6%B3%95%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BRun%3A+func%28p+*p2p.Peer%2C+rw+p2p.MsgReadWriter%29+error+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeer+%3A%3D+manager.newPeer%28int%28version%29%2C+p%2C+rw%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bselect+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+manager.newPeerCh+%26lt%3B-+peer%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.wg.Add%281%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+manager.wg.Done%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager.handle%28peer%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-manager.quitSync%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p2p.DiscQuitting%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BNodeInfo%3A+func%28%29+interface%7B%7D+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager.NodeInfo%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BPeerInfo%3A+func%28id+discover.NodeID%29+interface%7B%7D+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+p+%3A%3D+manager.peers.Peer%28fmt.Sprintf%28%22%25x%22%2C+id%5B%3A8%5D%29%29%3B+p+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.Info%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28manager.SubProtocols%29+%3D%3D+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%2C+errIncompatibleConfig%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Construct+the+different+synchronisation+mechanisms%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+downloader%E6%98%AF%E8%B4%9F%E8%B4%A3%E4%BB%8E%E5%85%B6%E4%BB%96%E7%9A%84peer%E6%9D%A5%E5%90%8C%E6%AD%A5%E8%87%AA%E8%BA%AB%E6%95%B0%E6%8D%AE%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+downloader%E6%98%AF%E5%85%A8%E9%93%BE%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.downloader+%3D+downloader.New%28mode%2C+chaindb%2C+manager.eventMux%2C+blockchain%2C+nil%2C+manager.removePeer%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+validator+%E6%98%AF%E4%BD%BF%E7%94%A8%E4%B8%80%E8%87%B4%E6%80%A7%E5%BC%95%E6%93%8E%E6%9D%A5%E9%AA%8C%E8%AF%81%E5%8C%BA%E5%9D%97%E5%A4%B4%E7%9A%84%E5%87%BD%E6%95%B0%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvalidator+%3A%3D+func%28header+*types.Header%29+error+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+engine.VerifyHeader%28blockchain%2C+header%2C+true%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%BF%94%E5%9B%9E%E5%8C%BA%E5%9D%97%E9%AB%98%E5%BA%A6%E7%9A%84%E5%87%BD%E6%95%B0%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheighter+%3A%3D+func%28%29+uint64+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+blockchain.CurrentBlock%28%29.NumberU64%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%A6%82%E6%9E%9Cfast+sync%E5%BC%80%E5%90%AF%E4%BA%86%E3%80%82+%E9%82%A3%E4%B9%88%E4%B8%8D%E4%BC%9A%E8%B0%83%E7%94%A8inserter%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Binserter+%3A%3D+func%28blocks+types.Blocks%29+%28int%2C+error%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+fast+sync+is+running%2C+deny+importing+weird+blocks%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+atomic.LoadUint32%28%26amp%3Bmanager.fastSync%29+%3D%3D+1+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Warn%28%22Discarded+bad+propagated+block%22%2C+%22number%22%2C+blocks%5B0%5D.Number%28%29%2C+%22hash%22%2C+blocks%5B0%5D.Hash%28%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+0%2C+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%AE%BE%E7%BD%AE%E5%BC%80%E5%A7%8B%E6%8E%A5%E6%94%B6%E4%BA%A4%E6%98%93%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreUint32%28%26amp%3Bmanager.acceptTxs%2C+1%29+%2F%2F+Mark+initial+sync+done+on+any+fetcher+import%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E6%8F%92%E5%85%A5%E5%8C%BA%E5%9D%97%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager.blockchain.InsertChain%28blocks%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AAfetcher+%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Fetcher%E8%B4%9F%E8%B4%A3%E7%A7%AF%E7%B4%AF%E6%9D%A5%E8%87%AA%E5%90%84%E4%B8%AApeer%E7%9A%84%E5%8C%BA%E5%9D%97%E9%80%9A%E7%9F%A5%E5%B9%B6%E5%AE%89%E6%8E%92%E8%BF%9B%E8%A1%8C%E6%A3%80%E7%B4%A2%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.fetcher+%3D+fetcher.New%28blockchain.GetBlockByHash%2C+validator%2C+manager.BroadcastBlock%2C+heighter%2C+inserter%2C+manager.removePeer%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager%2C+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%E6%9C%8D%E5%8A%A1%E7%9A%84APIs%28%29%E6%96%B9%E6%B3%95%E4%BC%9A%E8%BF%94%E5%9B%9E%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2%E7%9A%84RPC%E6%96%B9%E6%B3%95%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+APIs+returns+the+collection+of+RPC+services+the+ethereum+package+offers.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+NOTE%2C+some+of+these+services+probably+need+to+be+moved+to+somewhere+else.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28s+*Ethereum%29+APIs%28%29+%5B%5Drpc.API+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bapis+%3A%3D+ethapi.GetAPIs%28s.ApiBackend%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Append+any+APIs+exposed+explicitly+by+the+consensus+engine%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bapis+%3D+append%28apis%2C+s.engine.APIs%28s.BlockChain%28%29%29...%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Append+all+the+local+APIs+and+return%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+append%28apis%2C+%5B%5Drpc.API%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BNamespace%3A+%22eth%22%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BVersion%3A+%221.0%22%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BService%3A+NewPublicEthereumAPI%28s%29%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BPublic%3A+true%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B...%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2C+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BNamespace%3A+%22net%22%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BVersion%3A+%221.0%22%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BService%3A+s.netRPCService%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BPublic%3A+true%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D...%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%E6%9C%8D%E5%8A%A1%E7%9A%84Protocols%E6%96%B9%E6%B3%95%E4%BC%9A%E8%BF%94%E5%9B%9E%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E4%BA%86%E9%82%A3%E4%BA%9Bp2p%E7%9A%84Protocol%E3%80%82+%E8%BF%94%E5%9B%9E%E5%8D%8F%E8%AE%AE%E7%AE%A1%E7%90%86%E5%99%A8%E9%87%8C%E9%9D%A2%E7%9A%84%E6%89%80%E6%9C%89SubProtocols.+%E5%A6%82%E6%9E%9C%E6%9C%89lesServer%E9%82%A3%E4%B9%88%E8%BF%98%E6%8F%90%E4%BE%9BlesServer%E7%9A%84Protocol%E3%80%82%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E3%80%82%E6%89%80%E6%9C%89%E7%9A%84%E7%BD%91%E7%BB%9C%E5%8A%9F%E8%83%BD%E9%83%BD%E6%98%AF%E9%80%9A%E8%BF%87Protocol%E7%9A%84%E6%96%B9%E5%BC%8F%E6%8F%90%E4%BE%9B%E5%87%BA%E6%9D%A5%E7%9A%84%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Protocols+implements+node.Service%2C+returning+all+the+currently+configured%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+network+protocols+to+start.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28s+*Ethereum%29+Protocols%28%29+%5B%5Dp2p.Protocol+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+s.lesServer+%3D%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+s.protocolManager.SubProtocols%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+append%28s.protocolManager.SubProtocols%2C+s.lesServer.Protocols%28%29...%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++Ethereum%E6%9C%8D%E5%8A%A1%E5%9C%A8%E5%88%9B%E5%BB%BA%E4%B9%8B%E5%90%8E%EF%BC%8C%E4%BC%9A%E8%A2%AB%E8%B0%83%E7%94%A8%E6%9C%8D%E5%8A%A1%E7%9A%84Start%E6%96%B9%E6%B3%95%E3%80%82%E4%B8%8B%E9%9D%A2%E6%88%91%E4%BB%AC%E6%9D%A5%E7%9C%8B%E7%9C%8BStart%E6%96%B9%E6%B3%95%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Start+implements+node.Service%2C+starting+all+internal+goroutines+needed+by+the%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Ethereum+protocol+implementation.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28s+*Ethereum%29+Start%28srvr+*p2p.Server%29+error+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Start+the+bloom+bits+servicing+goroutines%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%90%AF%E5%8A%A8%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E7%9A%84goroutine+TODO%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bs.startBloomHandlers%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Start+the+RPC+service%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C%E7%9A%84API+net%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bs.netRPCService+%3D+ethapi.NewPublicNetAPI%28srvr%2C+s.NetVersion%28%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Figure+out+a+max+peers+count+based+on+the+server+limits%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmaxPeers+%3A%3D+srvr.MaxPeers%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+s.config.LightServ+%26gt%3B+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmaxPeers+-%3D+s.config.LightPeers%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+maxPeers+%26lt%3B+srvr.MaxPeers%2F2+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmaxPeers+%3D+srvr.MaxPeers+%2F+2%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Start+the+networking+layer+and+the+light+server+if+requested%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%90%AF%E5%8A%A8%E5%8D%8F%E8%AE%AE%E7%AE%A1%E7%90%86%E5%99%A8%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bs.protocolManager.Start%28maxPeers%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+s.lesServer+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%A6%82%E6%9E%9ClesServer%E4%B8%8D%E4%B8%BAnil+%E5%90%AF%E5%8A%A8%E5%AE%83%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bs.lesServer.Start%28srvr%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%E5%8D%8F%E8%AE%AE%E7%AE%A1%E7%90%86%E5%99%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btype+ProtocolManager+struct+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnetworkId+uint64%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BfastSync+uint32+%2F%2F+Flag+whether+fast+sync+is+enabled+%28gets+disabled+if+we+already+have+blocks%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BacceptTxs+uint32+%2F%2F+Flag+whether+we%27re+considered+synchronised+%28enables+transaction+processing%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btxpool+txPool%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bblockchain+*core.BlockChain%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bchaindb+ethdb.Database%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bchainconfig+*params.ChainConfig%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmaxPeers+int%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdownloader+*downloader.Downloader%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfetcher+*fetcher.Fetcher%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeers+*peerSet%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BSubProtocols+%5B%5Dp2p.Protocol%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BeventMux+*event.TypeMux%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtxCh+chan+core.TxPreEvent%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtxSub+event.Subscription%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BminedBlockSub+*event.TypeMuxSubscription%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+channels+for+fetcher%2C+syncer%2C+txsyncLoop%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnewPeerCh+chan+*peer%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtxsyncCh+chan+*txsync%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BquitSync+chan+struct%7B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnoMorePeers+chan+struct%7B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+wait+group+is+used+for+graceful+shutdowns+during+downloading%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+and+processing%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bwg+sync.WaitGroup%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%E5%8D%8F%E8%AE%AE%E7%AE%A1%E7%90%86%E5%99%A8%E7%9A%84Start%E6%96%B9%E6%B3%95%E3%80%82%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E9%87%8C%E9%9D%A2%E5%90%AF%E5%8A%A8%E4%BA%86%E5%A4%A7%E9%87%8F%E7%9A%84goroutine%E7%94%A8%E6%9D%A5%E5%A4%84%E7%90%86%E5%90%84%E7%A7%8D%E4%BA%8B%E5%8A%A1%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%8E%A8%E6%B5%8B%EF%BC%8C%E8%BF%99%E4%B8%AA%E7%B1%BB%E5%BA%94%E8%AF%A5%E6%98%AF%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%9C%8D%E5%8A%A1%E7%9A%84%E4%B8%BB%E8%A6%81%E5%AE%9E%E7%8E%B0%E7%B1%BB%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28pm+*ProtocolManager%29+Start%28maxPeers+int%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.maxPeers+%3D+maxPeers%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+broadcast+transactions%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%B9%BF%E6%92%AD%E4%BA%A4%E6%98%93%E7%9A%84%E9%80%9A%E9%81%93%E3%80%82+txCh%E4%BC%9A%E4%BD%9C%E4%B8%BAtxpool%E7%9A%84TxPreEvent%E8%AE%A2%E9%98%85%E9%80%9A%E9%81%93%E3%80%82txpool%E6%9C%89%E4%BA%86%E8%BF%99%E7%A7%8D%E6%B6%88%E6%81%AF%E4%BC%9A%E9%80%9A%E7%9F%A5%E7%BB%99%E8%BF%99%E4%B8%AAtxCh%E3%80%82+%E5%B9%BF%E6%92%AD%E4%BA%A4%E6%98%93%E7%9A%84goroutine%E4%BC%9A%E6%8A%8A%E8%BF%99%E4%B8%AA%E6%B6%88%E6%81%AF%E5%B9%BF%E6%92%AD%E5%87%BA%E5%8E%BB%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.txCh+%3D+make%28chan+core.TxPreEvent%2C+txChanSize%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%AE%A2%E9%98%85%E7%9A%84%E5%9B%9E%E6%89%A7%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.txSub+%3D+pm.txpool.SubscribeTxPreEvent%28pm.txCh%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%90%AF%E5%8A%A8%E5%B9%BF%E6%92%AD%E7%9A%84goroutine%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.txBroadcastLoop%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+broadcast+mined+blocks%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%AE%A2%E9%98%85%E6%8C%96%E7%9F%BF%E6%B6%88%E6%81%AF%E3%80%82%E5%BD%93%E6%96%B0%E7%9A%84Block%E8%A2%AB%E6%8C%96%E5%87%BA%E6%9D%A5%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E4%BA%A7%E7%94%9F%E6%B6%88%E6%81%AF%E3%80%82+%E8%BF%99%E4%B8%AA%E8%AE%A2%E9%98%85%E5%92%8C%E4%B8%8A%E9%9D%A2%E7%9A%84%E9%82%A3%E4%B8%AA%E8%AE%A2%E9%98%85%E9%87%87%E7%94%A8%E4%BA%86%E4%B8%A4%E7%A7%8D%E4%B8%8D%E5%90%8C%E7%9A%84%E6%A8%A1%E5%BC%8F%EF%BC%8C%E8%BF%99%E7%A7%8D%E6%98%AF%E6%A0%87%E8%AE%B0%E4%B8%BADeprecated%E7%9A%84%E8%AE%A2%E9%98%85%E6%96%B9%E5%BC%8F%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.minedBlockSub+%3D+pm.eventMux.Subscribe%28core.NewMinedBlockEvent%7B%7D%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E6%8C%96%E7%9F%BF%E5%B9%BF%E6%92%AD+goroutine+%E5%BD%93%E6%8C%96%E5%87%BA%E6%9D%A5%E7%9A%84%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E5%B0%BD%E5%BF%AB%E7%9A%84%E5%B9%BF%E6%92%AD%E5%88%B0%E7%BD%91%E7%BB%9C%E4%B8%8A%E9%9D%A2%E5%8E%BB%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.minedBroadcastLoop%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+start+sync+handlers%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%90%8C%E6%AD%A5%E5%99%A8%E8%B4%9F%E8%B4%A3%E5%91%A8%E6%9C%9F%E6%80%A7%E5%9C%B0%E4%B8%8E%E7%BD%91%E7%BB%9C%E5%90%8C%E6%AD%A5%EF%BC%8C%E4%B8%8B%E8%BD%BD%E6%95%A3%E5%88%97%E5%92%8C%E5%9D%97%E4%BB%A5%E5%8F%8A%E5%A4%84%E7%90%86%E9%80%9A%E7%9F%A5%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.syncer%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+txsyncLoop%E8%B4%9F%E8%B4%A3%E6%AF%8F%E4%B8%AA%E6%96%B0%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%88%9D%E5%A7%8B%E4%BA%8B%E5%8A%A1%E5%90%8C%E6%AD%A5%E3%80%82+%E5%BD%93%E6%96%B0%E7%9A%84peer%E5%87%BA%E7%8E%B0%E6%97%B6%EF%BC%8C%E6%88%91%E4%BB%AC%E8%BD%AC%E5%8F%91%E6%89%80%E6%9C%89%E5%BD%93%E5%89%8D%E5%BE%85%E5%A4%84%E7%90%86%E7%9A%84%E4%BA%8B%E5%8A%A1%E3%80%82+%E4%B8%BA%E4%BA%86%E6%9C%80%E5%B0%8F%E5%8C%96%E5%87%BA%E5%8F%A3%E5%B8%A6%E5%AE%BD%E4%BD%BF%E7%94%A8%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%80%E6%AC%A1%E5%8F%AA%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%AA%E5%B0%8F%E5%8C%85%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.txsyncLoop%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%E5%BD%93p2p%E7%9A%84server%E5%90%AF%E5%8A%A8%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%BC%9A%E4%B8%BB%E5%8A%A8%E7%9A%84%E6%89%BE%E8%8A%82%E7%82%B9%E5%8E%BB%E8%BF%9E%E6%8E%A5%EF%BC%8C%E6%88%96%E8%80%85%E8%A2%AB%E5%85%B6%E4%BB%96%E7%9A%84%E8%8A%82%E7%82%B9%E8%BF%9E%E6%8E%A5%E3%80%82+%E8%BF%9E%E6%8E%A5%E7%9A%84%E8%BF%87%E7%A8%8B%E6%98%AF%E9%A6%96%E5%85%88%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%E4%BF%A1%E9%81%93%E7%9A%84%E6%8F%A1%E6%89%8B%EF%BC%8C%E7%84%B6%E5%90%8E%E8%BF%9B%E8%A1%8C%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%8F%A1%E6%89%8B%E3%80%82+%E6%9C%80%E5%90%8E%E4%B8%BA%E6%AF%8F%E4%B8%AA%E5%8D%8F%E8%AE%AE%E5%90%AF%E5%8A%A8goroutine+%E6%89%A7%E8%A1%8CRun%E6%96%B9%E6%B3%95%E6%9D%A5%E6%8A%8A%E6%8E%A7%E5%88%B6%E4%BA%A4%E7%BB%99%E6%9C%80%E7%BB%88%E7%9A%84%E5%8D%8F%E8%AE%AE%E3%80%82+%E8%BF%99%E4%B8%AArun%E6%96%B9%E6%B3%95%E9%A6%96%E5%85%88%E5%88%9B%E5%BB%BA%E4%BA%86%E4%B8%80%E4%B8%AApeer%E5%AF%B9%E8%B1%A1%EF%BC%8C%E7%84%B6%E5%90%8E%E8%B0%83%E7%94%A8%E4%BA%86handle%E6%96%B9%E6%B3%95%E6%9D%A5%E5%A4%84%E7%90%86%E8%BF%99%E4%B8%AApeer%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BRun%3A+func%28p+*p2p.Peer%2C+rw+p2p.MsgReadWriter%29+error+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeer+%3A%3D+manager.newPeer%28int%28version%29%2C+p%2C+rw%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bselect+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+manager.newPeerCh+%26lt%3B-+peer%3A+%2F%2F%E6%8A%8Apeer%E5%8F%91%E9%80%81%E5%88%B0newPeerCh%E9%80%9A%E9%81%93%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.wg.Add%281%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+manager.wg.Done%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager.handle%28peer%29+%2F%2F+%E8%B0%83%E7%94%A8handlo%E6%96%B9%E6%B3%95%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-manager.quitSync%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p2p.DiscQuitting%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++handle%E6%96%B9%E6%B3%95%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+handle+is+the+callback+invoked+to+manage+the+life+cycle+of+an+eth+peer.+When%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+this+function+terminates%2C+the+peer+is+disconnected.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+handle%E6%98%AF%E4%B8%80%E4%B8%AA%E5%9B%9E%E8%B0%83%E6%96%B9%E6%B3%95%EF%BC%8C%E7%94%A8%E6%9D%A5%E7%AE%A1%E7%90%86eth%E7%9A%84peer%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86%E3%80%82+%E5%BD%93%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E9%80%80%E5%87%BA%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8Cpeer%E7%9A%84%E8%BF%9E%E6%8E%A5%E4%B9%9F%E4%BC%9A%E6%96%AD%E5%BC%80%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28pm+*ProtocolManager%29+handle%28p+*peer%29+error+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pm.peers.Len%28%29+%26gt%3B%3D+pm.maxPeers+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p2p.DiscTooManyPeers%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Ethereum+peer+connected%22%2C+%22name%22%2C+p.Name%28%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Execute+the+Ethereum+handshake%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btd%2C+head%2C+genesis+%3A%3D+pm.blockchain.Status%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+td%E6%98%AFtotal+difficult%2C+head%E6%98%AF%E5%BD%93%E5%89%8D%E7%9A%84%E5%8C%BA%E5%9D%97%E5%A4%B4%EF%BC%8Cgenesis%E6%98%AF%E5%88%9B%E4%B8%96%E5%8C%BA%E5%9D%97%E7%9A%84%E4%BF%A1%E6%81%AF%E3%80%82+%E5%8F%AA%E6%9C%89%E5%88%9B%E4%B8%96%E5%8C%BA%E5%9D%97%E7%9B%B8%E5%90%8C%E6%89%8D%E8%83%BD%E6%8F%A1%E6%89%8B%E6%88%90%E5%8A%9F%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+p.Handshake%28pm.networkId%2C+td%2C+head%2C+genesis%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Ethereum+handshake+failed%22%2C+%22err%22%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+rw%2C+ok+%3A%3D+p.rw.%28*meteredMsgReadWriter%29%3B+ok+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Brw.Init%28p.version%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Register+the+peer+locally%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E6%8A%8Apeer%E6%B3%A8%E5%86%8C%E5%88%B0%E6%9C%AC%E5%9C%B0%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+pm.peers.Register%28p%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Error%28%22Ethereum+peer+registration+failed%22%2C+%22err%22%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+pm.removePeer%28p.id%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Register+the+peer+in+the+downloader.+If+the+downloader+considers+it+banned%2C+we+disconnect%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E6%8A%8Apeer%E6%B3%A8%E5%86%8C%E7%BB%99downloader.+%E5%A6%82%E6%9E%9Cdownloader%E8%AE%A4%E4%B8%BA%E8%BF%99%E4%B8%AApeer%E8%A2%AB%E7%A6%81%EF%BC%8C%E9%82%A3%E4%B9%88%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+pm.downloader.RegisterPeer%28p.id%2C+p.version%2C+p%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Propagate+existing+transactions.+new+transactions+appearing%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+after+this+will+be+sent+via+broadcasts.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E6%8A%8A%E5%BD%93%E5%89%8Dpending%E7%9A%84%E4%BA%A4%E6%98%93%E5%8F%91%E9%80%81%E7%BB%99%E5%AF%B9%E6%96%B9%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%8F%AA%E5%9C%A8%E8%BF%9E%E6%8E%A5%E5%88%9A%E5%BB%BA%E7%AB%8B%E7%9A%84%E6%97%B6%E5%80%99%E5%8F%91%E7%94%9F%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.syncTransactions%28p%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+we%27re+DAO+hard-fork+aware%2C+validate+any+remote+peer+with+regard+to+the+hard-fork%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E9%AA%8C%E8%AF%81peer%E7%9A%84DAO%E7%A1%AC%E5%88%86%E5%8F%89%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+daoBlock+%3A%3D+pm.chainconfig.DAOForkBlock%3B+daoBlock+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Request+the+peer%27s+DAO+fork+header+for+extra-data+validation%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+p.RequestHeadersByNumber%28daoBlock.Uint64%28%29%2C+1%2C+0%2C+false%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Start+a+timer+to+disconnect+if+the+peer+doesn%27t+reply+in+time%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%A6%82%E6%9E%9C15%E7%A7%92%E5%86%85%E6%B2%A1%E6%9C%89%E6%8E%A5%E6%94%B6%E5%88%B0%E5%9B%9E%E5%BA%94%E3%80%82%E9%82%A3%E4%B9%88%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop+%3D+time.AfterFunc%28daoChallengeTimeout%2C+func%28%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Timed+out+DAO+fork-check%2C+dropping%22%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.removePeer%28p.id%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Make+sure+it%27s+cleaned+up+if+the+peer+dies+off%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+func%28%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+p.forkDrop+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop.Stop%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop+%3D+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+main+loop.+handle+incoming+messages.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E4%B8%BB%E5%BE%AA%E7%8E%AF%E3%80%82+%E5%A4%84%E7%90%86%E8%BF%9B%E5%85%A5%E7%9A%84%E6%B6%88%E6%81%AF%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+pm.handleMsg%28p%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Ethereum+message+handling+failed%22%2C+%22err%22%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++Handshake%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Handshake+executes+the+eth+protocol+handshake%2C+negotiating+version+number%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+network+IDs%2C+difficulties%2C+head+and+genesis+blocks.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28p+*peer%29+Handshake%28network+uint64%2C+td+*big.Int%2C+head+common.Hash%2C+genesis+common.Hash%29+error+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Send+out+own+handshake+in+a+new+thread%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+error%E7%9A%84channel%E7%9A%84%E5%A4%A7%E5%B0%8F%E6%98%AF2%EF%BC%8C+%E5%B0%B1%E6%98%AF%E4%B8%BA%E4%BA%86%E4%B8%80%E6%AC%A1%E6%80%A7%E5%A4%84%E7%90%86%E4%B8%8B%E9%9D%A2%E7%9A%84%E4%B8%A4%E4%B8%AAgoroutine%E6%96%B9%E6%B3%95%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Berrc+%3A%3D+make%28chan+error%2C+2%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+status+statusData+%2F%2F+safe+to+read+after+two+values+have+been+received+from+errc%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+func%28%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Berrc+%26lt%3B-+p2p.Send%28p.rw%2C+StatusMsg%2C+%26amp%3BstatusData%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BProtocolVersion%3A+uint32%28p.version%29%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BNetworkId%3A+network%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BTD%3A+td%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BCurrentBlock%3A+head%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BGenesisBlock%3A+genesis%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+func%28%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Berrc+%26lt%3B-+p.readStatus%28network%2C+%26amp%3Bstatus%2C+genesis%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btimeout+%3A%3D+time.NewTimer%28handshakeTimeout%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+timeout.Stop%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%A6%82%E6%9E%9C%E6%8E%A5%E6%94%B6%E5%88%B0%E4%BB%BB%E4%BD%95%E4%B8%80%E4%B8%AA%E9%94%99%E8%AF%AF%28%E5%8F%91%E9%80%81%EF%BC%8C%E6%8E%A5%E6%94%B6%29%2C%E6%88%96%E8%80%85%E6%98%AF%E8%B6%85%E6%97%B6%EF%BC%8C+%E9%82%A3%E4%B9%88%E5%B0%B1%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i+%3A%3D+0%3B+i+%26lt%3B+2%3B+i%2B%2B+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bselect+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+err+%3A%3D+%26lt%3B-errc%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-timeout.C%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p2p.DiscReadTimeout%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.td%2C+p.head+%3D+status.TD%2C+status.CurrentBlock%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++readStatus%EF%BC%8C%E6%A3%80%E6%9F%A5%E5%AF%B9%E7%AB%AF%E8%BF%94%E5%9B%9E%E7%9A%84%E5%90%84%E7%A7%8D%E6%83%85%E5%86%B5%EF%BC%8C%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28p+*peer%29+readStatus%28network+uint64%2C+status+*statusData%2C+genesis+common.Hash%29+%28err+error%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmsg%2C+err+%3A%3D+p.rw.ReadMsg%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+msg.Code+%21%3D+StatusMsg+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrNoStatusMsg%2C+%22first+msg+has+code+%25x+%28%21%3D+%25x%29%22%2C+msg.Code%2C+StatusMsg%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+msg.Size+%26gt%3B+ProtocolMaxMsgSize+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrMsgTooLarge%2C+%22%25v+%26gt%3B+%25v%22%2C+msg.Size%2C+ProtocolMaxMsgSize%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Decode+the+handshake+and+make+sure+everything+matches%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Bstatus%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+status.GenesisBlock+%21%3D+genesis+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrGenesisBlockMismatch%2C+%22%25x+%28%21%3D+%25x%29%22%2C+status.GenesisBlock%5B%3A8%5D%2C+genesis%5B%3A8%5D%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+status.NetworkId+%21%3D+network+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrNetworkIdMismatch%2C+%22%25d+%28%21%3D+%25d%29%22%2C+status.NetworkId%2C+network%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+int%28status.ProtocolVersion%29+%21%3D+p.version+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrProtocolVersionMismatch%2C+%22%25d+%28%21%3D+%25d%29%22%2C+status.ProtocolVersion%2C+p.version%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++Register+%E7%AE%80%E5%8D%95%E7%9A%84%E6%8A%8Apeer%E5%8A%A0%E5%85%A5%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84peers%E7%9A%84map%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Register+injects+a+new+peer+into+the+working+set%2C+or+returns+an+error+if+the%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+peer+is+already+known.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28ps+*peerSet%29+Register%28p+*peer%29+error+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bps.lock.Lock%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+ps.lock.Unlock%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+ps.closed+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errClosed%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+ok+%3A%3D+ps.peers%5Bp.id%5D%3B+ok+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errAlreadyRegistered%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bps.peers%5Bp.id%5D+%3D+p%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%E7%BB%8F%E8%BF%87%E4%B8%80%E7%B3%BB%E5%88%97%E7%9A%84%E6%A3%80%E6%9F%A5%E5%92%8C%E6%8F%A1%E6%89%8B%E4%B9%8B%E5%90%8E%EF%BC%8C+%E5%BE%AA%E7%8E%AF%E7%9A%84%E8%B0%83%E7%94%A8%E4%BA%86handleMsg%E6%96%B9%E6%B3%95%E6%9D%A5%E5%A4%84%E7%90%86%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E3%80%82+%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E5%BE%88%E9%95%BF%EF%BC%8C%E4%B8%BB%E8%A6%81%E6%98%AF%E5%A4%84%E7%90%86%E6%8E%A5%E6%94%B6%E5%88%B0%E5%90%84%E7%A7%8D%E6%B6%88%E6%81%AF%E4%B9%8B%E5%90%8E%E7%9A%84%E5%BA%94%E5%AF%B9%E6%8E%AA%E6%96%BD%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+handleMsg+is+invoked+whenever+an+inbound+message+is+received+from+a+remote%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+peer.+The+remote+connection+is+turn+down+upon+returning+any+error.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28pm+*ProtocolManager%29+handleMsg%28p+*peer%29+error+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Read+the+next+message+from+the+remote+peer%2C+and+ensure+it%27s+fully+consumed%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmsg%2C+err+%3A%3D+p.rw.ReadMsg%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+msg.Size+%26gt%3B+ProtocolMaxMsgSize+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrMsgTooLarge%2C+%22%25v+%26gt%3B+%25v%22%2C+msg.Size%2C+ProtocolMaxMsgSize%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+msg.Discard%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Handle+the+message+depending+on+its+contents%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bswitch+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+StatusMsg%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Status+messages+should+never+arrive+after+the+handshake%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+StatusMsg%E5%BA%94%E8%AF%A5%E5%9C%A8HandleShake%E9%98%B6%E6%AE%B5%E6%8E%A5%E6%94%B6%E5%88%B0%E3%80%82+%E7%BB%8F%E8%BF%87%E4%BA%86HandleShake%E4%B9%8B%E5%90%8E%E6%98%AF%E4%B8%8D%E5%BA%94%E8%AF%A5%E6%8E%A5%E6%94%B6%E5%88%B0%E8%BF%99%E7%A7%8D%E6%B6%88%E6%81%AF%E7%9A%84%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrExtraStatusMsg%2C+%22uncontrolled+status+message%22%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Block+header+query%2C+collect+the+requested+headers+and+reply%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E6%8E%A5%E6%94%B6%E5%88%B0%E8%AF%B7%E6%B1%82%E5%8C%BA%E5%9D%97%E5%A4%B4%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%8C+%E4%BC%9A%E6%A0%B9%E6%8D%AE%E8%AF%B7%E6%B1%82%E8%BF%94%E5%9B%9E%E5%8C%BA%E5%9D%97%E5%A4%B4%E4%BF%A1%E6%81%AF%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+GetBlockHeadersMsg%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Decode+the+complex+header+query%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+query+getBlockHeadersData%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Bquery%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22%25v%3A+%25v%22%2C+msg%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BhashMode+%3A%3D+query.Origin.Hash+%21%3D+%28common.Hash%7B%7D%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Gather+headers+until+the+fetch+or+network+limits+is+reached%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+common.StorageSize%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheaders+%5B%5D*types.Header%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+bool%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+%21unknown+%26amp%3B%26amp%3B+len%28headers%29+%26lt%3B+int%28query.Amount%29+%26amp%3B%26amp%3B+bytes+%26lt%3B+softResponseLimit+%26amp%3B%26amp%3B+len%28headers%29+%26lt%3B+downloader.MaxHeaderFetch+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+next+header+satisfying+the+query%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+origin+*types.Header%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+hashMode+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Borigin+%3D+pm.blockchain.GetHeaderByHash%28query.Origin.Hash%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Borigin+%3D+pm.blockchain.GetHeaderByNumber%28query.Origin.Number%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+origin+%3D%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnumber+%3A%3D+origin.Number.Uint64%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheaders+%3D+append%28headers%2C+origin%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+%2B%3D+estHeaderRlpSize%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Advance+to+the+next+header+of+the+query%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bswitch+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+query.Origin.Hash+%21%3D+%28common.Hash%7B%7D%29+%26amp%3B%26amp%3B+query.Reverse%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Hash+based+traversal+towards+the+genesis+block%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E4%BB%8EHash%E6%8C%87%E5%AE%9A%E7%9A%84%E5%BC%80%E5%A7%8B%E6%9C%9D%E5%88%9B%E4%B8%96%E5%8C%BA%E5%9D%97%E7%A7%BB%E5%8A%A8%E3%80%82+%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%8F%8D%E5%90%91%E7%A7%BB%E5%8A%A8%E3%80%82+%E9%80%9A%E8%BF%87hash%E6%9F%A5%E6%89%BE%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i+%3A%3D+0%3B+i+%26lt%3B+int%28query.Skip%29%2B1%3B+i%2B%2B+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+header+%3A%3D+pm.blockchain.GetHeader%28query.Origin.Hash%2C+number%29%3B+header+%21%3D+nil+%7B%2F%2F+%E9%80%9A%E8%BF%87hash%E5%92%8Cnumber%E8%8E%B7%E5%8F%96%E5%89%8D%E4%B8%80%E4%B8%AA%E5%8C%BA%E5%9D%97%E5%A4%B4%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bquery.Origin.Hash+%3D+header.ParentHash%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnumber--%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak+%2F%2Fbreak%E6%98%AF%E8%B7%B3%E5%87%BAswitch%E3%80%82+unknow%E7%94%A8%E6%9D%A5%E8%B7%B3%E5%87%BA%E5%BE%AA%E7%8E%AF%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+query.Origin.Hash+%21%3D+%28common.Hash%7B%7D%29+%26amp%3B%26amp%3B+%21query.Reverse%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Hash+based+traversal+towards+the+leaf+block%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E9%80%9A%E8%BF%87hash%E6%9D%A5%E6%9F%A5%E6%89%BE%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcurrent+%3D+origin.Number.Uint64%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnext+%3D+current+%2B+query.Skip+%2B+1%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+next+%26lt%3B%3D+current+%7B+%2F%2F%E6%AD%A3%E5%90%91%EF%BC%8C+%E4%BD%86%E6%98%AFnext%E6%AF%94%E5%BD%93%E5%89%8D%E8%BF%98%E5%B0%8F%EF%BC%8C%E9%98%B2%E5%A4%87%E6%95%B4%E6%95%B0%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Binfos%2C+_+%3A%3D+json.MarshalIndent%28p.Peer.Info%28%29%2C+%22%22%2C+%22+%22%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Warn%28%22GetBlockHeaders+skip+overflow+attack%22%2C+%22current%22%2C+current%2C+%22skip%22%2C+query.Skip%2C+%22next%22%2C+next%2C+%22attacker%22%2C+infos%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+header+%3A%3D+pm.blockchain.GetHeaderByNumber%28next%29%3B+header+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pm.blockchain.GetBlockHashesFromHash%28header.Hash%28%29%2C+query.Skip%2B1%29%5Bquery.Skip%5D+%3D%3D+query.Origin.Hash+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%A6%82%E6%9E%9C%E5%8F%AF%E4%BB%A5%E6%89%BE%E5%88%B0%E8%BF%99%E4%B8%AAheader%EF%BC%8C%E8%80%8C%E4%B8%94%E8%BF%99%E4%B8%AAheader%E5%92%8Corigin%E5%9C%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E9%93%BE%E4%B8%8A%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bquery.Origin.Hash+%3D+header.Hash%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+query.Reverse%3A%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E9%80%9A%E8%BF%87number%E6%9F%A5%E6%89%BE%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Number+based+traversal+towards+the+genesis+block%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+query.Origin.Hash+%3D%3D+%28common.Hash%7B%7D%29+%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+query.Origin.Number+%26gt%3B%3D+query.Skip%2B1+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bquery.Origin.Number+-%3D+%28query.Skip+%2B+1%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%21query.Reverse%3A%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+%2F%2F%E9%80%9A%E8%BF%87number%E6%9F%A5%E6%89%BE%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Number+based+traversal+towards+the+leaf+block%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bquery.Origin.Number+%2B%3D+%28query.Skip+%2B+1%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.SendBlockHeaders%28headers%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+BlockHeadersMsg%3A+%2F%2F%E6%8E%A5%E6%94%B6%E5%88%B0%E4%BA%86GetBlockHeadersMsg%E7%9A%84%E5%9B%9E%E7%AD%94%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+A+batch+of+headers+arrived+to+one+of+our+previous+requests%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+headers+%5B%5D*types.Header%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Bheaders%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+no+headers+were+received%2C+but+we%27re+expending+a+DAO+fork+check%2C+maybe+it%27s+that%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%A6%82%E6%9E%9C%E5%AF%B9%E7%AB%AF%E6%B2%A1%E6%9C%89%E8%BF%94%E5%9B%9E%E4%BB%BB%E4%BD%95%E7%9A%84headers%2C%E8%80%8C%E4%B8%94forkDrop%E4%B8%8D%E4%B8%BA%E7%A9%BA%EF%BC%8C%E9%82%A3%E4%B9%88%E5%BA%94%E8%AF%A5%E6%98%AF%E6%88%91%E4%BB%AC%E7%9A%84DAO%E6%A3%80%E6%9F%A5%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B9%8B%E5%89%8D%E5%9C%A8HandShake%E5%8F%91%E9%80%81%E4%BA%86DAO+header%E7%9A%84%E8%AF%B7%E6%B1%82%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28headers%29+%3D%3D+0+%26amp%3B%26amp%3B+p.forkDrop+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Possibly+an+empty+reply+to+the+fork+header+checks%2C+sanity+check+TDs%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BverifyDAO+%3A%3D+true%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+we+already+have+a+DAO+header%2C+we+can+check+the+peer%27s+TD+against+it.+If%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+the+peer%27s+ahead+of+this%2C+it+too+must+have+a+reply+to+the+DAO+check%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+daoHeader+%3A%3D+pm.blockchain.GetHeaderByNumber%28pm.chainconfig.DAOForkBlock.Uint64%28%29%29%3B+daoHeader+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+td+%3A%3D+p.Head%28%29%3B+td.Cmp%28pm.blockchain.GetTd%28daoHeader.Hash%28%29%2C+daoHeader.Number.Uint64%28%29%29%29+%26gt%3B%3D+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F%E8%BF%99%E4%B8%AA%E6%97%B6%E5%80%99%E6%A3%80%E6%9F%A5%E5%AF%B9%E7%AB%AF%E7%9A%84total+difficult+%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E8%B6%85%E8%BF%87%E4%BA%86DAO%E5%88%86%E5%8F%89%E5%8C%BA%E5%9D%97%E7%9A%84td%E5%80%BC%EF%BC%8C+%E5%A6%82%E6%9E%9C%E8%B6%85%E8%BF%87%E4%BA%86%EF%BC%8C%E8%AF%B4%E6%98%8E%E5%AF%B9%E7%AB%AF%E5%BA%94%E8%AF%A5%E5%AD%98%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%8C%BA%E5%9D%97%E5%A4%B4%EF%BC%8C+%E4%BD%86%E6%98%AF%E8%BF%94%E5%9B%9E%E7%9A%84%E7%A9%BA%E7%99%BD%E7%9A%84%EF%BC%8C%E9%82%A3%E4%B9%88%E8%BF%99%E9%87%8C%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5%E3%80%82+%E8%BF%99%E9%87%8C%E4%BB%80%E4%B9%88%E9%83%BD%E6%B2%A1%E6%9C%89%E5%81%9A%E3%80%82+%E5%A6%82%E6%9E%9C%E5%AF%B9%E7%AB%AF%E8%BF%98%E4%B8%8D%E5%8F%91%E9%80%81%EF%BC%8C%E9%82%A3%E4%B9%88%E4%BC%9A%E8%A2%AB%E8%B6%85%E6%97%B6%E9%80%80%E5%87%BA%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BverifyDAO+%3D+false%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+we%27re+seemingly+on+the+same+chain%2C+disable+the+drop+timer%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+verifyDAO+%7B+%2F%2F+%E5%A6%82%E6%9E%9C%E9%AA%8C%E8%AF%81%E6%88%90%E5%8A%9F%EF%BC%8C%E9%82%A3%E4%B9%88%E5%88%A0%E9%99%A4%E6%8E%89%E8%AE%A1%E6%97%B6%E5%99%A8%EF%BC%8C%E7%84%B6%E5%90%8E%E8%BF%94%E5%9B%9E%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Seems+to+be+on+the+same+side+of+the+DAO+fork%22%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop.Stop%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop+%3D+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Filter+out+any+explicitly+requested+headers%2C+deliver+the+rest+to+the+downloader%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%BF%87%E6%BB%A4%E5%87%BA%E4%BB%BB%E4%BD%95%E9%9D%9E%E5%B8%B8%E6%98%8E%E7%A1%AE%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%8C+%E7%84%B6%E5%90%8E%E6%8A%8A%E5%89%A9%E4%B8%8B%E7%9A%84%E6%8A%95%E9%80%92%E7%BB%99downloader%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%A6%82%E6%9E%9C%E9%95%BF%E5%BA%A6%E6%98%AF1+%E9%82%A3%E4%B9%88filter%E4%B8%BAtrue%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfilter+%3A%3D+len%28headers%29+%3D%3D+1%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+filter+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+it%27s+a+potential+DAO+fork+check%2C+validate+against+the+rules%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+p.forkDrop+%21%3D+nil+%26amp%3B%26amp%3B+pm.chainconfig.DAOForkBlock.Cmp%28headers%5B0%5D.Number%29+%3D%3D+0+%7B+%2F%2FDAO%E6%A3%80%E6%9F%A5%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Disable+the+fork+drop+timer%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop.Stop%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop+%3D+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Validate+the+header+and+either+drop+the+peer+or+continue%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+misc.VerifyDAOHeaderExtraData%28pm.chainconfig%2C+headers%5B0%5D%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Verified+to+be+on+the+other+side+of+the+DAO+fork%2C+dropping%22%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Verified+to+be+on+the+same+side+of+the+DAO+fork%22%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Irrelevant+of+the+fork+checks%2C+send+the+header+to+the+fetcher+just+in+case%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AFDAO%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%BA%A4%E7%BB%99%E8%BF%87%E6%BB%A4%E5%99%A8%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4%E3%80%82%E8%BF%87%E6%BB%A4%E5%99%A8%E4%BC%9A%E8%BF%94%E5%9B%9E%E9%9C%80%E8%A6%81%E7%BB%A7%E7%BB%AD%E5%A4%84%E7%90%86%E7%9A%84headers%EF%BC%8C%E8%BF%99%E4%BA%9Bheaders%E4%BC%9A%E8%A2%AB%E4%BA%A4%E7%BB%99downloader%E8%BF%9B%E8%A1%8C%E5%88%86%E5%8F%91%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheaders+%3D+pm.fetcher.FilterHeaders%28p.id%2C+headers%2C+time.Now%28%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28headers%29+%26gt%3B+0+%7C%7C+%21filter+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Berr+%3A%3D+pm.downloader.DeliverHeaders%28p.id%2C+headers%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Failed+to+deliver+headers%22%2C+%22err%22%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+GetBlockBodiesMsg%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Block+Body%E7%9A%84%E8%AF%B7%E6%B1%82+%E8%BF%99%E4%B8%AA%E6%AF%94%E8%BE%83%E7%AE%80%E5%8D%95%E3%80%82+%E4%BB%8Eblockchain%E9%87%8C%E9%9D%A2%E8%8E%B7%E5%8F%96body%E8%BF%94%E5%9B%9E%E5%B0%B1%E8%A1%8C%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Decode+the+retrieval+message%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmsgStream+%3A%3D+rlp.NewStream%28msg.Payload%2C+uint64%28msg.Size%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+err+%3A%3D+msgStream.List%28%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Gather+blocks+until+the+fetch+or+network+limits+is+reached%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+common.Hash%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+int%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbodies+%5B%5Drlp.RawValue%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+bytes+%26lt%3B+softResponseLimit+%26amp%3B%26amp%3B+len%28bodies%29+%26lt%3B+downloader.MaxBlockFetch+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+hash+of+the+next+block%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msgStream.Decode%28%26amp%3Bhash%29%3B+err+%3D%3D+rlp.EOL+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+if+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+requested+block+body%2C+stopping+if+enough+was+found%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+data+%3A%3D+pm.blockchain.GetBodyRLP%28hash%29%3B+len%28data%29+%21%3D+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbodies+%3D+append%28bodies%2C+data%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+%2B%3D+len%28data%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.SendBlockBodiesRLP%28bodies%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+BlockBodiesMsg%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+A+batch+of+block+bodies+arrived+to+one+of+our+previous+requests%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+request+blockBodiesData%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Brequest%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Deliver+them+all+to+the+downloader+for+queuing%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btrasactions+%3A%3D+make%28%5B%5D%5B%5D*types.Transaction%2C+len%28request%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Buncles+%3A%3D+make%28%5B%5D%5B%5D*types.Header%2C+len%28request%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i%2C+body+%3A%3D+range+request+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btrasactions%5Bi%5D+%3D+body.Transactions%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Buncles%5Bi%5D+%3D+body.Uncles%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Filter+out+any+explicitly+requested+bodies%2C+deliver+the+rest+to+the+downloader%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%BF%87%E6%BB%A4%E6%8E%89%E4%BB%BB%E4%BD%95%E6%98%BE%E7%A4%BA%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%8C+%E5%89%A9%E4%B8%8B%E7%9A%84%E4%BA%A4%E7%BB%99downloader%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfilter+%3A%3D+len%28trasactions%29+%26gt%3B+0+%7C%7C+len%28uncles%29+%26gt%3B+0%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+filter+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btrasactions%2C+uncles+%3D+pm.fetcher.FilterBodies%28p.id%2C+trasactions%2C+uncles%2C+time.Now%28%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28trasactions%29+%26gt%3B+0+%7C%7C+len%28uncles%29+%26gt%3B+0+%7C%7C+%21filter+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Berr+%3A%3D+pm.downloader.DeliverBodies%28p.id%2C+trasactions%2C+uncles%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Failed+to+deliver+bodies%22%2C+%22err%22%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+p.version+%26gt%3B%3D+eth63+%26amp%3B%26amp%3B+msg.Code+%3D%3D+GetNodeDataMsg%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%AF%B9%E7%AB%AF%E7%9A%84%E7%89%88%E6%9C%AC%E6%98%AFeth63+%E8%80%8C%E4%B8%94%E6%98%AF%E8%AF%B7%E6%B1%82NodeData%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Decode+the+retrieval+message%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmsgStream+%3A%3D+rlp.NewStream%28msg.Payload%2C+uint64%28msg.Size%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+err+%3A%3D+msgStream.List%28%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Gather+state+data+until+the+fetch+or+network+limits+is+reached%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+common.Hash%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+int%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdata+%5B%5D%5B%5Dbyte%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+bytes+%26lt%3B+softResponseLimit+%26amp%3B%26amp%3B+len%28data%29+%26lt%3B+downloader.MaxStateFetch+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+hash+of+the+next+state+entry%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msgStream.Decode%28%26amp%3Bhash%29%3B+err+%3D%3D+rlp.EOL+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+if+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+requested+state+entry%2C+stopping+if+enough+was+found%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%AF%B7%E6%B1%82%E7%9A%84%E4%BB%BB%E4%BD%95hash%E5%80%BC%E9%83%BD%E4%BC%9A%E8%BF%94%E5%9B%9E%E7%BB%99%E5%AF%B9%E6%96%B9%E3%80%82+%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+entry%2C+err+%3A%3D+pm.chaindb.Get%28hash.Bytes%28%29%29%3B+err+%3D%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdata+%3D+append%28data%2C+entry%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+%2B%3D+len%28entry%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.SendNodeData%28data%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+p.version+%26gt%3B%3D+eth63+%26amp%3B%26amp%3B+msg.Code+%3D%3D+NodeDataMsg%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+A+batch+of+node+state+data+arrived+to+one+of+our+previous+requests%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+data+%5B%5D%5B%5Dbyte%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Bdata%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Deliver+all+to+the+downloader%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E6%95%B0%E6%8D%AE%E4%BA%A4%E7%BB%99downloader%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+pm.downloader.DeliverNodeData%28p.id%2C+data%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Failed+to+deliver+node+state+data%22%2C+%22err%22%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+p.version+%26gt%3B%3D+eth63+%26amp%3B%26amp%3B+msg.Code+%3D%3D+GetReceiptsMsg%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%AF%B7%E6%B1%82%E6%94%B6%E6%8D%AE%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Decode+the+retrieval+message%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmsgStream+%3A%3D+rlp.NewStream%28msg.Payload%2C+uint64%28msg.Size%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+err+%3A%3D+msgStream.List%28%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Gather+state+data+until+the+fetch+or+network+limits+is+reached%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+common.Hash%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+int%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breceipts+%5B%5Drlp.RawValue%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+bytes+%26lt%3B+softResponseLimit+%26amp%3B%26amp%3B+len%28receipts%29+%26lt%3B+downloader.MaxReceiptFetch+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+hash+of+the+next+block%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msgStream.Decode%28%26amp%3Bhash%29%3B+err+%3D%3D+rlp.EOL+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+if+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+requested+block%27s+receipts%2C+skipping+if+unknown+to+us%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bresults+%3A%3D+core.GetBlockReceipts%28pm.chaindb%2C+hash%2C+core.GetBlockNumber%28pm.chaindb%2C+hash%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+results+%3D%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+header+%3A%3D+pm.blockchain.GetHeaderByHash%28hash%29%3B+header+%3D%3D+nil+%7C%7C+header.ReceiptHash+%21%3D+types.EmptyRootHash+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcontinue%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+known%2C+encode+and+queue+for+response+packet%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+encoded%2C+err+%3A%3D+rlp.EncodeToBytes%28results%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Error%28%22Failed+to+encode+receipt%22%2C+%22err%22%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breceipts+%3D+append%28receipts%2C+encoded%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+%2B%3D+len%28encoded%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.SendReceiptsRLP%28receipts%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+p.version+%26gt%3B%3D+eth63+%26amp%3B%26amp%3B+msg.Code+%3D%3D+ReceiptsMsg%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+A+batch+of+receipts+arrived+to+one+of+our+previous+requests%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+receipts+%5B%5D%5B%5D*types.Receipt%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Breceipts%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Deliver+all+to+the+downloader%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+pm.downloader.DeliverReceipts%28p.id%2C+receipts%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Failed+to+deliver+receipts%22%2C+%22err%22%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+NewBlockHashesMsg%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E6%8E%A5%E6%94%B6%E5%88%B0BlockHashesMsg%E6%B6%88%E6%81%AF%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+announces+newBlockHashesData%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Bannounces%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22%25v%3A+%25v%22%2C+msg%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Mark+the+hashes+as+present+at+the+remote+node%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+block+%3A%3D+range+announces+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.MarkBlock%28block.Hash%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Schedule+all+the+unknown+hashes+for+retrieval%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3A%3D+make%28newBlockHashesData%2C+0%2C+len%28announces%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+block+%3A%3D+range+announces+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+%21pm.blockchain.HasBlock%28block.Hash%2C+block.Number%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+append%28unknown%2C+block%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+block+%3A%3D+range+unknown+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E9%80%9A%E7%9F%A5fetcher%E6%9C%89%E4%B8%80%E4%B8%AA%E6%BD%9C%E5%9C%A8%E7%9A%84block%E9%9C%80%E8%A6%81%E4%B8%8B%E8%BD%BD%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.fetcher.Notify%28p.id%2C+block.Hash%2C+block.Number%2C+time.Now%28%29%2C+p.RequestOneHeader%2C+p.RequestBodies%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+NewBlockMsg%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+and+decode+the+propagated+block%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+request+newBlockData%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Brequest%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22%25v%3A+%25v%22%2C+msg%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Brequest.Block.ReceivedAt+%3D+msg.ReceivedAt%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Brequest.Block.ReceivedFrom+%3D+p%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Mark+the+peer+as+owning+the+block+and+schedule+it+for+import%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.MarkBlock%28request.Block.Hash%28%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.fetcher.Enqueue%28p.id%2C+request.Block%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Assuming+the+block+is+importable+by+the+peer%2C+but+possibly+not+yet+done+so%2C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+calculate+the+head+hash+and+TD+that+the+peer+truly+must+have.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtrueHead+%3D+request.Block.ParentHash%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtrueTD+%3D+new%28big.Int%29.Sub%28request.TD%2C+request.Block.Difficulty%28%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Update+the+peers+total+difficulty+if+better+than+the+previous%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+td+%3A%3D+p.Head%28%29%3B+trueTD.Cmp%28td%29+%26gt%3B+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%A6%82%E6%9E%9Cpeer%E7%9A%84%E7%9C%9F%E5%AE%9E%E7%9A%84TD%E5%92%8Chead%E5%92%8C%E6%88%91%E4%BB%AC%E8%BF%99%E8%BE%B9%E8%AE%B0%E8%BD%BD%E7%9A%84%E4%B8%8D%E5%90%8C%EF%BC%8C+%E8%AE%BE%E7%BD%AEpeer%E7%9C%9F%E5%AE%9E%E7%9A%84head%E5%92%8Ctd%EF%BC%8C%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.SetHead%28trueHead%2C+trueTD%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Schedule+a+sync+if+above+ours.+Note%2C+this+will+not+fire+a+sync+for+a+gap+of%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+a+singe+block+%28as+the+true+TD+is+below+the+propagated+block%29%2C+however+this%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+scenario+should+easily+be+covered+by+the+fetcher.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%A6%82%E6%9E%9C%E7%9C%9F%E5%AE%9E%E7%9A%84TD%E6%AF%94%E6%88%91%E4%BB%AC%E7%9A%84TD%E5%A4%A7%EF%BC%8C%E9%82%A3%E4%B9%88%E8%AF%B7%E6%B1%82%E5%92%8C%E8%BF%99%E4%B8%AApeer%E5%90%8C%E6%AD%A5%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BcurrentBlock+%3A%3D+pm.blockchain.CurrentBlock%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+trueTD.Cmp%28pm.blockchain.GetTd%28currentBlock.Hash%28%29%2C+currentBlock.NumberU64%28%29%29%29+%26gt%3B+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.synchronise%28p%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+TxMsg%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Transactions+arrived%2C+make+sure+we+have+a+valid+and+fresh+chain+to+handle+them%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E4%BA%A4%E6%98%93%E4%BF%A1%E6%81%AF%E8%BF%94%E5%9B%9E%E3%80%82+%E5%9C%A8%E6%88%91%E4%BB%AC%E6%B2%A1%E7%94%A8%E5%90%8C%E6%AD%A5%E5%AE%8C%E6%88%90%E4%B9%8B%E5%89%8D%E4%B8%8D%E4%BC%9A%E6%8E%A5%E6%94%B6%E4%BA%A4%E6%98%93%E4%BF%A1%E6%81%AF%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+atomic.LoadUint32%28%26amp%3Bpm.acceptTxs%29+%3D%3D+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Transactions+can+be+processed%2C+parse+all+of+them+and+deliver+to+the+pool%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+txs+%5B%5D*types.Transaction%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Btxs%29%3B+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i%2C+tx+%3A%3D+range+txs+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Validate+and+mark+the+remote+transaction%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+tx+%3D%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22transaction+%25d+is+nil%22%2C+i%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.MarkTransaction%28tx.Hash%28%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E6%B7%BB%E5%8A%A0%E5%88%B0txpool%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.txpool.AddRemotes%28txs%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefault%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrInvalidMsgCode%2C+%22%25v%22%2C+msg.Code%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%E5%87%A0%E7%A7%8D%E5%90%8C%E6%AD%A5synchronise%2C+%E4%B9%8B%E5%89%8D%E5%8F%91%E7%8E%B0%E5%AF%B9%E6%96%B9%E7%9A%84%E8%8A%82%E7%82%B9%E6%AF%94%E8%87%AA%E5%B7%B1%E8%8A%82%E7%82%B9%E8%A6%81%E6%9B%B4%E6%96%B0%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E8%B0%83%E7%94%A8%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95synchronise%EF%BC%8C%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+synchronise+tries+to+sync+up+our+local+block+chain+with+a+remote+peer.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+synchronise+%E5%B0%9D%E8%AF%95+%E8%AE%A9%E6%9C%AC%E5%9C%B0%E5%8C%BA%E5%9D%97%E9%93%BE%E8%B7%9F%E8%BF%9C%E7%AB%AF%E5%90%8C%E6%AD%A5%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28pm+*ProtocolManager%29+synchronise%28peer+*peer%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Short+circuit+if+no+peers+are+available%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+peer+%3D%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Make+sure+the+peer%27s+TD+is+higher+than+our+own%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BcurrentBlock+%3A%3D+pm.blockchain.CurrentBlock%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btd+%3A%3D+pm.blockchain.GetTd%28currentBlock.Hash%28%29%2C+currentBlock.NumberU64%28%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BpHead%2C+pTd+%3A%3D+peer.Head%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pTd.Cmp%28td%29+%26lt%3B%3D+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Otherwise+try+to+sync+with+the+downloader%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmode+%3A%3D+downloader.FullSync%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+atomic.LoadUint32%28%26amp%3Bpm.fastSync%29+%3D%3D+1+%7B+%2F%2F%E5%A6%82%E6%9E%9C%E6%98%BE%E5%BC%8F%E7%94%B3%E6%98%8E%E6%98%AFfast%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Fast+sync+was+explicitly+requested%2C+and+explicitly+granted%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmode+%3D+downloader.FastSync%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+if+currentBlock.NumberU64%28%29+%3D%3D+0+%26amp%3B%26amp%3B+pm.blockchain.CurrentFastBlock%28%29.NumberU64%28%29+%26gt%3B+0+%7B+%2F%2F%E5%A6%82%E6%9E%9C%E6%95%B0%E6%8D%AE%E5%BA%93%E6%98%AF%E7%A9%BA%E7%99%BD%E7%9A%84%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+The+database+seems+empty+as+the+current+block+is+the+genesis.+Yet+the+fast%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+block+is+ahead%2C+so+fast+sync+was+enabled+for+this+node+at+a+certain+point.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+The+only+scenario+where+this+can+happen+is+if+the+user+manually+%28or+via+a%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+bad+block%29+rolled+back+a+fast+sync+node+below+the+sync+point.+In+this+case%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+however+it%27s+safe+to+reenable+fast+sync.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreUint32%28%26amp%3Bpm.fastSync%2C+1%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmode+%3D+downloader.FastSync%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Run+the+sync+cycle%2C+and+disable+fast+sync+if+we%27ve+went+past+the+pivot+block%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Berr+%3A%3D+pm.downloader.Synchronise%28peer.id%2C+pHead%2C+pTd%2C+mode%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+atomic.LoadUint32%28%26amp%3Bpm.fastSync%29+%3D%3D+1+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Disable+fast+sync+if+we+indeed+have+something+in+our+chain%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pm.blockchain.CurrentBlock%28%29.NumberU64%28%29+%26gt%3B+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Info%28%22Fast+sync+complete%2C+auto+disabling%22%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreUint32%28%26amp%3Bpm.fastSync%2C+0%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreUint32%28%26amp%3Bpm.acceptTxs%2C+1%29+%2F%2F+Mark+initial+sync+done%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%90%8C%E6%AD%A5%E5%AE%8C%E6%88%90+%E5%BC%80%E5%A7%8B%E6%8E%A5%E6%94%B6%E4%BA%A4%E6%98%93%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+head+%3A%3D+pm.blockchain.CurrentBlock%28%29%3B+head.NumberU64%28%29+%26gt%3B+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+We%27ve+completed+a+sync+cycle%2C+notify+all+peers+of+new+state.+This+path+is%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+essential+in+star-topology+networks+where+a+gateway+node+needs+to+notify%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+all+its+out-of-date+peers+of+the+availability+of+a+new+block.+This+failure%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+scenario+will+most+often+crop+up+in+private+and+hackathon+networks+with%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+degenerate+connectivity%2C+but+it+should+be+healthy+for+the+mainnet+too+to%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+more+reliably+update+peers+or+the+local+TD+state.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E6%88%91%E4%BB%AC%E5%91%8A%E8%AF%89%E6%89%80%E6%9C%89%E7%9A%84peer%E6%88%91%E4%BB%AC%E7%9A%84%E7%8A%B6%E6%80%81%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.BroadcastBlock%28head%2C+false%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%E4%BA%A4%E6%98%93%E5%B9%BF%E6%92%AD%E3%80%82txBroadcastLoop+%E5%9C%A8start%E7%9A%84%E6%97%B6%E5%80%99%E5%90%AF%E5%8A%A8%E7%9A%84goroutine%E3%80%82+txCh%E5%9C%A8txpool%E6%8E%A5%E6%94%B6%E5%88%B0%E4%B8%80%E6%9D%A1%E5%90%88%E6%B3%95%E7%9A%84%E4%BA%A4%E6%98%93%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E5%BE%80%E8%BF%99%E4%B8%AA%E4%B8%8A%E9%9D%A2%E5%86%99%E5%85%A5%E4%BA%8B%E4%BB%B6%E3%80%82+%E7%84%B6%E5%90%8E%E6%8A%8A%E4%BA%A4%E6%98%93%E5%B9%BF%E6%92%AD%E7%BB%99%E6%89%80%E6%9C%89%E7%9A%84peers%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28self+*ProtocolManager%29+txBroadcastLoop%28%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bselect+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+event+%3A%3D+%26lt%3B-self.txCh%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.BroadcastTx%28event.Tx.Hash%28%29%2C+event.Tx%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Err%28%29+channel+will+be+closed+when+unsubscribing.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-self.txSub.Err%28%29%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%E6%8C%96%E7%9F%BF%E5%B9%BF%E6%92%AD%E3%80%82%E5%BD%93%E6%94%B6%E5%88%B0%E8%AE%A2%E9%98%85%E7%9A%84%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%97%B6%E5%80%99%E6%8A%8A%E6%96%B0%E6%8C%96%E5%88%B0%E7%9A%84%E7%9F%BF%E5%B9%BF%E6%92%AD%E5%87%BA%E5%8E%BB%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Mined+broadcast+loop%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28self+*ProtocolManager%29+minedBroadcastLoop%28%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+automatically+stops+if+unsubscribe%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+obj+%3A%3D+range+self.minedBlockSub.Chan%28%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bswitch+ev+%3A%3D+obj.Data.%28type%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+core.NewMinedBlockEvent%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.BroadcastBlock%28ev.Block%2C+true%29+%2F%2F+First+propagate+block+to+peers%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.BroadcastBlock%28ev.Block%2C+false%29+%2F%2F+Only+then+announce+to+the+rest%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++syncer%E8%B4%9F%E8%B4%A3%E5%AE%9A%E6%9C%9F%E5%92%8C%E7%BD%91%E7%BB%9C%E5%90%8C%E6%AD%A5%EF%BC%8C%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+syncer+is+responsible+for+periodically+synchronising+with+the+network%2C+both%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+downloading+hashes+and+blocks+as+well+as+handling+the+announcement+handler.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F%E5%90%8C%E6%AD%A5%E5%99%A8%E8%B4%9F%E8%B4%A3%E5%91%A8%E6%9C%9F%E6%80%A7%E5%9C%B0%E4%B8%8E%E7%BD%91%E7%BB%9C%E5%90%8C%E6%AD%A5%EF%BC%8C%E4%B8%8B%E8%BD%BD%E6%95%A3%E5%88%97%E5%92%8C%E5%9D%97%E4%BB%A5%E5%8F%8A%E5%A4%84%E7%90%86%E9%80%9A%E7%9F%A5%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28pm+*ProtocolManager%29+syncer%28%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Start+and+ensure+cleanup+of+sync+mechanisms%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.fetcher.Start%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+pm.fetcher.Stop%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+pm.downloader.Terminate%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Wait+for+different+events+to+fire+synchronisation+operations%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BforceSync+%3A%3D+time.NewTicker%28forceSyncCycle%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+forceSync.Stop%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bselect+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-pm.newPeerCh%3A+%2F%2F%E5%BD%93%E6%9C%89%E6%96%B0%E7%9A%84Peer%E5%A2%9E%E5%8A%A0%E7%9A%84%E6%97%B6%E5%80%99+%E4%BC%9A%E5%90%8C%E6%AD%A5%E3%80%82+%E8%BF%99%E4%B8%AA%E6%97%B6%E5%80%99%E8%BF%98%E5%8F%AF%E8%83%BD%E8%A7%A6%E5%8F%91%E5%8C%BA%E5%9D%97%E5%B9%BF%E6%92%AD%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Make+sure+we+have+peers+to+select+from%2C+then+sync%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pm.peers.Len%28%29+%26lt%3B+minDesiredPeerCount+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.synchronise%28pm.peers.BestPeer%28%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-forceSync.C%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%AE%9A%E6%97%B6%E8%A7%A6%E5%8F%91+10%E7%A7%92%E4%B8%80%E6%AC%A1%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Force+a+sync+even+if+not+enough+peers+are+present%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+BestPeer%28%29+%E9%80%89%E6%8B%A9%E6%80%BB%E9%9A%BE%E5%BA%A6%E6%9C%80%E5%A4%A7%E7%9A%84%E8%8A%82%E7%82%B9%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.synchronise%28pm.peers.BestPeer%28%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-pm.noMorePeers%3A+%2F%2F+%E9%80%80%E5%87%BA%E4%BF%A1%E5%8F%B7%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++txsyncLoop%E8%B4%9F%E8%B4%A3%E6%8A%8Apending%E7%9A%84%E4%BA%A4%E6%98%93%E5%8F%91%E9%80%81%E7%BB%99%E6%96%B0%E5%BB%BA%E7%AB%8B%E7%9A%84%E8%BF%9E%E6%8E%A5%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+txsyncLoop+takes+care+of+the+initial+transaction+sync+for+each+new%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+connection.+When+a+new+peer+appears%2C+we+relay+all+currently+pending%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+transactions.+In+order+to+minimise+egress+bandwidth+usage%2C+we+send%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+the+transactions+in+small+packs+to+one+peer+at+a+time.%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtxsyncLoop%E8%B4%9F%E8%B4%A3%E6%AF%8F%E4%B8%AA%E6%96%B0%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%88%9D%E5%A7%8B%E4%BA%8B%E5%8A%A1%E5%90%8C%E6%AD%A5%E3%80%82+%E5%BD%93%E6%96%B0%E7%9A%84%E5%AF%B9%E7%AD%89%E4%BD%93%E5%87%BA%E7%8E%B0%E6%97%B6%EF%BC%8C%E6%88%91%E4%BB%AC%E8%BD%AC%E5%8F%91%E6%89%80%E6%9C%89%E5%BD%93%E5%89%8D%E5%BE%85%E5%A4%84%E7%90%86%E7%9A%84%E4%BA%8B%E5%8A%A1%E3%80%82+%E4%B8%BA%E4%BA%86%E6%9C%80%E5%B0%8F%E5%8C%96%E5%87%BA%E5%8F%A3%E5%B8%A6%E5%AE%BD%E4%BD%BF%E7%94%A8%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%80%E6%AC%A1%E5%B0%86%E4%B8%80%E4%B8%AA%E5%B0%8F%E5%8C%85%E4%B8%AD%E7%9A%84%E4%BA%8B%E5%8A%A1%E5%8F%91%E9%80%81%E7%BB%99%E4%B8%80%E4%B8%AA%E5%AF%B9%E7%AD%89%E4%BD%93%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28pm+*ProtocolManager%29+txsyncLoop%28%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpending+%3D+make%28map%5Bdiscover.NodeID%5D*txsync%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bsending+%3D+false+%2F%2F+whether+a+send+is+active%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpack+%3D+new%28txsync%29+%2F%2F+the+pack+that+is+being+sent%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdone+%3D+make%28chan+error%2C+1%29+%2F%2F+result+of+the+send%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+send+starts+a+sending+a+pack+of+transactions+from+the+sync.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bsend+%3A%3D+func%28s+*txsync%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Fill+pack+with+transactions+up+to+the+target+size.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bsize+%3A%3D+common.StorageSize%280%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpack.p+%3D+s.p%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpack.txs+%3D+pack.txs%5B%3A0%5D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i+%3A%3D+0%3B+i+%26lt%3B+len%28s.txs%29+%26amp%3B%26amp%3B+size+%26lt%3B+txsyncPackSize%3B+i%2B%2B+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpack.txs+%3D+append%28pack.txs%2C+s.txs%5Bi%5D%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bsize+%2B%3D+s.txs%5Bi%5D.Size%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Remove+the+transactions+that+will+be+sent.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bs.txs+%3D+s.txs%5B%3Acopy%28s.txs%2C+s.txs%5Blen%28pack.txs%29%3A%5D%29%5D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28s.txs%29+%3D%3D+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdelete%28pending%2C+s.p.ID%28%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Send+the+pack+in+the+background.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bs.p.Log%28%29.Trace%28%22Sending+batch+of+transactions%22%2C+%22count%22%2C+len%28pack.txs%29%2C+%22bytes%22%2C+size%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bsending+%3D+true%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+func%28%29+%7B+done+%26lt%3B-+pack.p.SendTransactions%28pack.txs%29+%7D%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+pick+chooses+the+next+pending+sync.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E9%9A%8F%E6%9C%BA%E6%8C%91%E9%80%89%E4%B8%80%E4%B8%AAtxsync%E6%9D%A5%E5%8F%91%E9%80%81%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpick+%3A%3D+func%28%29+*txsync+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28pending%29+%3D%3D+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bn+%3A%3D+rand.Intn%28len%28pending%29%29+%2B+1%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+s+%3A%3D+range+pending+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+n--%3B+n+%3D%3D+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+s%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bselect+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+s+%3A%3D+%26lt%3B-pm.txsyncCh%3A+%2F%2F%E4%BB%8E%E8%BF%99%E9%87%8C%E6%8E%A5%E6%94%B6txsyncCh%E6%B6%88%E6%81%AF%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpending%5Bs.p.ID%28%29%5D+%3D+s%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+%21sending+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bsend%28s%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+err+%3A%3D+%26lt%3B-done%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bsending+%3D+false%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Stop+tracking+peers+that+cause+send+failures.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpack.p.Log%28%29.Debug%28%22Transaction+send+failed%22%2C+%22err%22%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdelete%28pending%2C+pack.p.ID%28%29%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Schedule+the+next+send.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+s+%3A%3D+pick%28%29%3B+s+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bsend%28s%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-pm.quitSync%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++txsyncCh%E9%98%9F%E5%88%97%E7%9A%84%E7%94%9F%E4%BA%A7%E8%80%85%EF%BC%8CsyncTransactions%E6%98%AF%E5%9C%A8handle%E6%96%B9%E6%B3%95%E9%87%8C%E9%9D%A2%E8%B0%83%E7%94%A8%E7%9A%84%E3%80%82+%E5%9C%A8%E6%96%B0%E9%93%BE%E6%8E%A5%E5%88%9A%E5%88%9A%E5%88%9B%E5%BB%BA%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E8%A2%AB%E8%B0%83%E7%94%A8%E4%B8%80%E6%AC%A1%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+syncTransactions+starts+sending+all+currently+pending+transactions+to+the+given+peer.%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc+%28pm+*ProtocolManager%29+syncTransactions%28p+*peer%29+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+txs+types.Transactions%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpending%2C+_+%3A%3D+pm.txpool.Pending%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+batch+%3A%3D+range+pending+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btxs+%3D+append%28txs%2C+batch...%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28txs%29+%3D%3D+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bselect+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+pm.txsyncCh+%26lt%3B-+%26amp%3Btxsync%7Bp%2C+txs%7D%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-pm.quitSync%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B%E3%80%82+%E6%88%91%E4%BB%AC%E7%8E%B0%E5%9C%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%A4%A7%E7%9A%84%E6%B5%81%E7%A8%8B%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%E5%8C%BA%E5%9D%97%E5%90%8C%E6%AD%A5%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%3Cspan+style%3D%22color%3A%236796e6%3B%22%3E1.%3C%2Fspan%3E+%E5%A6%82%E6%9E%9C%E6%98%AF%E8%87%AA%E5%B7%B1%E6%8C%96%E7%9A%84%E7%9F%BF%E3%80%82%E9%80%9A%E8%BF%87goroutine+minedBroadcastLoop%28%29%E6%9D%A5%E8%BF%9B%E8%A1%8C%E5%B9%BF%E6%92%AD%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%3Cspan+style%3D%22color%3A%236796e6%3B%22%3E2.%3C%2Fspan%3E+%E5%A6%82%E6%9E%9C%E6%98%AF%E6%8E%A5%E6%94%B6%E5%88%B0%E5%85%B6%E4%BB%96%E4%BA%BA%E7%9A%84%E5%8C%BA%E5%9D%97%E5%B9%BF%E6%92%AD%EF%BC%8C%28NewBlockHashesMsg%2FNewBlockMsg%29%2C%E6%98%AF%E5%90%A6fetcher%E4%BC%9A%E9%80%9A%E7%9F%A5%E7%9A%84peer%EF%BC%9F+TODO%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%3Cspan+style%3D%22color%3A%236796e6%3B%22%3E3.%3C%2Fspan%3E+goroutine+syncer%28%29%E4%B8%AD%E4%BC%9A%E5%AE%9A%E6%97%B6%E7%9A%84%E5%90%8CBestPeer%28%29%E6%9D%A5%E5%90%8C%E6%AD%A5%E4%BF%A1%E6%81%AF%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%E4%BA%A4%E6%98%93%E5%90%8C%E6%AD%A5%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%3Cspan+style%3D%22color%3A%236796e6%3B%22%3E1.%3C%2Fspan%3E+%E6%96%B0%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%E3%80%82+%E6%8A%8Apending%E7%9A%84%E4%BA%A4%E6%98%93%E5%8F%91%E9%80%81%E7%BB%99%E4%BB%96%E3%80%82%0A+++%3C%2Fdiv%3E%0A+++%3Cp%3E%3Cspan+style%3D%22color%3A%236796e6%3B%22%3E2.%3C%2Fspan%3E+%E6%9C%AC%E5%9C%B0%E5%8F%91%E9%80%81%E4%BA%86%E4%B8%80%E4%B8%AA%E4%BA%A4%E6%98%93%EF%BC%8C%E6%88%96%E8%80%85%E6%98%AF%E6%8E%A5%E6%94%B6%E5%88%B0%E5%88%AB%E4%BA%BA%E5%8F%91%E6%9D%A5%E7%9A%84%E4%BA%A4%E6%98%93%E4%BF%A1%E6%81%AF%E3%80%82+txpool%E4%BC%9A%E4%BA%A7%E7%94%9F%E4%B8%80%E6%9D%A1%E6%B6%88%E6%81%AF%EF%BC%8C%E6%B6%88%E6%81%AF%E8%A2%AB%E4%BC%A0%E9%80%92%E5%88%B0txCh%E9%80%9A%E9%81%93%E3%80%82+%E7%84%B6%E5%90%8E%E8%A2%ABgoroutine+txBroadcastLoop%28%29%E5%A4%84%E7%90%86%EF%BC%8C+%E5%8F%91%E9%80%81%E7%BB%99%E5%85%B6%E4%BB%96%E4%B8%8D%E7%9F%A5%E9%81%93%E8%BF%99%E4%B8%AA%E4%BA%A4%E6%98%93%E7%9A%84peer%E3%80%82%3C%2Fp%3E%0A+++%3Cp%3E%3C%2Fp%3E%0A+++%3Ch2+style%3D%22font-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3B%22%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180430224554793%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22+alt%3D%22%22%3E%3Cbr%3E%3Cbr%3E%3C%2Fh2%3E%0A+++%3Cp+style%3D%22color%3Argb%2825%2C25%2C25%29%3Bfont-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3B%22%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180425001235188%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22+alt%3D%22%22%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180425001144107%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22+alt%3D%22%22%3E%3Cbr%3E%3C%2Fp%3E%0A+++%3Cp+style%3D%22color%3Argb%2825%2C25%2C25%29%3Bfont-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3B%22%3E%E7%BD%91%E5%9D%80%EF%BC%9Ahttp%3A%2F%2Fwww.qukuailianxueyuan.io%2F%3Cbr%3E%3C%2Fp%3E%0A+++%3Cp+style%3D%22color%3Argb%2825%2C25%2C25%29%3Bfont-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3B%22%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180426145827720%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22+alt%3D%22%22%3E%3Cbr%3E%3C%2Fp%3E%0A+++%3Cp+style%3D%22color%3Argb%2825%2C25%2C25%29%3Bfont-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3B%22%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F2018042614570887%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22+alt%3D%22%22%3E%3Cbr%3E%3C%2Fp%3E%0A+++%3Cp+style%3D%22color%3Argb%2825%2C25%2C25%29%3Bfont-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3B%22%3E%E6%AC%B2%E9%A2%86%E5%8F%96%E9%80%A0%E5%B8%81%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%85%A8%E5%A5%97%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%B5%84%E6%96%99%3C%2Fp%3E%0A+++%3Cp+style%3D%22font-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3B%22%3E%3Cspan+style%3D%22color%3Argb%2825%2C25%2C25%29%3B%22%3E%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%BA%A4%E6%B5%81QQ%E7%BE%A4%EF%BC%9A%3C%2Fspan%3E%3Cspan+style%3D%22color%3Argb%28255%2C0%2C0%29%3Bbackground-color%3Argb%28255%2C255%2C255%29%3B%22%3E756146052%26nbsp%3B%26nbsp%3B%3C%2Fspan%3E%3Cspan+style%3D%22color%3Argb%2825%2C25%2C25%29%3B%22%3E%E5%A4%87%E6%B3%A8%EF%BC%9ACSDN%3C%2Fspan%3E%3C%2Fp%3E%0A+++%3Cp+style%3D%22color%3Argb%2825%2C25%2C25%29%3Bfont-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3B%22%3E%E5%B0%B9%E6%88%90%E5%AD%A6%E9%99%A2%E5%BE%AE%E4%BF%A1%EF%BC%9A%E5%A4%87%E6%B3%A8%EF%BC%9ACSDN%3C%2Fp%3E%0A+++%3Cp+style%3D%22color%3Argb%2825%2C25%2C25%29%3Btext-align%3Acenter%3Bfont-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3B%22%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180425000635656%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22+alt%3D%22%22%3E%3C%2Fp%3E%0A+++%3Cdiv%3E%0A++++%3Cbr%3E%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A++%3C%2Fdiv%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn+btn-red-hollow%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fitcastcpp%2Farticle%2Fdetails%2F80305409%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fitcastcpp%2Farticle%2Fdetails%2F80305409%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}
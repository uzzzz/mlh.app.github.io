---
layout: default
title: 使用朴素贝叶斯过滤垃圾邮件
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Cdiv+class%3D%22article-copyright%22%3E%0A+++%E7%89%88%E6%9D%83%E5%A3%B0%E6%98%8E%EF%BC%9A%E6%9C%AC%E6%96%87%E4%B8%BA%E5%8D%9A%E4%B8%BB%E5%8E%9F%E5%88%9B%E6%96%87%E7%AB%A0%EF%BC%8C%E6%9C%AA%E7%BB%8F%E5%8D%9A%E4%B8%BB%E5%85%81%E8%AE%B8%E4%B8%8D%E5%BE%97%E8%BD%AC%E8%BD%BD%E3%80%82+https%3A%2F%2Fblog.csdn.net%2Fqq_30241709%2Farticle%2Fdetails%2F87896527+%0A+%3C%2Fdiv%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-f57960eb32.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22+id%3D%22content_views%22%3E+%0A++%3Ch3%3E%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE%EF%BC%9A%E5%88%87%E5%88%86%E6%96%87%E6%9C%AC%3C%2Fh3%3E+%0A++%3Cp%3Epython%E7%9A%84split%28%29%E6%96%B9%E6%B3%95%E5%8F%AF%E4%BB%A5%E5%88%87%E5%88%86%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%8C%E5%AE%83%E6%98%AF%E6%8C%89%E7%85%A7%E7%A9%BA%E6%A0%BC%E5%AF%B9%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E8%A1%8C%E5%88%92%E5%88%86%EF%BC%8C%E6%9C%89%E6%97%B6%E4%B8%8D%E6%98%AF%E9%82%A3%E4%B9%88%E5%87%86%E7%A1%AE%E3%80%82%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3EIn+%5B7%5D%3A+sentence+%3D+%27This+is+the+best+book+on+Python+or+M.L.+I+have+ever+laid+eyes+upon.%27%0A%0AIn+%5B8%5D%3A+sentence.split%28%29%0AOut%5B8%5D%3A%0A%5B%27This%27%2C%0A+%27is%27%2C%0A+%27the%27%2C%0A+%27best%27%2C%0A+%27book%27%2C%0A+%27on%27%2C%0A+%27Python%27%2C%0A+%27or%27%2C%0A+%27M.L.%27%2C%0A+%27I%27%2C%0A+%27have%27%2C%0A+%27ever%27%2C%0A+%27laid%27%2C%0A+%27eyes%27%2C%0A+%27upon.%27%5D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%9D%A5%E5%88%87%E5%88%86%E5%8F%A5%E5%AD%90%E4%BC%9A%E6%9B%B4%E5%87%86%E7%A1%AE%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3EIn+%5B1%5D%3A+import+re%0A%0AIn+%5B2%5D%3A+regular+%3D+re.compile%28%27%5C%5CW*%27%29%0A%0AIn+%5B3%5D%3A+sentence+%3D+%27This+is+the+best+book+on+Python+or+M.L.+I+have+ever+laid+eyes+upon.%27%0A%0AIn+%5B4%5D%3A+list_of_tokens+%3D+regular.split%28sentence%29%0AC%3A%5CUsers%5Cbirdguan%5CAnaconda3%5CScripts%5Cipython%3A1%3A+FutureWarning%3A+split%28%29+requires+a+non-empty+pattern+match.%0A%0AIn+%5B5%5D%3A+list_of_tokens%0AOut%5B5%5D%3A%0A%5B%27This%27%2C%0A+%27is%27%2C%0A+%27the%27%2C%0A+%27best%27%2C%0A+%27book%27%2C%0A+%27on%27%2C%0A+%27Python%27%2C%0A+%27or%27%2C%0A+%27M%27%2C%0A+%27L%27%2C%0A+%27I%27%2C%0A+%27have%27%2C%0A+%27ever%27%2C%0A+%27laid%27%2C%0A+%27eyes%27%2C%0A+%27upon%27%2C%0A+%27%27%5D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E7%8E%B0%E5%9C%A8%E5%BE%97%E5%88%B0%E4%B8%80%E7%B3%BB%E5%88%97%E8%AF%8D%E7%BB%84%E6%88%90%E7%9A%84%E8%AF%8D%E8%A1%A8%EF%BC%8C%E4%BD%86%E6%98%AF%E9%87%8C%E9%9D%A2%E7%9A%84%E7%A9%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%9C%80%E8%A6%81%E5%8E%BB%E6%8E%89%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3EIn+%5B6%5D%3A+%5Btoken+for+token+in+list_of_tokens+if+len%28token%29+%26gt%3B+0%5D%0AOut%5B6%5D%3A%0A%5B%27This%27%2C%0A+%27is%27%2C%0A+%27the%27%2C%0A+%27best%27%2C%0A+%27book%27%2C%0A+%27on%27%2C%0A+%27Python%27%2C%0A+%27or%27%2C%0A+%27M%27%2C%0A+%27L%27%2C%0A+%27I%27%2C%0A+%27have%27%2C%0A+%27ever%27%2C%0A+%27laid%27%2C%0A+%27eyes%27%2C%0A+%27upon%27%5D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E7%8E%B0%E5%9C%A8%E8%A7%A3%E5%86%B3%E5%AD%98%E5%9C%A8%E5%A4%A7%E5%86%99%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3EIn+%5B7%5D%3A+%5Btoken.lower%28%29+for+token+in+list_of_tokens+if+len%28token%29+%26gt%3B+0%5D%0AOut%5B7%5D%3A%0A%5B%27this%27%2C%0A+%27is%27%2C%0A+%27the%27%2C%0A+%27best%27%2C%0A+%27book%27%2C%0A+%27on%27%2C%0A+%27python%27%2C%0A+%27or%27%2C%0A+%27m%27%2C%0A+%27l%27%2C%0A+%27i%27%2C%0A+%27have%27%2C%0A+%27ever%27%2C%0A+%27laid%27%2C%0A+%27eyes%27%2C%0A+%27upon%27%5D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Ch3%3E%E6%B5%8B%E8%AF%95%E7%AE%97%E6%B3%95%EF%BC%9A%E4%BD%BF%E7%94%A8%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E8%BF%9B%E8%A1%8C%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81%3C%2Fh3%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3Eimport+re%0Aimport+numpy+as+np%0A%0A%0Adef+create_vocab_list%28data_set%29%3A%0A++++vocab_set+%3D+set%28%5B%5D%29%0A++++for+document+in+data_set%3A%0A++++++++vocab_set+%3D+vocab_set+%7C+set%28document%29%0A++++return+list%28vocab_set%29%0A%0A%0Adef+set_of_word2vec%28vocab_list%2C+input_set%29%3A%0A++++return_vec+%3D+%5B0%5D+*+len%28vocab_list%29%0A++++for+word+in+input_set%3A%0A++++++++if+word+in+vocab_list%3A%0A++++++++++++return_vec%5Bvocab_list.index%28word%29%5D+%3D+1%0A++++++++else%3A%0A++++++++++++print%28%22the+word%3A+%25s+is+not+in+the+vocabulary%22+%25+word%29%0A++++return+return_vec%0A%0A%0Adef+train_naive_bayes%28train_matrix%2C+train_category%29%3A%0A++++train_docs_num+%3D+len%28train_matrix%29%0A++++words_num+%3D+len%28train_matrix%5B0%5D%29%0A++++p_abusive+%3D+sum%28train_category%29%2Ffloat%28train_docs_num%29%0A++++p0_num+%3D+np.ones%28words_num%29%0A++++p1_num+%3D+np.ones%28words_num%29%0A++++p0_sum+%3D+2.0%0A++++p1_sum+%3D+2.0%0A++++for+i+in+range%28train_docs_num%29%3A%0A++++++++if+train_category%5Bi%5D+%3D%3D+1%3A%0A++++++++++++p1_num+%2B%3D+train_matrix%5Bi%5D%0A++++++++++++p1_sum+%2B%3D+sum%28train_matrix%5Bi%5D%29%0A++++++++else%3A%0A++++++++++++p0_num+%2B%3D+train_matrix%5Bi%5D%0A++++++++++++p0_sum+%2B%3D+sum%28train_matrix%5Bi%5D%29%0A++++p0_vec+%3D+np.log%28p0_num%2Fp0_sum%29%0A++++p1_vec+%3D+np.log%28p1_num%2Fp1_sum%29%0A++++return+p0_vec%2C+p1_vec%2C+p_abusive%0A%0A%0Adef+classify_naive_bayes%28vec2classify%2C+p0_vec%2C+p1_vec%2C+p_class1%29%3A%0A++++p1+%3D+np.sum%28vec2classify+*+p1_vec%29+%2B+np.log%28p_class1%29%0A++++p0+%3D+np.sum%28vec2classify+*+p0_vec%29+%2B+np.log%281+-+p_class1%29%0A++++if+p1+%26gt%3B+p0%3A%0A++++++++return+1%0A++++else%3A%0A++++++++return+0%0A%0A%0Adef+parse_text%28big_string%29%3A%0A++++%22%22%22%0A++++%E6%8E%A5%E5%8F%97%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B9%B6%E5%B0%86%E5%85%B6%E8%A7%A3%E6%9E%90%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%97%E8%A1%A8%0A++++%3Aparam+big_string%3A%0A++++%3Areturn%3A%0A++++%22%22%22%0A++++token_list+%3D+re.split%28r%27%5CW*%27%2C+big_string%29%0A++++return+%5Btoken.lower%28%29+for+token+in+token_list+if+len%28token%29+%26gt%3B+0%5D%0A%0A%0Adef+spam_test%28%29%3A%0A++++doc_list+%3D+%5B%5D%0A++++class_list+%3D+%5B%5D%0A++++full_list+%3D+%5B%5D%0A++++%23+%E5%AF%BC%E5%85%A5%E5%B9%B6%E8%A7%A3%E6%9E%90%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6%0A++++for+i+in+range%281%2C+26%29%3A%0A++++++++word_list+%3D+parse_text%28open%28%27email%2Fspam%2F%25d.txt%27+%25+i%29.read%28%29%29%0A++++++++doc_list.append%28word_list%29%0A++++++++full_list.extend%28word_list%29%0A++++++++class_list.append%281%29%0A++++++++word_list+%3D+parse_text%28open%28%27email%2Fham%2F%25d.txt%27+%25+i%29.read%28%29%29%0A++++++++doc_list.append%28word_list%29%0A++++++++full_list.extend%28word_list%29%0A++++++++class_list.append%280%29%0A++++vocab_list+%3D+create_vocab_list%28doc_list%29%0A++++total_error_count+%3D+0%0A++++for+step+in+range%2810%29%3A%0A++++++++print%28%22%3D%3D%3D%3D%3D%26gt%3B+step++%25d+%26lt%3B%3D%3D%3D%3D%3D%22+%25+%28step%2B1%29%29%0A++++++++train_set+%3D+list%28range%2850%29%29%0A++++++++test_set+%3D+%5B%5D%0A++++++++%23+%E9%9A%8F%E6%9C%BA%E6%9E%84%E5%BB%BA%E8%AE%AD%E7%BB%83%E9%9B%86%0A++++++++for+i+in+range%2810%29%3A%0A++++++++++++rand_index+%3D+int%28np.random.uniform%281%2C+len%28train_set%29%29%29%0A++++++++++++test_set.append%28train_set%5Brand_index%5D%29%0A++++++++++++del+train_set%5Brand_index%5D%0A++++++++train_mat+%3D+%5B%5D%0A++++++++train_class+%3D+%5B%5D%0A++++++++for+doc_index+in+train_set%3A%0A++++++++++++train_mat.append%28set_of_word2vec%28vocab_list%2C+doc_list%5Bdoc_index%5D%29%29%0A++++++++++++train_class.append%28class_list%5Bdoc_index%5D%29%0A++++++++p0_v%2C+p1_v%2C+p_spam+%3D+train_naive_bayes%28train_mat%2C+train_class%29%0A++++++++error_count+%3D+0%0A++++++++for+doc_index+in+test_set%3A%0A++++++++++++word_vector+%3D+set_of_word2vec%28vocab_list%2C+doc_list%5Bdoc_index%5D%29%0A++++++++++++if+classify_naive_bayes%28word_vector%2C+p0_v%2C+p1_v%2C+p_spam%29+%21%3D+class_list%5Bdoc_index%5D%3A%0A++++++++++++++++error_count+%2B%3D+1%0A++++++++++++++++total_error_count+%2B%3D+1%0A++++++++++++++++print%28%22%5BWARNING%5D+The+real+class+of+%22%2C+doc_list%5Bdoc_index%5D%2C+%22is%22%2C+class_list%5Bdoc_index%5D%29%0A++++++++print%28%22Current+error+rate+is%3A%22%2C+float%28error_count%29%2Flen%28test_set%29%29%0A++++print%28%22average+error+rate+is+%25f%22+%25+%28total_error_count%2F%2810*10%29%29%29%0A%0A%0Aif+__name__+%3D%3D+%27__main__%27%3A%0A++++spam_test%28%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E8%BF%99%E9%87%8C%E9%9A%8F%E6%9C%BA%E9%80%89%E6%8B%A9%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86%E4%BD%9C%E4%B8%BA%E8%AE%AD%E7%BB%83%E9%9B%86%EF%BC%8C%E8%80%8C%E5%89%A9%E4%BD%99%E9%83%A8%E5%88%86%E4%BD%9C%E4%B8%BA%E6%B5%8B%E8%AF%95%E9%9B%86%E7%9A%84%E8%BF%87%E7%A8%8B%E7%A7%B0%E4%B8%BA%3Cstrong%3E%E7%95%99%E5%AD%98%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81%3C%2Fstrong%3E%E3%80%82%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E" | url_decode}}
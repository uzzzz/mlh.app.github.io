---
layout: default
title: EOS 之demux源码解析
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Cdiv+class%3D%22markdown_views%22%3E+%0A++%3Ch1+id%3D%22eos-%E4%B9%8Bdemux%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%22%3EEOS+%E4%B9%8Bdemux%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%3C%2Fh1%3E+%0A++%3Cp%3EDemux%E4%BB%8EFacebook%E7%9A%84Flux+Architecture%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F%E5%92%8CRedux%EF%BC%88JavaScript%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%8A%B6%E6%80%81%E5%AE%B9%E5%99%A8%EF%BC%8C%E5%8D%B3%E5%BA%94%E7%94%A8%E6%95%B0%E6%8D%AE%E6%B5%81%E6%A1%86%E6%9E%B6%EF%BC%89%E4%B8%AD%E6%B1%B2%E5%8F%96%E7%81%B5%E6%84%9F%EF%BC%8C%E5%88%9B%E5%BB%BA%E4%BA%86%E4%B8%80%E4%B8%AA%E5%90%8E%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F%E3%80%82Demux%E8%B5%8B%E4%BA%88%E5%8C%BA%E5%9D%97%E9%93%BE%E4%BA%8B%E4%BB%B6%E6%BA%AF%E6%BA%90%E6%8A%80%E6%9C%AF%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%87%86%E7%A1%AE%E5%9C%B0%E6%9B%B4%E6%96%B0EOSIO%E4%B8%8A%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%8F%AF%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%82+%3Cbr%3E+Demux%E7%9A%84%E4%B8%80%E5%A4%A7%E4%BC%98%E5%8A%BF%E6%98%AF%E5%85%81%E8%AE%B8%E5%8C%BA%E5%9D%97%E9%93%BE%E4%BA%8B%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%9C%B0%EF%BC%88%E5%B9%B6%E4%B8%94%E5%8F%AF%E9%AA%8C%E8%AF%81%E5%9C%B0%EF%BC%89%E6%9B%B4%E6%96%B0%E5%88%B0Mongo%E6%88%96Postgres+SQL%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E8%BF%99%E6%84%8F%E5%91%B3%E7%9D%80%E5%AD%98%E5%82%A8%E5%9C%A8%E5%85%B6%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E4%BB%8D%E7%84%B6%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E5%8C%BA%E5%9D%97%E9%93%BE%E8%BF%9B%E8%A1%8C%E9%AA%8C%E8%AF%81%E3%80%82%E5%B9%B6%E4%B8%94%E5%85%BC%E5%85%B7%E4%BC%A0%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%81%B5%E6%B4%BB%E6%80%A7%E5%92%8C%E9%80%9F%E5%BA%A6%EF%BC%8C%E5%8F%8A%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E4%BF%A1%E4%BB%BB%E5%92%8C%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%B1%9E%E6%80%A7%EF%BC%8C%E8%BE%BE%E5%88%B0%E4%BA%86%E4%B8%A4%E5%85%A8%E5%85%B6%E7%BE%8E%E7%9A%84%E6%95%88%E6%9E%9C%E3%80%82+%3Cbr%3E+%3Cimg+src%3D%22https%3A%2F%2Fupload-images.jianshu.io%2Fupload_images%2F13043506-0b0d285a496d72ae%3FimageMogr2%2Fauto-orient%2Fstrip%257CimageView2%2F2%2Fw%2F700%22+alt%3D%22%E8%BF%99%E9%87%8C%E5%86%99%E5%9B%BE%E7%89%87%E6%8F%8F%E8%BF%B0%22+title%3D%22%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%A6%82%E4%B8%8A%E5%9B%BE%E6%89%80%E7%A4%BA%EF%BC%9A+%3Cbr%3E+Action+Reader+%E8%B4%9F%E8%B4%A3%E8%AF%BB%E5%8F%96bloackchain%E7%9A%84%E6%95%B0%E6%8D%AE%E3%80%82+%3Cbr%3E+Action+watcher+%E8%B4%9F%E8%B4%A3%E8%B0%83%E5%BA%A6Action+Reader%E6%A3%80%E6%B5%8B%E6%96%B0%E7%9A%84chain%E6%95%B0%E6%8D%AE%E3%80%82+%3Cbr%3E+Action+Handler+%E8%B4%9F%E8%B4%A3%E8%BF%87%E6%BB%A4%E5%92%8C%E5%88%86%E5%8F%91updaters+%E5%92%8Ceffects%E4%BA%8B%E4%BB%B6%E3%80%82+%3Cbr%3E+%E7%9B%AE%E5%89%8D%E6%88%91%E4%BB%AC%E9%A1%B9%E7%9B%AE%E6%98%AF%E5%9C%A8updaters%E9%87%8C%E9%9D%A2%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B0%E6%8D%AE%EF%BC%8Ceffects%E4%BA%8B%E4%BB%B6%E7%9A%84%E5%85%B7%E4%BD%93%E4%BD%9C%E7%94%A8%E8%BF%98%E6%B2%A1%E6%9C%89%E7%A0%94%E7%A9%B6%E5%88%B0%E3%80%82%3C%2Fp%3E+%0A++%3Ch1+id%3D%22%E9%80%9A%E8%BF%87example%E6%9D%A5%E8%A7%A3%E8%AF%BB%E6%BA%90%E7%A0%81%22%3E%E9%80%9A%E8%BF%87example%E6%9D%A5%E8%A7%A3%E8%AF%BB%E6%BA%90%E7%A0%81%3C%2Fh1%3E+%0A++%3Chr%3E+%0A++%3Cp%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F2018081122383681%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0hhcmJvdXJmeQ%3D%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22+alt%3D%22%E8%BF%99%E9%87%8C%E5%86%99%E5%9B%BE%E7%89%87%E6%8F%8F%E8%BF%B0%22+title%3D%22%22%3E%3C%2Fp%3E+%0A++%3Ch1+id%3D%22indexjs%22%3Eindex.js%3C%2Fh1%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+javascript%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+%7B%0A++readers%3A+%7B+eos%3A+%7B+NodeosActionReader+%7D+%7D%2C%0A++watchers%3A+%7B+BaseActionWatcher+%7D%2C%0A%7D+%3D+%3Cspan+class%3D%22hljs-built_in%22%3Erequire%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-string%22%3E%22..%2F..%2Fdist%2F%22%3C%2Fspan%3E%29%0A%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+ObjectActionHandler+%3D+%3Cspan+class%3D%22hljs-built_in%22%3Erequire%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-string%22%3E%22.%2FObjectActionHandler%22%3C%2Fspan%3E%29%0A%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+updaters+%3D+%3Cspan+class%3D%22hljs-built_in%22%3Erequire%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-string%22%3E%22.%2Fupdaters%22%3C%2Fspan%3E%29%0A%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+effects+%3D+%3Cspan+class%3D%22hljs-built_in%22%3Erequire%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-string%22%3E%22.%2Feffects%22%3C%2Fspan%3E%29%0A%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AE%BE%E7%BD%AEhandler%E5%88%86%E5%8F%91%E7%9A%84updaters%E5%92%8Ceffects%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+actionHandler+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+ObjectActionHandler%28%0A++updaters%2C%0A++effects%2C%0A%29%0A%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%AE%9A%E4%B9%89reader%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%AF%BB%E5%8F%96%E4%BD%8D%E7%BD%AE%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+actionReader+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+NodeosActionReader%28%0A++%3Cspan+class%3D%22hljs-string%22%3E%22http%3A%2F%2Fmainnet.eoscalgary.io%22%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Thanks+EOS+Calgary%21%3C%2Fspan%3E%0A++%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Start+at+most+recent+blocks%3C%2Fspan%3E%0A++%3Cspan+class%3D%22hljs-literal%22%3Etrue%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E8%AE%BE%E7%BD%AE%E6%98%AF%E5%90%A6%E8%8E%B7%E5%8F%96%E4%B8%8D%E5%8F%AF%E9%80%86%E7%9A%84%E6%95%B0%E6%8D%AE%3C%2Fspan%3E%0A%29%0A%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%B0%86reader%E5%92%8Chandler%E8%AE%BE%E7%BD%AE%E5%88%B0watcher%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+actionWatcher+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+BaseActionWatcher%28%0A++actionReader%2C%0A++actionHandler%2C%0A++%3Cspan+class%3D%22hljs-number%22%3E500%3C%2Fspan%3E%2C%0A%29%0A%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+%E5%BC%80%E5%A7%8B%E8%BD%AE%E8%AF%A2%E7%9B%91%E6%8E%A7chain%E6%95%B0%E6%8D%AE%3C%2Fspan%3E%0AactionWatcher.watch%28%29%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3Eexample%E9%87%8C%E9%9D%A2%E7%9A%84%E4%BB%A3%E7%A0%81%E5%B0%B1%E4%B8%8D%E8%B4%B4%E4%BA%86%EF%BC%8C%E6%9C%89%E5%85%B4%E8%B6%A3%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%B7%B1%E7%9C%8B%E7%9C%8B%E6%BA%90%E7%A0%81%E3%80%82%3C%2Fp%3E+%0A++%3Ch1+id%3D%22baseactionwatcher%22%3EBaseActionWatcher%3C%2Fh1%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+javascript%22%3E%3Cspan+class%3D%22hljs-pi%22%3E%22use+strict%22%3C%2Fspan%3E%3B%0A%3Cspan+class%3D%22hljs-keyword%22%3Evar%3C%2Fspan%3E+__awaiter+%3D+%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E+%26amp%3B%26amp%3B+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.__awaiter%29+%7C%7C+%3Cspan+class%3D%22hljs-function%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-params%22%3E%28thisArg%2C+_arguments%2C+P%2C+generator%29%3C%2Fspan%3E+%7B%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+%28P+%7C%7C+%28P+%3D+Promise%29%29%28%3Cspan+class%3D%22hljs-function%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-params%22%3E%28resolve%2C+reject%29%3C%2Fspan%3E+%7B%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-function%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-title%22%3Efulfilled%3C%2Fspan%3E%3Cspan+class%3D%22hljs-params%22%3E%28value%29%3C%2Fspan%3E+%7B%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E+%7B+step%28generator.next%28value%29%29%3B+%7D+%3Cspan+class%3D%22hljs-keyword%22%3Ecatch%3C%2Fspan%3E+%28e%29+%7B+reject%28e%29%3B+%7D+%7D%0A++++++++%3Cspan+class%3D%22hljs-function%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-title%22%3Erejected%3C%2Fspan%3E%3Cspan+class%3D%22hljs-params%22%3E%28value%29%3C%2Fspan%3E+%7B%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E+%7B+step%28generator%5B%3Cspan+class%3D%22hljs-string%22%3E%22throw%22%3C%2Fspan%3E%5D%28value%29%29%3B+%7D+%3Cspan+class%3D%22hljs-keyword%22%3Ecatch%3C%2Fspan%3E+%28e%29+%7B+reject%28e%29%3B+%7D+%7D%0A++++++++%3Cspan+class%3D%22hljs-function%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-title%22%3Estep%3C%2Fspan%3E%3Cspan+class%3D%22hljs-params%22%3E%28result%29%3C%2Fspan%3E+%7B%3C%2Fspan%3E+result.done+%3F+resolve%28result.value%29+%3A+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+P%28%3Cspan+class%3D%22hljs-function%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-params%22%3E%28resolve%29%3C%2Fspan%3E+%7B%3C%2Fspan%3E+resolve%28result.value%29%3B+%7D%29.then%28fulfilled%2C+rejected%29%3B+%7D%0A++++++++step%28%28generator+%3D+generator.apply%28thisArg%2C+_arguments+%7C%7C+%5B%5D%29%29.next%28%29%29%3B%0A++++%7D%29%3B%0A%7D%3B%0A%3Cspan+class%3D%22hljs-built_in%22%3EObject%3C%2Fspan%3E.defineProperty%28exports%2C+%3Cspan+class%3D%22hljs-string%22%3E%22__esModule%22%3C%2Fspan%3E%2C+%7B+value%3A+%3Cspan+class%3D%22hljs-literal%22%3Etrue%3C%2Fspan%3E+%7D%29%3B%0A%3Cspan+class%3D%22hljs-comment%22%3E%2F**+*+Cooredinates+implementations+of+%60AbstractActionReader%60s+and+%60AbstractActionHandler%60s+in+*+a+polling+loop.+*%2F%3C%2Fspan%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Eclass%3C%2Fspan%3E+BaseActionWatcher+%7B%0A++++constructor%28actionReader%2C+actionHandler%2C+pollInterval%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionReader+%3D+actionReader%3B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionHandler+%3D+actionHandler%3B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.pollInterval+%3D+pollInterval%3B%0A++++%7D%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F**+*+Starts+a+polling+loop+running+in+replay+mode.+*%2F%3C%2Fspan%3E%0A++++replay%28%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+__awaiter%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-function%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E*+%3Cspan+class%3D%22hljs-params%22%3E%28%29%3C%2Fspan%3E+%7B%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eyield%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionReader.seekToBlock%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionReader.startAtBlock%29%3B%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eyield%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.watch%28%29%3B%0A++++++++%7D%29%3B%0A++++%7D%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F**+*+Uses+the+given+actionReader+and+actionHandler+to+poll+and+process+new+blocks.+*%2F%3C%2Fspan%3E%0A++++watch%28%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+__awaiter%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-function%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E*+%3Cspan+class%3D%22hljs-params%22%3E%28%29%3C%2Fspan%3E+%7B%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Record+start+time%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+startTime+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-built_in%22%3EDate%3C%2Fspan%3E%28%29.getTime%28%29%3B%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Process+blocks+until+we%27re+at+the+head+block%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Elet%3C%2Fspan%3E+headBlockNumber+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3B%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ewhile%3C%2Fspan%3E+%28%21headBlockNumber+%7C%7C+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionReader.currentBlockNumber+%26lt%3B+headBlockNumber%29+%7B%0A%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+%5BblockData%2C+isRollback%5D+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Eyield%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionReader.nextBlock%28%29%3B%0A++++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Handle+block+%28and+the+actions+within+them%29%3C%2Fspan%3E%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Elet%3C%2Fspan%3E+needToSeek+%3D+%3Cspan+class%3D%22hljs-literal%22%3Efalse%3C%2Fspan%3E%3B%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Elet%3C%2Fspan%3E+seekBlockNum+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3B%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28blockData%29+%7B%0A++++++++++++++++++++%5BneedToSeek%2C+seekBlockNum%5D+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Eyield%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionHandler.handleBlock%28blockData%2C+isRollback%2C+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionReader.isFirstBlock%29%3B%0A++++++++++++++++%7D%0A++++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Seek+to+next+needed+block+at+the+request+of+the+action+handler%3C%2Fspan%3E%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28needToSeek%29+%7B%0A++++++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eyield%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionReader.seekToBlock%28seekBlockNum+-+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29%3B%0A++++++++++++++++%7D%0A++++++++++++++++headBlockNumber+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionReader.headBlockNumber%3B%0A++++++++++++%7D%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Record+end+time%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+endTime+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-built_in%22%3EDate%3C%2Fspan%3E%28%29.getTime%28%29%3B%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Calculate+timing+for+next+iteration%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+duration+%3D+endTime+-+startTime%3B%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Elet%3C%2Fspan%3E+waitTime+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.pollInterval+-+duration%3B%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28waitTime+%26lt%3B+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%29+%7B%0A++++++++++++++++waitTime+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3B%0A++++++++++++%7D%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Schedule+next+iteration%3C%2Fspan%3E%0A++++++++++++setTimeout%28%28%29+%3D%26gt%3B+__awaiter%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-function%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Efunction%3C%2Fspan%3E*+%3Cspan+class%3D%22hljs-params%22%3E%28%29%3C%2Fspan%3E+%7B%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eyield%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.watch%28%29%3B+%7D%29%2C+waitTime%29%3B%0A++++++++%7D%29%3B%0A++++%7D%0A%7D%0Aexports.BaseActionWatcher+%3D+BaseActionWatcher%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E4%B8%8B%E9%9D%A2%E8%BF%99%E6%AE%B5%E4%BB%A3%E7%A0%81%E9%80%9A%E8%BF%87%E9%80%92%E5%BD%92%E8%B0%83%E7%94%A8watch%28%29%E4%B8%80%E7%9B%B4%E8%BD%AE%E8%AF%A2%E5%88%B0%E6%9C%80%E6%96%B0%E6%95%B0%E6%8D%AE%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+coffeescript%22%3EsetTimeout%3Cspan+class%3D%22hljs-function%22%3E%3Cspan+class%3D%22hljs-params%22%3E%28%28%29+%3D%26gt%3B+__awaiter%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-reserved%22%3Evoid%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-reserved%22%3Evoid%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-reserved%22%3Efunction%3C%2Fspan%3E*+%28%29+%7B+%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+yield+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.watch%28%29%3B+%7D%29%2C+waitTime%29%3C%2Fspan%3E%3B%3C%2Fspan%3E%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E4%B8%8B%E9%9D%A2%E7%9C%8B%E7%9C%8B%E5%AF%B9ActionReader%E7%9A%84%E8%B0%83%E5%BA%A6%EF%BC%8C%E4%BB%A5%E5%8F%8Ahandler%E6%97%B6%E9%97%B4%E7%9A%84%E5%88%86%E5%8F%91%E4%BB%A3%E7%A0%81%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+cs%22%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Ewhile%3C%2Fspan%3E+%28%21headBlockNumber+%7C%7C+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionReader.currentBlockNumber+%26lt%3B+headBlockNumber%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+%5BblockData%2C+isRollback%5D+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Eyield%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionReader.nextBlock%28%29%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Handle+block+%28and+the+actions+within+them%29%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Elet%3C%2Fspan%3E+needToSeek+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Efalse%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Elet%3C%2Fspan%3E+seekBlockNum+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28blockData%29+%7B%0A++++++++++%5BneedToSeek%2C+seekBlockNum%5D+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Eyield%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionHandler.handleBlock%28blockData%2C+isRollback%2C+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionReader.isFirstBlock%29%0A++++++++%7D%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Seek+to+next+needed+block+at+the+request+of+the+action+handler%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28needToSeek%29+%7B%0A++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eyield%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionReader.seekToBlock%28seekBlockNum+-+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29%0A++++++++%7D%0A++++++++headBlockNumber+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.actionReader.headBlockNumber%0A++++++%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3Ewhile+%E7%9A%84%E6%9D%A1%E4%BB%B6%21headBlockNumber%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E6%97%B6%E5%80%99%E4%B8%BAtrue%EF%BC%8C%E8%BF%99%E6%97%B6%E5%80%99%E8%BF%9B%E5%85%A5%E8%B0%83%E5%BA%A6%E3%80%82%E9%80%9A%E8%BF%87this.actionReader.nextBlock%28%29%E6%96%B9%E6%B3%95%E8%8E%B7%E5%8F%96%E5%8C%BA%E5%9D%97%E4%BF%A1%E6%81%AFblockData%E5%92%8C%E6%98%AF%E5%90%A6%E5%9B%9E%E6%BB%9AisRollBack%E3%80%82%E6%88%91%E4%BB%AC%E5%86%8D%E6%9D%A5%E7%9C%8B%E7%9C%8BActionReader%E7%9A%84%E4%BB%A3%E7%A0%81%EF%BC%8C%E7%9C%8B%E7%9C%8BnextBlock%28%29%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88%E4%BA%8B%E6%83%85%E3%80%82%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+java%22%3E%0A%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+__awaiter+%3D+%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E+%26amp%3B%26amp%3B+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.__awaiter%29+%7C%7C+function+%28thisArg%2C+_arguments%2C+P%2C+generator%29+%7B%0A++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+%28P+%7C%7C+%28P+%3D+Promise%29%29%28%28%28resolve%2C+reject%29+%3D%26gt%3B+%7B%0A++++function+fulfilled%28value%29+%7B+%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E+%7B+step%28generator.next%28value%29%29+%7D+%3Cspan+class%3D%22hljs-keyword%22%3Ecatch%3C%2Fspan%3E+%28e%29+%7B+reject%28e%29+%7D+%7D%0A++++function+rejected%28value%29+%7B+%3Cspan+class%3D%22hljs-keyword%22%3Etry%3C%2Fspan%3E+%7B+step%28generator.%3Cspan+class%3D%22hljs-keyword%22%3Ethrow%3C%2Fspan%3E%28value%29%29+%7D+%3Cspan+class%3D%22hljs-keyword%22%3Ecatch%3C%2Fspan%3E+%28e%29+%7B+reject%28e%29+%7D+%7D%0A++++function+step%28result%29+%7B+result.done+%3F+resolve%28result.value%29+%3A+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+P%28%28%28resolve%29+%3D%26gt%3B+%7B+resolve%28result.value%29+%7D%29%29.then%28fulfilled%2C+rejected%29+%7D%0A++++step%28%28generator+%3D+generator.apply%28thisArg%2C+_arguments+%7C%7C+%5B%5D%29%29.next%28%29%29%0A++%7D%29%29%0A%7D%0AObject.defineProperty%28exports%2C+%3Cspan+class%3D%22hljs-string%22%3E%22__esModule%22%3C%2Fspan%3E%2C+%7B+value%3A+%3Cspan+class%3D%22hljs-keyword%22%3Etrue%3C%2Fspan%3E+%7D%29%0A%3Cspan+class%3D%22hljs-javadoc%22%3E%2F**+*+Reads+blocks+from+a+blockchain%2C+outputting+normalized+%60Block%60+objects.+*%2F%3C%2Fspan%3E%0Aclass+AbstractActionReader+%7B%0A++constructor%28startAtBlock+%3D+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%2C+onlyIrreversible+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Efalse%3C%2Fspan%3E%2C+maxHistoryLength+%3D+%3Cspan+class%3D%22hljs-number%22%3E600%3C%2Fspan%3E%29+%7B%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.startAtBlock+%3D+startAtBlock%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.onlyIrreversible+%3D+onlyIrreversible%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.maxHistoryLength+%3D+maxHistoryLength%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.headBlockNumber+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.isFirstBlock+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Etrue%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enull%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory+%3D+%5B%5D%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockNumber+%3D+startAtBlock+-+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%0A++%7D%0A++%3Cspan+class%3D%22hljs-javadoc%22%3E%2F**+*+Loads+the+next+block+with+chainInterface+after+validating%2C+updating+all+relevant+state.+*+If+block+fails+validation%2C+rollback+will+be+called%2C+and+will+update+state+to+last+block+unseen.+*%2F%3C%2Fspan%3E%0A++nextBlock%28%29+%7B%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+__awaiter%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+function*+%28%29+%7B%0A++++++let+blockData+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enull%3C%2Fspan%3E%0A++++++let+isRollback+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Efalse%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+If+we%27re+on+the+head+block%2C+refresh+current+head+block%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%9C%A8nextBlock%E4%B8%AD%E9%80%9A%E8%BF%87%E4%B8%8B%E9%9D%A2%E4%BB%A3%E7%A0%81%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%9C%A8%E6%9C%80%E6%96%B0%E5%8C%BA%E5%9D%97%E4%BF%A1%E6%81%AF%E4%B8%8A%E9%9D%A2%EF%BC%8C%E4%B8%8D%E5%86%8D%E5%88%99%E5%88%B7%E6%96%B0%E5%8C%BA%E5%9D%97%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%85%B6%E4%B8%ADgetHeadBlockNumber%28%29%E5%9C%A8eos%E7%9B%AE%E5%BD%95%E4%B8%8B%E9%9D%A2%E7%9A%84NodeosActionReaders%E9%87%8C%E9%9D%A2%EF%BC%8C%E5%B0%B1%E6%98%AF%E8%8E%B7%E5%8F%96%E6%9C%80%E6%96%B0%E5%8C%BA%E5%9D%97%E9%93%BE%E4%BF%A1%E6%81%AF%E3%80%82%E6%B2%A1%E6%9C%89%E7%89%B9%E5%88%AB%E7%9A%84%E4%BB%A3%E7%A0%81%E3%80%82%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%B8%ADthis.headBlockNumber+%3D+0%EF%BC%8C%E6%89%80%E4%BB%A5%E8%BF%99%E9%87%8C%E5%9B%9E%E5%8E%BB%E8%8E%B7%E5%8F%96%E5%8C%BA%E5%9D%97%E9%93%BE%E6%9C%80%E6%96%B0%E7%9A%84number%EF%BC%8C%E5%B9%B6%E6%9B%B4%E6%96%B0headBlockNumber%E3%80%82%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockNumber+%3D%3D%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.headBlockNumber+%7C%7C+%21%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.headBlockNumber%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.headBlockNumber+%3D+yield+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.getHeadBlockNumber%28%29%0A++++++%7D%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+If+currentBlockNumber+is+negative%2C+it+means+we+wrap+to+the+end+of+the+chain+%28most+recent+blocks%29%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+This+should+only+ever+happen+when+we+first+start%2C+so+we+check+that+there%27s+no+block+history%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%88%A4%E6%96%AD%E6%98%AF%E4%B8%8D%E6%98%AF%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%90%AF%E5%8A%A8%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%98%AF%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%90%AF%E5%8A%A8%E5%B9%B6%E5%B0%86%E9%9C%80%E8%A6%81%E6%9B%B4%E6%96%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E6%8C%87%E5%90%91%E6%9C%80%E6%96%B0%E7%9A%84block%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockNumber+%26lt%3B+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E+%26amp%3B%26amp%3B+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory.length+%3D%3D%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockNumber+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.headBlockNumber+%2B+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockNumber%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.startAtBlock+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockNumber+%2B+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%0A++++++%7D%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+If+we%27re+now+behind+one+or+more+new+blocks%2C+process+them%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%A7%A3%E6%9E%90%E6%95%B0%E6%8D%AE%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockNumber+%26lt%3B+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.headBlockNumber%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+unvalidatedBlockData+%3D+yield+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.getBlock%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockNumber+%2B+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+expectedHash+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData+%21%3D%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enull%3C%2Fspan%3E+%3F+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData.blockHash+%3A+%3Cspan+class%3D%22hljs-string%22%3E%22INVALID%22%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+actualHash+%3D+unvalidatedBlockData.previousBlockHash%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Continue+if+the+new+block+is+on+the+same+chain+as+our+history%2C+or+if+we%27ve+just+started%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E5%9B%9E%E6%BB%9A%EF%BC%8C%E4%B8%8D%E5%9B%9E%E6%BB%9A%E5%88%99%E5%B0%86%E5%BD%93%E5%89%8Dnumber%E8%8E%B7%E5%8F%96%E7%9A%84%E5%8C%BA%E5%9D%97%E4%BF%A1%E6%81%AF%E5%BC%80%E5%A7%8B%E8%AE%B0%E5%BD%95%E4%BF%A1%E6%81%AF%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28expectedHash+%3D%3D%3D+actualHash+%7C%7C+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory.length+%3D%3D%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%29+%7B%0A++++++++++blockData+%3D+unvalidatedBlockData+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Block+is+now+validated%3C%2Fspan%3E%0A++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData%29+%7B%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory.push%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+No+longer+current%2C+belongs+on+history%3C%2Fspan%3E%0A++++++++++%7D%0A++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory.splice%28%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory.length+-+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.maxHistoryLength%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Trim+history%3C%2Fspan%3E%0A++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData+%3D+blockData+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Replaced+with+the+real+current+block%3C%2Fspan%3E%0A++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockNumber+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData.blockNumber%0A++++++++%7D+%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E+%7B%0A++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Since+the+new+block+did+not+match+our+history%2C+we+can+assume+our+history+is+wrong%3C%2Fspan%3E%0A++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+and+need+to+roll+back%3C%2Fspan%3E%0A++++++++++yield+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.rollback%28%29%0A++++++++++isRollback+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Etrue%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Signal+action+handler+that+we+must+roll+back%3C%2Fspan%3E%0A++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Reset+for+safety%2C+as+new+fork+could+have+less+blocks+than+the+previous+fork%3C%2Fspan%3E%0A++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.headBlockNumber+%3D+yield+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.getHeadBlockNumber%28%29%0A++++++++%7D%0A++++++%7D%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Let+handler+know+if+this+is+the+earliest+block+we%27ll+send%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.isFirstBlock+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockNumber+%3D%3D%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.startAtBlock%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData+%3D%3D%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enull%3C%2Fspan%3E%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethrow%3C%2Fspan%3E+Error%28%3Cspan+class%3D%22hljs-string%22%3E%22currentBlockData+must+not+be+null.%22%3C%2Fspan%3E%29%0A++++++%7D%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%BF%94%E5%9B%9E%E5%BD%93%E5%89%8D%E5%8C%BA%E5%9D%97%E4%BF%A1%E6%81%AF%EF%BC%8C%E6%98%AF%E5%90%A6%E5%9B%9E%E6%BB%9A%E4%BF%A1%E6%81%AF%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%5B%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData%2C+isRollback%5D%0A++++%7D%29%0A++%7D%0A++%3Cspan+class%3D%22hljs-javadoc%22%3E%2F**+*+Incrementally+rolls+back+reader+state+one+block+at+a+time%2C+comparing+the+blockHistory+with+*+newly+fetched+blocks.+Rollback+is+finished+when+either+the+current+block%27s+previous+hash+*+matches+the+previous+block%27s+hash%2C+or+when+history+is+exhausted.+*+*%3Cspan+class%3D%22hljs-javadoctag%22%3E+%40return%3C%2Fspan%3E+%7BPromise%26lt%3Bvoid%26gt%3B%7D+*%2F%3C%2Fspan%3E%0A++rollback%28%29+%7B%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+__awaiter%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+function*+%28%29+%7B%0A++++++console.info%28%3Cspan+class%3D%22hljs-string%22%3E%22%21%21+Fork+detected+%21%21%22%3C%2Fspan%3E%29%0A++++++let+blocksToRewind%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Rewind+at+least+1+block+back%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory.length+%26gt%3B+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+TODO%3A%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+check+and+throw+error+if+undefined%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+block+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory.pop%28%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28block+%3D%3D%3D+undefined%29+%7B%0A++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethrow%3C%2Fspan%3E+Error%28%3Cspan+class%3D%22hljs-string%22%3E%22block+history+should+not+have+undefined+entries.%22%3C%2Fspan%3E%29%0A++++++++%7D%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData+%3D+yield+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.getBlock%28block.blockNumber%29%0A++++++++blocksToRewind+%3D+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%0A++++++%7D%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Pop+off+blocks+from+cached+block+history+and+compare+them+with+freshly+fetched+blocks%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ewhile%3C%2Fspan%3E+%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory.length+%26gt%3B+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+%5BcachedPreviousBlockData%5D+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory.slice%28-%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+previousBlockData+%3D+yield+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.getBlock%28cachedPreviousBlockData.blockNumber%29%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+TODO%3A%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+add+null+guards%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+currentBlock+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28currentBlock+%21%3D%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enull%3C%2Fspan%3E%29+%7B%0A++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28currentBlock.previousBlockHash+%3D%3D%3D+previousBlockData.blockHash%29+%7B%0A++++++++++++console.info%28%60%E2%9C%93+BLOCK+%24%7BcurrentBlock.blockNumber%7D+MATCH%3A%60%29%0A++++++++++++console.info%28%60++expected%3A+%24%7BcurrentBlock.previousBlockHash%7D%60%29%0A++++++++++++console.info%28%60++received%3A+%24%7BpreviousBlockData.blockHash%7D%60%29%0A++++++++++++console.info%28%60Rewinding+%24%7BblocksToRewind%7D+blocks+to+block+%28%24%7BcurrentBlock.blockNumber%7D%29...%60%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ebreak%3C%2Fspan%3E%0A++++++++++%7D%0A++++++++++console.info%28%60%E2%9C%95+BLOCK+%24%7BcurrentBlock.blockNumber%7D+MISMATCH%3A%60%29%0A++++++++++console.info%28%60++expected%3A+%24%7BcurrentBlock.previousBlockHash%7D%60%29%0A++++++++++console.info%28%60++received%3A+%24%7BpreviousBlockData.blockHash%7D%60%29%0A++++++++++console.info%28%3Cspan+class%3D%22hljs-string%22%3E%22Rollback+history+has+been+exhausted%21%22%3C%2Fspan%3E%29%0A++++++++%7D%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData+%3D+previousBlockData%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory.pop%28%29%0A++++++++blocksToRewind+%2B%3D+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%0A++++++%7D%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory.length+%3D%3D%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%29+%7B%0A++++++++yield+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.rollbackExhausted%28%29%0A++++++%7D%0A++++%7D%29%0A++%7D%0A++%3Cspan+class%3D%22hljs-javadoc%22%3E%2F**+*+When+history+is+exhausted+in+rollback%28%29%2C+this+is+run+to+handle+the+situation.+If+left+unimplemented%2C+*+then+only+instantiate+with+%60onlyIrreversible%60+set+to+true.+*%2F%3C%2Fspan%3E%0A++rollbackExhausted%28%29+%7B%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ethrow%3C%2Fspan%3E+Error%28%3Cspan+class%3D%22hljs-string%22%3E%22Rollback+history+has+been+exhausted%2C+and+no+rollback+exhaustion+handling+has+been+implemented.%22%3C%2Fspan%3E%29%0A++%7D%0A++%3Cspan+class%3D%22hljs-javadoc%22%3E%2F**+*+Move+to+the+specified+block.+*+%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%8C%87%E5%AE%9A%E5%8C%BA%E5%9D%97%EF%BC%8C%E5%BC%80%E5%A7%8B%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE+*%2F%3C%2Fspan%3E%0A++seekToBlock%28blockNumber%29+%7B%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+__awaiter%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+function*+%28%29+%7B%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Clear+current+block+data%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enull%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.headBlockNumber+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+If+we%27re+going+back+to+the+first+block%2C+we+don%27t+want+to+get+the+preceding+block%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28blockNumber+%3D%3D%3D+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory+%3D+%5B%5D%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E%0A++++++%7D%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Check+if+block+exists+in+history%3C%2Fspan%3E%0A++++++let+toDelete+%3D+-%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+%28let+i+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory.length+-+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%3B+i+%26gt%3B%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3B+i--%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory%5Bi%5D.blockNumber+%3D%3D%3D+blockNumber%29+%7B%0A++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ebreak%3C%2Fspan%3E%0A++++++++%7D+%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E+%7B%0A++++++++++toDelete+%2B%3D+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%0A++++++++%7D%0A++++++%7D%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28toDelete+%26gt%3B%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory.splice%28toDelete%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.blockHistory.pop%28%29+%7C%7C+%3Cspan+class%3D%22hljs-keyword%22%3Enull%3C%2Fspan%3E%0A++++++%7D%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Load+current+block%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockNumber+%3D+blockNumber+-+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28%21%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockData+%3D+yield+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.getBlock%28%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.currentBlockNumber%29%0A++++++%7D%0A++++%7D%29%0A++%7D%0A%7D%0Aexports.AbstractActionReader+%3D+AbstractActionReader%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89%E4%BA%86currentBlockNumber%EF%BC%88%E5%BD%93%E5%89%8D%E5%8C%BA%E5%9D%97number%EF%BC%89%EF%BC%8CstartAtBlock%EF%BC%88%E5%BC%80%E5%A7%8B%E5%8C%BA%E5%9D%97number%EF%BC%89%E7%AD%89%E4%BF%A1%E6%81%AF%E3%80%82%E5%85%B7%E4%BD%93%E7%9A%84%E9%80%BB%E8%BE%91%E9%83%BD%E5%9C%A8%E6%B3%A8%E9%87%8A%E9%87%8C%E9%9D%A2%E3%80%82+%3Cbr%3E+%E9%80%9A%E8%BF%87ActionReader%E8%8E%B7%E5%8F%96%E4%BA%86%E5%BD%93%E5%89%8D%E5%8C%BA%E5%9D%97%E4%BF%A1%E6%81%AF%EF%BC%8C%E4%B8%8B%E9%9D%A2%E7%9C%8B%E7%9C%8B%E5%9C%A8%E8%8E%B7%E5%8F%96%E7%9A%84blockData%E4%B9%8B%E5%90%8E%EF%BC%8CActionHandler%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88%E4%BA%8B%E6%83%85%E3%80%82%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+cs%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Epublic%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Easync%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-title%22%3EhandleBlock%3C%2Fspan%3E%28%0A++++block%3A+Block%2C%0A++++isRollback%3A+boolean%2C%0A++++isFirstBlock%3A+boolean%2C%0A++++isReplay%3A+boolean+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Efalse%3C%2Fspan%3E%2C%0A++%29%3A+Promise%26lt%3B%5Bboolean%2C+number%5D%26gt%3B+%7B%0A%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28isRollback%29+%7B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eawait%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.rollbackTo%28block.blockNumber+-+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%29%0A++++%7D%0A%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28%21%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.lastProcessedBlockHash+%26amp%3B%26amp%3B+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.lastProcessedBlockNumber+%3D%3D%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%29+%7B%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%8E%B7%E5%8F%96indexState%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%8F%AF%E4%BB%A5%E5%9C%A8%E8%87%AA%E5%AE%9A%E4%B9%89handler%E7%9A%84%E5%AD%90%E7%B1%BB%E4%B8%AD%E9%87%8D%E5%86%99%EF%BC%8C%E7%94%A8%E4%BA%8E%E8%AE%BE%E7%BD%AE%E6%9C%80%E5%BC%80%E5%A7%8B%E7%9A%84%E5%8C%BA%E5%9D%97%E4%BF%A1%E6%81%AF%E3%80%82%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+%7B+blockNumber%3A+indexStateBlockNumber%2C+blockHash%3A+indexStateBlockHash+%7D+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Eawait%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.loadIndexState%28%29%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28indexStateBlockNumber+%26amp%3B%26amp%3B+indexStateBlockHash%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.lastProcessedBlockNumber+%3D+indexStateBlockNumber%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.lastProcessedBlockHash+%3D+indexStateBlockHash%0A++++++%7D%0A++++%7D%0A%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+nextBlockNeeded+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.lastProcessedBlockNumber+%2B+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Just+processed+this+block%3B+skip%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%A4%84%E7%90%86%E8%BF%87%E7%9A%84%E4%BF%A1%E6%81%AF%EF%BC%8C%E6%9C%80%E6%96%B0%E4%BF%A1%E6%81%AF%E5%B7%B2%E5%A4%84%E7%90%86%EF%BC%8C%E4%B8%8D%E9%9C%80%E8%A6%81%E7%BB%A7%E7%BB%AD%E5%A4%84%E7%90%86%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28block.blockNumber+%3D%3D%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.lastProcessedBlockNumber%0A++++++++%26amp%3B%26amp%3B+block.blockHash+%3D%3D%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.lastProcessedBlockHash%29+%7B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%5B%3Cspan+class%3D%22hljs-keyword%22%3Efalse%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%5D%0A++++%7D%0A%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+If+it%27s+the+first+block+but+we%27ve+already+processed+blocks%2C+seek+to+next+block%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%A6%82%E6%9E%9C%E6%98%AF%E7%AC%AC%E4%B8%80%E6%9D%A1%E4%BF%A1%E6%81%AF%EF%BC%8C%E4%BD%86%E6%98%AF%E5%90%8E%E7%BB%AD%E4%BF%A1%E6%81%AF%E6%9C%AA%E5%A4%84%E7%90%86%EF%BC%8C%E5%88%99%E8%BF%94%E5%9B%9E%E9%9C%80%E8%A6%81%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%8C%87%E5%AE%9A%E5%8C%BA%E5%9D%97%EF%BC%8C%E7%BB%A7%E7%BB%AD%E8%B0%83%E7%94%A8watcher%E6%9B%B4%E6%96%B0%E6%95%B4%E4%B8%AA%E5%8C%BA%E5%9D%97%E4%BF%A1%E6%81%AF%E3%80%82%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28isFirstBlock+%26amp%3B%26amp%3B+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.lastProcessedBlockHash%29+%7B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%5B%3Cspan+class%3D%22hljs-keyword%22%3Etrue%3C%2Fspan%3E%2C+nextBlockNeeded%5D%0A++++%7D%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Only+check+if+this+is+the+block+we+need+if+it%27s+not+the+first+block%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8C%BA%E5%9D%97%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28%21isFirstBlock%29+%7B%0A++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%A6%82%E6%9E%9C%E5%BD%93%E5%89%8D%E5%8C%BA%E5%9D%97number%E4%B8%8D%E6%83%B3%E7%AD%89%EF%BC%8C%E5%88%99%E8%BF%94%E5%9B%9E%E9%9C%80%E8%A6%81%E8%B7%B3%E8%BD%AC%E5%88%B0%E4%B8%8B%E4%B8%80%E5%8C%BA%E5%9D%97%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28block.blockNumber+%21%3D%3D+nextBlockNeeded%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%5B%3Cspan+class%3D%22hljs-keyword%22%3Etrue%3C%2Fspan%3E%2C+nextBlockNeeded%5D%0A++++++%7D%0A++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+Block+sequence+consistency+should+be+handled+by+the+ActionReader+instance%3C%2Fspan%3E%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28block.previousBlockHash+%21%3D%3D+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.lastProcessedBlockHash%29+%7B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ethrow%3C%2Fspan%3E+Error%28%3Cspan+class%3D%22hljs-string%22%3E%22Block+hashes+do+not+match%3B+block+not+part+of+current+chain.%22%3C%2Fspan%3E%29%0A++++++%7D%0A++++%7D%0A%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%B0%83%E7%94%A8updaters%E5%92%8Ceffects%E5%A4%84%E7%90%86%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%95%B0%E6%8D%AE%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+handleWithArgs%3A+%28state%3A+any%2C+context%3F%3A+any%29+%3D%26gt%3B+%3Cspan+class%3D%22hljs-keyword%22%3Evoid%3C%2Fspan%3E+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Easync%3C%2Fspan%3E+%28state%3A+any%2C+context%3A+any+%3D+%7B%7D%29+%3D%26gt%3B+%7B%0A++++++%3Cspan+class%3D%22hljs-keyword%22%3Eawait%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.handleActions%28state%2C+block%2C+context%2C+isReplay%29%0A++++%7D%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eawait%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E.handleWithState%28handleWithArgs%29%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+%5B%3Cspan+class%3D%22hljs-keyword%22%3Efalse%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%5D%0A++%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E8%BF%99%E9%87%8C%E5%B0%B1%E6%98%AF%E5%88%A4%E6%96%AD%E8%8E%B7%E5%8F%96%E5%88%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E7%BB%99%E4%BA%88updaters%E5%92%8Ceffects%E5%A4%84%E7%90%86%EF%BC%8C%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E5%A4%84%E7%90%86%E5%88%99%E8%B0%83%E7%94%A8handleWithState%E6%9D%A5%E9%80%9A%E7%9F%A5updater%E5%92%8Ceffects%E6%9D%A5%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%E3%80%82updater%E5%92%8Ceffects%E5%88%99%E6%A0%B9%E6%8D%AE%E8%87%AA%E5%B7%B1%E5%AE%9A%E4%B9%89%E7%9A%84actionTypes%E6%9D%A5%E5%A4%84%E7%90%86%E7%9B%B8%E5%BA%94%E6%95%B0%E6%8D%AE%E3%80%82+%3Cbr%3E+%E5%85%B6%E4%B8%ADloadIndexState%28%29%E8%8E%B7%E5%8F%96%E7%9A%84%E4%BF%A1%E6%81%AF%E5%A6%82%E6%9E%9C%E5%92%8C%E5%8C%BA%E5%9D%97%E9%93%BE%E4%B8%8A%E5%AF%B9%E5%BA%94%E8%8A%82%E7%82%B9%E4%BF%A1%E6%81%AF%E7%9B%B8%E5%90%8C%EF%BC%8C%E5%88%99%E6%95%B0%E6%8D%AE%E5%B0%86%E4%BB%8EloadIndexState%28%29%E4%B8%AD%E8%8E%B7%E5%8F%96%E7%9A%84%E8%8A%82%E7%82%B9%E4%BF%A1%E6%81%AF%E5%BC%80%E5%A7%8B%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%90%A6%E5%88%99%E4%BB%8Ereader%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E8%8A%82%E7%82%B9%E6%95%B0%E6%8D%AE%E5%BC%80%E5%A7%8B%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E3%80%82ps%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E4%B9%88%E8%AE%BE%E7%BD%AE%EF%BC%8C%E7%9B%AE%E5%89%8D%E5%B0%8F%E7%BC%96%E8%BF%98%E6%B2%A1%E6%9C%89%E6%83%B3%E6%98%8E%E7%99%BD%EF%BC%8C%E6%AC%A2%E8%BF%8E%E5%91%8A%E7%9F%A5%E3%80%82+%3Cbr%3E+%E6%9C%80%E5%90%8E%E5%A6%82%E6%9E%9Chandler%E8%BF%94%E5%9B%9E%E9%9C%80%E8%A6%81%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%8C%87%E5%AE%9A%E7%9A%84block%EF%BC%8C%E5%88%99%E8%B0%83%E7%94%A8reader%E7%9A%84seekToBlock%E6%9D%A5%E6%9B%B4%E6%96%B0%E5%BD%93%E5%89%8D%E8%8A%82%E7%82%B9%E7%9A%84%E6%95%B0%E6%8D%AE%E3%80%82%E4%BB%8E%E8%80%8C%E5%9C%A8%E6%8C%87%E5%AE%9A%E7%9A%84%E8%8A%82%E7%82%B9%E5%BC%80%E5%A7%8B%E9%87%8D%E6%96%B0%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E3%80%82+%3Cbr%3E+%E8%87%B3%E6%AD%A4%EF%BC%8C%E6%95%B4%E4%B8%AA%E6%8A%93%E5%8F%96EOS%E5%8C%BA%E5%9D%97%E9%93%BE%E6%95%B0%E6%8D%AE%E7%9A%84%E9%80%92%E5%BD%92%E9%80%BB%E8%BE%91%E5%B0%B1%E5%88%86%E6%9E%90%E5%AE%8C%E6%AF%95%E3%80%82%E5%A6%82%E6%9C%89%E4%B8%8D%E5%BD%93%EF%BC%8C%E6%9C%9F%E6%9C%9B%E6%8C%87%E5%87%BA%EF%BC%81+%3Cbr%3E+%E8%B0%A2%E8%B0%A2%E3%80%82%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fmarkdown_views-ea0013b516.css%22%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn+btn-red-hollow%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2FHarbourfy%2Farticle%2Fdetails%2F81591947%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2FHarbourfy%2Farticle%2Fdetails%2F81591947%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}
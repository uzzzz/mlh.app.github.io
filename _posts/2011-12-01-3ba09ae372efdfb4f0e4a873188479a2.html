---
layout: default
title: paypal nvp接口编程笔记
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-e2445db1a8.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22%3E+%0A++%3Cp%3Epaypal%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B+1%3A%E9%A6%96%E5%85%88%EF%BC%8C%E7%94%A8%E6%88%B7%E5%B0%86paypal%E6%89%80%E9%9C%80%E7%9A%84%E5%8F%82%E6%95%B0%EF%BC%8C%E8%AF%B8%E5%A6%82%E8%AF%A5%E6%AC%A1%E4%BA%A4%E6%98%93%E7%9A%84%E7%9B%AE%E7%9A%84%E8%B4%A6%E5%8F%B7%EF%BC%8C%E9%87%91%E9%A2%9D%EF%BC%8C%E8%B4%A7%E7%89%A9%E5%90%8D%EF%BC%8C%E4%B8%AA%E6%95%B0%E7%AD%89%E7%AD%89%E4%B8%80%E5%B9%B6%E6%8C%89paypal%E6%8F%90%E4%BE%9B%E7%9A%84%E5%8F%82%E6%95%B0%E6%89%8B%E5%86%8C%E5%86%99%E6%88%90%E4%B8%80%E4%B8%AANVP%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%A7%E6%A6%82%E5%A6%82%E4%B8%8B%E9%9D%A2%E8%BF%99%E6%A0%B7%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+%3C%2Fp%3E+%0A++%3Cpre%3E%3Ccode+class%3D%22language-php%22%3E%24nvpstr%3D%0A++++++++%22%26amp%3BAMT%3D%22.%24payAmount+++++%2F%2F%E6%80%BB%E9%87%91%E9%A2%9D%0A++++++++.%22%26amp%3BPAYMENTACTION%3D%22.%24payType+%2F%2F%E4%BA%A4%E6%98%93%E7%B1%BB%E5%9E%8B%EF%BC%8C%E4%B8%80%E8%88%AC%E6%98%AF%E2%80%98sale%E2%80%99%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E6%98%AF%E6%8D%90%E5%8A%A9%E7%9A%84%E7%B1%BB%E5%9E%8B%0A++++++++.%22%26amp%3BRETURNURL%3D%22.%24returnURL+++%2F%2F%E5%A6%82%E6%9E%9C%E4%BA%A4%E6%98%93%E6%88%90%E5%8A%9F%EF%BC%8C%E8%BF%94%E5%9B%9E%E5%88%B0%E7%9A%84URL%0A++++++++.%22%26amp%3BCANCELURL%3D%22.%24cancelURL+++%2F%2F%E5%A6%82%E6%9E%9C%E4%BA%A4%E6%98%93%E5%A4%B1%E8%B4%A5%EF%BC%8C%E8%BF%94%E5%9B%9E%E5%88%B0%E7%9A%84url%0A++++++++.%22%26amp%3BCURRENCYCODE%3D%22.%24currency+%2F%2F%E8%B4%A7%E5%B8%81%E7%B1%BB%E5%9E%8B%0A++++++++.%22%26amp%3BDESC%3D%22.%24desc%3B++++++++++++%2F%2F%E8%B4%A7%E7%89%A9%E6%8F%8F%E8%BF%B0%3C%2Fcode%3E%3C%2Fpre%3E%E8%BF%99%E4%BA%9B%E5%8F%82%E6%95%B0%E4%B8%BA%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84%EF%BC%8C%E4%B9%9F%E6%9C%89%E4%B8%80%E4%BA%9B%E5%85%B6%E4%BB%96%E5%8F%AF%E9%80%89%E7%9A%84%E5%8F%82%E6%95%B0%EF%BC%8C%E5%85%B7%E4%BD%93%E5%8F%AF%E5%8F%82%E8%80%83%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3+%0A++%3Cp%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%86%99%E5%AE%8C%E5%90%8E%EF%BC%8C%E5%B0%86%E8%BF%99%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%91%E9%80%81%E7%BB%99paypal%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AAtoken%EF%BC%8C%E5%85%B7%E4%BD%93%E5%81%9A%E6%B3%95%E5%B0%B1%E6%98%AF%E5%B0%86%E5%85%B6%E4%B8%8E%E6%8F%90%E4%BE%9B%E7%9A%84%E7%94%9F%E6%88%90token%E7%9A%84url%E8%BF%9E%E8%B5%B7%E6%9D%A5%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%AAhttp%E8%AF%B7%E6%B1%82%EF%BC%8C%E6%88%91%E6%98%AF%E7%94%A8php%E7%9A%84curl%E5%BA%93%E6%9D%A5%E5%AE%9E%E7%8E%B0%E7%9A%84%3C%2Fp%3E+%0A++%3Cp%3E%3C%2Fp%3E+%0A++%3Cpre%3E%3Ccode+class%3D%22language-php%22%3Edefine%28%27API_ENDPOINT%27%2C+%27https%3A%2F%2Fapi-3t.sandbox.paypal.com%2Fnvp%27%29%3B%0A%24API_Endpoint+%3DAPI_ENDPOINT%3B%0A++++++++++++++++%24ch+%3D+curl_init%28%29%3B%0A%09%09curl_setopt%28%24ch%2C+CURLOPT_URL%2C%24API_Endpoint%29%3B%0A%09%09curl_setopt%28%24ch%2C+CURLOPT_VERBOSE%2C+1%29%3B%0A%09%09curl_setopt%28%24ch%2C+CURLOPT_SSL_VERIFYPEER%2C+FALSE%29%3B%0A%09%09curl_setopt%28%24ch%2C+CURLOPT_SSL_VERIFYHOST%2C+FALSE%29%3B%0A%09%09curl_setopt%28%24ch%2C+CURLOPT_RETURNTRANSFER%2C1%29%3B%0A%09%09curl_setopt%28%24ch%2C+CURLOPT_POST%2C+1%29%3B%0A%09%09%24nvpreq%3D%22METHOD%3D%22.urlencode%28%24methodName%29.%22%2F%2F%E6%96%B9%E6%B3%95%E5%90%8D%EF%BC%88%E6%9C%89%E4%B8%89%E7%A7%8D%EF%BC%8C%E8%BF%99%E9%87%8C%E6%98%AF%E5%8F%96%E5%BE%97token%E6%89%80%E4%BB%A5%E6%98%AFSetExpressCheckout%EF%BC%89%0A+++++++++++++++++++++++++%26amp%3BVERSION%3D%22.urlencode%28%24version%29.%22%2F%2Fapi%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7%0A+++++++++++++++++++++++++%26amp%3BPWD%3D%22.urlencode%28%24API_Password%29.%22%2F%2F%E5%95%86%E6%88%B7%E7%9A%84%E5%AF%86%E7%A0%81%EF%BC%8C%E8%AF%A5%E5%8F%82%E6%95%B0%E4%B8%BA%E5%95%86%E5%AE%B6%E5%9C%A8paypal%E6%B3%A8%E5%86%8C%E5%90%8E%E9%80%9A%E8%BF%87%E7%94%B3%E8%AF%B7%E8%8E%B7%E5%BE%97%0A+++++++++++++++++++++++++%26amp%3BUSER%3D%22.urlencode%28%24API_UserName%29.%22%2F%2F%E5%95%86%E6%88%B7%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%EF%BC%8C%E8%AF%A5%E5%8F%82%E6%95%B0%E4%B8%BA%E5%95%86%E5%AE%B6%E5%9C%A8paypal%E6%B3%A8%E5%86%8C%E5%90%8E%E9%80%9A%E8%BF%87%E7%94%B3%E8%AF%B7%E8%8E%B7%E5%BE%97%0A+++++++++++++++++++++++++%26amp%3BSIGNATURE%3D%22.urlencode%28%24API_Signature%29%2F%2F%E5%95%86%E6%88%B7%E7%9A%84%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6%EF%BC%8C%E8%AF%A5%E5%8F%82%E6%95%B0%E4%B8%BA%E5%95%86%E5%AE%B6%E5%9C%A8paypal%E6%B3%A8%E5%86%8C%E5%90%8E%E9%80%9A%E8%BF%87%E7%94%B3%E8%AF%B7%E8%8E%B7%E5%BE%97%0A++++++++++++++++++++++++.%24nvpStr%3B+%2F%2F%E4%B9%8B%E5%89%8D%E7%94%9F%E6%88%90%E7%9A%84%E5%95%86%E5%93%81%E4%BA%A4%E6%98%93%E4%BF%A1%E6%81%AF%E5%AD%97%E7%AC%A6%E4%B8%B2%0A%0A%09%09curl_setopt%28%24ch%2CCURLOPT_POSTFIELDS%2C%24nvpreq%29%3B%0A%0A%09%09%24response+%3D+curl_exec%28%24ch%29%EF%BC%9B%3C%2Fcode%3E%3C%2Fpre%3E%0A++%3Cbr%3E+%E4%B8%8A%E9%9D%A2%E4%BB%A3%E7%A0%81%E7%9A%84%E6%9C%80%E5%90%8E%E8%A1%8C%E4%B8%BA%E6%89%A7%E8%A1%8Ccurl%E7%84%B6%E5%90%8E%E8%8E%B7%E5%BE%97%E8%BF%94%E5%9B%9E%E5%80%BC%24response%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%80%BC%E4%B8%AD%E5%8C%85%E5%90%AB%E4%B8%80%E4%BA%9B%E8%AF%B8%E5%A6%82%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F%EF%BC%8C%E6%97%B6%E9%97%B4%E7%AD%89%E7%AD%89%EF%BC%8C%E4%BD%86%E6%9C%80%E9%87%8D%E8%A6%81%E7%9A%84%E6%98%AFtoken+%0A++%3Cp%3E%3C%2Fp%3E+%0A++%3Cp%3Etoken%E6%98%AF%E4%B8%80%E4%B8%AA%E6%9D%82%E4%B9%B1%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%8C%E5%8F%AF%E8%83%BD%E6%98%AFpaypal%E9%80%9A%E8%BF%87%E6%9F%90%E7%A7%8D%E7%AE%97%E6%B3%95%E7%AE%97%E5%87%BA%E6%9D%A5%E7%9A%84%EF%BC%8C%E4%B9%9F%E5%8F%AF%E8%83%BD%E6%98%AF%E9%9A%8F%E6%9C%BA%E7%94%9F%E6%88%90%E7%9A%84%EF%BC%8C%E4%BD%86%E4%B8%8D%E7%AE%A1%E6%80%8E%E4%B9%88%E6%A0%B7%EF%BC%8C%E4%BD%A0%E5%BF%85%E9%A1%BB%E5%B0%86%E8%BF%99%E4%B8%AAtoken%E9%99%84%E5%8A%A0%E5%88%B0paypal%E7%9A%84%E6%94%AF%E4%BB%98%E9%A1%B5%E9%9D%A2%E7%9A%84URL%E7%9A%84%E6%9C%80%E5%90%8E%E7%9A%84token%3D%E5%90%8E%E9%9D%A2%EF%BC%8C%E7%84%B6%E5%90%8E%E8%AE%BF%E9%97%AE%E8%AF%A5URL%E4%BE%BF%E5%8F%AF%E5%BC%80%E5%A7%8B%E4%BA%A4%E6%98%93%3C%2Fp%3E+%0A++%3Cpre%3E%3Ccode+class%3D%22language-php%22%3Edefine%28%27PAYPAL_URL%27%2C+%27https%3A%2F%2Fwww.sandbox.paypal.com%2Fcgi-bin%2Fwebscr%26amp%3Bcmd%3D_express-checkout%26amp%3Buseraction%3Dcommit%26amp%3Btoken%3D%27%29%3B%0A%26nbsp%3B%26nbsp%3B%26nbsp%3B+%24token+%3D+urldecode%28%24resArray%5B%22TOKEN%22%5D%29%3B%2F%2F%E8%8E%B7%E5%8F%96token+%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B+%26nbsp%3B%0A%26nbsp%3B%26nbsp%3B++%24payPalURL+%3D+PAYPAL_URL.%24token%3B%2F%2F%0A%26nbsp%3B%26nbsp%3B%26nbsp%3B+header%EF%BC%88%24payPalURL%EF%BC%89%3B%2F%2F%E8%AE%BF%E9%97%AEpaypal%E9%A1%B5%E9%9D%A2%E8%BF%9B%E8%A1%8C%E4%BA%A4%E6%98%93%0A%3C%2Fcode%3E%3C%2Fpre%3E2%EF%BC%9A%E8%BF%99%E4%B8%AA%E6%97%B6%E5%80%99%EF%BC%8C%E5%BA%94%E8%AF%A5%E8%BF%9B%E5%85%A5paypal%E6%94%AF%E4%BB%98%E9%A1%B5%E9%9D%A2%E4%BA%86%EF%BC%8C%E5%BD%93%E4%B9%B0%E5%AE%B6%E7%99%BB%E9%99%86%E5%B9%B6%E7%A1%AE%E8%AE%A4%E4%BA%86%E8%AE%A2%E5%8D%95%EF%BC%8C%E9%A1%B5%E9%9D%A2%E5%B0%86%E8%BF%94%E5%9B%9E%E4%BD%A0%E4%B9%8B%E5%89%8D%E5%9C%A8NVP%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E8%AE%BE%E7%BD%AE%E7%9A%84returnURL%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B9%B0%E5%AE%B6%E7%82%B9%E4%BA%86%E5%8F%96%E6%B6%88%EF%BC%8C%E8%B7%B3%E5%88%B0cancelURL+%0A++%3Cp%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%9C%A8returnURL%E6%88%91%E4%BB%AC%E5%B0%86%E8%B0%83%E7%94%A8paypal%E6%8F%90%E4%BE%9B%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%87%BD%E6%95%B0GetExpressCheckoutDetails%E6%9D%A5%E5%8F%96%E5%BE%97%E4%B8%80%E4%BA%9B%E8%B4%AD%E4%B9%B0%E8%80%85%E7%9A%84%E4%BF%A1%E6%81%AF%EF%BC%8C%E6%AF%94%E5%A6%82%E8%AF%B4%EF%BC%8C%E9%80%81%E8%B4%A7%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%80%E8%88%AC%E5%81%9A%E5%AE%9E%E7%89%A9%E4%BA%A4%E6%98%93%E7%9A%84%E7%94%A8%E7%9A%84%E6%AF%94%E8%BE%83%E5%A4%9A%E3%80%82%E5%90%8C%E6%97%B6%EF%BC%8Ctoken%E4%B9%9F%E8%A2%AB%E4%BC%A0%E8%BE%93%E5%9B%9E%E6%9D%A5%EF%BC%8C%E5%BA%94%E4%B8%BA%E5%9C%A8%E6%8E%A5%E4%B8%8B%E6%9D%A5%E9%9C%80%E8%A6%81%E8%BF%99%E4%B8%AA%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E3%EF%BC%9A%E4%BB%A5%E4%B8%8A%E7%9A%84%E6%AD%A5%E9%AA%A4%E4%BB%85%E4%BB%85%E5%8F%AA%E6%98%AFpaypal%E8%8E%B7%E5%8F%96%E4%BA%A4%E6%98%93%E6%89%80%E6%9C%89%E4%BF%A1%E6%81%AF%EF%BC%8C%E4%B9%B0%E5%AE%B6%E5%8D%96%E5%AE%B6%E5%81%9A%E5%87%86%E5%A4%87%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%8C%E6%9C%80%E5%90%8E%E4%B8%80%E6%AD%A5%EF%BC%8C%E8%B0%83%E7%94%A8DoExpressCheckoutPayment%E5%90%8E%EF%BC%8Cpaypal%E6%89%8D%E7%9C%9F%E6%AD%A3%E7%9A%84%E5%B0%86%E9%92%B1%E4%BB%8E%E4%B9%B0%E5%AE%B6%E8%B4%A6%E6%88%B7%E8%BD%AC%E7%A7%BB%E5%88%B0%E5%8D%96%E5%AE%B6%E8%B4%A6%E6%88%B7%E5%B9%B6%E6%94%B6%E5%8F%96%E5%AE%83%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%B4%B9%E7%94%A8%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%E4%BB%A5%E4%B8%8A%E5%A4%A7%E8%87%B4%E4%B8%BApaypal%E7%9A%84%E6%94%AF%E4%BB%98%E8%BF%87%E7%A8%8B%EF%BC%8C%E6%95%B4%E4%B8%AA%E8%BF%87%E7%A8%8B%E4%B8%AD%EF%BC%8Cpaypal%E7%9A%84token%E4%BD%9C%E4%B8%BA%E6%95%B4%E4%B8%AA%E4%BA%A4%E6%98%93%E7%9A%84%E5%94%AF%E4%B8%80%E6%A0%87%E7%A4%BA%EF%BC%8C%E4%BB%8E%E5%B0%86%E5%8F%82%E6%95%B0%E5%8F%91%E5%BE%80api-endpiont%E8%8E%B7%E5%BE%97%E5%BC%80%E5%A7%8B%EF%BC%8C%E4%B8%80%E7%9B%B4%E5%8F%82%E4%B8%8E%E5%85%B6%E4%B8%AD%E7%9B%B4%E5%88%B0%E4%BA%A4%E6%98%93%E7%9A%84%E5%AE%8C%E6%88%90%EF%BC%8C%E8%BF%99%E4%B8%AAtoken%E6%98%AF%E6%9C%89%E6%97%B6%E6%95%88%E7%9A%84%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%E4%BB%A5%E4%B8%8B%E4%B8%BA%E6%88%91%E4%BD%BF%E7%94%A8%E7%9A%84%E5%AE%8C%E6%95%B4%E7%9A%84paypal+nvp%E7%B1%BB%3C%2Fp%3E+%0A++%3Cp%3E%3C%2Fp%3E+%0A++%3Cpre%3E%3Ccode+class%3D%22language-html%22%3E%26lt%3B%3Fphp%0A%2F%2F%E4%BB%A5%E4%B8%8BURL%E4%B8%BAsanbox%EF%BC%8C%E4%BA%A6%E5%8D%B3%E6%B2%99%E7%9B%92%EF%BC%8C%E8%A1%A8%E6%98%8E%E5%B1%9E%E4%BA%8E%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%EF%BC%8C%E7%9C%9F%E5%AE%9E%E7%8E%AF%E5%A2%83%E4%B8%BAhttps%3A%2F%2Fapi-3t.paypal.com%2Fnvp%E5%92%8Chttps%3A%2F%2Fwww.paypal.com%2Fcgi-bin%2Fwebscr%26amp%3Bcmd%3D_express-checkout%26amp%3Buseraction%3Dcommit%26amp%3Btoken%3D%0Adefine%28%27API_ENDPOINT%27%2C+%27https%3A%2F%2Fapi-3t.sandbox.paypal.com%2Fnvp%27%29%3B%0Adefine%28%27PAYPAL_URL%27%2C+%27https%3A%2F%2Fwww.sandbox.paypal.com%2Fcgi-bin%2Fwebscr%26amp%3Bcmd%3D_express-checkout%26amp%3Buseraction%3Dcommit%26amp%3Btoken%3D%27%29%3B%0A%24API_Endpoint+%3DAPI_ENDPOINT%3B%0Aclass+paypal+%7B%0A%09public+%24errMsg+%3D+array%28%29%3B%0A%09function+__construct%28%29+%7B%0A%09%7D%0A++++++++%2F%2F%E8%8E%B7%E5%8F%96token%E7%9A%84%E5%87%BD%E6%95%B0%0A%09function+SetExpressCheckout%28%24params%29+%7B%0A%09%09%24token+%3D+%27%27%3B%0A%09%09%24serverName+%3D+%24_SERVER%5B%27SERVER_NAME%27%5D%3B%0A%09%09%24serverPort+%3D+%24_SERVER%5B%27SERVER_PORT%27%5D%3B%0A%09%09%24url+%3D+dirname%28%27https%3A%2F%2F%27.%24serverName.%27%3A%27.%24serverPort.%24_SERVER%5B%27REQUEST_URI%27%5D%29%3B%0A%09%09%24payAmount+%3D+%24params%5B%27amount%27%5D%3B%0A%09%09%24currency+%3D+%24params%5B%27currency%27%5D%3B%0A%09%09%24payType+%3D+%24params%5B%27payType%27%5D%3B%0A%09%09%24desc+%3D+%24params%5B%27DESC%27%5D%3B%0A%09%09%24returnURL+%3D+urlencode%28%24url.%27%2F%27.%24params%5B%27returnPage%27%5D.%27%3Fcmd%3Dpaypal%26amp%3Bcurrency%3D%27.%24currency.%27%26amp%3BpayType%3D%27.%24payType.%27%26amp%3BpayAmount%3D%27.%24payAmount%29%3B%0A%09%09%24cancelURL+%3D+urlencode%28%24url.%27%2F%27.%24params%5B%27cancelPage%27%5D.%27%3Fcmd%3Dcancel%27%29%3B%0A%09%09%24nvpstr+%3D+%22%26amp%3BAMT%3D%22.%24payAmount.%22%26amp%3BPAYMENTACTION%3D%22.%24payType.%22%26amp%3BRETURNURL%3D%22.%24returnURL.%22%26amp%3BCANCELURL%3D%22.%24cancelURL.%22%26amp%3BCURRENCYCODE%3D%22.%24currency.%22%26amp%3BDESC%3D%22.%24desc%3B%0A%09%09%24resArray%3Dself%3A%3AmakeCall%28%22SetExpressCheckout%22%2C+%24nvpstr%29%3B%0A%09%09if%28%21%24resArray%29+%7B%0A%09%09%09return+false%3B%0A%09%09%7D%0A%09%09if%28array_key_exists%28%27ACK%27%2C+%24resArray%29+AND+strtoupper%28%24resArray%5B%27ACK%27%5D%29+%3D%3D+%27SUCCESS%27%29+%7B%0A%09%09%09if+%28array_key_exists%28%22TOKEN%22%2C%24resArray%29%29+%7B%0A%09%09%09%09%24token+%3D+urldecode%28%24resArray%5B%22TOKEN%22%5D%29%3B%0A%09%09%09%7D%0A%09%09%09%24payPalURL+%3D+PAYPAL_URL.%24token%3B%0A%09%09%09echo+%24payPalURL%3B%0A%09%09%09return+%24payPalURL%3B%0A%09%09%7D%0A%09%09%2F%2F%E6%8F%92%E5%85%A5%E4%BD%A0%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%0A%09%7D%0A++++++++%2F%2F%0A%09function+GetExpressCheckoutDetails%28%24params%29+%7B%0A%09%09%24token+%3D+urlencode%28%24params%5B%27token%27%5D%29%3B%0A%09%09%24nvpstr+%3D+%22%26amp%3BTOKEN%3D%22.%24token%3B%0A%09%09%24resArray+%3D+self%3A%3AmakeCall%28%22GetExpressCheckoutDetails%22%2C%24nvpstr%29%3B%0A%09%09if%28%21%24resArray%29+%7B%0A%09%09%09return+false%3B%0A%09%09%7D%0A%09%09if%28array_key_exists%28%27ACK%27%2C+%24resArray%29+AND+strtoupper%28%24resArray%5B%27ACK%27%5D%29+%3D%3D+%27SUCCESS%27%29+%7B%0A%09%09%09return+%24resArray%3B%0A%09%09%7D+else+%7B%0A%09%09%09%2F%2F%E6%8F%92%E5%85%A5%E4%BD%A0%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%0A%09%09%7D%0A%09%7D%0A++++++++%2F%2F%E7%A1%AE%E5%AE%9A%E6%89%A7%E8%A1%8C%E4%BA%A4%E6%98%93%0A%09function+DoExpressCheckoutPayment%28%24params%29+%7B%0A%09%09%24token+%3D+urlencode%28+%24params%5B%27token%27%5D%29%3B%0A%09%09%24payAmount+%3D+urlencode+%28%24params%5B%27payAmount%27%5D%29%3B%0A%09%09%24payType+%3D+urlencode%28%24params%5B%27payType%27%5D%29%3B%0A%09%09%24payerID+%3D+urlencode%28%24params%5B%27PayerID%27%5D%29%3B%0A%09%09%24nvpstr+%3D+%27%26amp%3BTOKEN%3D%27.%24token.%27%26amp%3BPAYERID%3D%27.%24payerID.%27%26amp%3BPAYMENTACTION%3D%27.%24payType.%27%26amp%3BAMT%3D%27.%24payAmount+%3B%0A%09%09%24resArray+%3D+self%3A%3AmakeCall%28%22DoExpressCheckoutPayment%22%2C%24nvpstr%29%3B%0A%09%09if%28%21%24resArray%29+%7B%0A%09%09%09return+false%3B%0A%09%09%7D%0A%09%09if%28array_key_exists%28%27ACK%27%2C+%24resArray%29+AND+strtoupper%28%24resArray%5B%27ACK%27%5D%29+%3D%3D+%27SUCCESS%27%29+%7B%0A%09%09%09return+%24resArray%3B%0A%09%09%7D+else+%7B%0A%09%09%09+%2F%2F%E6%8F%92%E5%85%A5%E4%BD%A0%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%0A%09%09%7D%0A%09%7D%0A%0A%09function+RefundTransaction%28%24params%29+%7B%0A%09%09%24type+%3D+%24params%5B%27type%27%5D%3B%0A%09%09%24transactionId+%3D+%24params%5B%27transactionId%27%5D%3B%0A%09%09%24amount+%3D+urlencode%28%24params%5B%27amount%27%5D%29%3B%0A%09%09%24nvpstr+%3D+%27%26amp%3BTRANSACTIONID%3D%27.%24transactionId.%27%26amp%3BREFUNDTYPE%3D%27.%24type%3B%0A%09%09if%28%24type+%3D%3D+%27Full%27%29%0A%09%09%24nvpstr+.%3D+%27%26amp%3BAMT%3D%27.%24amount%3B%0A%09%09%24resArray+%3D+self%3A%3AmakeCall%28%22RefundTransaction%22%2C+%24nvpstr%29%3B%0A%09%09if%28%21%24resArray%29%7B%0A%09%09%09return+false%3B%0A%09%09%7D%0A%09%09if%28array_key_exists%28%27ACK%27%2C+%24resArray%29+AND+strtoupper%28%24resArray%5B%27ACK%27%5D%29+%3D%3D+%27SUCCESS%27%29+%7B%0A%09%09%09return+%24resArray%3B%0A%09%09%7D+else+%7B%0A%09%09%09+%2F%2F%E6%8F%92%E5%85%A5%E4%BD%A0%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%0A%09%09%7D%0A%09%7D%0A++++++++%E9%80%9A%E8%BF%87curl%E5%BA%93%E6%9D%A5%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%EF%BC%8C%E8%A2%AB%E4%BB%A5%E4%B8%8A%E7%9A%84%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%0A%09function+makeCall%28%24methodName%2C%24nvpStr%29+%7B%0A%09%09global+%24API_Endpoint%3B%0A%09%09%24version+%3D+%2782.0%27%3B%0A++++++++++++++++%2F%2F%E8%8E%B7%E5%8F%96%E5%95%86%E5%AE%B6%EF%BC%8C%E4%BA%A6%E5%8D%B3%E5%8D%96%E5%AE%B6%E7%9A%84%E8%B4%A6%E6%88%B7%E5%90%8D%EF%BC%8C%E5%AF%86%E7%A0%81%E5%92%8C%E7%AD%BE%E5%90%8D%EF%BC%8C%E6%88%91%E5%B0%86%E8%BF%99%E4%BA%9B%E6%94%BE%E5%9C%A8%E4%B8%80%E4%B8%AAxml%E6%96%87%E4%BB%B6%E4%B8%AD%E8%AF%BB%E5%8F%96%EF%BC%8C%E8%AF%BB%E8%80%85%E5%8F%AF%E8%87%AA%E8%A1%8C%E5%86%B3%E5%AE%9A%E5%A6%82%E4%BD%95%E5%8F%96%E8%BF%99%E4%BA%9B%0A+++++++++++++++%26nbsp%3B%24xml+%3D+new+DOMDocument+%28+%29%3B%0A%09%09%24xml-%26gt%3Bload%28%22xml%2Fxmlforpaypal.xml%22%29%3B%0A%09%09%24item+%3D+%24xml-%26gt%3BgetElementsByTagName%28%22root%22%29-%26gt%3Bitem%280%29%3B%0A%09%09%24item+%3D+%24xml-%26gt%3BgetElementsByTagName%28%22paypal%22%29-%26gt%3Bitem%280%29%3B%0A%09%09%24username+%3D+%24item-%26gt%3BgetElementsByTagName%28%22username%22%29-%26gt%3Bitem%280%29-%26gt%3BtextContent%3B%0A%09%09%24password+%3D+%24item-%26gt%3BgetElementsByTagName%28%22password%22%29-%26gt%3Bitem%280%29-%26gt%3BtextContent%3B%0A%09%09%24signature+%3D+%24item-%26gt%3BgetElementsByTagName%28%22signature%22%29-%26gt%3Bitem%280%29-%26gt%3BtextContent%3B%0A%09%09%24API_UserName+%3D+%24username%3B%0A%09%09%24API_Password+%3D+%24password%3B%0A%09%09%24API_Signature+%3D+%24signature%3B%0A%0A+++++++++++++++%26nbsp%3B%2F%2F++%24nvp_Header%3B%0A%09%09%24ch+%3D+curl_init%28%29%3B%0A%09%09curl_setopt%28%24ch%2C+CURLOPT_URL%2C%24API_Endpoint%29%3B%0A%09%09curl_setopt%28%24ch%2C+CURLOPT_VERBOSE%2C+1%29%3B%0A%09%09curl_setopt%28%24ch%2C+CURLOPT_SSL_VERIFYPEER%2C+FALSE%29%3B%0A%09%09curl_setopt%28%24ch%2C+CURLOPT_SSL_VERIFYHOST%2C+FALSE%29%3B%0A%09%09curl_setopt%28%24ch%2C+CURLOPT_RETURNTRANSFER%2C+1%29%3B%0A%09%09curl_setopt%28%24ch%2C+CURLOPT_POST%2C+1%29%3B%0A%09%09%2F*++if%28USE_PROXY%29%2F%2F%E5%A6%82%E6%9E%9C%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86%0A%09%09+%7B%0A%09%09+curl_setopt+%28%24ch%2C+CURLOPT_PROXY%2C+PROXY_HOST.%22%3A%22.PROXY_PORT%29%3B%0A%09%09+%7D*%2F%0A%09%09%24nvpreq+%3D+%22METHOD%3D%22.urlencode%28%24methodName%29.%22%26amp%3BVERSION%3D%22.urlencode%28%24version%29.%22%26amp%3BPWD%3D%22.urlencode%28%24API_Password%29.%22%26amp%3BUSER%3D%22.urlencode%28%24API_UserName%29.%22%26amp%3BSIGNATURE%3D%22.urlencode%28%24API_Signature%29.%24nvpStr%3B%0A%09%09curl_setopt%28%24ch%2C+CURLOPT_POSTFIELDS%2C+%24nvpreq%29%3B%0A%09%09%24response+%3D+curl_exec%28%24ch%29%3B%0A%09%09%24nvpResArray%3Dself%3A%3AdeformatNVP%28%24response%29%3B%0A%09%09if+%28%21%24response%29+%7B%0A%09%09%09%2F%2F%E6%8F%92%E5%85%A5%E4%BD%A0%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%0A%09%09%09return+false%3B%0A%09%09%7D+else+%7B%0A%09%09%09curl_close%28%24ch%29%3B%0A%09%09%7D%0A%09%09return+%24nvpResArray%3B%0A%09%7D%0A++++++++%2F%2F%E5%85%B3%E4%BA%8E%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E4%BD%A0%E6%87%82%E7%9A%84%0A%09function+deformatNVP%28%24nvpstr%29+%7B%0A%09%09%24intial+%3D+0%3B%0A%09%09%24nvpArray+%3D+array%28%29%3B%0A%09%09while%28strlen%28%24nvpstr%29%29+%7B%0A%09%09%09%24keypos+%3D+strpos%28%24nvpstr%2C+%27%3D%27%29%3B%0A%09%09%09%24valuepos+%3D+strpos%28%24nvpstr%2C%27%26amp%3B%27%29+%3F+strpos%28%24nvpstr%2C%27%26amp%3B%27%29+%3A+strlen%28%24nvpstr%29%3B%0A%09%09%09%24keyval+%3D+substr%28%24nvpstr%2C+%24intial%2C+%24keypos%29%3B%0A%09%09%09%24valval+%3D+substr%28%24nvpstr%2C+%24keypos%2B1%2C+%24valuepos-%24keypos-1%29%3B%0A%09%09%09%24nvpArray%5Burldecode%28%24keyval%29%5D+%3D+urldecode%28%24valval%29%3B%0A%09%09%09%24nvpstr+%3D+substr%28%24nvpstr%2C+%24valuepos%2B1%2C+strlen%28%24nvpstr%29%29%3B%0A%09%09%7D%0A%09%09return+%24nvpArray%3B%0A%09%7D%0A%7D%0A%3F%26gt%3B%3C%2Fcode%3E%3C%2Fpre%3E%0A++%3Cbr%3E%0A++%3Cbr%3E%0A++%3Cp%3E%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn+btn-red-hollow%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fmagic_zj00%2Farticle%2Fdetails%2F7029488%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fmagic_zj00%2Farticle%2Fdetails%2F7029488%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}
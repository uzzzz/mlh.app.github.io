---
layout: default
title: 长短期记忆人工神经网络（LSTM）及其tensorflow代码应用
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-f57960eb32.css%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-f57960eb32.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22+id%3D%22content_views%22%3E+%0A++%3Cp%3E%E8%BD%AC%E8%87%AA%EF%BC%9A%3Ca+href%3D%22https%3A%2F%2Fwww.cnblogs.com%2Fpinking%2Fp%2F9362966.html%22+rel%3D%22nofollow%22%3Ehttps%3A%2F%2Fwww.cnblogs.com%2Fpinking%2Fp%2F9362966.html%3C%2Fa%3E%3C%2Fp%3E+%0A++%3Cp%3E%E6%9C%AC%E6%96%87%E4%B8%BB%E8%A6%81%E5%8C%85%E6%8B%AC%EF%BC%9A%3C%2Fp%3E+%0A++%3Cul%3E%0A+++%3Cli%3E%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFLSTM%3C%2Fli%3E+%0A+++%3Cli%3E%E4%BA%8C%E3%80%81LSTM%E7%9A%84%E6%9B%B2%E7%BA%BF%E6%8B%9F%E5%90%88%3C%2Fli%3E+%0A+++%3Cli%3E%E4%B8%89%E3%80%81LSTM%E7%9A%84%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98%3C%2Fli%3E+%0A+++%3Cli%3E%E5%9B%9B%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88LSTM%E6%9C%89%E5%8A%A9%E4%BA%8E%E6%B6%88%E9%99%A4%E6%A2%AF%E5%BA%A6%E6%B6%88%E5%A4%B1%3C%2Fli%3E+%0A++%3C%2Ful%3E%0A++%3Ch1%3E%3Cstrong%3E%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFLSTM%3C%2Fstrong%3E%3C%2Fh1%3E+%0A++%3Cp%3E%E3%80%80%E3%80%80Long+Short+Term+%E7%BD%91%E7%BB%9C%E5%8D%B3%E4%B8%BALSTM%EF%BC%8C%E6%98%AF%E4%B8%80%E7%A7%8D%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%88RNN%EF%BC%89%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%AD%A6%E4%B9%A0%E9%95%BF%E6%9C%9F%E4%BE%9D%E8%B5%96%E9%97%AE%E9%A2%98%E3%80%82RNN+%E9%83%BD%E5%85%B7%E6%9C%89%E4%B8%80%E7%A7%8D%E9%87%8D%E5%A4%8D%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9D%97%E7%9A%84%E9%93%BE%E5%BC%8F%E7%9A%84%E5%BD%A2%E5%BC%8F%E3%80%82%E5%9C%A8%E6%A0%87%E5%87%86%E7%9A%84+RNN+%E4%B8%AD%EF%BC%8C%E8%BF%99%E4%B8%AA%E9%87%8D%E5%A4%8D%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8F%AA%E6%9C%89%E4%B8%80%E4%B8%AA%E9%9D%9E%E5%B8%B8%E7%AE%80%E5%8D%95%E7%9A%84%E7%BB%93%E6%9E%84%EF%BC%8C%E4%BE%8B%E5%A6%82%E4%B8%80%E4%B8%AA+tanh+%E5%B1%82%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180724214642280-1610978563.png%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%A6%82%E4%B8%8A%E4%B8%BA%E6%A0%87%E5%87%86%E7%9A%84RNN%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84%EF%BC%8CLSTM%E5%88%99%E4%B8%8E%E6%AD%A4%E4%B8%8D%E5%90%8C%EF%BC%8C%E5%85%B6%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84%E5%A6%82%E5%9B%BE%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180724214823153-832403738.png%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E3%80%80%E5%85%B6%E4%B8%AD%EF%BC%8C%E7%BD%91%E7%BB%9C%E4%B8%AD%E5%90%84%E4%B8%AA%E5%85%83%E7%B4%A0%E5%9B%BE%E6%A0%87%E4%B8%BA%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180724214919946-2066373877.png%22%3E%3C%2Fp%3E+%0A++%3Cp%3ELSTM+%E9%80%9A%E8%BF%87%E7%B2%BE%E5%BF%83%E8%AE%BE%E8%AE%A1%E7%9A%84%E7%A7%B0%E4%BD%9C%E4%B8%BA%E2%80%9C%E9%97%A8%E2%80%9D%E7%9A%84%E7%BB%93%E6%9E%84%E6%9D%A5%E5%8E%BB%E9%99%A4%E6%88%96%E8%80%85%E5%A2%9E%E5%8A%A0%E4%BF%A1%E6%81%AF%E5%88%B0%E7%BB%86%E8%83%9E%E7%8A%B6%E6%80%81%E7%9A%84%E8%83%BD%E5%8A%9B%E3%80%82%E9%97%A8%E6%98%AF%E4%B8%80%E7%A7%8D%E8%AE%A9%E4%BF%A1%E6%81%AF%E9%80%89%E6%8B%A9%E5%BC%8F%E9%80%9A%E8%BF%87%E7%9A%84%E6%96%B9%E6%B3%95%E3%80%82%E4%BB%96%E4%BB%AC%E5%8C%85%E5%90%AB%E4%B8%80%E4%B8%AA+sigmoid+%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%B1%82%E5%92%8C%E4%B8%80%E4%B8%AA+pointwise+%E4%B9%98%E6%B3%95%E6%93%8D%E4%BD%9C%E3%80%82LSTM+%E6%8B%A5%E6%9C%89%E4%B8%89%E4%B8%AA%E9%97%A8%EF%BC%8C%E6%9D%A5%E4%BF%9D%E6%8A%A4%E5%92%8C%E6%8E%A7%E5%88%B6%E7%BB%86%E8%83%9E%E7%8A%B6%E6%80%81%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%E3%80%80%E3%80%80%E9%A6%96%E5%85%88%E6%98%AF%E5%BF%98%E8%AE%B0%E9%97%A8%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180724215321206-298272092.png%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%A6%82%E4%B8%8A%EF%BC%8C%E5%BF%98%E8%AE%B0%E9%97%A8%E4%B8%AD%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E6%98%AF%EF%BC%8C%E8%AE%AD%E7%BB%83%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AAwf%E7%9A%84%E6%9D%83%E5%80%BC%EF%BC%8C%E8%80%8C%E4%B8%94%E4%B8%8A%E4%B8%80%E6%97%B6%E5%88%BB%E7%9A%84%E8%BE%93%E5%87%BA%E5%92%8C%E5%BD%93%E5%89%8D%E6%97%B6%E5%88%BB%E7%9A%84%E8%BE%93%E5%85%A5%E6%98%AF%E4%B8%80%E4%B8%AAconcat%E6%93%8D%E4%BD%9C%E3%80%82%E5%BF%98%E8%AE%B0%E9%97%A8%E5%86%B3%E5%AE%9A%E6%88%91%E4%BB%AC%E4%BC%9A%E4%BB%8E%E7%BB%86%E8%83%9E%E7%8A%B6%E6%80%81%E4%B8%AD%E4%B8%A2%E5%BC%83%E4%BB%80%E4%B9%88%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%9B%A0%E4%B8%BAsigmoid%E5%87%BD%E6%95%B0%E7%9A%84%E8%BE%93%E5%87%BA%E6%98%AF%E4%B8%80%E4%B8%AA%E5%B0%8F%E4%BA%8E1%E7%9A%84%E5%80%BC%EF%BC%8C%E7%9B%B8%E5%BD%93%E4%BA%8E%E5%AF%B9%E6%AF%8F%E4%B8%AA%E7%BB%B4%E5%BA%A6%E4%B8%8A%E7%9A%84%E5%80%BC%E5%81%9A%E4%B8%80%E4%B8%AA%E8%A1%B0%E5%87%8F%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%E3%80%80%E3%80%80%E7%84%B6%E5%90%8E%E6%98%AF%E4%BF%A1%E6%81%AF%E5%A2%9E%E5%8A%A0%E9%97%A8%EF%BC%8C%E5%86%B3%E5%AE%9A%E4%BA%86%E4%BB%80%E4%B9%88%E6%96%B0%E7%9A%84%E4%BF%A1%E6%81%AF%E5%88%B0%E7%BB%86%E8%83%9E%E7%8A%B6%E6%80%81%E4%B8%AD%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180724221636253-291187570.png%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%85%B6%E4%B8%AD%EF%BC%8Csigmoid%E5%86%B3%E5%AE%9A%E4%BA%86%E4%BB%80%E4%B9%88%E5%80%BC%E9%9C%80%E8%A6%81%E6%9B%B4%E6%96%B0%EF%BC%8Ctanh%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E7%BB%86%E8%83%9E%E7%8A%B6%E6%80%81%E7%9A%84%E5%80%99%E9%80%89%E5%90%91%E9%87%8FCt%EF%BC%8C%E8%AF%A5%E8%BF%87%E7%A8%8B%E8%AE%AD%E7%BB%83%E4%B8%A4%E4%B8%AA%E6%9D%83%E5%80%BCWi%E5%92%8CWc%E3%80%82%E7%BB%8F%E8%BF%87%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%92%8C%E7%AC%AC%E4%BA%8C%E4%B8%AA%E9%97%A8%E5%90%8E%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%A1%AE%E5%AE%9A%E4%BC%A0%E9%80%92%E4%BF%A1%E6%81%AF%E7%9A%84%E5%88%A0%E9%99%A4%E5%92%8C%E5%A2%9E%E5%8A%A0%EF%BC%8C%E5%8D%B3%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E2%80%9C%E7%BB%86%E8%83%9E%E7%8A%B6%E6%80%81%E2%80%9D%E7%9A%84%E6%9B%B4%E6%96%B0%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180724223305100-1627720971.png%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E3%80%80%E7%AC%AC%E4%B8%89%E4%B8%AA%E9%97%A8%E5%B0%B1%E6%98%AF%E4%BF%A1%E6%81%AF%E8%BE%93%E5%87%BA%E9%97%A8%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180725220824500-753314392.png%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E9%80%9A%E8%BF%87sigmoid%E7%A1%AE%E5%AE%9A%E7%BB%86%E8%83%9E%E7%8A%B6%E6%80%81%E9%82%A3%E4%B8%AA%E9%83%A8%E5%88%86%E5%B0%86%E8%BE%93%E5%87%BA%EF%BC%8Ctanh%E5%A4%84%E7%90%86%E7%BB%86%E8%83%9E%E7%8A%B6%E6%80%81%E5%BE%97%E5%88%B0%E4%B8%80%E4%B8%AA-1%E5%88%B01%E4%B9%8B%E9%97%B4%E7%9A%84%E5%80%BC%EF%BC%8C%E5%86%8D%E5%B0%86%E5%AE%83%E5%92%8Csigmoid%E9%97%A8%E7%9A%84%E8%BE%93%E5%87%BA%E7%9B%B8%E4%B9%98%EF%BC%8C%E8%BE%93%E5%87%BA%E7%A8%8B%E5%BA%8F%E7%A1%AE%E5%AE%9A%E8%BE%93%E5%87%BA%E7%9A%84%E9%83%A8%E5%88%86%E3%80%82%3C%2Fp%3E+%0A++%3Ch1%3E%26nbsp%3B%3Cstrong%3E%E4%BA%8C%E3%80%81LSTM%E7%9A%84%E6%9B%B2%E7%BA%BF%E6%8B%9F%E5%90%88%3C%2Fstrong%3E%3C%2Fh1%3E+%0A++%3Ch2%3E%3Cstrong%3E2.1+%E8%82%A1%E7%A5%A8%E4%BB%B7%E6%A0%BC%E9%A2%84%E6%B5%8B%3C%2Fstrong%3E%3C%2Fh2%3E+%0A++%3Cp%3E%E3%80%80%E3%80%80%E4%B8%8B%E9%9D%A2%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%AA%E7%BD%91%E4%B8%8A%E5%B8%B8%E7%94%A8%E7%9A%84%E5%88%A9%E7%94%A8LSTM%E5%81%9A%E8%82%A1%E7%A5%A8%E4%BB%B7%E6%A0%BC%E7%9A%84%E5%9B%9E%E5%BD%92%E4%BE%8B%E5%AD%90%EF%BC%8C%3Ca+href%3D%22https%3A%2F%2Ffiles.cnblogs.com%2Ffiles%2Fpinking%2Fdataset_2.zip%22+rel%3D%22nofollow%22%3E%E6%95%B0%E6%8D%AE%3C%2Fa%3E%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180729121900737-1504315078.png%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%A6%82%E4%B8%8A%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E7%94%A8%E4%BE%8B%E5%8C%85%E5%90%AB%EF%BC%9Aindex_code%2Cdate%2Copen%2Cclose%2Clow%2Chigh%2Cvolume%2Cmoney%2Cchange%E8%BF%99%E6%A0%B7%E5%87%A0%E4%B8%AA%E7%89%B9%E5%BE%81%E3%80%82%E6%8F%90%E5%8F%96%E7%89%B9%E5%BE%81%E4%BB%8Eopen-change%E4%B8%AA%E7%89%B9%E5%BE%81%EF%BC%8C%E4%BD%9C%E4%B8%BA%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%9A%84%E8%BE%93%E5%85%A5%EF%BC%8C%E8%BE%93%E5%87%BA%E5%8D%B3%E4%B8%BAlabel%E3%80%82%E6%95%B4%E4%B8%AA%E4%BB%A3%E7%A0%81%E5%A6%82%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3Eimport+pandas+as+pd%0Aimport+numpy+as+np%0Aimport+matplotlib.pyplot+as+plt%0Aimport+tensorflow+as+tf%0A+%0A%23%E5%AE%9A%E4%B9%89%E5%B8%B8%E9%87%8F%0Arnn_unit%3D10+++++++%23hidden+layer+units%0Ainput_size%3D7%0Aoutput_size%3D1%0Alr%3D0.0006+++++++++%23%E5%AD%A6%E4%B9%A0%E7%8E%87%0A%23%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%0Af%3Dopen%28%27dataset_2.csv%27%29%0Adf%3Dpd.read_csv%28f%29+++++%23%E8%AF%BB%E5%85%A5%E8%82%A1%E7%A5%A8%E6%95%B0%E6%8D%AE%0Adata%3Ddf.iloc%5B%3A%2C2%3A10%5D.values++%23%E5%8F%96%E7%AC%AC3-10%E5%88%97%0A+%0A+%0A%23%E8%8E%B7%E5%8F%96%E8%AE%AD%E7%BB%83%E9%9B%86%0Adef+get_train_data%28batch_size%3D60%2Ctime_step%3D20%2Ctrain_begin%3D0%2Ctrain_end%3D5800%29%3A%0A++++batch_index%3D%5B%5D%0A++++data_train%3Ddata%5Btrain_begin%3Atrain_end%5D%0A++++normalized_train_data%3D%28data_train-np.mean%28data_train%2Caxis%3D0%29%29%2Fnp.std%28data_train%2Caxis%3D0%29++%23%E6%A0%87%E5%87%86%E5%8C%96%0A++++train_x%2Ctrain_y%3D%5B%5D%2C%5B%5D+++%23%E8%AE%AD%E7%BB%83%E9%9B%86%0A++++for+i+in+range%28len%28normalized_train_data%29-time_step%29%3A%0A+++++++if+i+%25+batch_size%3D%3D0%3A%0A+++++++++++batch_index.append%28i%29%0A+++++++x%3Dnormalized_train_data%5Bi%3Ai%2Btime_step%2C%3A7%5D%0A+++++++y%3Dnormalized_train_data%5Bi%3Ai%2Btime_step%2C7%2Cnp.newaxis%5D%0A+++++++train_x.append%28x.tolist%28%29%29%0A+++++++train_y.append%28y.tolist%28%29%29%0A++++batch_index.append%28%28len%28normalized_train_data%29-time_step%29%29%0A++++return+batch_index%2Ctrain_x%2Ctrain_y%0A+%0A+%0A+%0A%23%E8%8E%B7%E5%8F%96%E6%B5%8B%E8%AF%95%E9%9B%86%0Adef+get_test_data%28time_step%3D20%2Ctest_begin%3D5800%29%3A%0A++++data_test%3Ddata%5Btest_begin%3A%5D%0A++++mean%3Dnp.mean%28data_test%2Caxis%3D0%29%0A++++std%3Dnp.std%28data_test%2Caxis%3D0%29%0A++++normalized_test_data%3D%28data_test-mean%29%2Fstd++%23%E6%A0%87%E5%87%86%E5%8C%96%0A++++size%3D%28len%28normalized_test_data%29%2Btime_step-1%29%2F%2Ftime_step++%23%E6%9C%89size%E4%B8%AAsample%0A++++test_x%2Ctest_y%3D%5B%5D%2C%5B%5D+%0A++++for+i+in+range%28size-1%29%3A%0A+++++++x%3Dnormalized_test_data%5Bi*time_step%3A%28i%2B1%29*time_step%2C%3A7%5D%0A+++++++y%3Dnormalized_test_data%5Bi*time_step%3A%28i%2B1%29*time_step%2C7%5D%0A+++++++test_x.append%28x.tolist%28%29%29%0A+++++++test_y.extend%28y%29%0A++++test_x.append%28%28normalized_test_data%5B%28i%2B1%29*time_step%3A%2C%3A7%5D%29.tolist%28%29%29%0A++++test_y.extend%28%28normalized_test_data%5B%28i%2B1%29*time_step%3A%2C7%5D%29.tolist%28%29%29%0A++++return+mean%2Cstd%2Ctest_x%2Ctest_y%0A+%0A+%0A+%0A%23%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E5%AE%9A%E4%B9%89%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%8F%98%E9%87%8F%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%0A%23%E8%BE%93%E5%85%A5%E5%B1%82%E3%80%81%E8%BE%93%E5%87%BA%E5%B1%82%E6%9D%83%E9%87%8D%E3%80%81%E5%81%8F%E7%BD%AE%0A+%0Aweights%3D%7B%0A+++++++++%27in%27%3Atf.Variable%28tf.random_normal%28%5Binput_size%2Crnn_unit%5D%29%29%2C%0A+++++++++%27out%27%3Atf.Variable%28tf.random_normal%28%5Brnn_unit%2C1%5D%29%29%0A++++++++%7D%0Abiases%3D%7B%0A++++++++%27in%27%3Atf.Variable%28tf.constant%280.1%2Cshape%3D%5Brnn_unit%2C%5D%29%29%2C%0A++++++++%27out%27%3Atf.Variable%28tf.constant%280.1%2Cshape%3D%5B1%2C%5D%29%29%0A+++++++%7D%0A+%0A%23%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E5%AE%9A%E4%B9%89%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%8F%98%E9%87%8F%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%0Adef+lstm%28X%29%3A++++%0A++++batch_size%3Dtf.shape%28X%29%5B0%5D%0A++++time_step%3Dtf.shape%28X%29%5B1%5D%0A++++w_in%3Dweights%5B%27in%27%5D%0A++++b_in%3Dbiases%5B%27in%27%5D+%0A++++input%3Dtf.reshape%28X%2C%5B-1%2Cinput_size%5D%29++%23%E9%9C%80%E8%A6%81%E5%B0%86tensor%E8%BD%AC%E6%88%902%E7%BB%B4%E8%BF%9B%E8%A1%8C%E8%AE%A1%E7%AE%97%EF%BC%8C%E8%AE%A1%E7%AE%97%E5%90%8E%E7%9A%84%E7%BB%93%E6%9E%9C%E4%BD%9C%E4%B8%BA%E9%9A%90%E8%97%8F%E5%B1%82%E7%9A%84%E8%BE%93%E5%85%A5%0A++++input_rnn%3Dtf.matmul%28input%2Cw_in%29%2Bb_in%0A++++input_rnn%3Dtf.reshape%28input_rnn%2C%5B-1%2Ctime_step%2Crnn_unit%5D%29++%23%E5%B0%86tensor%E8%BD%AC%E6%88%903%E7%BB%B4%EF%BC%8C%E4%BD%9C%E4%B8%BAlstm+cell%E7%9A%84%E8%BE%93%E5%85%A5%0A++++cell%3Dtf.nn.rnn_cell.BasicLSTMCell%28rnn_unit%29%0A++++init_state%3Dcell.zero_state%28batch_size%2Cdtype%3Dtf.float32%29%0A++++output_rnn%2Cfinal_states%3Dtf.nn.dynamic_rnn%28cell%2C+input_rnn%2Cinitial_state%3Dinit_state%2C+dtype%3Dtf.float32%29++%23output_rnn%E6%98%AF%E8%AE%B0%E5%BD%95lstm%E6%AF%8F%E4%B8%AA%E8%BE%93%E5%87%BA%E8%8A%82%E7%82%B9%E7%9A%84%E7%BB%93%E6%9E%9C%EF%BC%8Cfinal_states%E6%98%AF%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AAcell%E7%9A%84%E7%BB%93%E6%9E%9C%0A++++output%3Dtf.reshape%28output_rnn%2C%5B-1%2Crnn_unit%5D%29+%23%E4%BD%9C%E4%B8%BA%E8%BE%93%E5%87%BA%E5%B1%82%E7%9A%84%E8%BE%93%E5%85%A5%0A++++w_out%3Dweights%5B%27out%27%5D%0A++++b_out%3Dbiases%5B%27out%27%5D%0A++++pred%3Dtf.matmul%28output%2Cw_out%29%2Bb_out%0A++++return+pred%2Cfinal_states%0A+%0A+%0A+%0A%23%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%0Adef+train_lstm%28batch_size%3D80%2Ctime_step%3D15%2Ctrain_begin%3D2000%2Ctrain_end%3D5800%29%3A%0A++++X%3Dtf.placeholder%28tf.float32%2C+shape%3D%5BNone%2Ctime_step%2Cinput_size%5D%29%0A++++Y%3Dtf.placeholder%28tf.float32%2C+shape%3D%5BNone%2Ctime_step%2Coutput_size%5D%29%0A++++%23+%E8%AE%AD%E7%BB%83%E6%A0%B7%E6%9C%AC%E4%B8%AD%E7%AC%AC2001+-+5785%E4%B8%AA%E6%A0%B7%E6%9C%AC%EF%BC%8C%E6%AF%8F%E6%AC%A1%E5%8F%9615%E4%B8%AA%0A++++batch_index%2Ctrain_x%2Ctrain_y%3Dget_train_data%28batch_size%2Ctime_step%2Ctrain_begin%2Ctrain_end%29%0A++++print%28np.array%28train_x%29.shape%29%23+3785++15++7%0A++++print%28batch_index%29%0A++++%23%E7%9B%B8%E5%BD%93%E4%BA%8E%E6%80%BB%E5%85%B13785%E5%8F%A5%E8%AF%9D%EF%BC%8C%E6%AF%8F%E5%8F%A5%E8%AF%9D15%E4%B8%AA%E5%AD%97%EF%BC%8C%E6%AF%8F%E4%B8%AA%E5%AD%977%E4%B8%AA%E7%89%B9%E5%BE%81%EF%BC%88embadding%EF%BC%89%2C%E5%AF%B9%E4%BA%8E%E8%BF%99%E4%BA%9B%E6%A0%B7%E6%9C%AC%E6%AF%8F%E6%AC%A1%E8%AE%AD%E7%BB%8380%E5%8F%A5%E8%AF%9D%0A++++pred%2C_%3Dlstm%28X%29%0A++++%23%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0%0A++++loss%3Dtf.reduce_mean%28tf.square%28tf.reshape%28pred%2C%5B-1%5D%29-tf.reshape%28Y%2C+%5B-1%5D%29%29%29%0A++++train_op%3Dtf.train.AdamOptimizer%28lr%29.minimize%28loss%29%0A++++saver%3Dtf.train.Saver%28tf.global_variables%28%29%2Cmax_to_keep%3D15%29+%0A++++with+tf.Session%28%29+as+sess%3A%0A++++++++sess.run%28tf.global_variables_initializer%28%29%29%0A++++++++%23%E9%87%8D%E5%A4%8D%E8%AE%AD%E7%BB%83200%E6%AC%A1%0A++++++++for+i+in+range%28200%29%3A%0A++++++++++++%23%E6%AF%8F%E6%AC%A1%E8%BF%9B%E8%A1%8C%E8%AE%AD%E7%BB%83%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E6%AF%8F%E4%B8%AAbatch%E8%AE%AD%E7%BB%83batch_size%E4%B8%AA%E6%A0%B7%E6%9C%AC%0A++++++++++++for+step+in+range%28len%28batch_index%29-1%29%3A%0A++++++++++++++++_%2Closs_%3Dsess.run%28%5Btrain_op%2Closs%5D%2Cfeed_dict%3D%7BX%3Atrain_x%5Bbatch_index%5Bstep%5D%3Abatch_index%5Bstep%2B1%5D%5D%2CY%3Atrain_y%5Bbatch_index%5Bstep%5D%3Abatch_index%5Bstep%2B1%5D%5D%7D%29%0A++++++++++++print%28i%2Closs_%29%0A++++++++++++if+i+%25+200%3D%3D0%3A%0A++++++++++++++++print%28%22%E4%BF%9D%E5%AD%98%E6%A8%A1%E5%9E%8B%EF%BC%9A%22%2Csaver.save%28sess%2C%27model%2Fstock2.model%27%2Cglobal_step%3Di%29%29%0A+%0A+%0Atrain_lstm%28%29%0A+%0A+%0A%23%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E9%A2%84%E6%B5%8B%E6%A8%A1%E5%9E%8B%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%0Adef+prediction%28time_step%3D20%29%3A%0A++++X%3Dtf.placeholder%28tf.float32%2C+shape%3D%5BNone%2Ctime_step%2Cinput_size%5D%29%0A++++mean%2Cstd%2Ctest_x%2Ctest_y%3Dget_test_data%28time_step%29%0A++++pred%2C_%3Dlstm%28X%29++++%0A++++saver%3Dtf.train.Saver%28tf.global_variables%28%29%29%0A++++with+tf.Session%28%29+as+sess%3A%0A++++++++%23%E5%8F%82%E6%95%B0%E6%81%A2%E5%A4%8D%0A++++++++module_file+%3D+tf.train.latest_checkpoint%28%27model%27%29%0A++++++++saver.restore%28sess%2C+module_file%29%0A++++++++test_predict%3D%5B%5D%0A++++++++for+step+in+range%28len%28test_x%29-1%29%3A%0A++++++++++prob%3Dsess.run%28pred%2Cfeed_dict%3D%7BX%3A%5Btest_x%5Bstep%5D%5D%7D%29++%0A++++++++++predict%3Dprob.reshape%28%28-1%29%29%0A++++++++++test_predict.extend%28predict%29%0A++++++++test_y%3Dnp.array%28test_y%29*std%5B7%5D%2Bmean%5B7%5D%0A++++++++test_predict%3Dnp.array%28test_predict%29*std%5B7%5D%2Bmean%5B7%5D%0A++++++++acc%3Dnp.average%28np.abs%28test_predict-test_y%5B%3Alen%28test_predict%29%5D%29%2Ftest_y%5B%3Alen%28test_predict%29%5D%29++%23%E5%81%8F%E5%B7%AE%0A++++++++%23%E4%BB%A5%E6%8A%98%E7%BA%BF%E5%9B%BE%E8%A1%A8%E7%A4%BA%E7%BB%93%E6%9E%9C%0A++++++++plt.figure%28%29%0A++++++++plt.plot%28list%28range%28len%28test_predict%29%29%29%2C+test_predict%2C+color%3D%27b%27%29%0A++++++++plt.plot%28list%28range%28len%28test_y%29%29%29%2C+test_y%2C++color%3D%27r%27%29%0A++++++++plt.show%28%29%0A+%0Aprediction%28%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E8%BF%99%E4%B8%AA%E8%BF%87%E7%A8%8B%E5%B9%B6%E4%B8%8D%E9%9A%BE%E7%90%86%E8%A7%A3%EF%BC%8C%E4%B8%8B%E9%9D%A2%E5%88%86%E6%9E%90%E5%85%B6%E4%B8%AD%E7%BB%B4%E5%BA%A6%E5%8F%98%E6%8D%A2%EF%BC%8C%E4%BB%8E%E8%80%8C%E5%A2%9E%E5%8A%A0%E5%AF%B9LSTM%E7%9A%84%E7%90%86%E8%A7%A3%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180729130938862-524539663.png%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%AF%B9%E4%BA%8ERNN%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9A%84%E6%9E%84%E5%BB%BA%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BB%8E%E8%BE%93%E5%85%A5%E5%BC%A0%E9%87%8F%E7%9A%84%E7%BB%B4%E5%BA%A6%E4%B8%8A%E7%90%86%E8%A7%A3%EF%BC%8C%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E4%BD%BF%E7%94%A8dynamic_rnn%EF%BC%88%E5%BD%93%E7%84%B6%E5%8F%AF%E4%BB%A5%E6%B3%A8%E6%84%8F%E4%B8%8Etf.contrib.rnn.static_rnn%E5%9C%A8%E4%BD%BF%E7%94%A8%E4%B8%8A%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%89%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3Edynamic_rnn%28%0A++++cell%2C%0A++++inputs%2C%0A++++sequence_length%3DNone%2C%0A++++initial_state%3DNone%2C%0A++++dtype%3DNone%2C%0A++++parallel_iterations%3DNone%2C%0A++++swap_memory%3DFalse%2C%0A++++time_major%3DFalse%2C%0A++++scope%3DNone%0A%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%85%B6%E4%B8%AD%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%E3%80%80%E3%80%80cell%3A%E8%BE%93%E5%85%A5%E4%B8%80%E4%B8%AARNNcell%E5%AE%9E%E4%BE%8B%3C%2Fp%3E+%0A++%3Cp%3E%E3%80%80%E3%80%80inputs%3ARNN%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%9A%84%E8%BE%93%E5%85%A5%EF%BC%8C%E5%A6%82%E6%9E%9C+time_major+%3D%3D+False+%28default%29%EF%BC%8C%E8%BE%93%E5%85%A5%E7%9A%84%E5%BD%A2%E7%8A%B6%E6%98%AF%3A+%5Bbatch_size%2C+max_time%2C+embedding_size%5D%EF%BC%9B%E5%A6%82%E6%9E%9C+time_major+%3D%3D+True%2C+%E8%BE%93%E5%85%A5%E7%9A%84%E5%BD%A2%E7%8A%B6%E6%98%AF%3A+%5B+max_time%2C+batch_size%2C+embedding_size%5D%3C%2Fp%3E+%0A++%3Cp%3E%E3%80%80%E3%80%80initial_state%3A+RNN%E7%BD%91%E7%BB%9C%E7%9A%84%E5%88%9D%E5%A7%8B%E7%8A%B6%E6%80%81%EF%BC%8C%E7%BD%91%E7%BB%9C%E9%9C%80%E8%A6%81%E4%B8%80%E4%B8%AA%E5%88%9D%E5%A7%8B%E7%8A%B6%E6%80%81%EF%BC%8C%E5%AF%B9%E4%BA%8E%E6%99%AE%E9%80%9A%E7%9A%84RNN%E7%BD%91%E7%BB%9C%EF%BC%8C%E5%88%9D%E5%A7%8B%E7%8A%B6%E6%80%81%E7%9A%84%E5%BD%A2%E7%8A%B6%E6%98%AF%3A%5Bbatch_size%2C+cell.state_size%5D%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180729131852771-874939583.png%22%3E%3C%2Fp%3E+%0A++%3Ch2%3E%26nbsp%3B%3Cstrong%3E2.2+%E6%AD%A3%E5%BC%A6%E6%9B%B2%E7%BA%BF%E6%8B%9F%E5%90%88%3C%2Fstrong%3E%3C%2Fh2%3E+%0A++%3Cp%3E%E3%80%80%E3%80%80%E5%AF%B9%E4%BA%8E%E4%BD%BF%E7%94%A8LSTM%E5%81%9A%E6%9B%B2%E7%BA%BF%E6%8B%9F%E5%90%88%EF%BC%8C%E5%8F%82%E8%80%83%3Ca+href%3D%22https%3A%2F%2Fmorvanzhou.github.io%2Ftutorials%2Fmachine-learning%2Ftensorflow%2F5-09-RNN3%2F%22+rel%3D%22nofollow%22%3Ehttps%3A%2F%2Fmorvanzhou.github.io%2Ftutorials%2Fmachine-learning%2Ftensorflow%2F5-09-RNN3%2F%3C%2Fa%3E%EF%BC%8C%E5%BE%97%E5%88%B0%E4%BB%A3%E7%A0%81%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3Eimport+tensorflow+as+tf%0Aimport+numpy+as+np%0Aimport+matplotlib.pyplot+as+plt%0A++%0ABATCH_START+%3D+0+%23%E5%BB%BA%E7%AB%8B+batch+data+%E6%97%B6%E5%80%99%E7%9A%84+index%0ATIME_STEPS+%3D+20+%23+backpropagation+through+time+%E7%9A%84time_steps%0ABATCH_SIZE+%3D+50%0AINPUT_SIZE+%3D+1+%23+x%E6%95%B0%E6%8D%AE%E8%BE%93%E5%85%A5size%0AOUTPUT_SIZE+%3D+1+%23+cos%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA+size%0ACELL_SIZE+%3D+10+%23+RNN%E7%9A%84+hidden+unit+size%0ALR+%3D+0.006++%23+learning+rate%0A++%0A%23+%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE%E7%9A%84+get_batch+function%3A%0Adef+get_batch%28%29%3A%0A++++%23global+BATCH_START%2C+TIME_STEPS%0A++++%23+xs+shape+%2850batch%2C+20steps%29%0A++++xs+%3D+np.arange%28BATCH_START%2C+BATCH_START%2BTIME_STEPS*BATCH_SIZE%29.reshape%28%28BATCH_SIZE%2C+TIME_STEPS%29%29+%2F+%2810*np.pi%29%0A++++res+%3D+np.cos%28xs%29%0A++++%23+returned++xs+and+res%3A+shape+%28batch%2C+step%2C+input%29%0A++++return+%5Bxs%5B%3A%2C+%3A%2C+np.newaxis%5D%2C+res%5B%3A%2C+%3A%2C+np.newaxis%5D%5D%0A++%0A%23+%E5%AE%9A%E4%B9%89+LSTMRNN+%E7%9A%84%E4%B8%BB%E4%BD%93%E7%BB%93%E6%9E%84%0Aclass+LSTMRNN%28object%29%3A%0A++++def+__init__%28self%2C+n_steps%2C+input_size%2C+output_size%2C+cell_size%2C+batch_size%29%3A%0A++++++++self.n_steps+%3D+n_steps%0A++++++++self.input_size+%3D+input_size%0A++++++++self.output_size+%3D+output_size%0A++++++++self.cell_size+%3D+cell_size%0A++++++++self.batch_size+%3D+batch_size%0A++++++++with+tf.name_scope%28%27inputs%27%29%3A%0A++++++++++++self.xs+%3D+tf.placeholder%28tf.float32%2C+%5BNone%2C+n_steps%2C+input_size%5D%2C+name%3D%27xs%27%29%0A++++++++++++self.ys+%3D+tf.placeholder%28tf.float32%2C+%5BNone%2C+n_steps%2C+output_size%5D%2C+name%3D%27ys%27%29%0A++++++++with+tf.variable_scope%28%27in_hidden%27%29%3A%0A++++++++++++self.add_input_layer%28%29%0A++++++++with+tf.variable_scope%28%27LSTM_cell%27%29%3A%0A++++++++++++self.add_cell%28%29%0A++++++++with+tf.variable_scope%28%27out_hidden%27%29%3A%0A++++++++++++self.add_output_layer%28%29%0A++++++++with+tf.name_scope%28%27cost%27%29%3A%0A++++++++++++self.compute_cost%28%29%0A++++++++with+tf.name_scope%28%27train%27%29%3A%0A++++++++++++self.train_op+%3D+tf.train.AdamOptimizer%28LR%29.minimize%28self.cost%29%0A++%0A++++%23+%E8%AE%BE%E7%BD%AE+add_input_layer+%E5%8A%9F%E8%83%BD%2C+%E6%B7%BB%E5%8A%A0+input_layer%3A%0A++++def+add_input_layer%28self%2C+%29%3A%0A++++++++l_in_x+%3D+tf.reshape%28self.xs%2C+%5B-1%2C+self.input_size%5D%2C+name%3D%272_2D%27%29++%23+%28batch*n_step%2C+in_size%29%0A++++++++%23+Ws+%28in_size%2C+cell_size%29%0A++++++++Ws_in+%3D+self._weight_variable%28%5Bself.input_size%2C+self.cell_size%5D%29%0A++++++++%23+bs+%28cell_size%2C+%29%0A++++++++bs_in+%3D+self._bias_variable%28%5Bself.cell_size%2C+%5D%29%0A++++++++%23+l_in_y+%3D+%28batch+*+n_steps%2C+cell_size%29%0A++++++++with+tf.name_scope%28%27Wx_plus_b%27%29%3A%0A++++++++++++l_in_y+%3D+tf.matmul%28l_in_x%2C+Ws_in%29+%2B+bs_in%0A++++++++%23+reshape+l_in_y+%3D%3D%26gt%3B+%28batch%2C+n_steps%2C+cell_size%29%0A++++++++self.l_in_y+%3D+tf.reshape%28l_in_y%2C+%5B-1%2C+self.n_steps%2C+self.cell_size%5D%2C+name%3D%272_3D%27%29%0A++%0A++++%23+%E8%AE%BE%E7%BD%AE+add_cell+%E5%8A%9F%E8%83%BD%2C+%E6%B7%BB%E5%8A%A0+cell%2C+%E6%B3%A8%E6%84%8F%E8%BF%99%E9%87%8C%E7%9A%84+self.cell_init_state%2C%0A++++%23++%E5%9B%A0%E4%B8%BA%E6%88%91%E4%BB%AC%E5%9C%A8+training+%E7%9A%84%E6%97%B6%E5%80%99%2C+%E8%BF%99%E4%B8%AA%E5%9C%B0%E6%96%B9%E8%A6%81%E7%89%B9%E5%88%AB%E8%AF%B4%E6%98%8E.%0A++++def+add_cell%28self%29%3A%0A++++++++lstm_cell+%3D+tf.contrib.rnn.BasicLSTMCell%28self.cell_size%2C+forget_bias%3D1.0%2C+state_is_tuple%3DTrue%29%0A++++++++with+tf.name_scope%28%27initial_state%27%29%3A%0A++++++++++++self.cell_init_state+%3D+lstm_cell.zero_state%28self.batch_size%2C+dtype%3Dtf.float32%29%0A++++++++self.cell_outputs%2C+self.cell_final_state+%3D+tf.nn.dynamic_rnn%28lstm_cell%2C%0A+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++self.l_in_y%2C%0A+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++initial_state%3Dself.cell_init_state%2C%0A+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++time_major%3DFalse%29%0A++%0A++++%23+%E8%AE%BE%E7%BD%AE+add_output_layer+%E5%8A%9F%E8%83%BD%2C+%E6%B7%BB%E5%8A%A0+output_layer%3A%0A++++def+add_output_layer%28self%29%3A%0A++++++++%23+shape+%3D+%28batch+*+steps%2C+cell_size%29%0A++++++++l_out_x+%3D+tf.reshape%28self.cell_outputs%2C+%5B-1%2C+self.cell_size%5D%2C+name%3D%272_2D%27%29%0A++++++++Ws_out+%3D+self._weight_variable%28%5Bself.cell_size%2C+self.output_size%5D%29%0A++++++++bs_out+%3D+self._bias_variable%28%5Bself.output_size%2C+%5D%29%0A++++++++%23+shape+%3D+%28batch+*+steps%2C+output_size%29%0A++++++++with+tf.name_scope%28%27Wx_plus_b%27%29%3A%0A++++++++++++self.pred+%3D+tf.matmul%28l_out_x%2C+Ws_out%29+%2B+bs_out%0A++%0A++++%23+%E6%B7%BB%E5%8A%A0+RNN+%E4%B8%AD%E5%89%A9%E4%B8%8B%E7%9A%84%E9%83%A8%E5%88%86%3A%0A++++def+compute_cost%28self%29%3A%0A++++++++losses+%3D+tf.contrib.legacy_seq2seq.sequence_loss_by_example%28%0A++++++++++++%5Btf.reshape%28self.pred%2C+%5B-1%5D%2C+name%3D%27reshape_pred%27%29%5D%2C%0A++++++++++++%5Btf.reshape%28self.ys%2C+%5B-1%5D%2C+name%3D%27reshape_target%27%29%5D%2C%0A++++++++++++%5Btf.ones%28%5Bself.batch_size+*+self.n_steps%5D%2C+dtype%3Dtf.float32%29%5D%2C%0A++++++++++++average_across_timesteps%3DTrue%2C%0A++++++++++++softmax_loss_function%3Dself.ms_error%2C%0A++++++++++++name%3D%27losses%27%0A++++++++%29%0A++++++++with+tf.name_scope%28%27average_cost%27%29%3A%0A++++++++++++self.cost+%3D+tf.div%28%0A++++++++++++++++tf.reduce_sum%28losses%2C+name%3D%27losses_sum%27%29%2C%0A++++++++++++++++self.batch_size%2C%0A++++++++++++++++name%3D%27average_cost%27%29%0A++++++++++++tf.summary.scalar%28%27cost%27%2C+self.cost%29%0A++%0A++++def+ms_error%28self%2Clabels%2C+logits%29%3A%0A++++++++return+tf.square%28tf.subtract%28labels%2C+logits%29%29%0A++%0A++++def+_weight_variable%28self%2C+shape%2C+name%3D%27weights%27%29%3A%0A++++++++initializer+%3D+tf.random_normal_initializer%28mean%3D0.%2C+stddev%3D1.%2C+%29%0A++++++++return+tf.get_variable%28shape%3Dshape%2C+initializer%3Dinitializer%2C+name%3Dname%29%0A++%0A++++def+_bias_variable%28self%2C+shape%2C+name%3D%27biases%27%29%3A%0A++++++++initializer+%3D+tf.constant_initializer%280.1%29%0A++++++++return+tf.get_variable%28name%3Dname%2C+shape%3Dshape%2C+initializer%3Dinitializer%29%0A++%0A++%0A%23+%E8%AE%AD%E7%BB%83+LSTMRNN%0Aif+__name__+%3D%3D+%27__main__%27%3A%0A+++++%0A++++%23+%E6%90%AD%E5%BB%BA+LSTMRNN+%E6%A8%A1%E5%9E%8B%0A++++model+%3D+LSTMRNN%28TIME_STEPS%2C+INPUT_SIZE%2C+OUTPUT_SIZE%2C+CELL_SIZE%2C+BATCH_SIZE%29%0A++++sess+%3D+tf.Session%28%29%0A++++saver%3Dtf.train.Saver%28max_to_keep%3D3%29%0A++++sess.run%28tf.global_variables_initializer%28%29%29+%0A++++t+%3D+0+++%0A++++if%28t+%3D%3D+1%29%3A%0A++++++++model_file%3Dtf.train.latest_checkpoint%28%27model%2F%27%29%0A++++++++saver.restore%28sess%2Cmodel_file+%29%0A++++++++xs%2C+res+%3D+get_batch%28%29++%23+%E6%8F%90%E5%8F%96+batch+data%0A++++++++feed_dict+%3D+%7Bmodel.xs%3A+xs%7D%0A++++++++pred+%3D+sess.run%28+model.pred%2Cfeed_dict%3Dfeed_dict%29%0A++++++++xs.shape+%3D+%28-1%2C1%29%0A++++++++res.shape+%3D+%28-1%2C+1%29%0A++++++++pred.shape+%3D+%28-1%2C+1%29%0A++++++++print%28xs.shape%2Cres.shape%2Cpred.shape%29%0A++++++++plt.figure%28%29%0A++++++++plt.plot%28xs%2Cres%2C%27-r%27%29%0A++++++++plt.plot%28xs%2Cpred%2C%27--g%27%29+++++++%0A++++++++plt.show%28%29%0A++++else%3A%0A++++++++%23+matplotlib%E5%8F%AF%E8%A7%86%E5%8C%96%0A++++++++plt.ion%28%29++%23+%E8%AE%BE%E7%BD%AE%E8%BF%9E%E7%BB%AD+plot%0A++++++++plt.show%28%29++++%0A++++++++%23+%E8%AE%AD%E7%BB%83%E5%A4%9A%E6%AC%A1%0A++++++++for+i+in+range%282500%29%3A%0A++++++++++++xs%2C+res+%3D+get_batch%28%29++%23+%E6%8F%90%E5%8F%96+batch+data%0A++++++++++++%23+%E5%88%9D%E5%A7%8B%E5%8C%96+data%0A++++++++++++feed_dict+%3D+%7B%0A++++++++++++++++model.xs%3A+xs%2C%0A++++++++++++++++model.ys%3A+res%2C%0A++++++++++++%7D++++++++++%0A++++++++++++%23+%E8%AE%AD%E7%BB%83%0A++++++++++++_%2C+cost%2C+state%2C+pred+%3D+sess.run%28%0A++++++++++++++++%5Bmodel.train_op%2C+model.cost%2C+model.cell_final_state%2C+model.pred%5D%2C%0A++++++++++++++++feed_dict%3Dfeed_dict%29%0A++++++%0A++++++++++++%23+plotting%0A++++++++++++x+%3D+xs.reshape%28-1%2C1%29%0A++++++++++++r+%3D+res.reshape%28-1%2C+1%29%0A++++++++++++p+%3D+pred.reshape%28-1%2C+1%29%0A++++++++++++plt.clf%28%29%0A++++++++++++plt.plot%28x%2C+r%2C+%27r%27%2C+x%2C+p%2C+%27b--%27%29%0A++++++++++++plt.ylim%28%28-1.2%2C+1.2%29%29%0A++++++++++++plt.draw%28%29%0A++++++++++++plt.pause%280.3%29++%23+%E6%AF%8F+0.3+s+%E5%88%B7%E6%96%B0%E4%B8%80%E6%AC%A1%0A++++++%0A++++++++++++%23+%E6%89%93%E5%8D%B0+cost+%E7%BB%93%E6%9E%9C%0A++++++++++++if+i+%25+20+%3D%3D+0%3A%0A++++++++++++++++saver.save%28sess%2C+%22model%2Flstem_text.ckpt%22%2Cglobal_step%3Di%29%23%0A++++++++++++++++print%28%27cost%3A+%27%2C+round%28cost%2C+4%29%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E4%B8%80%E4%B8%AA%E6%9C%89%E6%84%8F%E6%80%9D%E7%9A%84%E7%8E%B0%E8%B1%A1%EF%BC%8C%E4%B8%8B%E9%9D%A2%E6%98%AF%E5%85%88%E5%90%8E%E4%B8%A4%E4%B8%AA%E6%97%B6%E5%88%BB%E7%9A%84%E5%9B%BE%E5%83%8F%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+height%3D%22385%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180729153116235-1139597775.png%22+width%3D%22420%22%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+height%3D%22384%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180729153132315-1833075629.png%22+width%3D%22419%22%3E%3C%2Fp%3E+%0A++%3Cp%3Ex%E5%80%BC%E8%BE%83%E5%B0%8F%E7%9A%84%E7%82%B9%E5%85%88%E6%94%B6%E6%95%9B%EF%BC%8Cx%E5%80%BC%E5%A4%A7%E7%9A%84%E6%94%B6%E6%95%9B%E9%80%9F%E5%BA%A6%E5%BE%88%E6%85%A2%E3%80%82%E5%85%B6%E5%8E%9F%E5%9B%A0%E4%B8%BB%E8%A6%81%E6%98%AFBPTT%E7%9A%84%E6%B1%82%E5%AF%BC%E8%BF%87%E7%A8%8B%EF%BC%8C%E5%AF%B9%E4%BA%8E%E6%97%B6%E9%97%B4%E9%9D%A0%E5%89%8D%E7%9A%84%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D%E5%BF%AB%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83%EF%BC%9A%3Ca+href%3D%22https%3A%2F%2Fwww.cnblogs.com%2Fpinking%2Fp%2F9418280.html%22+rel%3D%22nofollow%22%3Ehttps%3A%2F%2Fwww.cnblogs.com%2Fpinking%2Fp%2F9418280.html%3C%2Fa%3E%26nbsp%3B%E4%B8%AD1.2%E8%8A%82%E3%80%82%E5%B0%86%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84%E6%94%B9%E4%B8%BA%E5%8F%8C%E5%90%91%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3Edef+add_cell%28self%29%3A%0A++++++++lstm_cell+%3D+tf.contrib.rnn.BasicLSTMCell%28self.cell_size%2C+forget_bias%3D1.0%2C+state_is_tuple%3DTrue%29%0A++++++++lstm_cell+%3D+tf.contrib.rnn.MultiRNNCell%28%5Blstm_cell%5D%2C1%29%0A++++++++with+tf.name_scope%28%27initial_state%27%29%3A%0A++++++++++++self.cell_init_state+%3D+lstm_cell.zero_state%28self.batch_size%2C+dtype%3Dtf.float32%29%0A++++++++self.cell_outputs%2C+self.cell_final_state+%3D+tf.nn.dynamic_rnn%28lstm_cell%2C%0A+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++self.l_in_y%2C%0A+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++initial_state%3Dself.cell_init_state%2C%0A+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++time_major%3DFalse%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%8F%91%E7%8E%B0%E6%94%B6%E6%95%9B%E9%80%9F%E5%BA%A6%E5%BF%AB%E4%BA%86%E4%B8%80%E4%BA%9B%E3%80%82%E4%B8%8D%E8%BF%87%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E8%BF%98%E6%98%AF%E6%98%AF%E5%9B%A0%E4%B8%BAx%E7%9A%84%E5%80%BC%E8%BF%87%E5%A4%A7%E5%AF%BC%E8%87%B4%E7%9A%84%EF%BC%8C%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%B0%86%E5%8E%9F%E5%A7%8B%E7%9A%84%E5%80%BC%E7%9A%84%E8%8E%B7%E5%8F%96%E8%BF%9B%E8%A1%8C%E5%88%86%E6%AE%B5%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3EBATCH_START+%3D+3000+%23%E5%BB%BA%E7%AB%8B+batch+data+%E6%97%B6%E5%80%99%E7%9A%84+index%0ATIME_STEPS+%3D+20+%23+backpropagation+through+time+%E7%9A%84time_steps%0ABATCH_SIZE_r+%3D+50%0ABATCH_SIZE+%3D+10%0AINPUT_SIZE+%3D+1+%23+x%E6%95%B0%E6%8D%AE%E8%BE%93%E5%85%A5size%0AOUTPUT_SIZE+%3D+1+%23+cos%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA+size%0ACELL_SIZE+%3D+10+%23+RNN%E7%9A%84+hidden+unit+size%0ALR+%3D+0.006++%23+learning+rate%0Aii+%3D+0%0A%23+%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE%E7%9A%84+get_batch+function%3A%0Adef+get_batch%28%29%3A%0A++++global+ii%0A++++%23+xs+shape+%2850batch%2C+20steps%29%0A++++xs_r+%3D+np.arange%28BATCH_START%2C+BATCH_START%2BTIME_STEPS*BATCH_SIZE_r%29%0A++++xs+%3D+xs_r%5Bii*BATCH_SIZE*TIME_STEPS%3A%28ii%2B1%29*BATCH_SIZE*TIME_STEPS%5D.reshape%28%28BATCH_SIZE%2C+TIME_STEPS%29%29+%2F+%2810*np.pi%29%0A++++res+%3D+np.cos%28xs%29%0A++++ii+%2B%3D+1%0A++++if%28ii+%3D%3D+5%29%3A%0A++++++++ii+%3D+0%0A+++++%0A++++%23+returned++xs+and+res%3A+shape+%28batch%2C+step%2C+input%29%0A++++return+%5Bxs%5B%3A%2C+%3A%2C+np.newaxis%5D%2C+res%5B%3A%2C+%3A%2C+np.newaxis%5D%5D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E7%84%B6%E5%90%8E%E5%8F%AF%E4%BB%A5%E5%85%B7%E4%BD%93%E8%A7%82%E6%B5%8B%E6%9F%90%E4%B8%80%E6%AE%B5%E7%9A%84%E6%94%B6%E6%95%9B%E8%BF%87%E7%A8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3E%23+matplotlib%E5%8F%AF%E8%A7%86%E5%8C%96%0A++++++++plt.ion%28%29++%23+%E8%AE%BE%E7%BD%AE%E8%BF%9E%E7%BB%AD+plot%0A++++++++plt.show%28%29++++%0A++++++++%23+%E8%AE%AD%E7%BB%83%E5%A4%9A%E6%AC%A1%0A++++++++for+i+in+range%28200%29%3A%0A++++++++++++xs%2Cres%2Cpred+%3D+%5B%5D%2C%5B%5D%2C%5B%5D%0A++++++++++++for+j+in+range%285%29%3A%0A+++++++++++++++++%0A+%0A++++++++++++++++xsj%2C+resj+%3D+get_batch%28%29++%23+%E6%8F%90%E5%8F%96+batch+data%0A++++++++++++++++if%28j+%21%3D+0%29%3A%0A++++++++++++++++++++continue%0A++++++++++++++++%23+%E5%88%9D%E5%A7%8B%E5%8C%96+data%0A++++++++++++++++feed_dict+%3D+%7B%0A++++++++++++++++++++model.xs%3A+xsj%2C%0A++++++++++++++++++++model.ys%3A+resj%2C%0A++++++++++++++++%7D++++++++++%0A++++++++++++++++%23+%E8%AE%AD%E7%BB%83%0A++++++++++++++++_%2C+cost%2C+state%2C+predj+%3D+sess.run%28%0A++++++++++++++++++++%5Bmodel.train_op%2C+model.cost%2C+model.cell_final_state%2C+model.pred%5D%2C%0A++++++++++++++++++++feed_dict%3Dfeed_dict%29%0A++++++%0A++++++++++++%23+plotting%0A++++++++++++++++x+%3D+list%28xsj.reshape%28-1%2C1%29%29%0A++++++++++++++++r+%3D+list%28resj.reshape%28-1%2C+1%29%29%0A++++++++++++++++p+%3D+list%28predj.reshape%28-1%2C+1%29%29%0A++++++++++++++++xs+%2B%3D+x%0A++++++++++++++++res+%2B%3D+r%0A++++++++++++++++pred+%2B%3D+p%0A++++++++++++plt.clf%28%29%0A++++++++++++plt.plot%28xs%2C+res%2C+%27r%27%2C+x%2C+p%2C+%27b--%27%29%0A++++++++++++plt.ylim%28%28-1.2%2C+1.2%29%29%0A++++++++++++plt.draw%28%29%0A++++++++++++plt.pause%280.3%29++%23+%E6%AF%8F+0.3+s+%E5%88%B7%E6%96%B0%E4%B8%80%E6%AC%A1%0A++++++%0A++++++++++++%23+%E6%89%93%E5%8D%B0+cost+%E7%BB%93%E6%9E%9C%0A++++++++++++if+i+%25+20+%3D%3D+0%3A%0A++++++++++++++++saver.save%28sess%2C+%22model%2Flstem_text.ckpt%22%2Cglobal_step%3Di%29%23%0A++++++++++++++++print%28%27cost%3A+%27%2C+round%28cost%2C+4%29%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%EF%BC%8C%E5%BD%93%E8%AE%BE%E7%BD%AE%E7%9A%84%E5%8C%BA%E9%97%B4%E6%AF%94%E8%BE%83%E5%A4%A7%EF%BC%8C%E8%AD%AC%E5%A6%82BATCH_START+%3D+3000%E4%BA%86%EF%BC%8C%E9%82%A3%E4%B9%88%E5%B0%B1%E5%BE%88%E9%9A%BE%E6%94%B6%E6%95%9B%E4%BA%86%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180729164647930-2016319547.png%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%9B%A0%E6%AD%A4%EF%BC%8C%E8%BF%99%E9%87%8C%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E4%BA%86%EF%BC%8CLSTM%E5%81%9A%E5%9B%9E%E5%BD%92%E9%97%AE%E9%A2%98%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E6%B3%A8%E6%84%8F%E8%A7%82%E6%B5%8B%E5%80%BC%E4%B8%8E%E8%87%AA%E5%8F%98%E9%87%8F%E4%B9%8B%E9%97%B4%E4%B8%8D%E8%A6%81%E5%B7%AE%E8%B7%9D%E8%BF%87%E5%A4%A7%E3%80%82%E5%BD%93%E6%88%91%E4%BB%AC%E6%94%B9%E5%B0%8F%E4%B8%80%E4%BA%9Bx%E7%9A%84%E5%80%BC%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%95%88%E6%9E%9C%E5%A6%82%E5%9B%BE%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180729225930161-1405554160.gif%22%3E%3C%2Fp%3E+%0A++%3Ch1%3E%3Cstrong%3E%E4%B8%89%E3%80%81LSTM%E7%9A%84%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98%3C%2Fstrong%3E%3C%2Fh1%3E+%0A++%3Cp%3E%26nbsp%3B%E3%80%80%E3%80%80%E5%AF%B9%E4%BA%8E%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98%EF%BC%8C%E5%85%B6%E5%AE%9E%E5%92%8C%E5%9B%9E%E5%BD%92%E6%98%AF%E4%B8%80%E6%A0%B7%E7%9A%84%EF%BC%8C%E5%81%87%E8%AE%BE%E5%9C%A8%E4%B8%8A%E9%9D%A2%E7%9A%84%E6%AD%A3%E5%BC%A6%E5%87%BD%E6%95%B0%E7%9A%84%E5%9F%BA%E7%A1%80%E4%B8%8A%EF%BC%8C%E8%8B%A5y%E5%A4%A7%E4%BA%8E0%E6%A0%87%E8%AE%B0%E4%B8%BA1%EF%BC%8Cy%E5%B0%8F%E4%BA%8E0%E6%A0%87%E8%AE%B0%E4%B8%BA0%EF%BC%8C%E5%88%99%E8%BE%93%E5%87%BA%E5%8F%98%E6%88%90%E4%BA%86%E4%B8%80%E4%B8%AAn_class%EF%BC%88n%E4%B8%AA%E7%B1%BB%E5%88%AB%EF%BC%89%E7%9A%84%E5%90%91%E9%87%8F%EF%BC%8C%E6%9C%AC%E4%BE%8B%E4%B8%AD%E4%B8%A4%E4%B8%AA%E7%BB%B4%E5%BA%A6%E5%88%86%E5%88%AB%E4%BB%A3%E8%A1%A8%E6%A0%87%E8%AE%B0%E4%B8%BA0%E7%9A%84%E6%A6%82%E7%8E%87%E5%92%8C%E6%A0%87%E8%AE%B0%E4%B8%BA1%E7%9A%84%E6%A6%82%E7%8E%87%E3%80%82%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9%E7%9A%84%E5%9C%B0%E6%96%B9%E4%B8%BA%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%E3%80%80%E3%80%80%E9%A6%96%E5%85%88%E6%98%AF%E6%95%B0%E6%8D%AE%E4%BA%A7%E7%94%9F%E5%87%BD%E6%95%B0%EF%BC%8C%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%89%93%E6%A0%87%E7%AD%BE%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3E%23+%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE%E7%9A%84+get_batch+function%3A%0Adef+get_batch%28%29%3A%0A++++%23global+BATCH_START%2C+TIME_STEPS%0A++++%23+xs+shape+%2850batch%2C+20steps%29%0A++++xs+%3D+np.arange%28BATCH_START%2C+BATCH_START%2BTIME_STEPS*BATCH_SIZE%29.reshape%28%28BATCH_SIZE%2C+TIME_STEPS%29%29+%2F+%28200*np.pi%29%0A++++res+%3D+np.where%28np.cos%284*xs%29%26gt%3B%3D0%2C0%2C1%29.tolist%28%29%0A++++for+i+in+range%28BATCH_SIZE%29%3A%0A++++++++for+j+in+range%28TIME_STEPS%29%3A++++++++++%0A++++++++++++res%5Bi%5D%5Bj%5D+%3D+%5B0%2C1%5D+if+res%5Bi%5D%5Bj%5D+%3D%3D+1+else+%5B1%2C0%5D%0A++++%23+returned++xs+and+res%3A+shape+%28batch%2C+step%2C+input%2Foutput%29%0A++++return+%5Bxs%5B%3A%2C+%3A%2C+np.newaxis%5D%2C+np.array%28res%29%5D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E7%84%B6%E5%90%8E%E4%BF%AE%E6%94%B9%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0%EF%BC%8C%E5%9B%9E%E5%BD%92%E9%97%AE%E9%A2%98%E5%B0%B1%E4%B8%8D%E8%83%BD%E7%94%A8%E6%9C%80%E5%B0%8F%E4%BA%8C%E4%B9%98%E7%9A%84%E6%8D%9F%E5%A4%B1%E4%BA%86%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%87%87%E7%94%A8%E4%BA%A4%E5%8F%89%E7%86%B5%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3Edef+compute_cost%28self%29%3A%0A++++++++self.cost+%3D+tf.reduce_mean%28tf.nn.softmax_cross_entropy_with_logits%28labels+%3D+self.ys%2Clogits+%3D+self.pred%29%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E3%80%80%E5%BD%93%E7%84%B6%EF%BC%8C%E6%B3%A8%E6%84%8F%E4%B8%80%E4%B8%8B%E7%BB%B4%E5%BA%A6%E9%97%AE%E9%A2%98%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86%EF%BC%8C%E6%95%88%E6%9E%9C%E5%A6%82%E5%9B%BE%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180730002819643-407463784.gif%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201807%2F729758-20180730002840587-1266291246.png%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E6%88%B3%EF%BC%9A%3Ca+href%3D%22https%3A%2F%2Ffiles.cnblogs.com%2Ffiles%2Fpinking%2Flstm.zip%22+rel%3D%22nofollow%22%3E%E4%BE%8B%E5%AD%90%E4%BB%A3%E7%A0%81%3C%2Fa%3E%26nbsp%3B%3C%2Fp%3E+%0A++%3Ch1%3E%3Cstrong%3E%E5%9B%9B%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88LSTM%E6%9C%89%E5%8A%A9%E4%BA%8E%E6%B6%88%E9%99%A4%E6%A2%AF%E5%BA%A6%E6%B6%88%E5%A4%B1%3C%2Fstrong%3E%3C%2Fh1%3E+%0A++%3Cp%3E%E4%B8%BA%E4%BA%86%E8%A7%A3%E5%86%B3RNN%E7%9A%84%E6%A2%AF%E5%BA%A6%E9%97%AE%E9%A2%98%EF%BC%8C%E9%A6%96%E5%85%88%E6%9C%89%E4%BA%BA%E6%8F%90%E5%87%BA%E4%BA%86%E6%B8%97%E9%80%8F%E5%8D%95%E5%85%83%E7%9A%84%E5%8A%9E%E6%B3%95%EF%BC%8C%E5%8D%B3%E5%9C%A8%E6%97%B6%E9%97%B4%E8%BD%B4%E4%B8%8A%E5%A2%9E%E5%8A%A0%E8%B7%B3%E8%B7%83%E8%BF%9E%E6%8E%A5%EF%BC%8C%E5%90%8E%E6%8E%A8%E5%B9%BF%E6%88%90LSTM%E3%80%82LSTM%E5%85%B6%E9%97%A8%E7%BB%93%E6%9E%84%EF%BC%8C%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E7%A7%8D%E5%AF%B9%E6%A2%AF%E5%BA%A6%E7%9A%84%E9%80%89%E6%8B%A9%E7%9A%84%E4%BD%9C%E7%94%A8%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201808%2F729758-20180804155224140-666895657.png%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%AF%B9%E4%BA%8E%E9%97%A8%E7%BB%93%E6%9E%84%EF%BC%8C%E5%85%B6%E5%AE%9E%E5%A6%82%E6%9E%9C%E5%85%B3%E9%97%AD%EF%BC%8C%E5%88%99%E4%BC%9A%E4%B8%80%E7%9B%B4%E4%BF%9D%E5%AD%98%E4%BB%A5%E5%89%8D%E7%9A%84%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%85%B6%E5%AE%9E%E4%B9%9F%E5%B0%B1%E6%98%AF%E7%BC%A9%E7%9F%AD%E4%BA%86%E9%93%BE%E5%BC%8F%E6%B1%82%E5%AF%BC%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201808%2F729758-20180804160509192-453018364.png%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E3%80%80%26nbsp%3B+%26nbsp%3B+%E8%AD%AC%E5%A6%82%EF%BC%8C%E5%AF%B9%E6%9F%90%E4%BA%9B%E8%BE%93%E5%85%A5%E5%BC%A0%E9%87%8F%E8%AE%AD%E7%BB%83%E5%BE%97%E5%88%B0%E7%9A%84ft%E4%B8%80%E7%9B%B4%E4%B8%BA1%EF%BC%8C%E5%88%99Ct-1%E7%9A%84%E4%BF%A1%E6%81%AF%E5%8F%AF%E4%BB%A5%E4%B8%80%E7%9B%B4%E4%BF%9D%E5%AD%98%EF%BC%8C%E7%9B%B4%E5%88%B0%E6%9C%89%E8%BE%93%E5%85%A5x%E5%BE%97%E5%88%B0%E7%9A%84ft%E4%B8%BA0%EF%BC%8C%E5%88%99%E5%92%8C%E5%89%8D%E9%9D%A2%E7%9A%84%E4%BF%A1%E6%81%AF%E5%B0%B1%E6%B2%A1%E6%9C%89%E5%85%B3%E7%B3%BB%E4%BA%86%E3%80%82%E6%95%85%E8%A7%A3%E5%86%B3%E4%BA%86%E9%95%BF%E6%97%B6%E9%97%B4%E7%9A%84%E4%BE%9D%E8%B5%96%E9%97%AE%E9%A2%98%E3%80%82%E5%9B%A0%E4%B8%BA%E9%97%A8%E6%8E%A7%E6%9C%BA%E5%88%B6%E7%9A%84%E5%AD%98%E5%9C%A8%EF%BC%8C%E6%88%91%E4%BB%AC%E9%80%9A%E8%BF%87%E6%8E%A7%E5%88%B6%E9%97%A8%E7%9A%84%E6%89%93%E5%BC%80%E3%80%81%E5%85%B3%E9%97%AD%E7%AD%89%E6%93%8D%E4%BD%9C%EF%BC%8C%E8%AE%A9%E6%A2%AF%E5%BA%A6%E8%AE%A1%E7%AE%97%E6%B2%BF%E7%9D%80%E6%A2%AF%E5%BA%A6%E4%B9%98%E7%A7%AF%E6%8E%A5%E8%BF%911%E7%9A%84%E9%83%A8%E5%88%86%E5%88%9B%E5%BB%BA%E8%B7%AF%E5%BE%84%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201808%2F729758-20180804165617596-1803506189.jpg%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%A6%82%E4%B8%8A%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E9%97%A8%E7%9A%84%E6%8E%A7%E5%88%B6%EF%BC%8C%E7%9C%8B%E5%88%B0%E7%BA%A2%E8%89%B2%E5%92%8C%E8%93%9D%E8%89%B2%E7%AE%AD%E5%A4%B4%E4%BB%A3%E8%A1%A8%E7%9A%84%E8%B7%AF%E5%BE%84%E4%B8%8B%EF%BC%8Cyt%2B1%E7%9A%84%E5%9C%A8%E8%BF%99%E4%B8%AA%E8%B7%AF%E5%BE%84%E4%B8%8B%E7%9A%84%E6%A2%AF%E5%BA%A6%E4%B8%8E%E4%B8%8A%E4%B8%80%E6%97%B6%E5%88%BB%E6%A2%AF%E5%BA%A6%E4%BF%9D%E6%8C%81%E4%B8%8D%E5%8F%98%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%E3%80%80%E3%80%80%E5%AF%B9%E4%BA%8E%E4%BF%A1%E6%81%AF%E5%A2%9E%E5%8A%A0%E9%97%A8%E4%B8%8E%E5%BF%98%E8%AE%B0%E9%97%A8%E7%9A%84%E2%80%9C%2B%E2%80%9D%E6%93%8D%E4%BD%9C%EF%BC%8C%E5%85%B6%E6%B1%82%E5%AF%BC%E6%98%AF%E5%8A%A0%E6%B3%95%E6%93%8D%E4%BD%9C%E8%80%8C%E4%B8%8D%E6%98%AF%E4%B9%98%E6%B3%95%E6%93%8D%E4%BD%9C%EF%BC%8C%E8%AF%A5%E7%8E%AF%E8%8A%82%E6%A2%AF%E5%BA%A6%E4%B8%BA1%EF%BC%8C%E4%B8%8D%E4%BC%9A%E4%BA%A7%E7%94%9F%E9%93%BE%E5%BC%8F%E6%B1%82%E5%AF%BC%E3%80%82%E5%A6%82%E5%90%8E%E9%9D%A2%E7%9A%84%E6%B1%82%E5%AF%BC%EF%BC%8C%E7%BB%BF%E8%89%B2%E8%B7%AF%E5%BE%84%E5%92%8C%E8%93%9D%E8%89%B2%E8%B7%AF%E5%BE%84%E6%98%AF%E7%9B%B8%E5%8A%A0%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%8C%E4%BF%9D%E7%95%99%E4%BA%86%E4%B9%8B%E5%89%8D%E7%9A%84%E6%A2%AF%E5%BA%A6%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201808%2F729758-20180804171508708-761140061.png%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E7%84%B6%E8%80%8C%EF%BC%8C%E6%A2%AF%E5%BA%A6%E6%B6%88%E5%A4%B1%E7%8E%B0%E8%B1%A1%E5%8F%AF%E4%BB%A5%E6%94%B9%E5%96%84%EF%BC%8C%E4%BD%86%E6%98%AF%E6%A2%AF%E5%BA%A6%E7%88%86%E7%82%B8%E8%BF%98%E6%98%AF%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%87%BA%E7%8E%B0%E7%9A%84%E3%80%82%E8%AD%AC%E5%A6%82%E5%AF%B9%E4%BA%8E%E7%BB%BF%E8%89%B2%E8%B7%AF%E5%BE%84%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+src%3D%22https%3A%2F%2Fimages2018.cnblogs.com%2Fblog%2F729758%2F201808%2F729758-20180804173110381-2020555564.jpg%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E8%BF%98%E6%98%AF%E5%AD%98%E5%9C%A8%E7%9D%80w%E5%AF%BC%E8%87%B4%E7%9A%84%E6%A2%AF%E5%BA%A6%E7%88%86%E7%82%B8%E7%8E%B0%E8%B1%A1%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%3C%2Fp%3E+%0A++%3Ch1%3E%E8%BD%AC%E8%BD%BD%E8%AF%B4%E6%98%8E%3C%2Fh1%3E+%0A++%3Cp%3E%E6%84%9F%E8%B0%A2%E5%A4%A7%E4%BD%AC%E8%AF%A6%E7%BB%86%E7%9A%84%E8%AE%B2%E8%A7%A3%7E%3C%2Fp%3E+%0A++%3Cp%3E%E6%9C%AC%E6%96%87%E8%BD%AC%E8%87%AA%EF%BC%9A%3Ca+href%3D%22https%3A%2F%2Fwww.cnblogs.com%2Fpinking%2Fp%2F9362966.html%22+rel%3D%22nofollow%22%3Ehttps%3A%2F%2Fwww.cnblogs.com%2Fpinking%2Fp%2F9362966.html%3C%2Fa%3E%3C%2Fp%3E+%0A++%3Cp%3E%E4%BD%9C%E8%80%85%EF%BC%9A%3Ca+href%3D%22http%3A%2F%2Fwww.cnblogs.com%2Fkeerdi%2F%22+rel%3D%22nofollow%22%3E%E7%A6%85%E5%9C%A8%E5%BF%83%E4%B8%AD%3C%2Fa%3E%26nbsp%3B%3Cbr%3E%3Cbr%3E+%E5%87%BA%E5%A4%84%EF%BC%9A%3Ca+href%3D%22http%3A%2F%2Fwww.cnblogs.com%2Fpinking%2F%22+rel%3D%22nofollow%22%3Ehttp%3A%2F%2Fwww.cnblogs.com%2Fpinking%2F%3C%2Fa%3E%26nbsp%3B%3Cbr%3E%3Cbr%3E+%E6%9C%AC%E6%96%87%E7%89%88%E6%9D%83%E5%BD%92%E4%BD%9C%E8%80%85%E5%92%8C%E5%8D%9A%E5%AE%A2%E5%9B%AD%E5%85%B1%E6%9C%89%EF%BC%8C%E6%AC%A2%E8%BF%8E%E6%89%B9%E8%AF%84%E6%8C%87%E6%AD%A3%E5%8F%8A%E8%BD%AC%E8%BD%BD%EF%BC%8C%E4%BD%86%E6%9C%AA%E7%BB%8F%E4%BD%9C%E8%80%85%E5%90%8C%E6%84%8F%E5%BF%85%E9%A1%BB%E4%BF%9D%E7%95%99%E6%AD%A4%E6%AE%B5%E5%A3%B0%E6%98%8E%EF%BC%8C%E4%B8%94%E5%9C%A8%E6%96%87%E7%AB%A0%E9%A1%B5%E9%9D%A2%E6%98%8E%E6%98%BE%E4%BD%8D%E7%BD%AE%E7%BB%99%E5%87%BA%E5%8E%9F%E6%96%87%E8%BF%9E%E6%8E%A5%EF%BC%8C%E5%90%A6%E5%88%99%E4%BF%9D%E7%95%99%E8%BF%BD%E7%A9%B6%E6%B3%95%E5%BE%8B%E8%B4%A3%E4%BB%BB%E7%9A%84%E6%9D%83%E5%88%A9%E3%80%82%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E" | url_decode}}
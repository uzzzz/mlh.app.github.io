---
layout: default
title: 网络 -- 设置组播mac地址
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-e2445db1a8.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22%3E+%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23444444%3B%22%3E2.%E7%BB%84%E6%92%ADmac%E5%9C%B0%E5%9D%80%E6%98%A0%E5%B0%84%EF%BC%9F%3C%2Fspan%3E%0A++%3Cbr+style%3D%22color%3Argb%2868%2C68%2C68%29%3Bfont-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3B%22%3E%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23444444%3B%22%3E%26nbsp%3B+%26nbsp%3B+%E7%BB%84%E6%92%AD%E7%9A%84mac%E5%9C%B0%E5%9D%80%EF%BC%9A%3C%2Fspan%3E%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23444444%3B%22%3EIANA%E8%A7%84%E5%AE%9A%EF%BC%8CIPv4%E7%BB%84%E6%92%ADMAC%E5%9C%B0%E5%9D%80%E7%9A%84%E9%AB%9824%E4%BD%8D%E4%B8%BA0x01005E%EF%BC%8C%E7%AC%AC25%E4%BD%8D%E4%B8%BA0%EF%BC%8C%E4%BD%8E23%E4%BD%8D%E4%B8%BAIPv4%E7%BB%84%E6%92%AD%E5%9C%B0%E5%9D%80%E7%9A%84%E4%BD%8E23%E4%BD%8D%3C%2Fspan%3E%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23444444%3B%22%3E%E3%80%82%3C%2Fspan%3E%0A++%3Cbr+style%3D%22color%3Argb%2868%2C68%2C68%29%3Bfont-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3B%22%3E%0A++%3Cbr+style%3D%22color%3Argb%2868%2C68%2C68%29%3Bfont-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3B%22%3E%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23444444%3B%22%3E3.%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E8%AF%A5%E7%BB%84%E6%92%AD%E5%8C%85%E6%98%AF%E8%87%AA%E5%B7%B1%E7%9A%84%EF%BC%9F%3C%2Fspan%3E%0A++%3Cbr+style%3D%22color%3Argb%2868%2C68%2C68%29%3Bfont-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3B%22%3E%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23444444%3B%22%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3C%2Fspan%3E%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23444444%3B%22%3E%E5%8F%91%E9%80%81%E7%AB%AF%E5%8F%91%E9%80%81%E7%BB%84%E6%92%AD%E5%8C%85%E6%97%B6%EF%BC%8C%E7%9B%AE%E7%9A%84mac%E5%9C%B0%E5%9D%80%E6%98%AF%E6%A0%B9%E6%8D%AE%E7%BB%84%E6%92%ADip%E5%92%8C%E5%9B%BA%E5%AE%9A%E6%A0%BC%E5%BC%8F%E8%BF%9B%E8%A1%8C%E6%98%A0%E5%B0%84%EF%BC%8C%E5%B9%B6%E6%B2%A1%E6%9C%89%E6%8C%87%E5%90%91%E5%9B%BA%E5%AE%9A%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%EF%BC%8C%E5%90%91%E7%BD%91%E7%BB%9C%E4%B8%8A%E8%BF%9B%E8%A1%8C%E5%8F%91%E9%80%81%E3%80%82%3C%2Fspan%3E%0A++%3Cbr+style%3D%22color%3Argb%2868%2C68%2C68%29%3Bfont-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3B%22%3E%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23444444%3B%22%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3C%2Fspan%3E%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23444444%3B%22%3E%E6%8E%A5%E6%94%B6%E7%AB%AF%E6%8E%A5%E6%94%B6%E7%BB%84%E6%92%AD%E5%8C%85%E6%97%B6%EF%BC%8C%E5%90%8C%E6%A0%B7%E9%9C%80%E8%A6%81%E5%AF%B9%E7%BB%84%E6%92%ADip%E5%92%8C%E5%9B%BA%E5%AE%9A%E6%A0%BC%E5%BC%8F%E8%BF%9B%E8%A1%8C%E6%98%A0%E5%B0%84%EF%BC%8C%E7%94%9F%E6%88%90%E7%9A%84%E7%BB%84%E6%92%ADmac%E5%9C%B0%E5%9D%80%E4%B8%8E%E6%8E%A5%E6%94%B6%E5%88%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8C%85mac%E6%AF%94%E5%AF%B9%EF%BC%8C%E8%8B%A5%E7%9B%B8%E9%80%9A%E5%BE%80%E4%B8%8A%E4%BC%A0%E3%80%82%3C%2Fspan%3E%0A++%3Cbr+style%3D%22color%3Argb%2868%2C68%2C68%29%3Bfont-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3B%22%3E%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23444444%3B%22%3E%26nbsp%3B+%26nbsp%3B%26nbsp%3B%3C%2Fspan%3E%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%2300bfff%3B%22%3E%E6%8E%A5%E6%94%B6%E7%AB%AF%E5%90%8C%E6%A0%B7%E5%8F%AF%E4%BB%A5%E8%AE%BE%E7%BD%AE%3C%2Fspan%3E%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23ff0000%3B%22%3E%E6%B7%B7%E6%9D%82%E6%A8%A1%E5%BC%8F%3C%2Fspan%3E%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%2300bfff%3B%22%3E%EF%BC%9A%E6%8E%A5%E6%94%B6%E6%89%80%E6%9C%89%E7%BB%8F%E8%BF%87%E5%AE%83%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%81%EF%BC%8C%E8%BF%99%E6%A0%B7%3Cspan+style%3D%22font-family%3Aarial%2C+%27%E5%AE%8B%E4%BD%93%27%2C+sans-serif%3B%22%3E%E4%B8%8D%E8%AE%BA%E5%85%B6%E7%9B%AE%E7%9A%84%E5%9C%B0%E5%9D%80%E6%98%AF%E5%90%A6%E6%98%AF%E4%BB%96%3C%2Fspan%3E%EF%BC%8C%E9%83%BD%E4%BC%9A%E5%BE%80%E4%B8%8A%E4%BC%A0%EF%BC%8C%3Cspan+style%3D%22font-family%3Aarial%2C+%27%E5%AE%8B%E4%BD%93%27%2C+sans-serif%3B%22%3E%E7%94%B1%E7%BD%91%E7%BB%9C%E5%B1%82%E8%BF%9B%E8%A1%8C%E5%88%A4%E6%96%AD%EF%BC%8C%E7%A1%AE%E5%AE%9A%E6%98%AF%E9%80%92%E4%BA%A4%E4%B8%8A%E5%B1%82%EF%BC%88%E4%BC%A0%E8%BE%93%E5%B1%82%EF%BC%89%EF%BC%8C%E8%BF%98%E6%98%AF%E4%B8%A2%E5%BC%83%E3%80%82%3C%2Fspan%3E%3Cbr%3E%3C%2Fspan%3E%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23333333%3B%22%3E%3Cspan+style%3D%22font-family%3Aarial%2C+%27%E5%AE%8B%E4%BD%93%27%2C+sans-serif%3B%22%3E%3Cbr%3E%3C%2Fspan%3E%3C%2Fspan%3E%0A++%3Cbr+style%3D%22color%3Argb%2868%2C68%2C68%29%3Bfont-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3B%22%3E%0A++%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23333333%3B%22%3E%3Cspan+style%3D%22font-family%3Aarial%2C+%27%E5%AE%8B%E4%BD%93%27%2C+sans-serif%3B%22%3E4.%E7%BD%91%E5%8D%A1%E9%A9%B1%E5%8A%A8%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AE%E7%BB%84%E6%92%ADmac%E5%9C%B0%E5%9D%80%EF%BC%9F%3C%2Fspan%3E%3C%2Fspan%3E%0A++%3Cbr+style%3D%22color%3Argb%2868%2C68%2C68%29%3Bfont-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3B%22%3E%0A++%3Cp%3E%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23333333%3B%22%3E%3Cspan+style%3D%22font-family%3Aarial%2C+%27%E5%AE%8B%E4%BD%93%27%2C+sans-serif%3B%22%3E%26nbsp%3B+%26nbsp%3B+%E4%BB%A5%E4%B8%8B%E6%98%AFlinux%E4%B8%AD9x25%E8%AE%BE%E7%BD%AE%E7%BB%84%E6%92%ADmac%E5%9C%B0%E5%9D%80%E7%9A%84%E9%83%A8%E5%88%86%E4%BB%A3%E7%A0%81%3C%2Fspan%3E%3C%2Fspan%3E%3C%2Fp%3E%0A++%3Cp%3E%3Cspan+style%3D%22font-family%3ATahoma%2C+Helvetica%2C+SimSun%2C+sans-serif%3Bfont-size%3A14px%3Bcolor%3A%23333333%3B%22%3E%3Cspan+style%3D%22font-family%3Aarial%2C+%27%E5%AE%8B%E4%BD%93%27%2C+sans-serif%3B%22%3E%3C%2Fspan%3E%3C%2Fspan%3E%3C%2Fp%3E%0A++%3Cpre%3E%3Ccode+class%3D%22language-cpp%22%3Estatic+int+inline+hash_bit_value%28int+bitnr%2C+__u8+*addr%29%0A%7B%0A++++++++if+%28addr%5Bbitnr+%2F+8%5D+%26amp%3B+%281+%26lt%3B%26lt%3B+%28bitnr+%25+8%29%29%29%0A++++++++++++++++return+1%3B%0A++++++++return+0%3B%0A%7D%0A%0A%2F*%0A+*+The+hash+address+register+is+64+bits+long+and+takes+up+two+locations+in+the+memory+map.%0A+*+The+least+significant+bits+are+stored+in+EMAC_HSL+and+the+most+significant%0A+*+bits+in+EMAC_HSH.%0A+*%0A+*+The+unicast+hash+enable+and+the+multicast+hash+enable+bits+in+the+network+configuration%0A+*++register+enable+the+reception+of+hash+matched+frames.+The+destination+address+is%0A+*++reduced+to+a+6+bit+index+into+the+64+bit+hash+register+using+the+following+hash+function.%0A+*+The+hash+function+is+an+exclusive+or+of+every+sixth+bit+of+the+destination+address.%0A+*+++hash_index%5B5%5D+%3D+da%5B5%5D+%5E+da%5B11%5D+%5E+da%5B17%5D+%5E+da%5B23%5D+%5E+da%5B29%5D+%5E+da%5B35%5D+%5E+da%5B41%5D+%5E+da%5B47%5D%0A+*+++hash_index%5B4%5D+%3D+da%5B4%5D+%5E+da%5B10%5D+%5E+da%5B16%5D+%5E+da%5B22%5D+%5E+da%5B28%5D+%5E+da%5B34%5D+%5E+da%5B40%5D+%5E+da%5B46%5D%0A+*+++hash_index%5B3%5D+%3D+da%5B3%5D+%5E+da%5B09%5D+%5E+da%5B15%5D+%5E+da%5B21%5D+%5E+da%5B27%5D+%5E+da%5B33%5D+%5E+da%5B39%5D+%5E+da%5B45%5D%0A+*+++hash_index%5B2%5D+%3D+da%5B2%5D+%5E+da%5B08%5D+%5E+da%5B14%5D+%5E+da%5B20%5D+%5E+da%5B26%5D+%5E+da%5B32%5D+%5E+da%5B38%5D+%5E+da%5B44%5D%0A+*+++hash_index%5B1%5D+%3D+da%5B1%5D+%5E+da%5B07%5D+%5E+da%5B13%5D+%5E+da%5B19%5D+%5E+da%5B25%5D+%5E+da%5B31%5D+%5E+da%5B37%5D+%5E+da%5B43%5D%0A+*+++hash_index%5B0%5D+%3D+da%5B0%5D+%5E+da%5B06%5D+%5E+da%5B12%5D+%5E+da%5B18%5D+%5E+da%5B24%5D+%5E+da%5B30%5D+%5E+da%5B36%5D+%5E+da%5B42%5D%0A+*+da%5B0%5D+represents+the+least+significant+bit+of+the+first+byte+received%2C+that+is%2C+the+multicast%2F%0A+*++unicast+indicator%2C+and+da%5B47%5D+represents+the+most+significant+bit+of+the+last+byte%0A+*++received.%0A+*+If+the+hash+index+points+to+a+bit+that+is+set+in+the+hash+register+then+the+frame+will+be%0A+*++matched+according+to+whether+the+frame+is+multicast+or+unicast.%0A+*+A+multicast+match+will+be+signalled+if+the+multicast+hash+enable+bit+is+set%2C+da%5B0%5D+is+1+and%0A+*++the+hash+index+points+to+a+bit+set+in+the+hash+register.%0A+*+A+unicast+match+will+be+signalled+if+the+unicast+hash+enable+bit+is+set%2C+da%5B0%5D+is+0+and+the%0A+*++hash+index+points+to+a+bit+set+in+the+hash+register.%0A+*+To+receive+all+multicast+frames%2C+the+hash+register+should+be+set+with+all+ones+and+the%0A+*++multicast+hash+enable+bit+should+be+set+in+the+network+configuration+register.%0A+*%2F%0A%0A%2F*%0A+*+Return+the+hash+index+value+for+the+specified+address.%0A+*%2F%0Astatic+int+hash_get_index%28__u8+*addr%29%0A%7B%0A++++++++int+i%2C+j%2C+bitval%3B%0A++++++++int+hash_index+%3D+0%3B%0A%0A++++++++for+%28j+%3D+0%3B+j+%26lt%3B+6%3B+j%2B%2B%29+%7B%0A++++++++++++++++for+%28i+%3D+0%2C+bitval+%3D+0%3B+i+%26lt%3B+8%3B+i%2B%2B%29%0A++++++++++++++++++++++++bitval+%5E%3D+hash_bit_value%28i*6+%2B+j%2C+addr%29%3B%0A%0A++++++++++++++++hash_index+%7C%3D+%28bitval+%26lt%3B%26lt%3B+j%29%3B%0A++++++++%7D%0A%0A++++++++return+hash_index%3B%0A%7D%0A%0A%2F*%0A+*+Add+multicast+addresses+to+the+internal+multicast-hash+table.%0A+*%2F%0Astatic+void+at91ether_sethashtable%28struct+net_device+*dev%29%0A%7B%0A++++++++struct+netdev_hw_addr+*ha%3B%0A++++++++unsigned+long+mc_filter%5B2%5D%3B%0A++++++++unsigned+int+bitnr%3B%0A%0A++++++++mc_filter%5B0%5D+%3D+mc_filter%5B1%5D+%3D+0%3B%0A%0A++++++++netdev_for_each_mc_addr%28ha%2C+dev%29+%7B%0A++++++++++++++++bitnr+%3D+hash_get_index%28ha-%26gt%3Baddr%29%3B%0A++++++++++++++++mc_filter%5Bbitnr+%26gt%3B%26gt%3B+5%5D+%7C%3D+1+%26lt%3B%26lt%3B+%28bitnr+%26amp%3B+31%29%3B%0A++++++++%7D%0A%0A++++++++at91_emac_write%28AT91_EMAC_HSL%2C+mc_filter%5B0%5D%29%3B%0A++++++++at91_emac_write%28AT91_EMAC_HSH%2C+mc_filter%5B1%5D%29%3B%0A%7D%0A%0A%2F*%0A+*+Enable%2FDisable+promiscuous+and+multicast+modes.%0A+*%2F%0Astatic+void+at91ether_set_multicast_list%28struct+net_device+*dev%29%0A%7B%0A++++++++unsigned+long+cfg%3B%0A%0A++++++++cfg+%3D+at91_emac_read%28AT91_EMAC_CFG%29%3B%0A%0A++++++++if+%28dev-%26gt%3Bflags+%26amp%3B+IFF_PROMISC%29++++++++++++++++++++++++%2F*+Enable+promiscuous+mode+*%2F%0A++++++++++++++++cfg+%7C%3D+AT91_EMAC_CAF%3B%0A++++++++else+if+%28dev-%26gt%3Bflags+%26amp%3B+%28%7EIFF_PROMISC%29%29++++++++++++++++%2F*+Disable+promiscuous+mode+*%2F%0A++++++++++++++++cfg+%26amp%3B%3D+%7EAT91_EMAC_CAF%3B%0A%0A++++++++if+%28dev-%26gt%3Bflags+%26amp%3B+IFF_ALLMULTI%29+%7B++++++++++++++++%2F*+Enable+all+multicast+mode+*%2F%0A++++++++++++++++at91_emac_write%28AT91_EMAC_HSH%2C+-1%29%3B%0A++++++++++++++++at91_emac_write%28AT91_EMAC_HSL%2C+-1%29%3B%0A++++++++++++++++cfg+%7C%3D+AT91_EMAC_MTI%3B%0A++++++++%7D+else+if+%28%21netdev_mc_empty%28dev%29%29+%7B+%2F*+Enable+specific+multicasts+*%2F%0A++++++++++++++++at91ether_sethashtable%28dev%29%3B%0A++++++++++++++++cfg+%7C%3D+AT91_EMAC_MTI%3B%0A++++++++%7D+else+if+%28dev-%26gt%3Bflags+%26amp%3B+%28%7EIFF_ALLMULTI%29%29+%7B++++++++%2F*+Disable+all+multicast+mode+*%2F%0A++++++++++++++++at91_emac_write%28AT91_EMAC_HSH%2C+0%29%3B%0A++++++++++++++++at91_emac_write%28AT91_EMAC_HSL%2C+0%29%3B%0A++++++++++++++++cfg+%26amp%3B%3D+%7EAT91_EMAC_MTI%3B%0A++++++++%7D%0A%0A++++++++at91_emac_write%28AT91_EMAC_CFG%2C+cfg%29%3B%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E%0A++%3Cbr%3E%0A++%3Cbr%3E%0A++%3Cp%3E%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn+btn-red-hollow%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2FIvan804638781%2Farticle%2Fdetails%2F70859409%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2FIvan804638781%2Farticle%2Fdetails%2F70859409%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}
---
layout: default
title: 以太坊源码分析(11)eth目前的共识算法pow的整理
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-e2445db1a8.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22%3E+%0A++%3Cdiv+style%3D%22color%3Argb%28212%2C212%2C212%29%3Bbackground-color%3Argb%2830%2C30%2C30%29%3Bfont-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3Bfont-size%3A14px%3Bline-height%3A19px%3Bwhite-space%3Apre%3B%22%3E%0A+++%3Cdiv%3E%0A++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23+eth%E7%9B%AE%E5%89%8D%E7%9A%84%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95pow%E7%9A%84%E6%95%B4%E7%90%86%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23+%E6%B6%89%E5%8F%8A%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AD%90%E5%8C%85%E4%B8%BB%E8%A6%81%E6%9C%89consensus%2Cminer%2Ccore%2Cgeth%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%60%60%60%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%2Fconsensus+%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%E3%80%80%E3%80%80+consensus.go%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++1.+Prepare%E6%96%B9%E6%B3%95%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++2.+CalcDifficulty%E6%96%B9%E6%B3%95%EF%BC%9A%E8%AE%A1%E7%AE%97%E5%B7%A5%E4%BD%9C%E9%87%8F%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++3.+AccumulateRewards%E6%96%B9%E6%B3%95%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%AF%8F%E4%B8%AA%E5%9D%97%E7%9A%84%E5%87%BA%E5%9D%97%E5%A5%96%E5%8A%B1%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++4.+VerifySeal%E6%96%B9%E6%B3%95%EF%BC%9A%E6%A0%A1%E9%AA%8Cpow%E7%9A%84%E5%B7%A5%E4%BD%9C%E9%87%8F%E9%9A%BE%E5%BA%A6%E6%98%AF%E5%90%A6%E7%AC%A6%E5%90%88%E8%A6%81%E6%B1%82%EF%BC%8C%E8%BF%94%E5%9B%9Enil%E5%88%99%E9%80%9A%E8%BF%87%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++5.+verifyHeader%E6%96%B9%E6%B3%95%EF%BC%9A%E6%A0%A1%E9%AA%8C%E5%8C%BA%E5%9D%97%E5%A4%B4%E6%98%AF%E5%90%A6%E7%AC%A6%E5%90%88%E5%85%B1%E8%AF%86%E8%A7%84%E5%88%99%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%60%60%60%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%2Fminer+%E6%8C%96%E7%9F%BF%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++work.go%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++commitNewWork%28%29%3A%E6%8F%90%E4%BA%A4%E6%96%B0%E7%9A%84%E5%9D%97%EF%BC%8C%E6%96%B0%E7%9A%84%E4%BA%A4%E6%98%93%2C%E4%BB%8E%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%E8%8E%B7%E5%8F%96%E6%9C%AA%E6%89%93%E5%8C%85%E7%9A%84%E4%BA%A4%E6%98%93%EF%BC%8C%E7%84%B6%E5%90%8E%E6%8F%90%E4%BA%A4%E4%BA%A4%E6%98%93%2C%E8%BF%9B%E8%A1%8C%E6%89%93%E5%8C%85%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E+%0A++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E__%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81__%3C%2Fstrong%3E%3C%2Fspan%3E%3A%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%60%60%60%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++%2F%2F+Create+the+current+work+task+and+check+any+fork+transitions+needed%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bwork+%3A%3D+self.current%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+self.config.DAOForkSupport+%26amp%3B%26amp%3B+self.config.DAOForkBlock+%21%3D+nil+%26amp%3B%26amp%3B+self.config.DAOForkBlock.Cmp%28header.Number%29+%3D%3D+0+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmisc.ApplyDAOHardFork%28work.state%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpending%2C+err+%3A%3D+self.eth.TxPool%28%29.Pending%28%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Error%28%22Failed+to+fetch+pending+transactions%22%2C+%22err%22%2C+err%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btxs+%3A%3D+types.NewTransactionsByPriceAndNonce%28self.current.signer%2C+pending%29%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bwork.commitTransactions%28self.mux%2C+txs%2C+self.chain%2C+self.coinbase%29%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%60%60%60%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%60%60%60%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++eth%2Fhandler.go%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BNewProtocolManager+--%26gt%3B+verifyHeader+--%26gt%3B+VerifySeal%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%60%60%60%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E__%E6%95%B4%E6%9D%A1%E9%93%BE%E7%9A%84%E8%BF%90%E8%A1%8C%2C%E6%89%93%E5%8C%85%E4%BA%A4%E6%98%93%2C%E5%87%BA%E5%9D%97%E7%9A%84%E6%B5%81%E7%A8%8B__%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%60%60%60%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%2Fcmd%2Fgeth%2Fmain.go%2Fmain%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv%3E%0A++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmakeFullNode--%26gt%3BRegisterEthService--%26gt%3Beth.New--%26gt%3BNewProtocolManager+--%26gt%3B+verifyHeader+--%26gt%3B+VerifySeal%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv%3E%0A++++%60%60%60%0A+++%3C%2Fdiv%3E%0A+++%3Cp%3E%3C%2Fp%3E%0A+++%3Cp%3E%3C%2Fp%3E%0A+++%3Cdiv+style%3D%22color%3Argb%28212%2C212%2C212%29%3Bbackground-color%3Argb%2830%2C30%2C30%29%3Bfont-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3Bfont-size%3A14px%3Bline-height%3A19px%3Bwhite-space%3Apre%3B%22%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23+eth%E7%9A%84%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95pow%E8%B0%83%E7%94%A8%E6%A0%88%E8%AF%A6%E8%A7%A3%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23%23+%E6%A0%B8%E5%BF%83%E7%9A%84%E9%80%BB%E8%BE%91%E9%9C%80%E8%A6%81%E4%BB%8E%2Feth%2Fhandler.go%2FNewProtocolManager%E6%96%B9%E6%B3%95%E4%B8%8B%E5%BC%80%E5%A7%8B%2C%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%3A%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++manager.downloader+%3D+downloader.New%28mode%2C+chaindb%2C+manager.eventMux%2C+blockchain%2C+nil%2C+manager.removePeer%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvalidator+%3A%3D+func%28header+*types.Header%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+engine.VerifyHeader%28blockchain%2C+header%2C+true%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheighter+%3A%3D+func%28%29+uint64+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+blockchain.CurrentBlock%28%29.NumberU64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Binserter+%3A%3D+func%28blocks+types.Blocks%29+%28int%2C+error%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+fast+sync+is+running%2C+deny+importing+weird+blocks%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+atomic.LoadUint32%28%26amp%3Bmanager.fastSync%29+%3D%3D+1+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Warn%28%22Discarded+bad+propagated+block%22%2C+%22number%22%2C+blocks%5B0%5D.Number%28%29%2C+%22hash%22%2C+blocks%5B0%5D.Hash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+0%2C+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreUint32%28%26amp%3Bmanager.acceptTxs%2C+1%29+%2F%2F+Mark+initial+sync+done+on+any+fetcher+import%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager.blockchain.InsertChain%28blocks%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.fetcher+%3D+fetcher.New%28blockchain.GetBlockByHash%2C+validator%2C+manager.BroadcastBlock%2C+heighter%2C+inserter%2C+manager.removePeer%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager%2C+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23%23+%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%E7%94%9F%E6%88%90%E4%BA%86%E4%B8%80%E4%B8%AA%E6%A0%A1%E9%AA%8C%E5%8C%BA%E5%9D%97%E5%A4%B4%E9%83%A8%E7%9A%84%E5%AF%B9%E8%B1%A1%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60validator%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23%23+%E8%AE%A9%E6%88%91%E4%BB%AC%E7%BB%A7%E7%BB%AD%E8%B7%9F%E8%BF%9B%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60engine.VerifyHeader%28blockchain%2C+header%2C+true%29%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%E6%96%B9%E6%B3%95%3A%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+VerifyHeader+checks+whether+a+header+conforms+to+the+consensus+rules+of+the%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+stock+Ethereum+ethash+engine.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28ethash+*Ethash%29+VerifyHeader%28chain+consensus.ChainReader%2C+header+*types.Header%2C+seal+bool%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+we%27re+running+a+full+engine+faking%2C+accept+any+input+as+valid%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+ethash.fakeFull+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Short+circuit+if+the+header+is+known%2C+or+it%27s+parent+not%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnumber+%3A%3D+header.Number.Uint64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+chain.GetHeader%28header.Hash%28%29%2C+number%29+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bparent+%3A%3D+chain.GetHeader%28header.ParentHash%2C+number-1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+parent+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+consensus.ErrUnknownAncestor%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Sanity+checks+passed%2C+do+a+proper+verification%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+ethash.verifyHeader%28chain%2C+header%2C+parent%2C+false%2C+seal%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23%23+%E9%A6%96%E5%85%88%E7%9C%8B%E7%AC%AC%E4%B8%80%E4%B8%AAif%2C%E5%AE%83%E7%9A%84%E9%80%BB%E8%BE%91%E5%88%A4%E6%96%AD%E6%98%AF%E5%A6%82%E6%9E%9C%E4%B8%BAtrue%2C%E9%82%A3%E4%B9%88%E5%B0%B1%E5%85%B3%E9%97%AD%E6%89%80%E6%9C%89%E7%9A%84%E5%85%B1%E8%AF%86%E8%A7%84%E5%88%99%E6%A0%A1%E9%AA%8C%2C%E7%B4%A7%E8%B7%9F%E7%9D%80%E4%B8%A4%E4%B8%AAif%E5%88%A4%E6%96%AD%E6%98%AF%E5%8F%AA%E8%A6%81%E8%AF%A5block%E7%9A%84header%E7%9A%84hash%E5%92%8Cnumber%E6%88%96%E8%80%85%E4%B8%8A%E4%B8%80%E4%B8%AAheader%E7%9A%84hash%E5%92%8Cnumber%E5%AD%98%E5%9C%A8%E9%93%BE%E4%B8%8A%2C%E9%82%A3%E4%B9%88%E5%AE%83header%E7%9A%84%E5%85%B1%E8%AF%86%E8%A7%84%E5%88%99%E6%A0%A1%E9%AA%8C%E5%B0%B1%E9%80%9A%E8%BF%87%2C%E5%A6%82%E6%9E%9C%E9%83%BD%E4%B8%8D%E9%80%9A%E8%BF%87%2C%E9%82%A3%E4%B9%88%E8%AF%A5%E5%8C%BA%E5%9D%97%E6%A0%A1%E9%AA%8C%E5%A4%B1%E8%B4%A5%E8%B7%91%E5%87%BA%E9%94%99%E8%AF%AF.%E5%A6%82%E6%9E%9C%E8%B5%B0%E5%88%B0%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AAreturn%2C%E9%82%A3%E4%B9%88%E5%B0%B1%E9%9C%80%E8%A6%81%E5%81%9A%E4%B8%80%E4%BA%9B%E5%85%B6%E4%BB%96%E9%A2%9D%E5%A4%96%E9%AA%8C%E8%AF%81%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+verifyHeader+checks+whether+a+header+conforms+to+the+consensus+rules+of+the%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+stock+Ethereum+ethash+engine.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+See+YP+section+4.3.4.+%22Block+Header+Validity%22%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28ethash+*Ethash%29+verifyHeader%28chain+consensus.ChainReader%2C+header%2C+parent+*types.Header%2C+uncle+bool%2C+seal+bool%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Ensure+that+the+header%27s+extra-data+section+is+of+a+reasonable+size%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+uint64%28len%28header.Extra%29%29+%26gt%3B+params.MaximumExtraDataSize+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+fmt.Errorf%28%22extra-data+too+long%3A+%25d+%26gt%3B+%25d%22%2C+len%28header.Extra%29%2C+params.MaximumExtraDataSize%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Verify+the+header%27s+timestamp%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+uncle+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+header.Time.Cmp%28math.MaxBig256%29+%26gt%3B+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errLargeBlockTime%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+header.Time.Cmp%28big.NewInt%28time.Now%28%29.Unix%28%29%29%29+%26gt%3B+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+consensus.ErrFutureBlock%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+header.Time.Cmp%28parent.Time%29+%26lt%3B%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errZeroBlockTime%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Verify+the+block%27s+difficulty+based+in+it%27s+timestamp+and+parent%27s+difficulty%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bexpected+%3A%3D+CalcDifficulty%28chain.Config%28%29%2C+header.Time.Uint64%28%29%2C+parent%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+expected.Cmp%28header.Difficulty%29+%21%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+fmt.Errorf%28%22invalid+difficulty%3A+have+%25v%2C+want+%25v%22%2C+header.Difficulty%2C+expected%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Verify+that+the+gas+limit+is+%26lt%3B%3D+2%5E63-1%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+header.GasLimit.Cmp%28math.MaxBig63%29+%26gt%3B+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+fmt.Errorf%28%22invalid+gasLimit%3A+have+%25v%2C+max+%25v%22%2C+header.GasLimit%2C+math.MaxBig63%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Verify+that+the+gasUsed+is+%26lt%3B%3D+gasLimit%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+header.GasUsed.Cmp%28header.GasLimit%29+%26gt%3B+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+fmt.Errorf%28%22invalid+gasUsed%3A+have+%25v%2C+gasLimit+%25v%22%2C+header.GasUsed%2C+header.GasLimit%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Verify+that+the+gas+limit+remains+within+allowed+bounds%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdiff+%3A%3D+new%28big.Int%29.Set%28parent.GasLimit%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdiff+%3D+diff.Sub%28diff%2C+header.GasLimit%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdiff.Abs%28diff%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blimit+%3A%3D+new%28big.Int%29.Set%28parent.GasLimit%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blimit+%3D+limit.Div%28limit%2C+params.GasLimitBoundDivisor%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+diff.Cmp%28limit%29+%26gt%3B%3D+0+%7C%7C+header.GasLimit.Cmp%28params.MinGasLimit%29+%26lt%3B+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+fmt.Errorf%28%22invalid+gas+limit%3A+have+%25v%2C+want+%25v+%2B%3D+%25v%22%2C+header.GasLimit%2C+parent.GasLimit%2C+limit%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Verify+that+the+block+number+is+parent%27s+%2B1%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+diff+%3A%3D+new%28big.Int%29.Sub%28header.Number%2C+parent.Number%29%3B+diff.Cmp%28big.NewInt%281%29%29+%21%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+consensus.ErrInvalidNumber%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Verify+the+engine+specific+seal+securing+the+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+seal+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+ethash.VerifySeal%28chain%2C+header%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+all+checks+passed%2C+validate+any+special+fields+for+hard+forks%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+misc.VerifyDAOHeaderExtraData%28chain.Config%28%29%2C+header%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+misc.VerifyForkHashes%28chain.Config%28%29%2C+header%2C+uncle%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23%23+%E8%AF%A5%E6%96%B9%E6%B3%95%E4%BC%9A%E5%8E%BB%E6%A0%A1%E9%AA%8C%E8%AF%A5%E5%8C%BA%E5%9D%97%E5%A4%B4%E4%B8%AD%E7%9A%84extra%E6%95%B0%E6%8D%AE%E6%98%AF%E4%B8%8D%E6%98%AF%E6%AF%94%E7%BA%A6%E5%AE%9A%E7%9A%84%E5%8F%82%E6%95%B0%E6%9C%80%E5%A4%A7%E5%80%BC%E8%BF%98%E5%A4%A7%2C%E5%A6%82%E6%9E%9C%E8%B6%85%E8%BF%87%2C%E5%88%99%E8%BF%94%E5%9B%9E%E9%94%99%E8%AF%AF%2C%E5%85%B6%E6%AC%A1%E4%BC%9A%E5%8E%BB%E5%88%A4%E6%96%AD%E8%AF%A5%E5%8C%BA%E5%9D%97%E6%98%AF%E4%B8%8D%E6%98%AF%E4%B8%80%E4%B8%AAuncle%E5%8C%BA%E5%9D%97%2C%E5%A6%82%E6%9E%9Cheader%E7%9A%84%E6%97%B6%E9%97%B4%E6%88%B3%E4%B8%8D%E7%AC%A6%E5%90%88%E8%A7%84%E5%88%99%E5%88%99%E8%BF%94%E5%9B%9E%E9%94%99%E8%AF%AF%2C%E7%84%B6%E5%90%8E%E6%A0%B9%E6%8D%AE%E9%93%BE%E7%9A%84%E9%85%8D%E7%BD%AE%2Cheader%E7%9A%84%E6%97%B6%E9%97%B4%E6%88%B3%E4%BB%A5%E5%8F%8A%E4%B8%8A%E4%B8%80%E4%B8%AA%E5%8C%BA%E5%9D%97%E8%AE%A1%E7%AE%97%E4%B8%AD%E6%9C%AC%E6%AC%A1%E5%8C%BA%E5%9D%97%E6%9C%9F%E5%BE%85%E7%9A%84%E9%9A%BE%E5%BA%A6%2C%E5%A6%82%E6%9E%9Cheader%E7%9A%84%E9%9A%BE%E5%BA%A6%E5%92%8C%E6%9C%9F%E5%BE%85%E7%9A%84%E4%B8%8D%E4%B8%80%E8%87%B4%2C%E6%88%96header%E7%9A%84gasLimit%E6%AF%94%E6%9C%80%E5%A4%A7%E6%95%B0%E5%AD%97%E8%BF%98%E5%A4%A7%2C%E6%88%96%E5%B7%B2%E7%94%A8%E7%9A%84gas%E8%B6%85%E8%BF%87gasLimit%2C%E5%88%99%E8%BF%94%E5%9B%9E%E9%94%99%E8%AF%AF.%E5%A6%82%E6%9E%9CgasLimit%E8%B6%85%E8%BF%87%E9%A2%84%E5%AE%9A%E7%9A%84%E6%9C%80%E5%A4%A7%E5%80%BC%E6%88%96%E6%9C%80%E5%B0%8F%E5%80%BC%2C%E6%88%96header%E7%9A%84number%E5%87%8F%E5%8E%BB%E4%B8%8A%E4%B8%80%E4%B8%AAblock%E7%9A%84header%E7%9A%84number%E4%B8%8D%E4%B8%BA1%2C%E5%88%99%E8%BF%94%E5%9B%9E%E9%94%99%E8%AF%AF.%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60seal%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%E4%B8%BAtrue%2C%E5%88%99%E4%BC%9A%E5%8E%BB%E6%A0%A1%E9%AA%8C%E8%AF%A5%E5%8C%BA%E5%9D%97%E6%98%AF%E5%90%A6%E7%AC%A6%E5%90%88pow%E7%9A%84%E5%B7%A5%E4%BD%9C%E9%87%8F%E8%AF%81%E6%98%8E%E7%9A%84%E8%A6%81%E6%B1%82%28%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60verifySeal%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%E6%96%B9%E6%B3%95%29%2C%E5%9B%A0%E4%B8%BA%E7%A7%81%E6%9C%89%E9%93%BE%E4%B8%80%E8%88%AC%E6%98%AF%E4%B8%8D%E9%9C%80%E8%A6%81pow.%E6%9C%80%E5%90%8E%E4%B8%A4%E4%B8%AAif%E6%98%AF%E5%8E%BB%E5%88%A4%E6%96%AD%E5%8C%BA%E5%9D%97%E6%98%AF%E5%90%A6%E5%85%B7%E6%9C%89%E6%AD%A3%E7%A1%AE%E7%9A%84hash%2C%E9%98%B2%E6%AD%A2%E7%94%A8%E6%88%B7%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E9%93%BE%E4%B8%8A%2C%E4%BB%A5%E5%8F%8A%E6%A0%A1%E9%AA%8C%E5%9D%97%E5%A4%B4%E7%9A%84%E9%A2%9D%E5%A4%96%E6%95%B0%E6%8D%AE%E5%AD%97%E6%AE%B5%E6%98%AF%E5%90%A6%E7%AC%A6%E5%90%88DAO%E7%A1%AC%E5%8F%89%E8%A7%84%E5%88%99%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23%23+uncle+block%3A%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E__eth%E5%85%81%E8%AE%B8%E6%97%B7%E5%B7%A5%E5%9C%A8%E6%8C%96%E5%88%B0%E4%B8%80%E4%B8%AA%E5%9D%97%E7%9A%84%E5%90%8C%E6%97%B6%E5%8C%85%E5%90%AB%E4%B8%80%E7%BB%84uncle+block%E5%88%97%E8%A1%A8%2C%E4%B8%BB%E8%A6%81%E6%9C%89%E4%B8%A4%E4%B8%AA%E4%BD%9C%E7%94%A8%3A__%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++1.+%E7%94%B1%E4%BA%8E%E7%BD%91%E7%BB%9C%E4%BC%A0%E6%92%AD%E7%9A%84%E5%BB%B6%E8%BF%9F%E5%8E%9F%E5%9B%A0%2C%E9%80%9A%E8%BF%87%E5%A5%96%E5%8A%B1%E9%82%A3%E4%BA%9B%E7%94%B1%E4%BA%8E%E4%B8%8D%E6%98%AF%E9%93%BE%E7%BB%84%E6%88%90%E5%8C%BA%E5%9D%97%E9%83%A8%E5%88%86%E8%80%8C%E4%BA%A7%E7%94%9F%E9%99%88%E6%97%A7%E6%88%96%E5%AD%A4%E7%AB%8B%E5%8C%BA%E5%9D%97%E7%9A%84%E6%97%B7%E5%B7%A5%2C%E4%BB%8E%E8%80%8C%E5%87%8F%E5%B0%91%E9%9B%86%E6%9D%83%E6%BF%80%E5%8A%B1%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++2.+%E9%80%9A%E8%BF%87%E5%A2%9E%E5%8A%A0%E5%9C%A8%E4%B8%BB%E9%93%BE%E4%B8%8A%E7%9A%84%E5%B7%A5%E4%BD%9C%E9%87%8F%E6%9D%A5%E5%A2%9E%E5%8A%A0%E9%93%BE%E6%9D%A1%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%28%E5%9C%A8%E5%B7%A5%E4%BD%9C%E4%B8%AD%2C%E5%B0%91%E6%B5%AA%E8%B4%B9%E5%B7%A5%E4%BD%9C%E5%9C%A8%E9%99%88%E6%97%A7%E7%9A%84%E5%9D%97%E4%B8%8A%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++eth%E7%9A%84pow%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+CalcDifficulty+is+the+difficulty+adjustment+algorithm.+It+returns%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+the+difficulty+that+a+new+block+should+have+when+created+at+time%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+given+the+parent+block%27s+time+and+difficulty.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+TODO+%28karalabe%29%3A+Move+the+chain+maker+into+this+package+and+make+this+private%21%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+CalcDifficulty%28config+*params.ChainConfig%2C+time+uint64%2C+parent+*types.Header%29+*big.Int+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnext+%3A%3D+new%28big.Int%29.Add%28parent.Number%2C+big1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bswitch+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+config.IsByzantium%28next%29%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+calcDifficultyByzantium%28time%2C+parent%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+config.IsHomestead%28next%29%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+calcDifficultyHomestead%28time%2C+parent%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefault%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+calcDifficultyFrontier%28time%2C+parent%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23%23+%E8%AF%A5%E6%96%B9%E6%B3%95%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60case%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%E6%98%AF%E6%A0%B9%E6%8D%AE%E6%8B%9C%E5%8D%A0%E5%BA%AD%E8%A7%84%E5%88%99%E5%8E%BB%E8%AE%A1%E7%AE%97%E6%96%B0%E5%9D%97%E5%BA%94%E8%AF%A5%E5%85%B7%E6%9C%89%E7%9A%84%E9%9A%BE%E5%BA%A6%2C%E7%AC%AC%E4%BA%8C%E4%B8%AA%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60case%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%E6%98%AF%E6%A0%B9%E6%8D%AE%E5%AE%85%E5%9F%BA%E5%9C%B0%E8%A7%84%E5%88%99%E5%8E%BB%E8%AE%A1%E7%AE%97%E6%96%B0%E5%9D%97%E5%BA%94%E8%AF%A5%E5%85%B7%E6%9C%89%E7%9A%84%E9%9A%BE%E5%BA%A6%2C%E7%AC%AC%E4%B8%89%E4%B8%AA%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60case%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%E6%98%AF%E6%A0%B9%E6%8D%AE%E8%BE%B9%E7%95%8C%E8%A7%84%E5%88%99%E5%8E%BB%E8%AE%A1%E7%AE%97%E9%9A%BE%E5%BA%A6%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23+pow%E8%AE%A1%E7%AE%97%E7%94%9F%E6%88%90%E6%96%B0%E5%9D%97%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E+%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E__%2Fconsensus%2Fseal.go%2Fseal__%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A++++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%2F%2F+Seal+implements+consensus.Engine%2C+attempting+to+find+a+nonce+that+satisfies%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%2F%2F+the+block%27s+difficulty+requirements.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++func+%28ethash+*Ethash%29+Seal%28chain+consensus.ChainReader%2C+block+*types.Block%2C+stop+%26lt%3B-chan+struct%7B%7D%29+%28*types.Block%2C+error%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+we%27re+running+a+fake+PoW%2C+simply+return+a+0+nonce+immediately%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+ethash.fakeMode+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheader+%3A%3D+block.Header%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheader.Nonce%2C+header.MixDigest+%3D+types.BlockNonce%7B%7D%2C+common.Hash%7B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+block.WithSeal%28header%29%2C+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+we%27re+running+a+shared+PoW%2C+delegate+sealing+to+it%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+ethash.shared+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+ethash.shared.Seal%28chain%2C+block%2C+stop%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Create+a+runner+and+the+multiple+search+threads+it+directs%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Babort+%3A%3D+make%28chan+struct%7B%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bfound+%3A%3D+make%28chan+*types.Block%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bethash.lock.Lock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bthreads+%3A%3D+ethash.threads%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+ethash.rand+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bseed%2C+err+%3A%3D+crand.Int%28crand.Reader%2C+big.NewInt%28math.MaxInt64%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bethash.lock.Unlock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%2C+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bethash.rand+%3D+rand.New%28rand.NewSource%28seed.Int64%28%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bethash.lock.Unlock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+threads+%3D%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bthreads+%3D+runtime.NumCPU%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+threads+%26lt%3B+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bthreads+%3D+0+%2F%2F+Allows+disabling+local+mining+without+extra+logic+around+local%2Fremote%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+pend+sync.WaitGroup%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i+%3A%3D+0%3B+i+%26lt%3B+threads%3B+i%2B%2B+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpend.Add%281%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+func%28id+int%2C+nonce+uint64%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+pend.Done%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bethash.mine%28block%2C+id%2C+nonce%2C+abort%2C+found%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%28i%2C+uint64%28ethash.rand.Int63%28%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Wait+until+sealing+is+terminated+or+a+nonce+is+found%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+result+*types.Block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bselect+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-stop%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Outside+abort%2C+stop+all+miner+threads%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bclose%28abort%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+result+%3D+%26lt%3B-found%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+One+of+the+threads+found+a+block%2C+abort+all+others%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bclose%28abort%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-ethash.update%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Thread+count+was+changed+on+user+request%2C+restart%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bclose%28abort%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpend.Wait%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+ethash.Seal%28chain%2C+block%2C+stop%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Wait+for+all+miners+to+terminate+and+return+the+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Bpend.Wait%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+result%2C+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A++++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23%23+%E8%AF%A5%E6%96%B9%E6%B3%95%E7%9A%84foreach%E4%B8%AD%E5%B9%B6%E8%A1%8C%E6%8C%96%E6%96%B0%E5%9D%97%2C%E4%B8%80%E6%97%A6%E5%81%9C%E6%AD%A2%E6%88%96%E8%80%85%E6%89%BE%E5%88%B0%E6%96%B0%E5%BF%AB%2C%E5%88%99%E5%BA%9F%E5%BC%83%E5%85%B6%E4%BB%96%E6%89%80%E6%9C%89%E7%9A%84%2C%E5%A6%82%E6%9E%9C%E5%8D%8F%E7%A8%8B%E8%AE%A1%E7%AE%97%E6%9C%89%E5%8F%98%E6%9B%B4%2C%E5%88%99%E9%87%8D%E6%96%B0%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23%23+%E5%A5%BD%E4%BA%86pow%E6%8C%96%E7%9F%BF%E7%9A%84%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95%E5%B7%B2%E7%BB%8F%E5%87%BA%E7%8E%B0%2C%EF%BD%80ethash.mine%EF%BD%80%2C%E5%A6%82%E6%9E%9C%E6%8C%96%E5%8F%96%E5%88%B0%E6%96%B0%E5%9D%97%2C%E9%82%A3%E4%B9%88%E5%B0%B1%E5%86%99%E5%85%A5%E5%88%B0%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60found+channel%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+mine+is+the+actual+proof-of-work+miner+that+searches+for+a+nonce+starting+from%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+seed+that+results+in+correct+final+block+difficulty.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28ethash+*Ethash%29+mine%28block+*types.Block%2C+id+int%2C+seed+uint64%2C+abort+chan+struct%7B%7D%2C+found+chan+*types.Block%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Extract+some+data+from+the+header%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheader+%3D+block.Header%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+%3D+header.HashNoNonce%28%29.Bytes%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btarget+%3D+new%28big.Int%29.Div%28maxUint256%2C+header.Difficulty%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnumber+%3D+header.Number.Uint64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdataset+%3D+ethash.dataset%28number%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Start+generating+random+nonces+until+we+abort+or+find+a+good+one%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Battempts+%3D+int64%280%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnonce+%3D+seed%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blogger+%3A%3D+log.New%28%22miner%22%2C+id%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blogger.Trace%28%22Started+ethash+search+for+new+nonces%22%2C+%22seed%22%2C+seed%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bselect+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-abort%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Mining+terminated%2C+update+stats+and+abort%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blogger.Trace%28%22Ethash+nonce+search+aborted%22%2C+%22attempts%22%2C+nonce-seed%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bethash.hashrate.Mark%28attempts%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefault%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+We+don%27t+have+to+update+hash+rate+on+every+nonce%2C+so+update+after+after+2%5EX+nonces%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Battempts%2B%2B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+%28attempts+%25+%281+%26lt%3B%26lt%3B+15%29%29+%3D%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bethash.hashrate.Mark%28attempts%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Battempts+%3D+0%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Compute+the+PoW+value+of+this+nonce%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdigest%2C+result+%3A%3D+hashimotoFull%28dataset%2C+hash%2C+nonce%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+new%28big.Int%29.SetBytes%28result%29.Cmp%28target%29+%26lt%3B%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Correct+nonce+found%2C+create+a+new+header+with+it%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheader+%3D+types.CopyHeader%28header%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheader.Nonce+%3D+types.EncodeNonce%28nonce%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheader.MixDigest+%3D+common.BytesToHash%28digest%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Seal+and+return+a+block+%28if+still+needed%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bselect+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+found+%26lt%3B-+block.WithSeal%28header%29%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blogger.Trace%28%22Ethash+nonce+found+and+reported%22%2C+%22attempts%22%2C+nonce-seed%2C+%22nonce%22%2C+nonce%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-abort%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blogger.Trace%28%22Ethash+nonce+found+but+discarded%22%2C+%22attempts%22%2C+nonce-seed%2C+%22nonce%22%2C+nonce%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnonce%2B%2B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23%23+%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60target%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%E6%98%AF%E7%9B%AE%E6%A0%87%E6%96%B0%E5%9D%97%E7%9A%84%E9%9A%BE%E5%BA%A6%2C%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60hashimotoFull%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%E6%96%B9%E6%B3%95%E8%AE%A1%E7%AE%97%E5%87%BA%E4%B8%80%E4%B8%AAhash%E5%80%BC%2C%E5%A6%82%E6%9E%9C%E4%BA%A7%E7%94%9F%E7%9A%84%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60hash%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%E5%80%BC%E5%B0%8F%E4%BA%8E%E7%AD%89%E4%BA%8E%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60target%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%E7%9A%84%E5%80%BC%2C%E5%88%99hash%E9%9A%BE%E5%BA%A6%E7%AC%A6%E5%90%88%E8%A6%81%E6%B1%82%2C%E5%B0%86%E7%AC%A6%E5%90%88%E8%A6%81%E6%B1%82%E7%9A%84%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60header%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%E5%86%99%E5%85%A5%E5%88%B0%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60found+channel%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%E4%B8%AD%2C%E5%B9%B6%E8%BF%94%E5%9B%9E%2C%E5%90%A6%E5%88%99%E4%B8%80%E7%9B%B4%E5%BE%AA%E7%8E%AF%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+hashimotoFull+aggregates+data+from+the+full+dataset+%28using+the+full+in-memory%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+dataset%29+in+order+to+produce+our+final+value+for+a+particular+header+hash+and%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+nonce.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+hashimotoFull%28dataset+%5B%5Duint32%2C+hash+%5B%5Dbyte%2C+nonce+uint64%29+%28%5B%5Dbyte%2C+%5B%5Dbyte%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blookup+%3A%3D+func%28index+uint32%29+%5B%5Duint32+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Boffset+%3A%3D+index+*+hashWords%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+dataset%5Boffset+%3A+offset%2BhashWords%5D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+hashimoto%28hash%2C+nonce%2C+uint64%28len%28dataset%29%29*4%2C+lookup%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+hashimoto+aggregates+data+from+the+full+dataset+in+order+to+produce+our+final%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+value+for+a+particular+header+hash+and+nonce.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+hashimoto%28hash+%5B%5Dbyte%2C+nonce+uint64%2C+size+uint64%2C+lookup+func%28index+uint32%29+%5B%5Duint32%29+%28%5B%5Dbyte%2C+%5B%5Dbyte%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Calculate+the+number+of+theoretical+rows+%28we+use+one+buffer+nonetheless%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Brows+%3A%3D+uint32%28size+%2F+mixBytes%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Combine+header%2Bnonce+into+a+64+byte+seed%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bseed+%3A%3D+make%28%5B%5Dbyte%2C+40%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcopy%28seed%2C+hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbinary.LittleEndian.PutUint64%28seed%5B32%3A%5D%2C+nonce%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bseed+%3D+crypto.Keccak512%28seed%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BseedHead+%3A%3D+binary.LittleEndian.Uint32%28seed%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Start+the+mix+with+replicated+seed%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmix+%3A%3D+make%28%5B%5Duint32%2C+mixBytes%2F4%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i+%3A%3D+0%3B+i+%26lt%3B+len%28mix%29%3B+i%2B%2B+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmix%5Bi%5D+%3D+binary.LittleEndian.Uint32%28seed%5Bi%2516*4%3A%5D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Mix+in+random+dataset+nodes%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btemp+%3A%3D+make%28%5B%5Duint32%2C+len%28mix%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i+%3A%3D+0%3B+i+%26lt%3B+loopAccesses%3B+i%2B%2B+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bparent+%3A%3D+fnv%28uint32%28i%29%5EseedHead%2C+mix%5Bi%25len%28mix%29%5D%29+%25+rows%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+j+%3A%3D+uint32%280%29%3B+j+%26lt%3B+mixBytes%2FhashBytes%3B+j%2B%2B+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcopy%28temp%5Bj*hashWords%3A%5D%2C+lookup%282*parent%2Bj%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BfnvHash%28mix%2C+temp%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Compress+mix%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i+%3A%3D+0%3B+i+%26lt%3B+len%28mix%29%3B+i+%2B%3D+4+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmix%5Bi%2F4%5D+%3D+fnv%28fnv%28fnv%28mix%5Bi%5D%2C+mix%5Bi%2B1%5D%29%2C+mix%5Bi%2B2%5D%29%2C+mix%5Bi%2B3%5D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmix+%3D+mix%5B%3Alen%28mix%29%2F4%5D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdigest+%3A%3D+make%28%5B%5Dbyte%2C+common.HashLength%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i%2C+val+%3A%3D+range+mix+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbinary.LittleEndian.PutUint32%28digest%5Bi*4%3A%5D%2C+val%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+digest%2C+crypto.Keccak256%28append%28seed%2C+digest...%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23%23+%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%2C%E8%AF%A5%E6%96%B9%E6%B3%95%E6%98%AF%E4%B8%8D%E6%96%AD%E7%9A%84%E8%BF%9B%E8%A1%8Csha256%E7%9A%84hash%E8%BF%90%E7%AE%97%2C%E7%84%B6%E5%90%8E%E8%BF%94%E5%9B%9E%E8%BF%9B%E8%A1%8Chash%E5%80%BC%E9%9A%BE%E5%BA%A6%E7%9A%84%E5%AF%B9%E6%AF%94%2C%E5%A6%82%E6%9E%9Chash%E7%9A%84%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E5%A4%A7%E5%B0%8F%E5%B0%8F%E4%BA%8E%E7%AD%89%E4%BA%8E%E9%A2%84%E5%AE%9A%E7%9A%84%E9%9A%BE%E5%BA%A6%2C%E9%82%A3%E4%B9%88%E8%BF%99%E4%B8%AAhash%E5%B0%B1%E6%98%AF%E7%AC%A6%E5%90%88%E4%BA%A7%E5%9D%97%E8%A6%81%E6%B1%82%E7%9A%84%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A+++%3Cdiv+style%3D%22color%3Argb%28212%2C212%2C212%29%3Bbackground-color%3Argb%2830%2C30%2C30%29%3Bfont-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3Bfont-size%3A14px%3Bline-height%3A19px%3Bwhite-space%3Apre%3B%22%3E%0A++++%3Cdiv%3E%0A+++++%E4%BA%A7%E7%94%9F%E4%B8%80%E4%B8%AA%E9%9A%8F%E6%9C%BAseed%2C%E8%B5%8B%E7%BB%99nonce%E9%9A%8F%E6%9C%BA%E6%95%B0%EF%BC%8C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E7%84%B6%E5%90%8E%E8%BF%9B%E8%A1%8Csha256%E7%9A%84hash%E8%BF%90%E7%AE%97%2C%E5%A6%82%E6%9E%9C%E7%AE%97%E5%87%BA%E7%9A%84hash%E9%9A%BE%E5%BA%A6%E4%B8%8D%E7%AC%A6%E5%90%88%E7%9B%AE%E6%A0%87%E9%9A%BE%E5%BA%A6%2C%E5%88%99nonce%2B1%EF%BC%8C%E7%BB%A7%E7%BB%AD%E8%BF%90%E7%AE%97%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++worker.go%2Fwait%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28self+*worker%29+wait%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmustCommitNewWork+%3A%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+result+%3A%3D+range+self.recv+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.AddInt32%28%26amp%3Bself.atWork%2C+-1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+result+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcontinue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++agent.go%2Fmine%28%29%E6%96%B9%E6%B3%95%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++func+%28self+*CpuAgent%29+mine%28work+*Work%2C+stop+%26lt%3B-chan+struct%7B%7D%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+result%2C+err+%3A%3D+self.engine.Seal%28self.chain%2C+work.Block%2C+stop%29%3B+result+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Info%28%22Successfully+sealed+new+block%22%2C+%22number%22%2C+result.Number%28%29%2C+%22hash%22%2C+result.Hash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.returnCh+%26lt%3B-+%26amp%3BResult%7Bwork%2C+result%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Warn%28%22Block+sealing+failed%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.returnCh+%26lt%3B-+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E5%A6%82%E6%9E%9C%E6%8C%96%E5%88%B0%E4%B8%80%E4%B8%AA%E6%96%B0%E5%9D%97%EF%BC%8C%E5%88%99%E5%B0%86%E7%BB%93%E6%9E%9C%E5%86%99%E5%88%B0self%E7%9A%84return%E7%AE%A1%E9%81%93%E4%B8%AD%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E5%86%99%E5%9D%97%E7%9A%84%E6%96%B9%E6%B3%95WriteBlockAndState%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++wait%E6%96%B9%E6%B3%95%E6%8E%A5%E6%94%B6self.recv%E7%AE%A1%E9%81%93%E7%9A%84%E7%BB%93%E6%9E%9C%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%9C%89%E7%BB%93%E6%9E%9C%EF%BC%8C%E8%AF%B4%E6%98%8E%E6%9C%AC%E5%9C%B0%E6%8C%96%E5%88%B0%E6%96%B0%E5%9D%97%E4%BA%86%EF%BC%8C%E5%88%99%E5%B0%86%E6%96%B0%E5%9D%97%E8%BF%9B%E8%A1%8C%E5%AD%98%E5%82%A8%EF%BC%8C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E5%B9%B6%E6%8A%8A%E8%AF%A5%E5%9D%97%E6%94%BE%E5%88%B0%E5%BE%85%E7%A1%AE%E8%AE%A4%E7%9A%84block%E5%88%A4%E5%AE%9A%E5%8C%BA%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++miner.go%2Fupdate%E6%96%B9%E6%B3%95%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%9C%89%E6%96%B0%E5%9D%97%E5%87%BA%E6%9D%A5%EF%BC%8C%E5%88%99%E5%81%9C%E6%AD%A2%E6%8C%96%E7%9F%BF%E8%BF%9B%E8%A1%8C%E4%B8%8B%E8%BD%BD%E5%90%8C%E6%AD%A5%E6%96%B0%E5%9D%97%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8B%E8%BD%BD%E5%AE%8C%E6%88%90%E6%88%96%E5%A4%B1%E8%B4%A5%E7%9A%84%E4%BA%8B%E4%BB%B6%EF%BC%8C%E5%88%99%E7%BB%A7%E7%BB%AD%E5%BC%80%E5%A7%8B%E6%8C%96%E7%9F%BF.%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%2Fgeth%2Fmain.go%2Fgeth%E3%80%80--%26gt%3B+makeFullNode+--%26gt%3B+utils.RegisterEthService%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++--%26gt%3B+eth.New%28ctx%2C+cfg%29%E3%80%80--%26gt%3B+miner.New%28eth%2C+eth.chainConfig%2C+eth.EventMux%28%29%2C+eth.engine%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%BF%99%E4%B8%AA%E6%98%AF%E5%90%AF%E5%8A%A8%E9%93%BE%E5%90%8E%E5%88%B0%E6%8C%96%E7%9F%BF%EF%BC%8C%E5%85%B1%E8%AF%86%E4%BB%A3%E7%A0%81%E7%9A%84%E6%95%B4%E4%B8%AA%E8%B0%83%E7%94%A8%E6%A0%88%EF%BC%8C%E5%BC%80%E5%A7%8B%E5%88%86%E6%9E%90%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++func+New%28eth+Backend%2C+config+*params.ChainConfig%2C+mux+*event.TypeMux%2C+engine+consensus.Engine%29+*Miner+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bminer+%3A%3D+%26amp%3BMiner%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Beth%3A+eth%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmux%3A+mux%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bengine%3A+engine%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bworker%3A+newWorker%28config%2C+engine%2C+common.Address%7B%7D%2C+eth%2C+mux%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BcanStart%3A+1%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bminer.Register%28NewCpuAgent%28eth.BlockChain%28%29%2C+engine%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+miner.update%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+miner%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E4%BB%8Eminer.Update%28%29%E7%9A%84%E9%80%BB%E8%BE%91%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%87%BA%EF%BC%8C%E5%AF%B9%E4%BA%8E%E4%BB%BB%E4%BD%95%E4%B8%80%E4%B8%AAEthereum%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%9A%84%E8%8A%82%E7%82%B9%E6%9D%A5%E8%AF%B4%EF%BC%8C%E6%8C%96%E6%8E%98%E4%B8%80%E4%B8%AA%E6%96%B0%E5%8C%BA%E5%9D%97%E5%92%8C%E4%BB%8E%E5%85%B6%E4%BB%96%E8%8A%82%E7%82%B9%E4%B8%8B%E8%BD%BD%E3%80%81%E5%90%8C%E6%AD%A5%E4%B8%80%E4%B8%AA%E6%96%B0%E5%8C%BA%E5%9D%97%EF%BC%8C%E6%A0%B9%E6%9C%AC%E6%98%AF%E7%9B%B8%E4%BA%92%E5%86%B2%E7%AA%81%E7%9A%84%E3%80%82%E8%BF%99%E6%A0%B7%E7%9A%84%E8%A7%84%E5%AE%9A%EF%BC%8C%E4%BF%9D%E8%AF%81%E4%BA%86%E5%9C%A8%E6%9F%90%E4%B8%AA%E8%8A%82%E7%82%B9%E4%B8%8A%EF%BC%8C%E4%B8%80%E4%B8%AA%E6%96%B0%E5%8C%BA%E5%9D%97%E5%8F%AA%E5%8F%AF%E8%83%BD%E6%9C%89%E4%B8%80%E7%A7%8D%E6%9D%A5%E6%BA%90%EF%BC%8C%E8%BF%99%E5%8F%AF%E4%BB%A5%E5%A4%A7%E5%A4%A7%E9%99%8D%E4%BD%8E%E5%8F%AF%E8%83%BD%E5%87%BA%E7%8E%B0%E7%9A%84%E5%8C%BA%E5%9D%97%E5%86%B2%E7%AA%81%EF%BC%8C%E5%B9%B6%E9%81%BF%E5%85%8D%E5%85%A8%E7%BD%91%E4%B8%AD%E8%AE%A1%E7%AE%97%E8%B5%84%E6%BA%90%E7%9A%84%E6%B5%AA%E8%B4%B9%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E9%A6%96%E5%85%88%E6%98%AF%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++func+%28self+*Miner%29+Register%28agent+Agent%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+self.Mining%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bagent.Start%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.worker.register%28agent%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++func+%28self+*worker%29+register%28agent+Agent%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.mu.Lock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+self.mu.Unlock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.agents%5Bagent%5D+%3D+struct%7B%7D%7B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bagent.SetReturnCh%28self.recv%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%E5%B0%86self%E7%9A%84recv%E7%AE%A1%E9%81%93%E7%BB%91%E5%AE%9A%E5%9C%A8%E4%BA%86agent%E7%9A%84return%E7%AE%A1%E9%81%93%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E7%84%B6%E5%90%8E%E6%98%AFnewWorker%E6%96%B9%E6%B3%95%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++func+newWorker%28config+*params.ChainConfig%2C+engine+consensus.Engine%2C+coinbase+common.Address%2C+eth+Backend%2C+mux+*event.TypeMux%29+*worker+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bworker+%3A%3D+%26amp%3Bworker%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bconfig%3A+config%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bengine%3A+engine%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Beth%3A+eth%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmux%3A+mux%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtxCh%3A+make%28chan+core.TxPreEvent%2C+txChanSize%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BchainHeadCh%3A+make%28chan+core.ChainHeadEvent%2C+chainHeadChanSize%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BchainSideCh%3A+make%28chan+core.ChainSideEvent%2C+chainSideChanSize%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BchainDb%3A+eth.ChainDb%28%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Brecv%3A+make%28chan+*Result%2C+resultQueueSize%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bchain%3A+eth.BlockChain%28%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bproc%3A+eth.BlockChain%28%29.Validator%28%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BpossibleUncles%3A+make%28map%5Bcommon.Hash%5D*types.Block%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcoinbase%3A+coinbase%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bagents%3A+make%28map%5BAgent%5Dstruct%7B%7D%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunconfirmed%3A+newUnconfirmedBlocks%28eth.BlockChain%28%29%2C+miningLogAtDepth%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Subscribe+TxPreEvent+for+tx+pool%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bworker.txSub+%3D+eth.TxPool%28%29.SubscribeTxPreEvent%28worker.txCh%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Subscribe+events+for+blockchain%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bworker.chainHeadSub+%3D+eth.BlockChain%28%29.SubscribeChainHeadEvent%28worker.chainHeadCh%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bworker.chainSideSub+%3D+eth.BlockChain%28%29.SubscribeChainSideEvent%28worker.chainSideCh%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+worker.update%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+worker.wait%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bworker.commitNewWork%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+worker%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%E7%BB%91%E5%AE%9A%E4%BA%86%E4%B8%89%E4%B8%AA%E7%AE%A1%E9%81%93%2C%E9%A2%9D%E5%A4%96%E5%90%AF%E5%8A%A8%E4%BA%86%E4%B8%A4%E4%B8%AAgoroutine%E6%89%A7%E8%A1%8Cupdate%E5%92%8Cwait%E6%96%B9%E6%B3%95%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28self+*worker%29+update%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+self.txSub.Unsubscribe%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+self.chainHeadSub.Unsubscribe%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+self.chainSideSub.Unsubscribe%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+A+real+event+arrived%2C+process+interesting+content%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bselect+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Handle+ChainHeadEvent%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-self.chainHeadCh%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.commitNewWork%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Handle+ChainSideEvent%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+ev+%3A%3D+%26lt%3B-self.chainSideCh%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.uncleMu.Lock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.possibleUncles%5Bev.Block.Hash%28%29%5D+%3D+ev.Block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.uncleMu.Unlock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Handle+TxPreEvent%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+ev+%3A%3D+%26lt%3B-self.txCh%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Apply+transaction+to+the+pending+state+if+we%27re+not+mining%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+atomic.LoadInt32%28%26amp%3Bself.mining%29+%3D%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.currentMu.Lock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bacc%2C+_+%3A%3D+types.Sender%28self.current.signer%2C+ev.Tx%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btxs+%3A%3D+map%5Bcommon.Address%5Dtypes.Transactions%7Bacc%3A+%7Bev.Tx%7D%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btxset+%3A%3D+types.NewTransactionsByPriceAndNonce%28self.current.signer%2C+txs%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.current.commitTransactions%28self.mux%2C+txset%2C+self.chain%2C+self.coinbase%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.currentMu.Unlock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+we%27re+mining%2C+but+nothing+is+being+processed%2C+wake+on+new+transactions%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+self.config.Clique+%21%3D+nil+%26amp%3B%26amp%3B+self.config.Clique.Period+%3D%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.commitNewWork%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+System+stopped%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-self.txSub.Err%28%29%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-self.chainHeadSub.Err%28%29%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-self.chainSideSub.Err%28%29%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++worker.update%E6%96%B9%E6%B3%95%E4%B8%AD%E6%8E%A5%E6%94%B6%E5%90%84%E7%A7%8D%E4%BA%8B%E4%BB%B6%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%98%AF%E6%B0%B8%E4%B9%85%E5%BE%AA%E7%8E%AF%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%9C%89%E9%94%99%E8%AF%AF%E4%BA%8B%E4%BB%B6%E5%8F%91%E7%94%9F%EF%BC%8C%E5%88%99%E7%BB%88%E6%AD%A2%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%9C%89%E6%96%B0%E7%9A%84%E4%BA%A4%E6%98%93%E4%BA%8B%E4%BB%B6%EF%BC%8C%E5%88%99%E6%89%A7%E8%A1%8CcommitTransactions%E9%AA%8C%E8%AF%81%E6%8F%90%E4%BA%A4%E4%BA%A4%E6%98%93%E5%88%B0%E6%9C%AC%E5%9C%B0%E7%9A%84trx%E5%88%A4%E5%AE%9A%E6%B1%A0%E4%B8%AD%2C%E4%BE%9B%E4%B8%8B%E6%AC%A1%E5%87%BA%E5%9D%97%E4%BD%BF%E7%94%A8%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++worker.wait%E7%9A%84%E6%96%B9%E6%B3%95%E6%8E%A5%E6%94%B6self.recv%E7%AE%A1%E9%81%93%E7%9A%84%E7%BB%93%E6%9E%9C%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E6%9C%AC%E5%9C%B0%E6%96%B0%E6%8C%96%E5%87%BA%E7%9A%84%E5%9D%97%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%9C%89%E6%8C%96%E5%87%BA%EF%BC%8C%E5%88%99%E5%86%99%E5%85%A5%E5%9D%97%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%B9%B6%E5%B9%BF%E6%92%AD%E4%B8%80%E4%B8%AAchainHeadEvent%E4%BA%8B%E4%BB%B6%2C%E5%90%8C%E6%97%B6%E5%B0%86%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E8%AF%A5%E5%9D%97%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%BE%85%E7%A1%AE%E8%AE%A4%E5%88%97%E8%A1%A8%E4%B8%AD%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%8F%90%E4%BA%A4%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E5%B7%A5%E4%BD%9C%E9%87%8F%EF%BC%8CcommitNewWork%E6%96%B9%E6%B3%95%E7%9B%B8%E5%BD%93%E4%BA%8E%E5%85%B1%E8%AF%86%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%98%B6%E6%AE%B5%EF%BC%8C%E5%AE%83%E4%BC%9A%E7%BB%84%E8%A3%85%E4%B8%80%E4%B8%AA%E6%A0%87%E5%87%86%E7%9A%84%E5%9D%97%EF%BC%8C%E5%85%B6%E4%BB%96%E5%8C%85%E5%90%AB%E4%BA%A7%E5%87%BA%E8%AF%A5%E5%9D%97%E9%9C%80%E8%A6%81%E7%9A%84%E9%9A%BE%E5%BA%A6%EF%BC%8C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E7%84%B6%E5%90%8E%E5%B0%86%E4%BA%A7%E5%87%BA%E8%AF%A5%E5%9D%97%E7%9A%84%E5%B7%A5%E4%BD%9C%E4%BB%A5%E5%8F%8A%E5%9D%97%E4%BF%A1%E6%81%AF%E5%B9%BF%E6%92%AD%E7%BB%99%E6%89%80%E6%9C%89%E4%BB%A3%E7%90%86%EF%BC%8C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E6%8E%A5%E7%9D%80agent.go%E4%B8%AD%E7%9A%84update%E6%96%B9%E6%B3%95%E7%9B%91%E5%90%AC%E5%88%B0%E5%B9%BF%E6%92%AD%E6%96%B0%E5%9D%97%E5%B7%A5%E4%BD%9C%E9%87%8F%E7%9A%84%E4%BB%BB%E5%8A%A1%EF%BC%8C%E5%BC%80%E5%A7%8B%E6%8C%96%E7%9F%BF%EF%BC%8C%E6%8A%A2%E8%AF%A5%E5%9D%97%E7%9A%84%E5%87%BA%E5%9D%97%E6%9D%83%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++func+%28self+*CpuAgent%29+mine%28work+*Work%2C+stop+%26lt%3B-chan+struct%7B%7D%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+result%2C+err+%3A%3D+self.engine.Seal%28self.chain%2C+work.Block%2C+stop%29%3B+result+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Info%28%22Successfully+sealed+new+block%22%2C+%22number%22%2C+result.Number%28%29%2C+%22hash%22%2C+result.Hash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.returnCh+%26lt%3B-+%26amp%3BResult%7Bwork%2C+result%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Warn%28%22Block+sealing+failed%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.returnCh+%26lt%3B-+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%E5%BC%80%E5%A7%8B%E8%BF%9B%E8%A1%8C%E5%9D%97%E7%9A%84hash%E9%9A%BE%E5%BA%A6%E8%AE%A1%E7%AE%97%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%BF%94%E5%9B%9E%E7%9A%84result%E7%BB%93%E6%9E%9C%E4%B8%8D%E4%B8%BA%E7%A9%BA%EF%BC%8C%E8%AF%B4%E6%98%8E%E6%8C%96%E7%9F%BF%E6%88%90%E5%8A%9F%EF%BC%8C%E5%B0%86%E7%BB%93%E6%9E%9C%E5%86%99%E5%85%A5%E5%88%B0returnCh%E9%80%9A%E9%81%93%E4%B8%AD%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E7%84%B6%E5%90%8Eworker.go%E4%B8%AD%E7%9A%84wait%E6%96%B9%E6%B3%95%E5%8F%88%E6%8E%A5%E6%94%B6%E5%88%B0%E4%BA%86%E4%BF%A1%E6%81%AF%E5%BC%80%E5%A7%8B%E5%A4%84%E7%90%86.%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E7%BB%84%E8%A3%85%E5%A5%BD%E5%B8%A6%E6%9C%89%E9%9A%8F%E6%9C%BA%E6%95%B0hash%E7%9A%84%EF%BC%8C%E9%82%A3%E4%B9%88%E5%AD%98%E5%82%A8%E5%9D%97%E5%B0%86%E4%BC%9A%E8%BF%94%E5%9B%9E%E9%94%99%E8%AF%AF%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bstat%2C+err+%3A%3D+self.chain.WriteBlockAndState%28block%2C+work.receipts%2C+work.state%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Error%28%22Failed+writing+block+to+chain%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcontinue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++remote_agent+%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E5%A5%97RPC%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E7%9F%BF%E5%B7%A5%E8%BF%9B%E8%A1%8C%E9%87%87%E7%9F%BF%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%82+%E6%AF%94%E5%A6%82%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E7%9F%BF%E6%9C%BA%EF%BC%8C%E7%9F%BF%E6%9C%BA%E5%86%85%E9%83%A8%E6%B2%A1%E6%9C%89%E8%BF%90%E8%A1%8C%E4%BB%A5%E5%A4%AA%E5%9D%8A%E8%8A%82%E7%82%B9%EF%BC%8C%E7%9F%BF%E6%9C%BA%E9%A6%96%E5%85%88%E4%BB%8Eremote_agent%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%9A%84%E4%BB%BB%E5%8A%A1%EF%BC%8C%E7%84%B6%E5%90%8E%E8%BF%9B%E8%A1%8C%E6%8C%96%E7%9F%BF%E8%AE%A1%E7%AE%97%EF%BC%8C%E5%BD%93%E6%8C%96%E7%9F%BF%E5%AE%8C%E6%88%90%E5%90%8E%EF%BC%8C%E6%8F%90%E4%BA%A4%E8%AE%A1%E7%AE%97%E7%BB%93%E6%9E%9C%EF%BC%8C%E5%AE%8C%E6%88%90%E6%8C%96%E7%9F%BF%E3%80%82%0A++++%3C%2Fdiv%3E%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv+style%3D%22color%3Argb%28212%2C212%2C212%29%3Bbackground-color%3Argb%2830%2C30%2C30%29%3Bfont-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3Bfont-size%3A14px%3Bline-height%3A19px%3Bwhite-space%3Apre%3B%22%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23+eth%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%2C%E4%BB%8E%E6%9C%AC%E5%9C%B0%E8%8A%82%E7%82%B9%E6%8C%96%E5%88%B0%E5%9D%97%E5%BC%80%E5%A7%8B%E5%88%86%E6%9E%90%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23+%E9%A6%96%E5%85%88%E7%9B%AE%E5%89%8D%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%8A%E9%9D%A2%EF%BC%8C%E8%82%AF%E5%AE%9A%E4%B8%8D%E6%98%AF%E4%BB%A5CPU%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8C%96%E7%9F%BF%E7%9A%84%2C%E9%82%A3%E4%B9%88%E5%B0%B1%E6%98%AF%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60remoteAgent%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%E8%BF%99%E7%A7%8D%E5%BD%A2%E5%BC%8F%2C%E4%B9%9F%E5%B0%B1%E6%98%AF%E7%9F%BF%E6%9C%BA%E9%80%9A%E8%BF%87%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%BB%8E%E4%BB%A5%E5%A4%AA%E7%9A%84%E8%8A%82%E7%82%B9%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%8A%82%E7%82%B9%E7%9A%84%E5%87%BA%E5%9D%97%E4%BB%BB%E5%8A%A1%2C%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E7%84%B6%E5%90%8E%E7%9F%BF%E6%9C%BA%E6%A0%B9%E6%8D%AE%E7%AE%97%E5%87%BA%E7%AC%A6%E5%90%88%E8%AF%A5%E5%9D%97%E9%9A%BE%E5%BA%A6hash%E5%80%BC%2C%E6%8F%90%E4%BA%A4%E7%BB%99%E8%8A%82%E7%82%B9%2C%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%AF%B9%E5%BA%94%E7%9A%84%E4%BB%A5%E4%B8%8B%E6%96%B9%E6%B3%95.%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28a+*RemoteAgent%29+SubmitWork%28nonce+types.BlockNonce%2C+mixDigest%2C+hash+common.Hash%29+bool+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Ba.mu.Lock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+a.mu.Unlock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Make+sure+the+work+submitted+is+present%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bwork+%3A%3D+a.work%5Bhash%5D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+work+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Info%28%22Work+submitted+but+none+pending%22%2C+%22hash%22%2C+hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+false%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Make+sure+the+Engine+solutions+is+indeed+valid%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bresult+%3A%3D+work.Block.Header%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bresult.Nonce+%3D+nonce%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bresult.MixDigest+%3D+mixDigest%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+a.engine.VerifySeal%28a.chain%2C+result%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Warn%28%22Invalid+proof-of-work+submitted%22%2C+%22hash%22%2C+hash%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+false%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bblock+%3A%3D+work.Block.WithSeal%28result%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Solutions+seems+to+be+valid%2C+return+to+the+miner+and+notify+acceptance%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Ba.returnCh+%26lt%3B-+%26amp%3BResult%7Bwork%2C+block%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdelete%28a.work%2C+hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%AF%A5%E6%96%B9%E6%B3%95%E4%BC%9A%E6%A0%A1%E9%AA%8C%E6%8F%90%E4%BA%A4%E8%BF%87%E6%9D%A5%E7%9A%84%E5%9D%97%E7%9A%84hash%E9%9A%BE%E5%BA%A6%2C%E5%A6%82%E6%9E%9C%E6%98%AF%E6%AD%A3%E5%B8%B8%E7%9A%84%E8%AF%9D%2C%E5%88%99%E4%BC%9A%E5%B0%86%E8%AF%A5%E7%94%9F%E6%88%90%E7%9A%84%E5%9D%97%E5%86%99%E5%88%B0%E7%AE%A1%E9%81%93%E4%B8%AD%2C%E7%AE%A1%E9%81%93%E6%8E%A5%E6%94%B6%E7%9A%84%E6%96%B9%E6%B3%95%E5%9C%A8%2Fminer%2Fworker.go%2FWait%E6%96%B9%E6%B3%95%E4%B8%AD%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28self+*worker%29+wait%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmustCommitNewWork+%3A%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+result+%3A%3D+range+self.recv+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.AddInt32%28%26amp%3Bself.atWork%2C+-1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+result+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcontinue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bblock+%3A%3D+result.Block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bwork+%3A%3D+result.Work%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Update+the+block+hash+in+all+logs+since+it+is+now+available+and+not+when+the%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+receipt%2Flog+of+individual+transactions+were+created.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+r+%3A%3D+range+work.receipts+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+l+%3A%3D+range+r.Logs+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bl.BlockHash+%3D+block.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+log+%3A%3D+range+work.state.Logs%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.BlockHash+%3D+block.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bstat%2C+err+%3A%3D+self.chain.WriteBlockAndState%28block%2C+work.receipts%2C+work.state%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Error%28%22Failed+writing+block+to+chain%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcontinue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+check+if+canon+block+and+write+transactions%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+stat+%3D%3D+core.CanonStatTy+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+implicit+by+posting+ChainHeadEvent%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmustCommitNewWork+%3D+false%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Broadcast+the+block+and+announce+chain+insertion+event%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F%E3%80%80%E9%80%9A%E8%BF%87p2p%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%B0%86%E5%9D%97%E5%B9%BF%E6%92%AD%E5%88%B0%E8%BF%9E%E6%8E%A5%E7%9A%84%E8%8A%82%E7%82%B9%2C%E8%B5%B0%E7%9A%84%E8%BF%98%E6%98%AFchannel%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.mux.Post%28core.NewMinedBlockEvent%7BBlock%3A+block%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bevents+%5B%5Dinterface%7B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blogs+%3D+work.state.Logs%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bevents+%3D+append%28events%2C+core.ChainEvent%7BBlock%3A+block%2C+Hash%3A+block.Hash%28%29%2C+Logs%3A+logs%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+stat+%3D%3D+core.CanonStatTy+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bevents+%3D+append%28events%2C+core.ChainHeadEvent%7BBlock%3A+block%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.chain.PostChainEvents%28events%2C+logs%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Insert+the+block+into+the+set+of+pending+ones+to+wait+for+confirmations%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.unconfirmed.Insert%28block.NumberU64%28%29%2C+block.Hash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+mustCommitNewWork+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.commitNewWork%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%BF%99%E9%87%8C%E5%8F%91%E9%80%81%E4%BA%86%E4%B8%80%E4%B8%AA%E6%96%B0%E6%8C%96%E5%88%B0%E5%9D%97%E7%9A%84%E4%BA%8B%E4%BB%B6%2C%E6%8E%A5%E7%9D%80%E8%B7%9F%2C%E8%B0%83%E7%94%A8%E6%A0%88%E6%98%AF%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2Fgeth%2Fmain.go%2Fgeth%E3%80%80--%26gt%3B+startNode%E3%80%80--%26gt%3B+utils.StartNode%28stack%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++--%26gt%3B+stack.Start%28%29%E3%80%80--%26gt%3B+%2Fnode%2Fnode.go%2FStart%28%29+--%26gt%3B+service.Start%28running%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++--%26gt%3B+%2Feth%2Fbackend.go%2FStart%28%29+--%26gt%3B+%2Feth%2Fhandler.go%2FStart%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E5%A5%BD%E4%BA%86%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91%E5%9C%A8handler.go%2FStart%28%29%E9%87%8C%E9%9D%A2%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28pm+*ProtocolManager%29+Start%28maxPeers+int%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.maxPeers+%3D+maxPeers%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+broadcast+transactions%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%B9%BF%E6%92%AD%E4%BA%A4%E6%98%93%E7%9A%84%E9%80%9A%E9%81%93%E3%80%82+txCh%E4%BC%9A%E4%BD%9C%E4%B8%BAtxpool%E7%9A%84TxPreEvent%E8%AE%A2%E9%98%85%E9%80%9A%E9%81%93%E3%80%82txpool%E6%9C%89%E4%BA%86%E8%BF%99%E7%A7%8D%E6%B6%88%E6%81%AF%E4%BC%9A%E9%80%9A%E7%9F%A5%E7%BB%99%E8%BF%99%E4%B8%AAtxCh%E3%80%82+%E5%B9%BF%E6%92%AD%E4%BA%A4%E6%98%93%E7%9A%84goroutine%E4%BC%9A%E6%8A%8A%E8%BF%99%E4%B8%AA%E6%B6%88%E6%81%AF%E5%B9%BF%E6%92%AD%E5%87%BA%E5%8E%BB%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.txCh+%3D+make%28chan+core.TxPreEvent%2C+txChanSize%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%AE%A2%E9%98%85%E7%9A%84%E5%9B%9E%E6%89%A7%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.txSub+%3D+pm.txpool.SubscribeTxPreEvent%28pm.txCh%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.txBroadcastLoop%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%AE%A2%E9%98%85%E6%8C%96%E7%9F%BF%E6%B6%88%E6%81%AF%E3%80%82%E5%BD%93%E6%96%B0%E7%9A%84Block%E8%A2%AB%E6%8C%96%E5%87%BA%E6%9D%A5%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E4%BA%A7%E7%94%9F%E6%B6%88%E6%81%AF%E3%80%82+%E8%BF%99%E4%B8%AA%E8%AE%A2%E9%98%85%E5%92%8C%E4%B8%8A%E9%9D%A2%E7%9A%84%E9%82%A3%E4%B8%AA%E8%AE%A2%E9%98%85%E9%87%87%E7%94%A8%E4%BA%86%E4%B8%A4%E7%A7%8D%E4%B8%8D%E5%90%8C%E7%9A%84%E6%A8%A1%E5%BC%8F%EF%BC%8C%E8%BF%99%E7%A7%8D%E6%98%AF%E6%A0%87%E8%AE%B0%E4%B8%BADeprecated%E7%9A%84%E8%AE%A2%E9%98%85%E6%96%B9%E5%BC%8F%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+broadcast+mined+blocks%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.minedBlockSub+%3D+pm.eventMux.Subscribe%28core.NewMinedBlockEvent%7B%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F%E3%80%80%E6%8C%96%E7%9F%BF%E5%B9%BF%E6%92%AD+goroutine+%E5%BD%93%E6%8C%96%E5%87%BA%E6%9D%A5%E7%9A%84%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E5%B0%BD%E5%BF%AB%E7%9A%84%E5%B9%BF%E6%92%AD%E5%88%B0%E7%BD%91%E7%BB%9C%E4%B8%8A%E9%9D%A2%E5%8E%BB+%E6%9C%AC%E5%9C%B0%E6%8C%96%E5%87%BA%E7%9A%84%E5%9D%97%E9%80%9A%E8%BF%87%E8%BF%99%E7%A7%8D%E5%BD%A2%E5%BC%8F%E5%B9%BF%E6%92%AD%E5%87%BA%E5%8E%BB%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.minedBroadcastLoop%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%90%8C%E6%AD%A5%E5%99%A8%E8%B4%9F%E8%B4%A3%E5%91%A8%E6%9C%9F%E6%80%A7%E5%9C%B0%E4%B8%8E%E7%BD%91%E7%BB%9C%E5%90%8C%E6%AD%A5%EF%BC%8C%E4%B8%8B%E8%BD%BD%E6%95%A3%E5%88%97%E5%92%8C%E5%9D%97%E4%BB%A5%E5%8F%8A%E5%A4%84%E7%90%86%E9%80%9A%E7%9F%A5%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+start+sync+handlers%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.syncer%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+txsyncLoop%E8%B4%9F%E8%B4%A3%E6%AF%8F%E4%B8%AA%E6%96%B0%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%88%9D%E5%A7%8B%E4%BA%8B%E5%8A%A1%E5%90%8C%E6%AD%A5%E3%80%82+%E5%BD%93%E6%96%B0%E7%9A%84peer%E5%87%BA%E7%8E%B0%E6%97%B6%EF%BC%8C%E6%88%91%E4%BB%AC%E8%BD%AC%E5%8F%91%E6%89%80%E6%9C%89%E5%BD%93%E5%89%8D%E5%BE%85%E5%A4%84%E7%90%86%E7%9A%84%E4%BA%8B%E5%8A%A1%E3%80%82+%E4%B8%BA%E4%BA%86%E6%9C%80%E5%B0%8F%E5%8C%96%E5%87%BA%E5%8F%A3%E5%B8%A6%E5%AE%BD%E4%BD%BF%E7%94%A8%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%80%E6%AC%A1%E5%8F%AA%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%AA%E5%B0%8F%E5%8C%85%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.txsyncLoop%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60pm.minedBroadcastLoop%28%29%60%3C%2Fspan%3E%E9%87%8C%E9%9D%A2%E5%B0%B1%E6%9C%89%E7%AE%A1%E9%81%93%E6%8E%A5%E6%94%B6%E5%88%B0%E4%B8%8A%E9%9D%A2post%E5%87%BA%E6%9D%A5%E7%9A%84%E5%87%BA%E5%9D%97%E6%B6%88%E6%81%AF%2C%E8%B7%9F%E8%BF%9B%E5%8E%BB%E5%B0%86%E4%BC%9A%E7%9C%8B%E5%88%B0%E9%80%9A%E8%BF%87p2p%E7%BD%91%E7%BB%9C%E5%8F%91%E9%80%81%E7%BB%99%E8%8A%82%E7%82%B9%E7%9A%84%E9%80%BB%E8%BE%91%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+BroadcastBlock+will+either+propagate+a+block+to+a+subset+of+it%27s+peers%2C+or%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+will+only+announce+it%27s+availability+%28depending+what%27s+requested%29.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28pm+*ProtocolManager%29+BroadcastBlock%28block+*types.Block%2C+propagate+bool%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+%3A%3D+block.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeers+%3A%3D+pm.peers.PeersWithoutBlock%28hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+propagation+is+requested%2C+send+to+a+subset+of+the+peer%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+propagate+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Calculate+the+TD+of+the+block+%28it%27s+not+imported+yet%2C+so+block.Td+is+not+valid%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+td+*big.Int%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+parent+%3A%3D+pm.blockchain.GetBlock%28block.ParentHash%28%29%2C+block.NumberU64%28%29-1%29%3B+parent+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btd+%3D+new%28big.Int%29.Add%28block.Difficulty%28%29%2C+pm.blockchain.GetTd%28block.ParentHash%28%29%2C+block.NumberU64%28%29-1%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Error%28%22Propagating+dangling+block%22%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Send+the+block+to+a+subset+of+our+peers%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btransfer+%3A%3D+peers%5B%3Aint%28math.Sqrt%28float64%28len%28peers%29%29%29%29%5D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+peer+%3A%3D+range+transfer+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeer.SendNewBlock%28block%2C+td%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Trace%28%22Propagated+block%22%2C+%22hash%22%2C+hash%2C+%22recipients%22%2C+len%28transfer%29%2C+%22duration%22%2C+common.PrettyDuration%28time.Since%28block.ReceivedAt%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Otherwise+if+the+block+is+indeed+in+out+own+chain%2C+announce+it%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pm.blockchain.HasBlock%28hash%2C+block.NumberU64%28%29%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+peer+%3A%3D+range+peers+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeer.SendNewBlockHashes%28%5B%5Dcommon.Hash%7Bhash%7D%2C+%5B%5Duint64%7Bblock.NumberU64%28%29%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Trace%28%22Announced+block%22%2C+%22hash%22%2C+hash%2C+%22recipients%22%2C+len%28peers%29%2C+%22duration%22%2C+common.PrettyDuration%28time.Since%28block.ReceivedAt%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%BF%99%E9%87%8C%E9%9D%A2%E4%BC%9A%E5%8F%91%E9%80%81%E4%B8%A4%E7%A7%8D%E6%97%B6%E9%97%B4%EF%BC%8C%E4%B8%80%E7%A7%8D%E6%98%AF%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60NewBlockMsg%60%3C%2Fspan%3E%2C%E5%8F%A6%E5%A4%96%E4%B8%80%E7%A7%8D%E6%98%AF%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60NewBlockHashesMsg%60%3C%2Fspan%3E%2C%E5%A5%BD%E4%BA%86%E5%88%B0%E6%AD%A4%E6%9C%AC%E5%9C%B0%E8%8A%82%E7%82%B9%E6%8C%96%E5%88%B0%E7%9A%84%E5%9D%97%E5%B0%B1%E9%80%9A%E8%BF%87p2p%E7%BD%91%E7%BB%9C%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%BC%80%E5%A7%8B%E6%89%A9%E6%95%A3%E5%87%BA%E5%8E%BB%E4%BA%86%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E6%8E%A5%E7%9D%80%E7%9C%8B%E4%B8%8B%E4%B8%80%E4%B8%AA%E9%87%8D%E8%A6%81%E7%9A%84%E6%96%B9%E6%B3%95%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+NewProtocolManager+returns+a+new+ethereum+sub+protocol+manager.+The+Ethereum+sub+protocol+manages+peers+capable%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+with+the+ethereum+network.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+NewProtocolManager%28config+*params.ChainConfig%2C+mode+downloader.SyncMode%2C+networkId+uint64%2C+mux+*event.TypeMux%2C+txpool+txPool%2C+engine+consensus.Engine%2C+blockchain+*core.BlockChain%2C+chaindb+ethdb.Database%29+%28*ProtocolManager%2C+error%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Create+the+protocol+manager+with+the+base+fields%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager+%3A%3D+%26amp%3BProtocolManager%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnetworkId%3A+networkId%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BeventMux%3A+mux%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btxpool%3A+txpool%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bblockchain%3A+blockchain%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bchaindb%3A+chaindb%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bchainconfig%3A+config%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeers%3A+newPeerSet%28%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnewPeerCh%3A+make%28chan+*peer%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnoMorePeers%3A+make%28chan+struct%7B%7D%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtxsyncCh%3A+make%28chan+*txsync%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BquitSync%3A+make%28chan+struct%7B%7D%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Figure+out+whether+to+allow+fast+sync+or+not%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+mode+%3D%3D+downloader.FastSync+%26amp%3B%26amp%3B+blockchain.CurrentBlock%28%29.NumberU64%28%29+%26gt%3B+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Warn%28%22Blockchain+not+empty%2C+fast+sync+disabled%22%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmode+%3D+downloader.FullSync%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+mode+%3D%3D+downloader.FastSync+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.fastSync+%3D+uint32%281%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Initiate+a+sub-protocol+for+every+implemented+version+we+can+handle%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.SubProtocols+%3D+make%28%5B%5Dp2p.Protocol%2C+0%2C+len%28ProtocolVersions%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i%2C+version+%3A%3D+range+ProtocolVersions+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Skip+protocol+version+if+incompatible+with+the+mode+of+operation%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+mode+%3D%3D+downloader.FastSync+%26amp%3B%26amp%3B+version+%26lt%3B+eth63+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcontinue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Compatible%3B+initialise+the+sub-protocol%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bversion+%3A%3D+version+%2F%2F+Closure+for+the+run%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.SubProtocols+%3D+append%28manager.SubProtocols%2C+p2p.Protocol%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BName%3A+ProtocolName%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BVersion%3A+version%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BLength%3A+ProtocolLengths%5Bi%5D%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BRun%3A+func%28p+*p2p.Peer%2C+rw+p2p.MsgReadWriter%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeer+%3A%3D+manager.newPeer%28int%28version%29%2C+p%2C+rw%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bselect+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+manager.newPeerCh+%26lt%3B-+peer%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.wg.Add%281%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+manager.wg.Done%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager.handle%28peer%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-manager.quitSync%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p2p.DiscQuitting%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BNodeInfo%3A+func%28%29+interface%7B%7D+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager.NodeInfo%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BPeerInfo%3A+func%28id+discover.NodeID%29+interface%7B%7D+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+p+%3A%3D+manager.peers.Peer%28fmt.Sprintf%28%22%25x%22%2C+id%5B%3A8%5D%29%29%3B+p+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.Info%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28manager.SubProtocols%29+%3D%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%2C+errIncompatibleConfig%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+downloader%E6%98%AF%E8%B4%9F%E8%B4%A3%E4%BB%8E%E5%85%B6%E4%BB%96%E7%9A%84peer%E6%9D%A5%E5%90%8C%E6%AD%A5%E8%87%AA%E8%BA%AB%E6%95%B0%E6%8D%AE%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+downloader%E6%98%AF%E5%85%A8%E9%93%BE%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Construct+the+different+synchronisation+mechanisms%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.downloader+%3D+downloader.New%28mode%2C+chaindb%2C+manager.eventMux%2C+blockchain%2C+nil%2C+manager.removePeer%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvalidator+%3A%3D+func%28header+*types.Header%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+engine.VerifyHeader%28blockchain%2C+header%2C+true%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheighter+%3A%3D+func%28%29+uint64+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+blockchain.CurrentBlock%28%29.NumberU64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Binserter+%3A%3D+func%28blocks+types.Blocks%29+%28int%2C+error%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+fast+sync+is+running%2C+deny+importing+weird+blocks%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+atomic.LoadUint32%28%26amp%3Bmanager.fastSync%29+%3D%3D+1+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Warn%28%22Discarded+bad+propagated+block%22%2C+%22number%22%2C+blocks%5B0%5D.Number%28%29%2C+%22hash%22%2C+blocks%5B0%5D.Hash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+0%2C+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%AE%BE%E7%BD%AE%E5%BC%80%E5%A7%8B%E6%8E%A5%E6%94%B6%E4%BA%A4%E6%98%93%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreUint32%28%26amp%3Bmanager.acceptTxs%2C+1%29+%2F%2F+Mark+initial+sync+done+on+any+fetcher+import%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager.blockchain.InsertChain%28blocks%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AAfetcher%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Fetcher%E8%B4%9F%E8%B4%A3%E7%A7%AF%E7%B4%AF%E6%9D%A5%E8%87%AA%E5%90%84%E4%B8%AApeer%E7%9A%84%E5%8C%BA%E5%9D%97%E9%80%9A%E7%9F%A5%E5%B9%B6%E5%AE%89%E6%8E%92%E8%BF%9B%E8%A1%8C%E6%A3%80%E7%B4%A2%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.fetcher+%3D+fetcher.New%28blockchain.GetBlockByHash%2C+validator%2C+manager.BroadcastBlock%2C+heighter%2C+inserter%2C+manager.removePeer%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager%2C+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E8%AF%A5%E6%96%B9%E6%B3%95%E6%98%AF%E7%94%A8%E6%9D%A5%E7%AE%A1%E7%90%86%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%8D%8F%E8%AE%AE%E4%B8%8B%E7%9A%84%E5%A4%9A%E4%B8%AA%E5%AD%90%E5%8D%8F%E8%AE%AE%2C%E5%85%B6%E4%B8%AD%E7%9A%84%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60Run%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%E5%9C%A8%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E5%90%AF%E5%8A%A8%E7%9A%84%E6%97%B6%E5%80%99%E5%B0%B1%E4%BC%9A%E8%B0%83%E7%94%A8%2C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%98%AF%E9%98%BB%E5%A1%9E%E7%9A%84%2C%E8%B7%9F%E8%BF%9B%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60handler%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%E8%83%BD%E7%9C%8B%E5%88%B0%E8%BF%99%E6%A0%B7%E7%9A%84%E4%B8%80%E5%9D%97%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++for+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+pm.handleMsg%28p%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Ethereum+message+handling+failed%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E6%AD%BB%E5%BE%AA%E7%8E%AF%2C%E5%A4%84%E7%90%86p2p%E7%BD%91%E7%BB%9C%E8%BF%87%E6%9D%A5%E7%9A%84%E6%B6%88%E6%81%AF%2C%E6%8E%A5%E7%9D%80%E7%9C%8B%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60handleMsg%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28pm+*ProtocolManager%29+handleMsg%28p+*peer%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Read+the+next+message+from+the+remote+peer%2C+and+ensure+it%27s+fully+consumed%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmsg%2C+err+%3A%3D+p.rw.ReadMsg%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+msg.Size+%26gt%3B+ProtocolMaxMsgSize+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrMsgTooLarge%2C+%22%25v+%26gt%3B+%25v%22%2C+msg.Size%2C+ProtocolMaxMsgSize%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+msg.Discard%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Handle+the+message+depending+on+its+contents%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bswitch+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+StatusMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Status+messages+should+never+arrive+after+the+handshake%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrExtraStatusMsg%2C+%22uncontrolled+status+message%22%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Block+header+query%2C+collect+the+requested+headers+and+reply%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+GetBlockHeadersMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Decode+the+complex+header+query%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+query+getBlockHeadersData%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Bquery%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BhashMode+%3A%3D+query.Origin.Hash+%21%3D+%28common.Hash%7B%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Gather+headers+until+the+fetch+or+network+limits+is+reached%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+common.StorageSize%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheaders+%5B%5D*types.Header%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+bool%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+%21unknown+%26amp%3B%26amp%3B+len%28headers%29+%26lt%3B+int%28query.Amount%29+%26amp%3B%26amp%3B+bytes+%26lt%3B+softResponseLimit+%26amp%3B%26amp%3B+len%28headers%29+%26lt%3B+downloader.MaxHeaderFetch+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+next+header+satisfying+the+query%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+origin+*types.Header%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+hashMode+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Borigin+%3D+pm.blockchain.GetHeaderByHash%28query.Origin.Hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Borigin+%3D+pm.blockchain.GetHeaderByNumber%28query.Origin.Number%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+origin+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnumber+%3A%3D+origin.Number.Uint64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheaders+%3D+append%28headers%2C+origin%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+%2B%3D+estHeaderRlpSize%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Advance+to+the+next+header+of+the+query%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bswitch+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+query.Origin.Hash+%21%3D+%28common.Hash%7B%7D%29+%26amp%3B%26amp%3B+query.Reverse%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Hash+based+traversal+towards+the+genesis+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i+%3A%3D+0%3B+i+%26lt%3B+int%28query.Skip%29%2B1%3B+i%2B%2B+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+header+%3A%3D+pm.blockchain.GetHeader%28query.Origin.Hash%2C+number%29%3B+header+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bquery.Origin.Hash+%3D+header.ParentHash%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnumber--%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+query.Origin.Hash+%21%3D+%28common.Hash%7B%7D%29+%26amp%3B%26amp%3B+%21query.Reverse%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Hash+based+traversal+towards+the+leaf+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcurrent+%3D+origin.Number.Uint64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnext+%3D+current+%2B+query.Skip+%2B+1%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+next+%26lt%3B%3D+current+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Binfos%2C+_+%3A%3D+json.MarshalIndent%28p.Peer.Info%28%29%2C+%22%22%2C+%22+%22%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Warn%28%22GetBlockHeaders+skip+overflow+attack%22%2C+%22current%22%2C+current%2C+%22skip%22%2C+query.Skip%2C+%22next%22%2C+next%2C+%22attacker%22%2C+infos%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+header+%3A%3D+pm.blockchain.GetHeaderByNumber%28next%29%3B+header+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pm.blockchain.GetBlockHashesFromHash%28header.Hash%28%29%2C+query.Skip%2B1%29%5Bquery.Skip%5D+%3D%3D+query.Origin.Hash+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bquery.Origin.Hash+%3D+header.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+query.Reverse%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Number+based+traversal+towards+the+genesis+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+query.Origin.Number+%26gt%3B%3D+query.Skip%2B1+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bquery.Origin.Number+-%3D+%28query.Skip+%2B+1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%21query.Reverse%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Number+based+traversal+towards+the+leaf+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bquery.Origin.Number+%2B%3D+%28query.Skip+%2B+1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.SendBlockHeaders%28headers%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+BlockHeadersMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+A+batch+of+headers+arrived+to+one+of+our+previous+requests%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+headers+%5B%5D*types.Header%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Bheaders%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+no+headers+were+received%2C+but+we%27re+expending+a+DAO+fork+check%2C+maybe+it%27s+that%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28headers%29+%3D%3D+0+%26amp%3B%26amp%3B+p.forkDrop+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Possibly+an+empty+reply+to+the+fork+header+checks%2C+sanity+check+TDs%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BverifyDAO+%3A%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+we+already+have+a+DAO+header%2C+we+can+check+the+peer%27s+TD+against+it.+If%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+the+peer%27s+ahead+of+this%2C+it+too+must+have+a+reply+to+the+DAO+check%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+daoHeader+%3A%3D+pm.blockchain.GetHeaderByNumber%28pm.chainconfig.DAOForkBlock.Uint64%28%29%29%3B+daoHeader+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+td+%3A%3D+p.Head%28%29%3B+td.Cmp%28pm.blockchain.GetTd%28daoHeader.Hash%28%29%2C+daoHeader.Number.Uint64%28%29%29%29+%26gt%3B%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BverifyDAO+%3D+false%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+we%27re+seemingly+on+the+same+chain%2C+disable+the+drop+timer%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+verifyDAO+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Seems+to+be+on+the+same+side+of+the+DAO+fork%22%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop.Stop%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop+%3D+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Filter+out+any+explicitly+requested+headers%2C+deliver+the+rest+to+the+downloader%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfilter+%3A%3D+len%28headers%29+%3D%3D+1%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+filter+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+it%27s+a+potential+DAO+fork+check%2C+validate+against+the+rules%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+p.forkDrop+%21%3D+nil+%26amp%3B%26amp%3B+pm.chainconfig.DAOForkBlock.Cmp%28headers%5B0%5D.Number%29+%3D%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Disable+the+fork+drop+timer%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop.Stop%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop+%3D+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Validate+the+header+and+either+drop+the+peer+or+continue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+misc.VerifyDAOHeaderExtraData%28pm.chainconfig%2C+headers%5B0%5D%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Verified+to+be+on+the+other+side+of+the+DAO+fork%2C+dropping%22%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Verified+to+be+on+the+same+side+of+the+DAO+fork%22%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Irrelevant+of+the+fork+checks%2C+send+the+header+to+the+fetcher+just+in+case%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheaders+%3D+pm.fetcher.FilterHeaders%28p.id%2C+headers%2C+time.Now%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28headers%29+%26gt%3B+0+%7C%7C+%21filter+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Berr+%3A%3D+pm.downloader.DeliverHeaders%28p.id%2C+headers%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Failed+to+deliver+headers%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+GetBlockBodiesMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Decode+the+retrieval+message%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmsgStream+%3A%3D+rlp.NewStream%28msg.Payload%2C+uint64%28msg.Size%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+err+%3A%3D+msgStream.List%28%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Gather+blocks+until+the+fetch+or+network+limits+is+reached%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+common.Hash%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+int%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbodies+%5B%5Drlp.RawValue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+bytes+%26lt%3B+softResponseLimit+%26amp%3B%26amp%3B+len%28bodies%29+%26lt%3B+downloader.MaxBlockFetch+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+hash+of+the+next+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msgStream.Decode%28%26amp%3Bhash%29%3B+err+%3D%3D+rlp.EOL+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+if+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+requested+block+body%2C+stopping+if+enough+was+found%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+data+%3A%3D+pm.blockchain.GetBodyRLP%28hash%29%3B+len%28data%29+%21%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbodies+%3D+append%28bodies%2C+data%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+%2B%3D+len%28data%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.SendBlockBodiesRLP%28bodies%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+BlockBodiesMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+A+batch+of+block+bodies+arrived+to+one+of+our+previous+requests%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+request+blockBodiesData%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Brequest%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Deliver+them+all+to+the+downloader+for+queuing%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btrasactions+%3A%3D+make%28%5B%5D%5B%5D*types.Transaction%2C+len%28request%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Buncles+%3A%3D+make%28%5B%5D%5B%5D*types.Header%2C+len%28request%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i%2C+body+%3A%3D+range+request+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btrasactions%5Bi%5D+%3D+body.Transactions%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Buncles%5Bi%5D+%3D+body.Uncles%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Filter+out+any+explicitly+requested+bodies%2C+deliver+the+rest+to+the+downloader%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfilter+%3A%3D+len%28trasactions%29+%26gt%3B+0+%7C%7C+len%28uncles%29+%26gt%3B+0%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+filter+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btrasactions%2C+uncles+%3D+pm.fetcher.FilterBodies%28p.id%2C+trasactions%2C+uncles%2C+time.Now%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28trasactions%29+%26gt%3B+0+%7C%7C+len%28uncles%29+%26gt%3B+0+%7C%7C+%21filter+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Berr+%3A%3D+pm.downloader.DeliverBodies%28p.id%2C+trasactions%2C+uncles%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Failed+to+deliver+bodies%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+p.version+%26gt%3B%3D+eth63+%26amp%3B%26amp%3B+msg.Code+%3D%3D+GetNodeDataMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Decode+the+retrieval+message%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmsgStream+%3A%3D+rlp.NewStream%28msg.Payload%2C+uint64%28msg.Size%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+err+%3A%3D+msgStream.List%28%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Gather+state+data+until+the+fetch+or+network+limits+is+reached%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+common.Hash%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+int%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdata+%5B%5D%5B%5Dbyte%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+bytes+%26lt%3B+softResponseLimit+%26amp%3B%26amp%3B+len%28data%29+%26lt%3B+downloader.MaxStateFetch+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+hash+of+the+next+state+entry%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msgStream.Decode%28%26amp%3Bhash%29%3B+err+%3D%3D+rlp.EOL+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+if+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+requested+state+entry%2C+stopping+if+enough+was+found%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+entry%2C+err+%3A%3D+pm.chaindb.Get%28hash.Bytes%28%29%29%3B+err+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdata+%3D+append%28data%2C+entry%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+%2B%3D+len%28entry%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.SendNodeData%28data%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+p.version+%26gt%3B%3D+eth63+%26amp%3B%26amp%3B+msg.Code+%3D%3D+NodeDataMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+A+batch+of+node+state+data+arrived+to+one+of+our+previous+requests%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+data+%5B%5D%5B%5Dbyte%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Bdata%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Deliver+all+to+the+downloader%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+pm.downloader.DeliverNodeData%28p.id%2C+data%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Failed+to+deliver+node+state+data%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+p.version+%26gt%3B%3D+eth63+%26amp%3B%26amp%3B+msg.Code+%3D%3D+GetReceiptsMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Decode+the+retrieval+message%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmsgStream+%3A%3D+rlp.NewStream%28msg.Payload%2C+uint64%28msg.Size%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+err+%3A%3D+msgStream.List%28%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Gather+state+data+until+the+fetch+or+network+limits+is+reached%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+common.Hash%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+int%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breceipts+%5B%5Drlp.RawValue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+bytes+%26lt%3B+softResponseLimit+%26amp%3B%26amp%3B+len%28receipts%29+%26lt%3B+downloader.MaxReceiptFetch+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+hash+of+the+next+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msgStream.Decode%28%26amp%3Bhash%29%3B+err+%3D%3D+rlp.EOL+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+if+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+requested+block%27s+receipts%2C+skipping+if+unknown+to+us%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bresults+%3A%3D+core.GetBlockReceipts%28pm.chaindb%2C+hash%2C+core.GetBlockNumber%28pm.chaindb%2C+hash%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+results+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+header+%3A%3D+pm.blockchain.GetHeaderByHash%28hash%29%3B+header+%3D%3D+nil+%7C%7C+header.ReceiptHash+%21%3D+types.EmptyRootHash+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcontinue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+known%2C+encode+and+queue+for+response+packet%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+encoded%2C+err+%3A%3D+rlp.EncodeToBytes%28results%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Error%28%22Failed+to+encode+receipt%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breceipts+%3D+append%28receipts%2C+encoded%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+%2B%3D+len%28encoded%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.SendReceiptsRLP%28receipts%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+p.version+%26gt%3B%3D+eth63+%26amp%3B%26amp%3B+msg.Code+%3D%3D+ReceiptsMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+A+batch+of+receipts+arrived+to+one+of+our+previous+requests%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+receipts+%5B%5D%5B%5D*types.Receipt%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Breceipts%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Deliver+all+to+the+downloader%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+pm.downloader.DeliverReceipts%28p.id%2C+receipts%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Failed+to+deliver+receipts%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+NewBlockHashesMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+announces+newBlockHashesData%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Bannounces%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Mark+the+hashes+as+present+at+the+remote+node%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+block+%3A%3D+range+announces+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.MarkBlock%28block.Hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Schedule+all+the+unknown+hashes+for+retrieval%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3A%3D+make%28newBlockHashesData%2C+0%2C+len%28announces%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+block+%3A%3D+range+announces+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+%21pm.blockchain.HasBlock%28block.Hash%2C+block.Number%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+append%28unknown%2C+block%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+block+%3A%3D+range+unknown+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.fetcher.Notify%28p.id%2C+block.Hash%2C+block.Number%2C+time.Now%28%29%2C+p.RequestOneHeader%2C+p.RequestBodies%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+NewBlockMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+and+decode+the+propagated+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+request+newBlockData%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Brequest%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Brequest.Block.ReceivedAt+%3D+msg.ReceivedAt%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Brequest.Block.ReceivedFrom+%3D+p%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Mark+the+peer+as+owning+the+block+and+schedule+it+for+import%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.MarkBlock%28request.Block.Hash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.fetcher.Enqueue%28p.id%2C+request.Block%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Assuming+the+block+is+importable+by+the+peer%2C+but+possibly+not+yet+done+so%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+calculate+the+head+hash+and+TD+that+the+peer+truly+must+have.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtrueHead+%3D+request.Block.ParentHash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtrueTD+%3D+new%28big.Int%29.Sub%28request.TD%2C+request.Block.Difficulty%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Update+the+peers+total+difficulty+if+better+than+the+previous%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+td+%3A%3D+p.Head%28%29%3B+trueTD.Cmp%28td%29+%26gt%3B+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.SetHead%28trueHead%2C+trueTD%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Schedule+a+sync+if+above+ours.+Note%2C+this+will+not+fire+a+sync+for+a+gap+of%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+a+singe+block+%28as+the+true+TD+is+below+the+propagated+block%29%2C+however+this%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+scenario+should+easily+be+covered+by+the+fetcher.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BcurrentBlock+%3A%3D+pm.blockchain.CurrentBlock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+trueTD.Cmp%28pm.blockchain.GetTd%28currentBlock.Hash%28%29%2C+currentBlock.NumberU64%28%29%29%29+%26gt%3B+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.synchronise%28p%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+TxMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Transactions+arrived%2C+make+sure+we+have+a+valid+and+fresh+chain+to+handle+them%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+atomic.LoadUint32%28%26amp%3Bpm.acceptTxs%29+%3D%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Transactions+can+be+processed%2C+parse+all+of+them+and+deliver+to+the+pool%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+txs+%5B%5D*types.Transaction%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Btxs%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i%2C+tx+%3A%3D+range+txs+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Validate+and+mark+the+remote+transaction%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+tx+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22transaction+%25d+is+nil%22%2C+i%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.MarkTransaction%28tx.Hash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.txpool.AddRemotes%28txs%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefault%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrInvalidMsgCode%2C+%22%25v%22%2C+msg.Code%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%E5%B0%B1%E8%A7%A3%E7%A0%81%E4%BA%86p2p%E7%BD%91%E7%BB%9C%E8%BF%87%E6%9D%A5%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%A4%84%E7%90%86%E4%BA%86%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60NewBlockMsg%60%3C%2Fspan%3E%E5%92%8C%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60NewBlockHashesMsg%60%3C%2Fspan%3E%E8%BF%99%E4%B8%A4%E7%A7%8D%E4%BA%8B%E4%BB%B6%2C%E5%A6%82%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60NewBlockMsg%60%3C%2Fspan%3E%E4%B8%AD%E7%9A%84%E5%A4%84%E7%90%86%E9%80%BB%E8%BE%91%E6%98%AF%E7%9B%B4%E6%8E%A5%E9%80%9A%E8%BF%87%E7%AE%A1%E9%81%93%E5%8F%91%E9%80%81%E5%88%B0%E6%9C%AC%E5%9C%B0%E4%BA%86%2C%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60pm.fetcher.Enqueue%28p.id%2C+request.Block%29%60%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2C%E5%AF%B9%E5%BA%94%E7%9A%84%E7%AE%A1%E9%81%93%E5%90%8D%E6%98%AF%3A%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60f.inject%60%3C%2Fspan%3E%2C%E5%85%B6%E4%B8%AD%E6%98%AF%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%2C%2Ffetcher.go%2Fenqueue%E6%96%B9%E6%B3%95%E4%B8%AD%E5%86%99%E5%85%A5%E4%BA%86%E4%B8%80%E4%B8%AAFIFO%E9%98%9F%E5%88%97%E4%B8%AD%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28f+*Fetcher%29+enqueue%28peer+string%2C+block+*types.Block%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+%3A%3D+block.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Ensure+the+peer+isn%27t+DOSing+us%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcount+%3A%3D+f.queues%5Bpeer%5D+%2B+1%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+count+%26gt%3B+blockLimit+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Discarded+propagated+block%2C+exceeded+allowance%22%2C+%22peer%22%2C+peer%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%2C+%22limit%22%2C+blockLimit%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BpropBroadcastDOSMeter.Mark%281%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.forgetHash%28hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Discard+any+past+or+too+distant+blocks%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+dist+%3A%3D+int64%28block.NumberU64%28%29%29+-+int64%28f.chainHeight%28%29%29%3B+dist+%26lt%3B+-maxUncleDist+%7C%7C+dist+%26gt%3B+maxQueueDist+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Discarded+propagated+block%2C+too+far+away%22%2C+%22peer%22%2C+peer%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%2C+%22distance%22%2C+dist%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BpropBroadcastDropMeter.Mark%281%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.forgetHash%28hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Schedule+the+block+for+future+importing%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+ok+%3A%3D+f.queued%5Bhash%5D%3B+%21ok+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bop+%3A%3D+%26amp%3Binject%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Borigin%3A+peer%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bblock%3A+block%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.queues%5Bpeer%5D+%3D+count%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.queued%5Bhash%5D+%3D+op%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.queue.Push%28op%2C+-float32%28block.NumberU64%28%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+f.queueChangeHook+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.queueChangeHook%28op.block.Hash%28%29%2C+true%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Queued+propagated+block%22%2C+%22peer%22%2C+peer%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%2C+%22queued%22%2C+f.queue.Size%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%AF%A5%E9%98%9F%E5%88%97%E7%9A%84%E6%B6%88%E8%B4%B9%E7%AB%AF%E5%9C%A8%2Ffetcher.go%2Floop%E4%B8%AD%2C%E6%98%AF%E4%B8%80%E4%B8%AA%E6%AD%BB%E5%BE%AA%E7%8E%AF%2C%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++for+%21f.queue.Empty%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bop+%3A%3D+f.queue.PopItem%28%29.%28*inject%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+f.queueChangeHook+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.queueChangeHook%28op.block.Hash%28%29%2C+false%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+too+high+up+the+chain+or+phase%2C+continue+later%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnumber+%3A%3D+op.block.NumberU64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+number+%26gt%3B+height%2B1+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.queue.Push%28op%2C+-float32%28op.block.NumberU64%28%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+f.queueChangeHook+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.queueChangeHook%28op.block.Hash%28%29%2C+true%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Otherwise+if+fresh+and+still+unknown%2C+try+and+import%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+%3A%3D+op.block.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+number%2BmaxUncleDist+%26lt%3B+height+%7C%7C+f.getBlock%28hash%29+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.forgetBlock%28hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcontinue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.insert%28op.origin%2C+op.block%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E4%BB%8E%E9%98%9F%E5%88%97%E4%B8%AD%E5%8F%96%E5%87%BA%2C%E6%8E%A5%E7%9D%80%E7%9C%8B%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60insert%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28f+*Fetcher%29+insert%28peer+string%2C+block+*types.Block%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+%3A%3D+block.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Run+the+import+on+a+new+thread%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Importing+propagated+block%22%2C+%22peer%22%2C+peer%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+func%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+func%28%29+%7B+f.done+%26lt%3B-+hash+%7D%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+the+parent%27s+unknown%2C+abort+insertion%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bparent+%3A%3D+f.getBlock%28block.ParentHash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+parent+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Unknown+parent+of+propagated+block%22%2C+%22peer%22%2C+peer%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%2C+%22parent%22%2C+block.ParentHash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Quickly+validate+the+header+and+propagate+the+block+if+it+passes%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bswitch+err+%3A%3D+f.verifyHeader%28block.Header%28%29%29%3B+err+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+nil%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+All+ok%2C+quickly+propagate+to+our+peers%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BpropBroadcastOutTimer.UpdateSince%28block.ReceivedAt%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+f.broadcastBlock%28block%2C+true%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+consensus.ErrFutureBlock%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Weird+future+block%2C+don%27t+fail%2C+but+neither+propagate%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefault%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Something+went+very+wrong%2C+drop+the+peer%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Propagated+block+verification+failed%22%2C+%22peer%22%2C+peer%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.dropPeer%28peer%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Run+the+actual+import+and+log+any+issues%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+err+%3A%3D+f.insertChain%28types.Blocks%7Bblock%7D%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Propagated+block+import+failed%22%2C+%22peer%22%2C+peer%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+import+succeeded%2C+broadcast+the+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BpropAnnounceOutTimer.UpdateSince%28block.ReceivedAt%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+f.broadcastBlock%28block%2C+false%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Invoke+the+testing+hook+if+needed%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+f.importedHook+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.importedHook%28block%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%2C%E8%AF%A5%E6%96%B9%E6%B3%95%E4%BC%9A%E8%B0%83%E7%94%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60verifyHeader%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%E5%8E%BB%E6%A0%A1%E9%AA%8C%E5%8C%BA%E5%9D%97%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%B2%A1%E9%97%AE%E9%A2%98%E7%9A%84%E8%AF%9D%E5%B0%B1%E9%80%9A%E8%BF%87p2p%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%B9%BF%E6%92%AD%E5%87%BA%E5%8E%BB%2C%E7%84%B6%E5%90%8E%E8%B0%83%E7%94%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60insertChain%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%E6%8F%92%E5%85%A5%E5%88%B0%E6%9C%AC%E5%9C%B0%E7%9A%84leveldb%E4%B8%AD%2C%E6%8F%92%E5%85%A5%E6%B2%A1%E9%97%AE%E9%A2%98%E7%9A%84%E8%AF%9D%EF%BC%8C%E4%BC%9A%E5%86%8D%E5%B9%BF%E6%92%AD%E4%B8%80%E6%AC%A1%2C%E4%B8%8D%E8%BF%87%E8%BF%99%E6%AC%A1%E5%8F%AA%E4%BC%9A%E5%B9%BF%E6%92%ADblock%E7%9A%84hash%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E5%A6%82%E6%AD%A4%EF%BC%8C%E9%80%9A%E8%BF%87%E4%B8%80%E4%B8%AA%E5%AF%B9%E7%AD%89%E7%BD%91%E7%BB%9C%2C%E5%8F%AA%E8%A6%81%E5%9D%97%E5%90%88%E6%B3%95%2C%E9%82%A3%E4%B9%88%E5%B0%B1%E4%BC%9A%E8%A2%AB%E5%85%A8%E7%BD%91%E9%87%87%E7%BA%B3%2C%E5%85%B6%E4%B8%AD%E7%9A%84%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60verifyHeader%60%3C%2Fspan%3E%2C%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60insertChain%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%E9%83%BD%E6%98%AF%E5%9C%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60%2Fhandler.go%2FNewProtocolManager%60%3C%2Fspan%3E%E4%B8%AD%E5%AE%9A%E4%B9%89%E4%BC%A0%E8%BF%87%E6%9D%A5%E7%9A%84%2C%E6%89%80%E6%9C%89%E5%90%AF%E5%8A%A8%E7%9A%84%E9%80%BB%E8%BE%91%E9%83%BD%E6%98%AF%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60handler.go%2FStart%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%E4%B8%AD.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++fetch.go%E7%9A%84start%E6%96%B9%E6%B3%95%E5%9C%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60syncer%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%E4%B8%AD%E7%94%A8%E4%B8%80%E4%B8%AA%E5%8D%95%E7%8B%AC%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%A7%A6%E5%8F%91%E7%9A%84%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%2Fhandler.go%2FhandleMsg+--%26gt%3B+go+pm.synchronise%28p%29+--%26gt%3B+pm.downloader.Synchronise%28peer.id%2C+pHead%2C+pTd%2C+mode%29+--%26gt%3B+d.synchronise%28id%2C+head%2C+td%2C+mode%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++--%26gt%3B+d.syncWithPeer%28p%2C+hash%2C+td%29%60%2C%E8%AE%A9%E6%88%91%E4%BB%AC%E7%9C%8B%E4%B8%8B%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28d+*Downloader%29+syncWithPeer%28p+*peerConnection%2C+hash+common.Hash%2C+td+*big.Int%29+%28err+error%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.mux.Post%28StartEvent%7B%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+func%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+reset+on+error%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.mux.Post%28FailedEvent%7Berr%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.mux.Post%28DoneEvent%7B%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+p.version+%26lt%3B+62+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errTooOld%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Synchronising+with+the+network%22%2C+%22peer%22%2C+p.id%2C+%22eth%22%2C+p.version%2C+%22head%22%2C+hash%2C+%22td%22%2C+td%2C+%22mode%22%2C+d.mode%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+func%28start+time.Time%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Synchronisation+terminated%22%2C+%22elapsed%22%2C+time.Since%28start%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%28time.Now%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Look+up+the+sync+boundaries%3A+the+common+ancestor+and+the+target+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blatest%2C+err+%3A%3D+d.fetchHeight%28p%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheight+%3A%3D+latest.Number.Uint64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Borigin%2C+err+%3A%3D+d.findAncestor%28p%2C+height%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.syncStatsLock.Lock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+d.syncStatsChainHeight+%26lt%3B%3D+origin+%7C%7C+d.syncStatsChainOrigin+%26gt%3B+origin+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.syncStatsChainOrigin+%3D+origin%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.syncStatsChainHeight+%3D+height%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.syncStatsLock.Unlock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Initiate+the+sync+using+a+concurrent+header+and+content+retrieval+algorithm%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpivot+%3A%3D+uint64%280%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bswitch+d.mode+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+LightSync%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpivot+%3D+height%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+FastSync%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Calculate+the+new+fast%2Fslow+sync+pivot+point%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+d.fsPivotLock+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BpivotOffset%2C+err+%3A%3D+rand.Int%28rand.Reader%2C+big.NewInt%28int64%28fsPivotInterval%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpanic%28fmt.Sprintf%28%22Failed+to+access+crypto+random+source%3A+%25v%22%2C+err%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+height+%26gt%3B+uint64%28fsMinFullBlocks%29%2BpivotOffset.Uint64%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpivot+%3D+height+-+uint64%28fsMinFullBlocks%29+-+pivotOffset.Uint64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Pivot+point+locked+in%2C+use+this+and+do+not+pick+a+new+one%21%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpivot+%3D+d.fsPivotLock.Number.Uint64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+the+point+is+below+the+origin%2C+move+origin+back+to+ensure+state+download%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pivot+%26lt%3B+origin+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pivot+%26gt%3B+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Borigin+%3D+pivot+-+1%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Borigin+%3D+0%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Fast+syncing+until+pivot+block%22%2C+%22pivot%22%2C+pivot%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.queue.Prepare%28origin%2B1%2C+d.mode%2C+pivot%2C+latest%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+d.syncInitHook+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.syncInitHook%28origin%2C+height%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfetchers+%3A%3D+%5B%5Dfunc%28%29+error%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc%28%29+error+%7B+return+d.fetchHeaders%28p%2C+origin%2B1%29+%7D%2C+%2F%2F+Headers+are+always+retrieved%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc%28%29+error+%7B+return+d.fetchBodies%28origin+%2B+1%29+%7D%2C+%2F%2F+Bodies+are+retrieved+during+normal+and+fast+sync%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc%28%29+error+%7B+return+d.fetchReceipts%28origin+%2B+1%29+%7D%2C+%2F%2F+Receipts+are+retrieved+during+fast+sync%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc%28%29+error+%7B+return+d.processHeaders%28origin%2B1%2C+td%29+%7D%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+d.mode+%3D%3D+FastSync+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfetchers+%3D+append%28fetchers%2C+func%28%29+error+%7B+return+d.processFastSyncContent%28latest%29+%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+if+d.mode+%3D%3D+FullSync+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfetchers+%3D+append%28fetchers%2C+d.processFullSyncContent%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Berr+%3D+d.spawnSync%28fetchers%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%26amp%3B%26amp%3B+d.mode+%3D%3D+FastSync+%26amp%3B%26amp%3B+d.fsPivotLock+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+sync+failed+in+the+critical+section%2C+bump+the+fail+counter.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.AddUint32%28%26amp%3Bd.fsPivotFails%2C+1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E7%94%B1%E4%BA%8E%E4%B8%8A%E8%BF%B0%E6%95%B4%E4%B8%AA%E8%B0%83%E7%94%A8%E6%A0%88%E6%98%AF%E5%9C%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60newBlockMsg%60%3C%2Fspan%3E%E7%9A%84%E6%9D%A1%E4%BB%B6%E4%B8%AD%E8%A7%A6%E5%8F%91%E7%9A%84%2C%E8%BF%99%E9%87%8C%E7%9A%84%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60StartEvent%60%3C%2Fspan%3E%E4%BC%9A%E9%80%9A%E8%BF%87%E9%80%9A%E9%81%93%E7%9A%84%E5%BD%A2%E5%BC%8F%E4%BC%A0%E9%80%92%E5%88%B0miner.go%2Fupdate%E4%B8%AD%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28self+*Miner%29+update%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bevents+%3A%3D+self.mux.Subscribe%28downloader.StartEvent%7B%7D%2C+downloader.DoneEvent%7B%7D%2C+downloader.FailedEvent%7B%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++out%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+ev+%3A%3D+range+events.Chan%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bswitch+ev.Data.%28type%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+downloader.StartEvent%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreInt32%28%26amp%3Bself.canStart%2C+0%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+self.Mining%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.Stop%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreInt32%28%26amp%3Bself.shouldStart%2C+1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Info%28%22Mining+aborted+due+to+sync%22%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+downloader.DoneEvent%2C+downloader.FailedEvent%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BshouldStart+%3A%3D+atomic.LoadInt32%28%26amp%3Bself.shouldStart%29+%3D%3D+1%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreInt32%28%26amp%3Bself.canStart%2C+1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreInt32%28%26amp%3Bself.shouldStart%2C+0%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+shouldStart+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.Start%28self.coinbase%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+unsubscribe.+we%27re+only+interested+in+this+event+once%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bevents.Unsubscribe%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+stop+immediately+and+ignore+all+further+pending+events%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak+out%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%8E%A5%E6%94%B6%E5%88%B0%E8%BF%99%E4%B8%AA%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60StartEvent%60%3C%2Fspan%3E%E5%B0%B1%E4%BC%9A%E9%80%9A%E7%9F%A5%E6%89%80%E6%9C%89%E7%9A%84%E4%BB%A3%E7%90%86%EF%BC%8C%E8%B0%83%E7%94%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60stop%60%3C%2Fspan%3E%E5%81%9C%E6%AD%A2%E5%BD%93%E5%89%8D%E7%9B%B8%E5%90%8C%E5%9D%97%E7%9A%84%E6%8C%96%E7%9F%BF%2C%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60remote_Agent%60%3C%2Fspan%3E%E4%B8%AD%E7%9A%84%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60stop%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E6%9C%80%E5%90%8E%E5%86%8D%E7%9C%8B%E4%B8%80%E4%B8%8B%E6%96%B0%E5%9D%97%E5%A6%82%E4%BD%95%E5%B9%BF%E6%92%AD%E7%BB%99%E5%85%B6%E4%BB%96%E8%8A%82%E7%82%B9%E7%9A%84%2C%E5%A4%84%E7%90%86%E7%9A%84%E6%96%B9%E6%B3%95%E5%9C%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60%2Feth%2Fhandle.go%2FBroadcastBlock%60%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28pm+*ProtocolManager%29+BroadcastBlock%28block+*types.Block%2C+propagate+bool%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+%3A%3D+block.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeers+%3A%3D+pm.peers.PeersWithoutBlock%28hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+propagation+is+requested%2C+send+to+a+subset+of+the+peer%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+propagate+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Calculate+the+TD+of+the+block+%28it%27s+not+imported+yet%2C+so+block.Td+is+not+valid%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+td+*big.Int%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+parent+%3A%3D+pm.blockchain.GetBlock%28block.ParentHash%28%29%2C+block.NumberU64%28%29-1%29%3B+parent+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btd+%3D+new%28big.Int%29.Add%28block.Difficulty%28%29%2C+pm.blockchain.GetTd%28block.ParentHash%28%29%2C+block.NumberU64%28%29-1%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Error%28%22Propagating+dangling+block%22%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Send+the+block+to+a+subset+of+our+peers%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btransfer+%3A%3D+peers%5B%3Aint%28math.Sqrt%28float64%28len%28peers%29%29%29%29%5D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+peer+%3A%3D+range+transfer+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeer.SendNewBlock%28block%2C+td%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Trace%28%22Propagated+block%22%2C+%22hash%22%2C+hash%2C+%22recipients%22%2C+len%28transfer%29%2C+%22duration%22%2C+common.PrettyDuration%28time.Since%28block.ReceivedAt%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Otherwise+if+the+block+is+indeed+in+out+own+chain%2C+announce+it%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pm.blockchain.HasBlock%28hash%2C+block.NumberU64%28%29%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+peer+%3A%3D+range+peers+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeer.SendNewBlockHashes%28%5B%5Dcommon.Hash%7Bhash%7D%2C+%5B%5Duint64%7Bblock.NumberU64%28%29%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Trace%28%22Announced+block%22%2C+%22hash%22%2C+hash%2C+%22recipients%22%2C+len%28peers%29%2C+%22duration%22%2C+common.PrettyDuration%28time.Since%28block.ReceivedAt%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%E5%BE%AA%E7%8E%AF%E6%AF%8F%E4%B8%AA%E8%BF%9E%E6%8E%A5%E7%9A%84peer%E8%8A%82%E7%82%B9%2C%E8%B0%83%E7%94%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60peer.SendNewBlock%60%3C%2Fspan%3E%E5%8F%91%E9%80%81%E4%BA%A7%E5%9D%97%E6%B6%88%E6%81%AF%E8%BF%87%E5%8E%BB%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28p+*peer%29+SendNewBlock%28block+*types.Block%2C+td+*big.Int%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.knownBlocks.Add%28block.Hash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p2p.Send%28p.rw%2C+NewBlockMsg%2C+%5B%5Dinterface%7B%7D%7Bblock%2C+td%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+Send%28w+MsgWriter%2C+msgcode+uint64%2C+data+interface%7B%7D%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bsize%2C+r%2C+err+%3A%3D+rlp.EncodeToReader%28data%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+w.WriteMsg%28Msg%7BCode%3A+msgcode%2C+Size%3A+uint32%28size%29%2C+Payload%3A+r%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E9%80%9A%E8%BF%87%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60writeMsg%60%3C%2Fspan%3E%E5%86%99%E5%85%A5%E8%AF%A5%E8%8A%82%E7%82%B9%E9%87%8C%2C%E8%AF%A5%E6%96%B9%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%98%AF%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60rw+*netWrapper%29+WriteMsg%28msg+Msg%29%60%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28rw+*netWrapper%29+WriteMsg%28msg+Msg%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Brw.wmu.Lock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+rw.wmu.Unlock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Brw.conn.SetWriteDeadline%28time.Now%28%29.Add%28rw.wtimeout%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+rw.wrapped.WriteMsg%28msg%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%AF%A5%E6%96%B9%E6%B3%95%E8%AE%BE%E7%BD%AE%E4%BA%86%E4%B8%80%E4%B8%AA%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%2C%E5%BA%95%E5%B1%82%E8%B0%83%E7%94%A8%E4%BA%86net.go%E7%9A%84%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60Write%28b+%5B%5Dbyte%29+%28n+int%2C+err+error%29%60%3C%2Fspan%3E%2C%E9%80%9A%E8%BF%87%E7%BD%91%E7%BB%9C%E5%86%99%E7%BB%99%E5%AF%B9%E5%BA%94%E7%9A%84%E8%8A%82%E7%82%B9%E4%BA%86%2C%E7%84%B6%E5%90%8E%E6%8E%A5%E6%94%B6%E7%AB%AF%E7%9A%84%E6%96%B9%E6%B3%95%E4%B8%BA%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60ReadMsg%60%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28pm+*ProtocolManager%29+handleMsg%28p+*peer%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Read+the+next+message+from+the+remote+peer%2C+and+ensure+it%27s+fully+consumed%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmsg%2C+err+%3A%3D+p.rw.ReadMsg%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+msg.Size+%26gt%3B+ProtocolMaxMsgSize+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrMsgTooLarge%2C+%22%25v+%26gt%3B+%25v%22%2C+msg.Size%2C+ProtocolMaxMsgSize%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+msg.Discard%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E5%9C%A8%E8%BF%99%E8%BE%B9%E8%AF%BB%E5%8F%96%E7%BD%91%E7%BB%9C%E5%86%99%E5%85%A5%E6%9D%A5%E7%9A%84%E6%B6%88%E6%81%AF%2C%E7%84%B6%E5%90%8E%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C%E7%9A%84%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60msgCode%60%3C%2Fspan%3E%E4%BD%9C%E4%B8%8D%E5%90%8C%E7%9A%84%E5%A4%84%E7%90%86%2C%E7%94%B1%E4%BA%8E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60handleMsg%60%3C%2Fspan%3E%E6%98%AF%E5%9C%A8%E4%B8%80%E4%B8%AA%E6%AD%BB%E5%BE%AA%E7%8E%AF%E4%B8%AD%E8%B0%83%E7%94%A8%E7%9A%84%2C%E6%89%80%E4%BB%A5%E5%B0%B1%E8%83%BD%E4%B8%80%E7%9B%B4%E6%8E%A5%E6%94%B6%E5%88%B0%E8%8A%82%E7%82%B9%E5%B9%BF%E6%92%AD%E8%BF%87%E6%9D%A5%E7%9A%84%E6%B6%88%E6%81%AF%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2Feth%2Fhandler.go%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28pm+*ProtocolManager%29+handle%28p+*peer%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++td%2C+head%2C+genesis+%3A%3D+pm.blockchain.Status%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++p.Handshake%28pm.networkId%2C+td%2C+head%2C+genesis%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A++++++if+rw%2C+ok+%3A%3D+p.rw.%28*meteredMsgReadWriter%29%3B+ok+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++rm.Init%28p.version%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A++++++pm.peers.Register%28p%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++defer+pm.removePeer%28p.id%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A++++++pm.downloader.RegisterPeer%28p.id%2C+p.version%2C+p%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A++++++pm.syncTransactions%28p%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++...%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++for+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++if+err+%3A%3D+pm.handleMsg%28p%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++return+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++handle%28%29%E5%87%BD%E6%95%B0%E9%92%88%E5%AF%B9%E4%B8%80%E4%B8%AA%E6%96%B0peer%E5%81%9A%E4%BA%86%E5%A6%82%E4%B8%8B%E5%87%A0%E4%BB%B6%E4%BA%8B%EF%BC%9A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E6%8F%A1%E6%89%8B%EF%BC%8C%E4%B8%8E%E5%AF%B9%E6%96%B9peer%E6%B2%9F%E9%80%9A%E5%B7%B1%E6%96%B9%E7%9A%84%E5%8C%BA%E5%9D%97%E9%93%BE%E7%8A%B6%E6%80%81%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%80%E4%B8%AA%E8%AF%BB%E5%86%99%E9%80%9A%E9%81%93%EF%BC%8C%E7%94%A8%E4%BB%A5%E8%B7%9F%E5%AF%B9%E6%96%B9peer%E7%9B%B8%E4%BA%92%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E6%B3%A8%E5%86%8C%E5%AF%B9%E6%96%B9peer%EF%BC%8C%E5%AD%98%E5%85%A5%E5%B7%B1%E6%96%B9peer%E5%88%97%E8%A1%A8%EF%BC%9B%E5%8F%AA%E6%9C%89handle%28%29%E5%87%BD%E6%95%B0%E9%80%80%E5%87%BA%E6%97%B6%EF%BC%8C%E6%89%8D%E4%BC%9A%E5%B0%86%E8%BF%99%E4%B8%AApeer%E7%A7%BB%E9%99%A4%E5%87%BA%E5%88%97%E8%A1%A8%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++Downloader%E6%88%90%E5%91%98%E6%B3%A8%E5%86%8C%E8%BF%99%E4%B8%AA%E6%96%B0peer%EF%BC%9BDownloader%E4%BC%9A%E8%87%AA%E5%B7%B1%E7%BB%B4%E6%8A%A4%E4%B8%80%E4%B8%AA%E7%9B%B8%E9%82%BBpeer%E5%88%97%E8%A1%A8%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E8%B0%83%E7%94%A8syncTransactions%28%29%EF%BC%8C%E7%94%A8%E5%BD%93%E5%89%8Dtxpool%E4%B8%AD%E6%96%B0%E7%B4%AF%E8%AE%A1%E7%9A%84tx%E5%AF%B9%E8%B1%A1%E7%BB%84%E8%A3%85%E6%88%90%E4%B8%80%E4%B8%AAtxsync%7B%7D%E5%AF%B9%E8%B1%A1%EF%BC%8C%E6%8E%A8%E9%80%81%E5%88%B0%E5%86%85%E9%83%A8%E9%80%9A%E9%81%93txsyncCh%E3%80%82%E8%BF%98%E8%AE%B0%E5%BE%97Start%28%29%E5%90%AF%E5%8A%A8%E7%9A%84%E5%9B%9B%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B9%88%3F%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E5%85%B6%E4%B8%AD%E7%AC%AC%E5%9B%9B%E9%A1%B9txsyncLoop%28%29%E4%B8%AD%E7%94%A8%E4%BB%A5%E7%AD%89%E5%BE%85txsync%7B%7D%E6%95%B0%E6%8D%AE%E7%9A%84%E9%80%9A%E9%81%93txsyncCh%EF%BC%8C%E6%AD%A3%E6%98%AF%E5%9C%A8%E8%BF%99%E9%87%8C%E8%A2%AB%E6%8E%A8%E5%85%A5txsync%7B%7D%E7%9A%84%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E5%9C%A8%E6%97%A0%E9%99%90%E5%BE%AA%E7%8E%AF%E4%B8%AD%E5%90%AF%E5%8A%A8handleMsg%28%29%EF%BC%8C%E5%BD%93%E5%AF%B9%E6%96%B9peer%E5%8F%91%E5%87%BA%E4%BB%BB%E4%BD%95msg%E6%97%B6%EF%BC%8ChandleMsg%28%29%E5%8F%AF%E4%BB%A5%E6%8D%95%E6%8D%89%E7%9B%B8%E5%BA%94%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%B6%88%E6%81%AF%E5%B9%B6%E5%9C%A8%E5%B7%B1%E6%96%B9%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86%E3%80%82%0A++++%3C%2Fdiv%3E%0A+++%3C%2Fdiv%3E%0A+++%3Cdiv+style%3D%22color%3Argb%28212%2C212%2C212%29%3Bbackground-color%3Argb%2830%2C30%2C30%29%3Bfont-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3Bfont-size%3A14px%3Bline-height%3A19px%3Bwhite-space%3Apre%3B%22%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23+eth%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%2C%E4%BB%8E%E6%9C%AC%E5%9C%B0%E8%8A%82%E7%82%B9%E6%8C%96%E5%88%B0%E5%9D%97%E5%BC%80%E5%A7%8B%E5%88%86%E6%9E%90%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%23%23%23%23%23+%E9%A6%96%E5%85%88%E7%9B%AE%E5%89%8D%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%8A%E9%9D%A2%EF%BC%8C%E8%82%AF%E5%AE%9A%E4%B8%8D%E6%98%AF%E4%BB%A5CPU%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8C%96%E7%9F%BF%E7%9A%84%2C%E9%82%A3%E4%B9%88%E5%B0%B1%E6%98%AF%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%3Cstrong%3E%60remoteAgent%60%3C%2Fstrong%3E%3C%2Fspan%3E%0A+++++%3Cspan+style%3D%22color%3A%23569cd6%3B%22%3E%3Cstrong%3E%E8%BF%99%E7%A7%8D%E5%BD%A2%E5%BC%8F%2C%E4%B9%9F%E5%B0%B1%E6%98%AF%E7%9F%BF%E6%9C%BA%E9%80%9A%E8%BF%87%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%BB%8E%E4%BB%A5%E5%A4%AA%E7%9A%84%E8%8A%82%E7%82%B9%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%8A%82%E7%82%B9%E7%9A%84%E5%87%BA%E5%9D%97%E4%BB%BB%E5%8A%A1%2C%3C%2Fstrong%3E%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E7%84%B6%E5%90%8E%E7%9F%BF%E6%9C%BA%E6%A0%B9%E6%8D%AE%E7%AE%97%E5%87%BA%E7%AC%A6%E5%90%88%E8%AF%A5%E5%9D%97%E9%9A%BE%E5%BA%A6hash%E5%80%BC%2C%E6%8F%90%E4%BA%A4%E7%BB%99%E8%8A%82%E7%82%B9%2C%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%AF%B9%E5%BA%94%E7%9A%84%E4%BB%A5%E4%B8%8B%E6%96%B9%E6%B3%95.%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28a+*RemoteAgent%29+SubmitWork%28nonce+types.BlockNonce%2C+mixDigest%2C+hash+common.Hash%29+bool+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Ba.mu.Lock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+a.mu.Unlock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Make+sure+the+work+submitted+is+present%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bwork+%3A%3D+a.work%5Bhash%5D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+work+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Info%28%22Work+submitted+but+none+pending%22%2C+%22hash%22%2C+hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+false%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Make+sure+the+Engine+solutions+is+indeed+valid%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bresult+%3A%3D+work.Block.Header%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bresult.Nonce+%3D+nonce%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bresult.MixDigest+%3D+mixDigest%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+a.engine.VerifySeal%28a.chain%2C+result%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Warn%28%22Invalid+proof-of-work+submitted%22%2C+%22hash%22%2C+hash%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+false%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bblock+%3A%3D+work.Block.WithSeal%28result%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Solutions+seems+to+be+valid%2C+return+to+the+miner+and+notify+acceptance%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Ba.returnCh+%26lt%3B-+%26amp%3BResult%7Bwork%2C+block%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdelete%28a.work%2C+hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%AF%A5%E6%96%B9%E6%B3%95%E4%BC%9A%E6%A0%A1%E9%AA%8C%E6%8F%90%E4%BA%A4%E8%BF%87%E6%9D%A5%E7%9A%84%E5%9D%97%E7%9A%84hash%E9%9A%BE%E5%BA%A6%2C%E5%A6%82%E6%9E%9C%E6%98%AF%E6%AD%A3%E5%B8%B8%E7%9A%84%E8%AF%9D%2C%E5%88%99%E4%BC%9A%E5%B0%86%E8%AF%A5%E7%94%9F%E6%88%90%E7%9A%84%E5%9D%97%E5%86%99%E5%88%B0%E7%AE%A1%E9%81%93%E4%B8%AD%2C%E7%AE%A1%E9%81%93%E6%8E%A5%E6%94%B6%E7%9A%84%E6%96%B9%E6%B3%95%E5%9C%A8%2Fminer%2Fworker.go%2FWait%E6%96%B9%E6%B3%95%E4%B8%AD%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28self+*worker%29+wait%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmustCommitNewWork+%3A%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+result+%3A%3D+range+self.recv+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.AddInt32%28%26amp%3Bself.atWork%2C+-1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+result+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcontinue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bblock+%3A%3D+result.Block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bwork+%3A%3D+result.Work%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Update+the+block+hash+in+all+logs+since+it+is+now+available+and+not+when+the%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+receipt%2Flog+of+individual+transactions+were+created.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+r+%3A%3D+range+work.receipts+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+l+%3A%3D+range+r.Logs+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bl.BlockHash+%3D+block.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+log+%3A%3D+range+work.state.Logs%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.BlockHash+%3D+block.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bstat%2C+err+%3A%3D+self.chain.WriteBlockAndState%28block%2C+work.receipts%2C+work.state%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Error%28%22Failed+writing+block+to+chain%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcontinue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+check+if+canon+block+and+write+transactions%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+stat+%3D%3D+core.CanonStatTy+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+implicit+by+posting+ChainHeadEvent%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmustCommitNewWork+%3D+false%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Broadcast+the+block+and+announce+chain+insertion+event%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F%E3%80%80%E9%80%9A%E8%BF%87p2p%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%B0%86%E5%9D%97%E5%B9%BF%E6%92%AD%E5%88%B0%E8%BF%9E%E6%8E%A5%E7%9A%84%E8%8A%82%E7%82%B9%2C%E8%B5%B0%E7%9A%84%E8%BF%98%E6%98%AFchannel%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.mux.Post%28core.NewMinedBlockEvent%7BBlock%3A+block%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bevents+%5B%5Dinterface%7B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blogs+%3D+work.state.Logs%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bevents+%3D+append%28events%2C+core.ChainEvent%7BBlock%3A+block%2C+Hash%3A+block.Hash%28%29%2C+Logs%3A+logs%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+stat+%3D%3D+core.CanonStatTy+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bevents+%3D+append%28events%2C+core.ChainHeadEvent%7BBlock%3A+block%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.chain.PostChainEvents%28events%2C+logs%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Insert+the+block+into+the+set+of+pending+ones+to+wait+for+confirmations%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.unconfirmed.Insert%28block.NumberU64%28%29%2C+block.Hash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+mustCommitNewWork+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.commitNewWork%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%BF%99%E9%87%8C%E5%8F%91%E9%80%81%E4%BA%86%E4%B8%80%E4%B8%AA%E6%96%B0%E6%8C%96%E5%88%B0%E5%9D%97%E7%9A%84%E4%BA%8B%E4%BB%B6%2C%E6%8E%A5%E7%9D%80%E8%B7%9F%2C%E8%B0%83%E7%94%A8%E6%A0%88%E6%98%AF%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2Fgeth%2Fmain.go%2Fgeth%E3%80%80--%26gt%3B+startNode%E3%80%80--%26gt%3B+utils.StartNode%28stack%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++--%26gt%3B+stack.Start%28%29%E3%80%80--%26gt%3B+%2Fnode%2Fnode.go%2FStart%28%29+--%26gt%3B+service.Start%28running%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++--%26gt%3B+%2Feth%2Fbackend.go%2FStart%28%29+--%26gt%3B+%2Feth%2Fhandler.go%2FStart%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E5%A5%BD%E4%BA%86%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91%E5%9C%A8handler.go%2FStart%28%29%E9%87%8C%E9%9D%A2%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28pm+*ProtocolManager%29+Start%28maxPeers+int%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.maxPeers+%3D+maxPeers%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+broadcast+transactions%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%B9%BF%E6%92%AD%E4%BA%A4%E6%98%93%E7%9A%84%E9%80%9A%E9%81%93%E3%80%82+txCh%E4%BC%9A%E4%BD%9C%E4%B8%BAtxpool%E7%9A%84TxPreEvent%E8%AE%A2%E9%98%85%E9%80%9A%E9%81%93%E3%80%82txpool%E6%9C%89%E4%BA%86%E8%BF%99%E7%A7%8D%E6%B6%88%E6%81%AF%E4%BC%9A%E9%80%9A%E7%9F%A5%E7%BB%99%E8%BF%99%E4%B8%AAtxCh%E3%80%82+%E5%B9%BF%E6%92%AD%E4%BA%A4%E6%98%93%E7%9A%84goroutine%E4%BC%9A%E6%8A%8A%E8%BF%99%E4%B8%AA%E6%B6%88%E6%81%AF%E5%B9%BF%E6%92%AD%E5%87%BA%E5%8E%BB%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.txCh+%3D+make%28chan+core.TxPreEvent%2C+txChanSize%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%AE%A2%E9%98%85%E7%9A%84%E5%9B%9E%E6%89%A7%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.txSub+%3D+pm.txpool.SubscribeTxPreEvent%28pm.txCh%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.txBroadcastLoop%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%AE%A2%E9%98%85%E6%8C%96%E7%9F%BF%E6%B6%88%E6%81%AF%E3%80%82%E5%BD%93%E6%96%B0%E7%9A%84Block%E8%A2%AB%E6%8C%96%E5%87%BA%E6%9D%A5%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E4%BA%A7%E7%94%9F%E6%B6%88%E6%81%AF%E3%80%82+%E8%BF%99%E4%B8%AA%E8%AE%A2%E9%98%85%E5%92%8C%E4%B8%8A%E9%9D%A2%E7%9A%84%E9%82%A3%E4%B8%AA%E8%AE%A2%E9%98%85%E9%87%87%E7%94%A8%E4%BA%86%E4%B8%A4%E7%A7%8D%E4%B8%8D%E5%90%8C%E7%9A%84%E6%A8%A1%E5%BC%8F%EF%BC%8C%E8%BF%99%E7%A7%8D%E6%98%AF%E6%A0%87%E8%AE%B0%E4%B8%BADeprecated%E7%9A%84%E8%AE%A2%E9%98%85%E6%96%B9%E5%BC%8F%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+broadcast+mined+blocks%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.minedBlockSub+%3D+pm.eventMux.Subscribe%28core.NewMinedBlockEvent%7B%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F%E3%80%80%E6%8C%96%E7%9F%BF%E5%B9%BF%E6%92%AD+goroutine+%E5%BD%93%E6%8C%96%E5%87%BA%E6%9D%A5%E7%9A%84%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E5%B0%BD%E5%BF%AB%E7%9A%84%E5%B9%BF%E6%92%AD%E5%88%B0%E7%BD%91%E7%BB%9C%E4%B8%8A%E9%9D%A2%E5%8E%BB+%E6%9C%AC%E5%9C%B0%E6%8C%96%E5%87%BA%E7%9A%84%E5%9D%97%E9%80%9A%E8%BF%87%E8%BF%99%E7%A7%8D%E5%BD%A2%E5%BC%8F%E5%B9%BF%E6%92%AD%E5%87%BA%E5%8E%BB%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.minedBroadcastLoop%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E5%90%8C%E6%AD%A5%E5%99%A8%E8%B4%9F%E8%B4%A3%E5%91%A8%E6%9C%9F%E6%80%A7%E5%9C%B0%E4%B8%8E%E7%BD%91%E7%BB%9C%E5%90%8C%E6%AD%A5%EF%BC%8C%E4%B8%8B%E8%BD%BD%E6%95%A3%E5%88%97%E5%92%8C%E5%9D%97%E4%BB%A5%E5%8F%8A%E5%A4%84%E7%90%86%E9%80%9A%E7%9F%A5%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+start+sync+handlers%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.syncer%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+txsyncLoop%E8%B4%9F%E8%B4%A3%E6%AF%8F%E4%B8%AA%E6%96%B0%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%88%9D%E5%A7%8B%E4%BA%8B%E5%8A%A1%E5%90%8C%E6%AD%A5%E3%80%82+%E5%BD%93%E6%96%B0%E7%9A%84peer%E5%87%BA%E7%8E%B0%E6%97%B6%EF%BC%8C%E6%88%91%E4%BB%AC%E8%BD%AC%E5%8F%91%E6%89%80%E6%9C%89%E5%BD%93%E5%89%8D%E5%BE%85%E5%A4%84%E7%90%86%E7%9A%84%E4%BA%8B%E5%8A%A1%E3%80%82+%E4%B8%BA%E4%BA%86%E6%9C%80%E5%B0%8F%E5%8C%96%E5%87%BA%E5%8F%A3%E5%B8%A6%E5%AE%BD%E4%BD%BF%E7%94%A8%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%80%E6%AC%A1%E5%8F%AA%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%AA%E5%B0%8F%E5%8C%85%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.txsyncLoop%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60pm.minedBroadcastLoop%28%29%60%3C%2Fspan%3E%E9%87%8C%E9%9D%A2%E5%B0%B1%E6%9C%89%E7%AE%A1%E9%81%93%E6%8E%A5%E6%94%B6%E5%88%B0%E4%B8%8A%E9%9D%A2post%E5%87%BA%E6%9D%A5%E7%9A%84%E5%87%BA%E5%9D%97%E6%B6%88%E6%81%AF%2C%E8%B7%9F%E8%BF%9B%E5%8E%BB%E5%B0%86%E4%BC%9A%E7%9C%8B%E5%88%B0%E9%80%9A%E8%BF%87p2p%E7%BD%91%E7%BB%9C%E5%8F%91%E9%80%81%E7%BB%99%E8%8A%82%E7%82%B9%E7%9A%84%E9%80%BB%E8%BE%91%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+BroadcastBlock+will+either+propagate+a+block+to+a+subset+of+it%27s+peers%2C+or%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+will+only+announce+it%27s+availability+%28depending+what%27s+requested%29.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28pm+*ProtocolManager%29+BroadcastBlock%28block+*types.Block%2C+propagate+bool%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+%3A%3D+block.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeers+%3A%3D+pm.peers.PeersWithoutBlock%28hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+propagation+is+requested%2C+send+to+a+subset+of+the+peer%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+propagate+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Calculate+the+TD+of+the+block+%28it%27s+not+imported+yet%2C+so+block.Td+is+not+valid%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+td+*big.Int%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+parent+%3A%3D+pm.blockchain.GetBlock%28block.ParentHash%28%29%2C+block.NumberU64%28%29-1%29%3B+parent+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btd+%3D+new%28big.Int%29.Add%28block.Difficulty%28%29%2C+pm.blockchain.GetTd%28block.ParentHash%28%29%2C+block.NumberU64%28%29-1%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Error%28%22Propagating+dangling+block%22%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Send+the+block+to+a+subset+of+our+peers%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btransfer+%3A%3D+peers%5B%3Aint%28math.Sqrt%28float64%28len%28peers%29%29%29%29%5D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+peer+%3A%3D+range+transfer+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeer.SendNewBlock%28block%2C+td%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Trace%28%22Propagated+block%22%2C+%22hash%22%2C+hash%2C+%22recipients%22%2C+len%28transfer%29%2C+%22duration%22%2C+common.PrettyDuration%28time.Since%28block.ReceivedAt%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Otherwise+if+the+block+is+indeed+in+out+own+chain%2C+announce+it%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pm.blockchain.HasBlock%28hash%2C+block.NumberU64%28%29%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+peer+%3A%3D+range+peers+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeer.SendNewBlockHashes%28%5B%5Dcommon.Hash%7Bhash%7D%2C+%5B%5Duint64%7Bblock.NumberU64%28%29%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Trace%28%22Announced+block%22%2C+%22hash%22%2C+hash%2C+%22recipients%22%2C+len%28peers%29%2C+%22duration%22%2C+common.PrettyDuration%28time.Since%28block.ReceivedAt%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%BF%99%E9%87%8C%E9%9D%A2%E4%BC%9A%E5%8F%91%E9%80%81%E4%B8%A4%E7%A7%8D%E6%97%B6%E9%97%B4%EF%BC%8C%E4%B8%80%E7%A7%8D%E6%98%AF%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60NewBlockMsg%60%3C%2Fspan%3E%2C%E5%8F%A6%E5%A4%96%E4%B8%80%E7%A7%8D%E6%98%AF%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60NewBlockHashesMsg%60%3C%2Fspan%3E%2C%E5%A5%BD%E4%BA%86%E5%88%B0%E6%AD%A4%E6%9C%AC%E5%9C%B0%E8%8A%82%E7%82%B9%E6%8C%96%E5%88%B0%E7%9A%84%E5%9D%97%E5%B0%B1%E9%80%9A%E8%BF%87p2p%E7%BD%91%E7%BB%9C%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%BC%80%E5%A7%8B%E6%89%A9%E6%95%A3%E5%87%BA%E5%8E%BB%E4%BA%86%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E6%8E%A5%E7%9D%80%E7%9C%8B%E4%B8%8B%E4%B8%80%E4%B8%AA%E9%87%8D%E8%A6%81%E7%9A%84%E6%96%B9%E6%B3%95%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+NewProtocolManager+returns+a+new+ethereum+sub+protocol+manager.+The+Ethereum+sub+protocol+manages+peers+capable%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2F+with+the+ethereum+network.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+NewProtocolManager%28config+*params.ChainConfig%2C+mode+downloader.SyncMode%2C+networkId+uint64%2C+mux+*event.TypeMux%2C+txpool+txPool%2C+engine+consensus.Engine%2C+blockchain+*core.BlockChain%2C+chaindb+ethdb.Database%29+%28*ProtocolManager%2C+error%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Create+the+protocol+manager+with+the+base+fields%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager+%3A%3D+%26amp%3BProtocolManager%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnetworkId%3A+networkId%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BeventMux%3A+mux%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btxpool%3A+txpool%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bblockchain%3A+blockchain%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bchaindb%3A+chaindb%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bchainconfig%3A+config%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeers%3A+newPeerSet%28%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnewPeerCh%3A+make%28chan+*peer%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BnoMorePeers%3A+make%28chan+struct%7B%7D%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtxsyncCh%3A+make%28chan+*txsync%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BquitSync%3A+make%28chan+struct%7B%7D%29%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Figure+out+whether+to+allow+fast+sync+or+not%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+mode+%3D%3D+downloader.FastSync+%26amp%3B%26amp%3B+blockchain.CurrentBlock%28%29.NumberU64%28%29+%26gt%3B+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Warn%28%22Blockchain+not+empty%2C+fast+sync+disabled%22%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmode+%3D+downloader.FullSync%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+mode+%3D%3D+downloader.FastSync+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.fastSync+%3D+uint32%281%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Initiate+a+sub-protocol+for+every+implemented+version+we+can+handle%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.SubProtocols+%3D+make%28%5B%5Dp2p.Protocol%2C+0%2C+len%28ProtocolVersions%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i%2C+version+%3A%3D+range+ProtocolVersions+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Skip+protocol+version+if+incompatible+with+the+mode+of+operation%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+mode+%3D%3D+downloader.FastSync+%26amp%3B%26amp%3B+version+%26lt%3B+eth63+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcontinue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Compatible%3B+initialise+the+sub-protocol%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bversion+%3A%3D+version+%2F%2F+Closure+for+the+run%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.SubProtocols+%3D+append%28manager.SubProtocols%2C+p2p.Protocol%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BName%3A+ProtocolName%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BVersion%3A+version%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BLength%3A+ProtocolLengths%5Bi%5D%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BRun%3A+func%28p+*p2p.Peer%2C+rw+p2p.MsgReadWriter%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeer+%3A%3D+manager.newPeer%28int%28version%29%2C+p%2C+rw%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bselect+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+manager.newPeerCh+%26lt%3B-+peer%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.wg.Add%281%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+manager.wg.Done%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager.handle%28peer%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%26lt%3B-manager.quitSync%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p2p.DiscQuitting%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BNodeInfo%3A+func%28%29+interface%7B%7D+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager.NodeInfo%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BPeerInfo%3A+func%28id+discover.NodeID%29+interface%7B%7D+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+p+%3A%3D+manager.peers.Peer%28fmt.Sprintf%28%22%25x%22%2C+id%5B%3A8%5D%29%29%3B+p+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.Info%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28manager.SubProtocols%29+%3D%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%2C+errIncompatibleConfig%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+downloader%E6%98%AF%E8%B4%9F%E8%B4%A3%E4%BB%8E%E5%85%B6%E4%BB%96%E7%9A%84peer%E6%9D%A5%E5%90%8C%E6%AD%A5%E8%87%AA%E8%BA%AB%E6%95%B0%E6%8D%AE%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+downloader%E6%98%AF%E5%85%A8%E9%93%BE%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Construct+the+different+synchronisation+mechanisms%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.downloader+%3D+downloader.New%28mode%2C+chaindb%2C+manager.eventMux%2C+blockchain%2C+nil%2C+manager.removePeer%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvalidator+%3A%3D+func%28header+*types.Header%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+engine.VerifyHeader%28blockchain%2C+header%2C+true%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheighter+%3A%3D+func%28%29+uint64+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+blockchain.CurrentBlock%28%29.NumberU64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Binserter+%3A%3D+func%28blocks+types.Blocks%29+%28int%2C+error%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+fast+sync+is+running%2C+deny+importing+weird+blocks%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+atomic.LoadUint32%28%26amp%3Bmanager.fastSync%29+%3D%3D+1+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Warn%28%22Discarded+bad+propagated+block%22%2C+%22number%22%2C+blocks%5B0%5D.Number%28%29%2C+%22hash%22%2C+blocks%5B0%5D.Hash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+0%2C+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E8%AE%BE%E7%BD%AE%E5%BC%80%E5%A7%8B%E6%8E%A5%E6%94%B6%E4%BA%A4%E6%98%93%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreUint32%28%26amp%3Bmanager.acceptTxs%2C+1%29+%2F%2F+Mark+initial+sync+done+on+any+fetcher+import%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager.blockchain.InsertChain%28blocks%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AAfetcher%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Fetcher%E8%B4%9F%E8%B4%A3%E7%A7%AF%E7%B4%AF%E6%9D%A5%E8%87%AA%E5%90%84%E4%B8%AApeer%E7%9A%84%E5%8C%BA%E5%9D%97%E9%80%9A%E7%9F%A5%E5%B9%B6%E5%AE%89%E6%8E%92%E8%BF%9B%E8%A1%8C%E6%A3%80%E7%B4%A2%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmanager.fetcher+%3D+fetcher.New%28blockchain.GetBlockByHash%2C+validator%2C+manager.BroadcastBlock%2C+heighter%2C+inserter%2C+manager.removePeer%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+manager%2C+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E8%AF%A5%E6%96%B9%E6%B3%95%E6%98%AF%E7%94%A8%E6%9D%A5%E7%AE%A1%E7%90%86%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%8D%8F%E8%AE%AE%E4%B8%8B%E7%9A%84%E5%A4%9A%E4%B8%AA%E5%AD%90%E5%8D%8F%E8%AE%AE%2C%E5%85%B6%E4%B8%AD%E7%9A%84%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60Run%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%E5%9C%A8%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E5%90%AF%E5%8A%A8%E7%9A%84%E6%97%B6%E5%80%99%E5%B0%B1%E4%BC%9A%E8%B0%83%E7%94%A8%2C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%98%AF%E9%98%BB%E5%A1%9E%E7%9A%84%2C%E8%B7%9F%E8%BF%9B%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60handler%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%E8%83%BD%E7%9C%8B%E5%88%B0%E8%BF%99%E6%A0%B7%E7%9A%84%E4%B8%80%E5%9D%97%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++for+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+pm.handleMsg%28p%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Ethereum+message+handling+failed%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E6%AD%BB%E5%BE%AA%E7%8E%AF%2C%E5%A4%84%E7%90%86p2p%E7%BD%91%E7%BB%9C%E8%BF%87%E6%9D%A5%E7%9A%84%E6%B6%88%E6%81%AF%2C%E6%8E%A5%E7%9D%80%E7%9C%8B%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60handleMsg%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28pm+*ProtocolManager%29+handleMsg%28p+*peer%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Read+the+next+message+from+the+remote+peer%2C+and+ensure+it%27s+fully+consumed%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmsg%2C+err+%3A%3D+p.rw.ReadMsg%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+msg.Size+%26gt%3B+ProtocolMaxMsgSize+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrMsgTooLarge%2C+%22%25v+%26gt%3B+%25v%22%2C+msg.Size%2C+ProtocolMaxMsgSize%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+msg.Discard%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Handle+the+message+depending+on+its+contents%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bswitch+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+StatusMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Status+messages+should+never+arrive+after+the+handshake%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrExtraStatusMsg%2C+%22uncontrolled+status+message%22%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Block+header+query%2C+collect+the+requested+headers+and+reply%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+GetBlockHeadersMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Decode+the+complex+header+query%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+query+getBlockHeadersData%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Bquery%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BhashMode+%3A%3D+query.Origin.Hash+%21%3D+%28common.Hash%7B%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Gather+headers+until+the+fetch+or+network+limits+is+reached%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+common.StorageSize%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheaders+%5B%5D*types.Header%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+bool%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+%21unknown+%26amp%3B%26amp%3B+len%28headers%29+%26lt%3B+int%28query.Amount%29+%26amp%3B%26amp%3B+bytes+%26lt%3B+softResponseLimit+%26amp%3B%26amp%3B+len%28headers%29+%26lt%3B+downloader.MaxHeaderFetch+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+next+header+satisfying+the+query%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+origin+*types.Header%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+hashMode+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Borigin+%3D+pm.blockchain.GetHeaderByHash%28query.Origin.Hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Borigin+%3D+pm.blockchain.GetHeaderByNumber%28query.Origin.Number%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+origin+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnumber+%3A%3D+origin.Number.Uint64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheaders+%3D+append%28headers%2C+origin%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+%2B%3D+estHeaderRlpSize%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Advance+to+the+next+header+of+the+query%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bswitch+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+query.Origin.Hash+%21%3D+%28common.Hash%7B%7D%29+%26amp%3B%26amp%3B+query.Reverse%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Hash+based+traversal+towards+the+genesis+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i+%3A%3D+0%3B+i+%26lt%3B+int%28query.Skip%29%2B1%3B+i%2B%2B+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+header+%3A%3D+pm.blockchain.GetHeader%28query.Origin.Hash%2C+number%29%3B+header+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bquery.Origin.Hash+%3D+header.ParentHash%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnumber--%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+query.Origin.Hash+%21%3D+%28common.Hash%7B%7D%29+%26amp%3B%26amp%3B+%21query.Reverse%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Hash+based+traversal+towards+the+leaf+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcurrent+%3D+origin.Number.Uint64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnext+%3D+current+%2B+query.Skip+%2B+1%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+next+%26lt%3B%3D+current+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Binfos%2C+_+%3A%3D+json.MarshalIndent%28p.Peer.Info%28%29%2C+%22%22%2C+%22+%22%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Warn%28%22GetBlockHeaders+skip+overflow+attack%22%2C+%22current%22%2C+current%2C+%22skip%22%2C+query.Skip%2C+%22next%22%2C+next%2C+%22attacker%22%2C+infos%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+header+%3A%3D+pm.blockchain.GetHeaderByNumber%28next%29%3B+header+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pm.blockchain.GetBlockHashesFromHash%28header.Hash%28%29%2C+query.Skip%2B1%29%5Bquery.Skip%5D+%3D%3D+query.Origin.Hash+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bquery.Origin.Hash+%3D+header.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+query.Reverse%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Number+based+traversal+towards+the+genesis+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+query.Origin.Number+%26gt%3B%3D+query.Skip%2B1+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bquery.Origin.Number+-%3D+%28query.Skip+%2B+1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+%21query.Reverse%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Number+based+traversal+towards+the+leaf+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bquery.Origin.Number+%2B%3D+%28query.Skip+%2B+1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.SendBlockHeaders%28headers%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+BlockHeadersMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+A+batch+of+headers+arrived+to+one+of+our+previous+requests%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+headers+%5B%5D*types.Header%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Bheaders%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+no+headers+were+received%2C+but+we%27re+expending+a+DAO+fork+check%2C+maybe+it%27s+that%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28headers%29+%3D%3D+0+%26amp%3B%26amp%3B+p.forkDrop+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Possibly+an+empty+reply+to+the+fork+header+checks%2C+sanity+check+TDs%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BverifyDAO+%3A%3D+true%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+we+already+have+a+DAO+header%2C+we+can+check+the+peer%27s+TD+against+it.+If%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+the+peer%27s+ahead+of+this%2C+it+too+must+have+a+reply+to+the+DAO+check%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+daoHeader+%3A%3D+pm.blockchain.GetHeaderByNumber%28pm.chainconfig.DAOForkBlock.Uint64%28%29%29%3B+daoHeader+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+td+%3A%3D+p.Head%28%29%3B+td.Cmp%28pm.blockchain.GetTd%28daoHeader.Hash%28%29%2C+daoHeader.Number.Uint64%28%29%29%29+%26gt%3B%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BverifyDAO+%3D+false%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+we%27re+seemingly+on+the+same+chain%2C+disable+the+drop+timer%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+verifyDAO+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Seems+to+be+on+the+same+side+of+the+DAO+fork%22%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop.Stop%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop+%3D+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Filter+out+any+explicitly+requested+headers%2C+deliver+the+rest+to+the+downloader%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfilter+%3A%3D+len%28headers%29+%3D%3D+1%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+filter+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+it%27s+a+potential+DAO+fork+check%2C+validate+against+the+rules%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+p.forkDrop+%21%3D+nil+%26amp%3B%26amp%3B+pm.chainconfig.DAOForkBlock.Cmp%28headers%5B0%5D.Number%29+%3D%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Disable+the+fork+drop+timer%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop.Stop%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.forkDrop+%3D+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Validate+the+header+and+either+drop+the+peer+or+continue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+misc.VerifyDAOHeaderExtraData%28pm.chainconfig%2C+headers%5B0%5D%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Verified+to+be+on+the+other+side+of+the+DAO+fork%2C+dropping%22%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.Log%28%29.Debug%28%22Verified+to+be+on+the+same+side+of+the+DAO+fork%22%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Irrelevant+of+the+fork+checks%2C+send+the+header+to+the+fetcher+just+in+case%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheaders+%3D+pm.fetcher.FilterHeaders%28p.id%2C+headers%2C+time.Now%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28headers%29+%26gt%3B+0+%7C%7C+%21filter+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Berr+%3A%3D+pm.downloader.DeliverHeaders%28p.id%2C+headers%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Failed+to+deliver+headers%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+GetBlockBodiesMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Decode+the+retrieval+message%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmsgStream+%3A%3D+rlp.NewStream%28msg.Payload%2C+uint64%28msg.Size%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+err+%3A%3D+msgStream.List%28%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Gather+blocks+until+the+fetch+or+network+limits+is+reached%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+common.Hash%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+int%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbodies+%5B%5Drlp.RawValue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+bytes+%26lt%3B+softResponseLimit+%26amp%3B%26amp%3B+len%28bodies%29+%26lt%3B+downloader.MaxBlockFetch+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+hash+of+the+next+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msgStream.Decode%28%26amp%3Bhash%29%3B+err+%3D%3D+rlp.EOL+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+if+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+requested+block+body%2C+stopping+if+enough+was+found%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+data+%3A%3D+pm.blockchain.GetBodyRLP%28hash%29%3B+len%28data%29+%21%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbodies+%3D+append%28bodies%2C+data%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+%2B%3D+len%28data%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.SendBlockBodiesRLP%28bodies%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+BlockBodiesMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+A+batch+of+block+bodies+arrived+to+one+of+our+previous+requests%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+request+blockBodiesData%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Brequest%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Deliver+them+all+to+the+downloader+for+queuing%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btrasactions+%3A%3D+make%28%5B%5D%5B%5D*types.Transaction%2C+len%28request%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Buncles+%3A%3D+make%28%5B%5D%5B%5D*types.Header%2C+len%28request%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i%2C+body+%3A%3D+range+request+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btrasactions%5Bi%5D+%3D+body.Transactions%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Buncles%5Bi%5D+%3D+body.Uncles%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Filter+out+any+explicitly+requested+bodies%2C+deliver+the+rest+to+the+downloader%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfilter+%3A%3D+len%28trasactions%29+%26gt%3B+0+%7C%7C+len%28uncles%29+%26gt%3B+0%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+filter+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btrasactions%2C+uncles+%3D+pm.fetcher.FilterBodies%28p.id%2C+trasactions%2C+uncles%2C+time.Now%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+len%28trasactions%29+%26gt%3B+0+%7C%7C+len%28uncles%29+%26gt%3B+0+%7C%7C+%21filter+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Berr+%3A%3D+pm.downloader.DeliverBodies%28p.id%2C+trasactions%2C+uncles%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Failed+to+deliver+bodies%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+p.version+%26gt%3B%3D+eth63+%26amp%3B%26amp%3B+msg.Code+%3D%3D+GetNodeDataMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Decode+the+retrieval+message%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmsgStream+%3A%3D+rlp.NewStream%28msg.Payload%2C+uint64%28msg.Size%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+err+%3A%3D+msgStream.List%28%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Gather+state+data+until+the+fetch+or+network+limits+is+reached%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+common.Hash%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+int%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdata+%5B%5D%5B%5Dbyte%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+bytes+%26lt%3B+softResponseLimit+%26amp%3B%26amp%3B+len%28data%29+%26lt%3B+downloader.MaxStateFetch+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+hash+of+the+next+state+entry%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msgStream.Decode%28%26amp%3Bhash%29%3B+err+%3D%3D+rlp.EOL+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+if+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+requested+state+entry%2C+stopping+if+enough+was+found%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+entry%2C+err+%3A%3D+pm.chaindb.Get%28hash.Bytes%28%29%29%3B+err+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdata+%3D+append%28data%2C+entry%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+%2B%3D+len%28entry%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.SendNodeData%28data%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+p.version+%26gt%3B%3D+eth63+%26amp%3B%26amp%3B+msg.Code+%3D%3D+NodeDataMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+A+batch+of+node+state+data+arrived+to+one+of+our+previous+requests%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+data+%5B%5D%5B%5Dbyte%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Bdata%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Deliver+all+to+the+downloader%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+pm.downloader.DeliverNodeData%28p.id%2C+data%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Failed+to+deliver+node+state+data%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+p.version+%26gt%3B%3D+eth63+%26amp%3B%26amp%3B+msg.Code+%3D%3D+GetReceiptsMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Decode+the+retrieval+message%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BmsgStream+%3A%3D+rlp.NewStream%28msg.Payload%2C+uint64%28msg.Size%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+err+%3A%3D+msgStream.List%28%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Gather+state+data+until+the+fetch+or+network+limits+is+reached%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+common.Hash%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+int%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breceipts+%5B%5Drlp.RawValue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+bytes+%26lt%3B+softResponseLimit+%26amp%3B%26amp%3B+len%28receipts%29+%26lt%3B+downloader.MaxReceiptFetch+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+hash+of+the+next+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msgStream.Decode%28%26amp%3Bhash%29%3B+err+%3D%3D+rlp.EOL+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+if+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+the+requested+block%27s+receipts%2C+skipping+if+unknown+to+us%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bresults+%3A%3D+core.GetBlockReceipts%28pm.chaindb%2C+hash%2C+core.GetBlockNumber%28pm.chaindb%2C+hash%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+results+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+header+%3A%3D+pm.blockchain.GetHeaderByHash%28hash%29%3B+header+%3D%3D+nil+%7C%7C+header.ReceiptHash+%21%3D+types.EmptyRootHash+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcontinue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+known%2C+encode+and+queue+for+response+packet%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+encoded%2C+err+%3A%3D+rlp.EncodeToBytes%28results%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Error%28%22Failed+to+encode+receipt%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breceipts+%3D+append%28receipts%2C+encoded%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbytes+%2B%3D+len%28encoded%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p.SendReceiptsRLP%28receipts%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+p.version+%26gt%3B%3D+eth63+%26amp%3B%26amp%3B+msg.Code+%3D%3D+ReceiptsMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+A+batch+of+receipts+arrived+to+one+of+our+previous+requests%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+receipts+%5B%5D%5B%5D*types.Receipt%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Breceipts%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Deliver+all+to+the+downloader%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+pm.downloader.DeliverReceipts%28p.id%2C+receipts%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Failed+to+deliver+receipts%22%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+NewBlockHashesMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+announces+newBlockHashesData%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Bannounces%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Mark+the+hashes+as+present+at+the+remote+node%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+block+%3A%3D+range+announces+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.MarkBlock%28block.Hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Schedule+all+the+unknown+hashes+for+retrieval%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3A%3D+make%28newBlockHashesData%2C+0%2C+len%28announces%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+block+%3A%3D+range+announces+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+%21pm.blockchain.HasBlock%28block.Hash%2C+block.Number%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bunknown+%3D+append%28unknown%2C+block%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+block+%3A%3D+range+unknown+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.fetcher.Notify%28p.id%2C+block.Hash%2C+block.Number%2C+time.Now%28%29%2C+p.RequestOneHeader%2C+p.RequestBodies%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+NewBlockMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Retrieve+and+decode+the+propagated+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+request+newBlockData%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Brequest%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Brequest.Block.ReceivedAt+%3D+msg.ReceivedAt%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Brequest.Block.ReceivedFrom+%3D+p%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Mark+the+peer+as+owning+the+block+and+schedule+it+for+import%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.MarkBlock%28request.Block.Hash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.fetcher.Enqueue%28p.id%2C+request.Block%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Assuming+the+block+is+importable+by+the+peer%2C+but+possibly+not+yet+done+so%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+calculate+the+head+hash+and+TD+that+the+peer+truly+must+have.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+%28%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtrueHead+%3D+request.Block.ParentHash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BtrueTD+%3D+new%28big.Int%29.Sub%28request.TD%2C+request.Block.Difficulty%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Update+the+peers+total+difficulty+if+better+than+the+previous%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+td+%3A%3D+p.Head%28%29%3B+trueTD.Cmp%28td%29+%26gt%3B+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.SetHead%28trueHead%2C+trueTD%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Schedule+a+sync+if+above+ours.+Note%2C+this+will+not+fire+a+sync+for+a+gap+of%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+a+singe+block+%28as+the+true+TD+is+below+the+propagated+block%29%2C+however+this%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+scenario+should+easily+be+covered+by+the+fetcher.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BcurrentBlock+%3A%3D+pm.blockchain.CurrentBlock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+trueTD.Cmp%28pm.blockchain.GetTd%28currentBlock.Hash%28%29%2C+currentBlock.NumberU64%28%29%29%29+%26gt%3B+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+pm.synchronise%28p%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+msg.Code+%3D%3D+TxMsg%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Transactions+arrived%2C+make+sure+we+have+a+valid+and+fresh+chain+to+handle+them%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+atomic.LoadUint32%28%26amp%3Bpm.acceptTxs%29+%3D%3D+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Transactions+can+be+processed%2C+parse+all+of+them+and+deliver+to+the+pool%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+txs+%5B%5D*types.Transaction%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%3A%3D+msg.Decode%28%26amp%3Btxs%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22msg+%25v%3A+%25v%22%2C+msg%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+i%2C+tx+%3A%3D+range+txs+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Validate+and+mark+the+remote+transaction%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+tx+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrDecode%2C+%22transaction+%25d+is+nil%22%2C+i%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.MarkTransaction%28tx.Hash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpm.txpool.AddRemotes%28txs%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefault%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrInvalidMsgCode%2C+%22%25v%22%2C+msg.Code%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+nil%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%E5%B0%B1%E8%A7%A3%E7%A0%81%E4%BA%86p2p%E7%BD%91%E7%BB%9C%E8%BF%87%E6%9D%A5%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%A4%84%E7%90%86%E4%BA%86%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60NewBlockMsg%60%3C%2Fspan%3E%E5%92%8C%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60NewBlockHashesMsg%60%3C%2Fspan%3E%E8%BF%99%E4%B8%A4%E7%A7%8D%E4%BA%8B%E4%BB%B6%2C%E5%A6%82%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60NewBlockMsg%60%3C%2Fspan%3E%E4%B8%AD%E7%9A%84%E5%A4%84%E7%90%86%E9%80%BB%E8%BE%91%E6%98%AF%E7%9B%B4%E6%8E%A5%E9%80%9A%E8%BF%87%E7%AE%A1%E9%81%93%E5%8F%91%E9%80%81%E5%88%B0%E6%9C%AC%E5%9C%B0%E4%BA%86%2C%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60pm.fetcher.Enqueue%28p.id%2C+request.Block%29%60%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2C%E5%AF%B9%E5%BA%94%E7%9A%84%E7%AE%A1%E9%81%93%E5%90%8D%E6%98%AF%3A%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60f.inject%60%3C%2Fspan%3E%2C%E5%85%B6%E4%B8%AD%E6%98%AF%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%2C%2Ffetcher.go%2Fenqueue%E6%96%B9%E6%B3%95%E4%B8%AD%E5%86%99%E5%85%A5%E4%BA%86%E4%B8%80%E4%B8%AAFIFO%E9%98%9F%E5%88%97%E4%B8%AD%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28f+*Fetcher%29+enqueue%28peer+string%2C+block+*types.Block%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+%3A%3D+block.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Ensure+the+peer+isn%27t+DOSing+us%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcount+%3A%3D+f.queues%5Bpeer%5D+%2B+1%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+count+%26gt%3B+blockLimit+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Discarded+propagated+block%2C+exceeded+allowance%22%2C+%22peer%22%2C+peer%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%2C+%22limit%22%2C+blockLimit%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BpropBroadcastDOSMeter.Mark%281%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.forgetHash%28hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Discard+any+past+or+too+distant+blocks%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+dist+%3A%3D+int64%28block.NumberU64%28%29%29+-+int64%28f.chainHeight%28%29%29%3B+dist+%26lt%3B+-maxUncleDist+%7C%7C+dist+%26gt%3B+maxQueueDist+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Discarded+propagated+block%2C+too+far+away%22%2C+%22peer%22%2C+peer%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%2C+%22distance%22%2C+dist%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BpropBroadcastDropMeter.Mark%281%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.forgetHash%28hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Schedule+the+block+for+future+importing%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+ok+%3A%3D+f.queued%5Bhash%5D%3B+%21ok+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bop+%3A%3D+%26amp%3Binject%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Borigin%3A+peer%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bblock%3A+block%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.queues%5Bpeer%5D+%3D+count%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.queued%5Bhash%5D+%3D+op%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.queue.Push%28op%2C+-float32%28block.NumberU64%28%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+f.queueChangeHook+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.queueChangeHook%28op.block.Hash%28%29%2C+true%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Queued+propagated+block%22%2C+%22peer%22%2C+peer%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%2C+%22queued%22%2C+f.queue.Size%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%AF%A5%E9%98%9F%E5%88%97%E7%9A%84%E6%B6%88%E8%B4%B9%E7%AB%AF%E5%9C%A8%2Ffetcher.go%2Floop%E4%B8%AD%2C%E6%98%AF%E4%B8%80%E4%B8%AA%E6%AD%BB%E5%BE%AA%E7%8E%AF%2C%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++for+%21f.queue.Empty%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bop+%3A%3D+f.queue.PopItem%28%29.%28*inject%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+f.queueChangeHook+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.queueChangeHook%28op.block.Hash%28%29%2C+false%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+too+high+up+the+chain+or+phase%2C+continue+later%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bnumber+%3A%3D+op.block.NumberU64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+number+%26gt%3B+height%2B1+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.queue.Push%28op%2C+-float32%28op.block.NumberU64%28%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+f.queueChangeHook+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.queueChangeHook%28op.block.Hash%28%29%2C+true%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Otherwise+if+fresh+and+still+unknown%2C+try+and+import%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+%3A%3D+op.block.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+number%2BmaxUncleDist+%26lt%3B+height+%7C%7C+f.getBlock%28hash%29+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.forgetBlock%28hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcontinue%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.insert%28op.origin%2C+op.block%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E4%BB%8E%E9%98%9F%E5%88%97%E4%B8%AD%E5%8F%96%E5%87%BA%2C%E6%8E%A5%E7%9D%80%E7%9C%8B%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60insert%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28f+*Fetcher%29+insert%28peer+string%2C+block+*types.Block%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+%3A%3D+block.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Run+the+import+on+a+new+thread%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Importing+propagated+block%22%2C+%22peer%22%2C+peer%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+func%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+func%28%29+%7B+f.done+%26lt%3B-+hash+%7D%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+the+parent%27s+unknown%2C+abort+insertion%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bparent+%3A%3D+f.getBlock%28block.ParentHash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+parent+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Unknown+parent+of+propagated+block%22%2C+%22peer%22%2C+peer%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%2C+%22parent%22%2C+block.ParentHash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Quickly+validate+the+header+and+propagate+the+block+if+it+passes%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bswitch+err+%3A%3D+f.verifyHeader%28block.Header%28%29%29%3B+err+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+nil%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+All+ok%2C+quickly+propagate+to+our+peers%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BpropBroadcastOutTimer.UpdateSince%28block.ReceivedAt%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+f.broadcastBlock%28block%2C+true%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+consensus.ErrFutureBlock%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Weird+future+block%2C+don%27t+fail%2C+but+neither+propagate%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefault%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Something+went+very+wrong%2C+drop+the+peer%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Propagated+block+verification+failed%22%2C+%22peer%22%2C+peer%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.dropPeer%28peer%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Run+the+actual+import+and+log+any+issues%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+_%2C+err+%3A%3D+f.insertChain%28types.Blocks%7Bblock%7D%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Propagated+block+import+failed%22%2C+%22peer%22%2C+peer%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%2C+%22err%22%2C+err%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+import+succeeded%2C+broadcast+the+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BpropAnnounceOutTimer.UpdateSince%28block.ReceivedAt%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bgo+f.broadcastBlock%28block%2C+false%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Invoke+the+testing+hook+if+needed%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+f.importedHook+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bf.importedHook%28block%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%2C%E8%AF%A5%E6%96%B9%E6%B3%95%E4%BC%9A%E8%B0%83%E7%94%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60verifyHeader%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%E5%8E%BB%E6%A0%A1%E9%AA%8C%E5%8C%BA%E5%9D%97%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%B2%A1%E9%97%AE%E9%A2%98%E7%9A%84%E8%AF%9D%E5%B0%B1%E9%80%9A%E8%BF%87p2p%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%B9%BF%E6%92%AD%E5%87%BA%E5%8E%BB%2C%E7%84%B6%E5%90%8E%E8%B0%83%E7%94%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60insertChain%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%E6%8F%92%E5%85%A5%E5%88%B0%E6%9C%AC%E5%9C%B0%E7%9A%84leveldb%E4%B8%AD%2C%E6%8F%92%E5%85%A5%E6%B2%A1%E9%97%AE%E9%A2%98%E7%9A%84%E8%AF%9D%EF%BC%8C%E4%BC%9A%E5%86%8D%E5%B9%BF%E6%92%AD%E4%B8%80%E6%AC%A1%2C%E4%B8%8D%E8%BF%87%E8%BF%99%E6%AC%A1%E5%8F%AA%E4%BC%9A%E5%B9%BF%E6%92%ADblock%E7%9A%84hash%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E5%A6%82%E6%AD%A4%EF%BC%8C%E9%80%9A%E8%BF%87%E4%B8%80%E4%B8%AA%E5%AF%B9%E7%AD%89%E7%BD%91%E7%BB%9C%2C%E5%8F%AA%E8%A6%81%E5%9D%97%E5%90%88%E6%B3%95%2C%E9%82%A3%E4%B9%88%E5%B0%B1%E4%BC%9A%E8%A2%AB%E5%85%A8%E7%BD%91%E9%87%87%E7%BA%B3%2C%E5%85%B6%E4%B8%AD%E7%9A%84%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60verifyHeader%60%3C%2Fspan%3E%2C%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60insertChain%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%E9%83%BD%E6%98%AF%E5%9C%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60%2Fhandler.go%2FNewProtocolManager%60%3C%2Fspan%3E%E4%B8%AD%E5%AE%9A%E4%B9%89%E4%BC%A0%E8%BF%87%E6%9D%A5%E7%9A%84%2C%E6%89%80%E6%9C%89%E5%90%AF%E5%8A%A8%E7%9A%84%E9%80%BB%E8%BE%91%E9%83%BD%E6%98%AF%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60handler.go%2FStart%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%E4%B8%AD.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++fetch.go%E7%9A%84start%E6%96%B9%E6%B3%95%E5%9C%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60syncer%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%E4%B8%AD%E7%94%A8%E4%B8%80%E4%B8%AA%E5%8D%95%E7%8B%AC%E7%9A%84%E5%8D%8F%E7%A8%8B%E8%A7%A6%E5%8F%91%E7%9A%84%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%2Fhandler.go%2FhandleMsg+--%26gt%3B+go+pm.synchronise%28p%29+--%26gt%3B+pm.downloader.Synchronise%28peer.id%2C+pHead%2C+pTd%2C+mode%29+--%26gt%3B+d.synchronise%28id%2C+head%2C+td%2C+mode%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++--%26gt%3B+d.syncWithPeer%28p%2C+hash%2C+td%29%60%2C%E8%AE%A9%E6%88%91%E4%BB%AC%E7%9C%8B%E4%B8%8B%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28d+*Downloader%29+syncWithPeer%28p+*peerConnection%2C+hash+common.Hash%2C+td+*big.Int%29+%28err+error%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.mux.Post%28StartEvent%7B%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+func%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+reset+on+error%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.mux.Post%28FailedEvent%7Berr%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.mux.Post%28DoneEvent%7B%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+p.version+%26lt%3B+62+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errTooOld%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Synchronising+with+the+network%22%2C+%22peer%22%2C+p.id%2C+%22eth%22%2C+p.version%2C+%22head%22%2C+hash%2C+%22td%22%2C+td%2C+%22mode%22%2C+d.mode%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+func%28start+time.Time%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Synchronisation+terminated%22%2C+%22elapsed%22%2C+time.Since%28start%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%28time.Now%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Look+up+the+sync+boundaries%3A+the+common+ancestor+and+the+target+block%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blatest%2C+err+%3A%3D+d.fetchHeight%28p%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bheight+%3A%3D+latest.Number.Uint64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Borigin%2C+err+%3A%3D+d.findAncestor%28p%2C+height%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.syncStatsLock.Lock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+d.syncStatsChainHeight+%26lt%3B%3D+origin+%7C%7C+d.syncStatsChainOrigin+%26gt%3B+origin+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.syncStatsChainOrigin+%3D+origin%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.syncStatsChainHeight+%3D+height%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.syncStatsLock.Unlock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Initiate+the+sync+using+a+concurrent+header+and+content+retrieval+algorithm%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpivot+%3A%3D+uint64%280%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bswitch+d.mode+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+LightSync%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpivot+%3D+height%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+FastSync%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Calculate+the+new+fast%2Fslow+sync+pivot+point%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+d.fsPivotLock+%3D%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BpivotOffset%2C+err+%3A%3D+rand.Int%28rand.Reader%2C+big.NewInt%28int64%28fsPivotInterval%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpanic%28fmt.Sprintf%28%22Failed+to+access+crypto+random+source%3A+%25v%22%2C+err%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+height+%26gt%3B+uint64%28fsMinFullBlocks%29%2BpivotOffset.Uint64%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpivot+%3D+height+-+uint64%28fsMinFullBlocks%29+-+pivotOffset.Uint64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Pivot+point+locked+in%2C+use+this+and+do+not+pick+a+new+one%21%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpivot+%3D+d.fsPivotLock.Number.Uint64%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+the+point+is+below+the+origin%2C+move+origin+back+to+ensure+state+download%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pivot+%26lt%3B+origin+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pivot+%26gt%3B+0+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Borigin+%3D+pivot+-+1%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Borigin+%3D+0%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Debug%28%22Fast+syncing+until+pivot+block%22%2C+%22pivot%22%2C+pivot%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.queue.Prepare%28origin%2B1%2C+d.mode%2C+pivot%2C+latest%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+d.syncInitHook+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bd.syncInitHook%28origin%2C+height%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfetchers+%3A%3D+%5B%5Dfunc%28%29+error%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc%28%29+error+%7B+return+d.fetchHeaders%28p%2C+origin%2B1%29+%7D%2C+%2F%2F+Headers+are+always+retrieved%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc%28%29+error+%7B+return+d.fetchBodies%28origin+%2B+1%29+%7D%2C+%2F%2F+Bodies+are+retrieved+during+normal+and+fast+sync%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc%28%29+error+%7B+return+d.fetchReceipts%28origin+%2B+1%29+%7D%2C+%2F%2F+Receipts+are+retrieved+during+fast+sync%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfunc%28%29+error+%7B+return+d.processHeaders%28origin%2B1%2C+td%29+%7D%2C%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+d.mode+%3D%3D+FastSync+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfetchers+%3D+append%28fetchers%2C+func%28%29+error+%7B+return+d.processFastSyncContent%28latest%29+%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+if+d.mode+%3D%3D+FullSync+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfetchers+%3D+append%28fetchers%2C+d.processFullSyncContent%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Berr+%3D+d.spawnSync%28fetchers%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%26amp%3B%26amp%3B+d.mode+%3D%3D+FastSync+%26amp%3B%26amp%3B+d.fsPivotLock+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+sync+failed+in+the+critical+section%2C+bump+the+fail+counter.%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.AddUint32%28%26amp%3Bd.fsPivotFails%2C+1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E7%94%B1%E4%BA%8E%E4%B8%8A%E8%BF%B0%E6%95%B4%E4%B8%AA%E8%B0%83%E7%94%A8%E6%A0%88%E6%98%AF%E5%9C%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60newBlockMsg%60%3C%2Fspan%3E%E7%9A%84%E6%9D%A1%E4%BB%B6%E4%B8%AD%E8%A7%A6%E5%8F%91%E7%9A%84%2C%E8%BF%99%E9%87%8C%E7%9A%84%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60StartEvent%60%3C%2Fspan%3E%E4%BC%9A%E9%80%9A%E8%BF%87%E9%80%9A%E9%81%93%E7%9A%84%E5%BD%A2%E5%BC%8F%E4%BC%A0%E9%80%92%E5%88%B0miner.go%2Fupdate%E4%B8%AD%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28self+*Miner%29+update%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bevents+%3A%3D+self.mux.Subscribe%28downloader.StartEvent%7B%7D%2C+downloader.DoneEvent%7B%7D%2C+downloader.FailedEvent%7B%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++out%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+ev+%3A%3D+range+events.Chan%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bswitch+ev.Data.%28type%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+downloader.StartEvent%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreInt32%28%26amp%3Bself.canStart%2C+0%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+self.Mining%28%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.Stop%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreInt32%28%26amp%3Bself.shouldStart%2C+1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Info%28%22Mining+aborted+due+to+sync%22%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bcase+downloader.DoneEvent%2C+downloader.FailedEvent%3A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3BshouldStart+%3A%3D+atomic.LoadInt32%28%26amp%3Bself.shouldStart%29+%3D%3D+1%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreInt32%28%26amp%3Bself.canStart%2C+1%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Batomic.StoreInt32%28%26amp%3Bself.shouldStart%2C+0%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+shouldStart+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bself.Start%28self.coinbase%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+unsubscribe.+we%27re+only+interested+in+this+event+once%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bevents.Unsubscribe%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+stop+immediately+and+ignore+all+further+pending+events%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bbreak+out%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%8E%A5%E6%94%B6%E5%88%B0%E8%BF%99%E4%B8%AA%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60StartEvent%60%3C%2Fspan%3E%E5%B0%B1%E4%BC%9A%E9%80%9A%E7%9F%A5%E6%89%80%E6%9C%89%E7%9A%84%E4%BB%A3%E7%90%86%EF%BC%8C%E8%B0%83%E7%94%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60stop%60%3C%2Fspan%3E%E5%81%9C%E6%AD%A2%E5%BD%93%E5%89%8D%E7%9B%B8%E5%90%8C%E5%9D%97%E7%9A%84%E6%8C%96%E7%9F%BF%2C%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60remote_Agent%60%3C%2Fspan%3E%E4%B8%AD%E7%9A%84%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60stop%60%3C%2Fspan%3E%E6%96%B9%E6%B3%95%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E6%9C%80%E5%90%8E%E5%86%8D%E7%9C%8B%E4%B8%80%E4%B8%8B%E6%96%B0%E5%9D%97%E5%A6%82%E4%BD%95%E5%B9%BF%E6%92%AD%E7%BB%99%E5%85%B6%E4%BB%96%E8%8A%82%E7%82%B9%E7%9A%84%2C%E5%A4%84%E7%90%86%E7%9A%84%E6%96%B9%E6%B3%95%E5%9C%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60%2Feth%2Fhandle.go%2FBroadcastBlock%60%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28pm+*ProtocolManager%29+BroadcastBlock%28block+*types.Block%2C+propagate+bool%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bhash+%3A%3D+block.Hash%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeers+%3A%3D+pm.peers.PeersWithoutBlock%28hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+If+propagation+is+requested%2C+send+to+a+subset+of+the+peer%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+propagate+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Calculate+the+TD+of+the+block+%28it%27s+not+imported+yet%2C+so+block.Td+is+not+valid%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bvar+td+*big.Int%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+parent+%3A%3D+pm.blockchain.GetBlock%28block.ParentHash%28%29%2C+block.NumberU64%28%29-1%29%3B+parent+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btd+%3D+new%28big.Int%29.Add%28block.Difficulty%28%29%2C+pm.blockchain.GetTd%28block.ParentHash%28%29%2C+block.NumberU64%28%29-1%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D+else+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Error%28%22Propagating+dangling+block%22%2C+%22number%22%2C+block.Number%28%29%2C+%22hash%22%2C+hash%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Send+the+block+to+a+subset+of+our+peers%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Btransfer+%3A%3D+peers%5B%3Aint%28math.Sqrt%28float64%28len%28peers%29%29%29%29%5D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+peer+%3A%3D+range+transfer+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeer.SendNewBlock%28block%2C+td%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Trace%28%22Propagated+block%22%2C+%22hash%22%2C+hash%2C+%22recipients%22%2C+len%28transfer%29%2C+%22duration%22%2C+common.PrettyDuration%28time.Since%28block.ReceivedAt%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Otherwise+if+the+block+is+indeed+in+out+own+chain%2C+announce+it%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+pm.blockchain.HasBlock%28hash%2C+block.NumberU64%28%29%29+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bfor+_%2C+peer+%3A%3D+range+peers+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bpeer.SendNewBlockHashes%28%5B%5Dcommon.Hash%7Bhash%7D%2C+%5B%5Duint64%7Bblock.NumberU64%28%29%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Blog.Trace%28%22Announced+block%22%2C+%22hash%22%2C+hash%2C+%22recipients%22%2C+len%28peers%29%2C+%22duration%22%2C+common.PrettyDuration%28time.Since%28block.ReceivedAt%29%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E8%AF%A5%E6%96%B9%E6%B3%95%E4%B8%AD%E5%BE%AA%E7%8E%AF%E6%AF%8F%E4%B8%AA%E8%BF%9E%E6%8E%A5%E7%9A%84peer%E8%8A%82%E7%82%B9%2C%E8%B0%83%E7%94%A8%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60peer.SendNewBlock%60%3C%2Fspan%3E%E5%8F%91%E9%80%81%E4%BA%A7%E5%9D%97%E6%B6%88%E6%81%AF%E8%BF%87%E5%8E%BB%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28p+*peer%29+SendNewBlock%28block+*types.Block%2C+td+*big.Int%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bp.knownBlocks.Add%28block.Hash%28%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+p2p.Send%28p.rw%2C+NewBlockMsg%2C+%5B%5Dinterface%7B%7D%7Bblock%2C+td%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+Send%28w+MsgWriter%2C+msgcode+uint64%2C+data+interface%7B%7D%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bsize%2C+r%2C+err+%3A%3D+rlp.EncodeToReader%28data%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+w.WriteMsg%28Msg%7BCode%3A+msgcode%2C+Size%3A+uint32%28size%29%2C+Payload%3A+r%7D%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E9%80%9A%E8%BF%87%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60writeMsg%60%3C%2Fspan%3E%E5%86%99%E5%85%A5%E8%AF%A5%E8%8A%82%E7%82%B9%E9%87%8C%2C%E8%AF%A5%E6%96%B9%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%98%AF%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60rw+*netWrapper%29+WriteMsg%28msg+Msg%29%60%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28rw+*netWrapper%29+WriteMsg%28msg+Msg%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Brw.wmu.Lock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+rw.wmu.Unlock%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Brw.conn.SetWriteDeadline%28time.Now%28%29.Add%28rw.wtimeout%29%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+rw.wrapped.WriteMsg%28msg%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E8%AF%A5%E6%96%B9%E6%B3%95%E8%AE%BE%E7%BD%AE%E4%BA%86%E4%B8%80%E4%B8%AA%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%2C%E5%BA%95%E5%B1%82%E8%B0%83%E7%94%A8%E4%BA%86net.go%E7%9A%84%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60Write%28b+%5B%5Dbyte%29+%28n+int%2C+err+error%29%60%3C%2Fspan%3E%2C%E9%80%9A%E8%BF%87%E7%BD%91%E7%BB%9C%E5%86%99%E7%BB%99%E5%AF%B9%E5%BA%94%E7%9A%84%E8%8A%82%E7%82%B9%E4%BA%86%2C%E7%84%B6%E5%90%8E%E6%8E%A5%E6%94%B6%E7%AB%AF%E7%9A%84%E6%96%B9%E6%B3%95%E4%B8%BA%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60ReadMsg%60%3C%2Fspan%3E%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28pm+*ProtocolManager%29+handleMsg%28p+*peer%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%2F%2F+Read+the+next+message+from+the+remote+peer%2C+and+ensure+it%27s+fully+consumed%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bmsg%2C+err+%3A%3D+p.rw.ReadMsg%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bif+msg.Size+%26gt%3B+ProtocolMaxMsgSize+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Breturn+errResp%28ErrMsgTooLarge%2C+%22%25v+%26gt%3B+%25v%22%2C+msg.Size%2C+ProtocolMaxMsgSize%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3B%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%26nbsp%3B%26nbsp%3B%26nbsp%3B%26nbsp%3Bdefer+msg.Discard%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E5%9C%A8%E8%BF%99%E8%BE%B9%E8%AF%BB%E5%8F%96%E7%BD%91%E7%BB%9C%E5%86%99%E5%85%A5%E6%9D%A5%E7%9A%84%E6%B6%88%E6%81%AF%2C%E7%84%B6%E5%90%8E%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C%E7%9A%84%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60msgCode%60%3C%2Fspan%3E%E4%BD%9C%E4%B8%8D%E5%90%8C%E7%9A%84%E5%A4%84%E7%90%86%2C%E7%94%B1%E4%BA%8E%0A+++++%3Cspan+style%3D%22color%3A%23ce9178%3B%22%3E%60handleMsg%60%3C%2Fspan%3E%E6%98%AF%E5%9C%A8%E4%B8%80%E4%B8%AA%E6%AD%BB%E5%BE%AA%E7%8E%AF%E4%B8%AD%E8%B0%83%E7%94%A8%E7%9A%84%2C%E6%89%80%E4%BB%A5%E5%B0%B1%E8%83%BD%E4%B8%80%E7%9B%B4%E6%8E%A5%E6%94%B6%E5%88%B0%E8%8A%82%E7%82%B9%E5%B9%BF%E6%92%AD%E8%BF%87%E6%9D%A5%E7%9A%84%E6%B6%88%E6%81%AF%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%2F%2Feth%2Fhandler.go%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++func+%28pm+*ProtocolManager%29+handle%28p+*peer%29+error+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++td%2C+head%2C+genesis+%3A%3D+pm.blockchain.Status%28%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++p.Handshake%28pm.networkId%2C+td%2C+head%2C+genesis%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A++++++if+rw%2C+ok+%3A%3D+p.rw.%28*meteredMsgReadWriter%29%3B+ok+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++rm.Init%28p.version%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A++++++pm.peers.Register%28p%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++defer+pm.removePeer%28p.id%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A++++++pm.downloader.RegisterPeer%28p.id%2C+p.version%2C+p%29%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A++++++pm.syncTransactions%28p%29%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++...%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++for+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++if+err+%3A%3D+pm.handleMsg%28p%29%3B+err+%21%3D+nil+%7B%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++return+err%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A++++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%7D%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++%60%60%60%0A++++%3C%2Fdiv%3E%0A++++%3Cbr%3E%0A++++%3Cdiv%3E%0A+++++handle%28%29%E5%87%BD%E6%95%B0%E9%92%88%E5%AF%B9%E4%B8%80%E4%B8%AA%E6%96%B0peer%E5%81%9A%E4%BA%86%E5%A6%82%E4%B8%8B%E5%87%A0%E4%BB%B6%E4%BA%8B%EF%BC%9A%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E6%8F%A1%E6%89%8B%EF%BC%8C%E4%B8%8E%E5%AF%B9%E6%96%B9peer%E6%B2%9F%E9%80%9A%E5%B7%B1%E6%96%B9%E7%9A%84%E5%8C%BA%E5%9D%97%E9%93%BE%E7%8A%B6%E6%80%81%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%80%E4%B8%AA%E8%AF%BB%E5%86%99%E9%80%9A%E9%81%93%EF%BC%8C%E7%94%A8%E4%BB%A5%E8%B7%9F%E5%AF%B9%E6%96%B9peer%E7%9B%B8%E4%BA%92%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E6%B3%A8%E5%86%8C%E5%AF%B9%E6%96%B9peer%EF%BC%8C%E5%AD%98%E5%85%A5%E5%B7%B1%E6%96%B9peer%E5%88%97%E8%A1%A8%EF%BC%9B%E5%8F%AA%E6%9C%89handle%28%29%E5%87%BD%E6%95%B0%E9%80%80%E5%87%BA%E6%97%B6%EF%BC%8C%E6%89%8D%E4%BC%9A%E5%B0%86%E8%BF%99%E4%B8%AApeer%E7%A7%BB%E9%99%A4%E5%87%BA%E5%88%97%E8%A1%A8%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++Downloader%E6%88%90%E5%91%98%E6%B3%A8%E5%86%8C%E8%BF%99%E4%B8%AA%E6%96%B0peer%EF%BC%9BDownloader%E4%BC%9A%E8%87%AA%E5%B7%B1%E7%BB%B4%E6%8A%A4%E4%B8%80%E4%B8%AA%E7%9B%B8%E9%82%BBpeer%E5%88%97%E8%A1%A8%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E8%B0%83%E7%94%A8syncTransactions%28%29%EF%BC%8C%E7%94%A8%E5%BD%93%E5%89%8Dtxpool%E4%B8%AD%E6%96%B0%E7%B4%AF%E8%AE%A1%E7%9A%84tx%E5%AF%B9%E8%B1%A1%E7%BB%84%E8%A3%85%E6%88%90%E4%B8%80%E4%B8%AAtxsync%7B%7D%E5%AF%B9%E8%B1%A1%EF%BC%8C%E6%8E%A8%E9%80%81%E5%88%B0%E5%86%85%E9%83%A8%E9%80%9A%E9%81%93txsyncCh%E3%80%82%E8%BF%98%E8%AE%B0%E5%BE%97Start%28%29%E5%90%AF%E5%8A%A8%E7%9A%84%E5%9B%9B%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B9%88%3F%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E5%85%B6%E4%B8%AD%E7%AC%AC%E5%9B%9B%E9%A1%B9txsyncLoop%28%29%E4%B8%AD%E7%94%A8%E4%BB%A5%E7%AD%89%E5%BE%85txsync%7B%7D%E6%95%B0%E6%8D%AE%E7%9A%84%E9%80%9A%E9%81%93txsyncCh%EF%BC%8C%E6%AD%A3%E6%98%AF%E5%9C%A8%E8%BF%99%E9%87%8C%E8%A2%AB%E6%8E%A8%E5%85%A5txsync%7B%7D%E7%9A%84%E3%80%82%0A++++%3C%2Fdiv%3E%0A++++%3Cdiv%3E%0A+++++%E5%9C%A8%E6%97%A0%E9%99%90%E5%BE%AA%E7%8E%AF%E4%B8%AD%E5%90%AF%E5%8A%A8handleMsg%28%29%EF%BC%8C%E5%BD%93%E5%AF%B9%E6%96%B9peer%E5%8F%91%E5%87%BA%E4%BB%BB%E4%BD%95msg%E6%97%B6%EF%BC%8ChandleMsg%28%29%E5%8F%AF%E4%BB%A5%E6%8D%95%E6%8D%89%E7%9B%B8%E5%BA%94%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%B6%88%E6%81%AF%E5%B9%B6%E5%9C%A8%E5%B7%B1%E6%96%B9%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86%E3%80%82%0A++++%3C%2Fdiv%3E%0A+++%3C%2Fdiv%3E%0A+++%3Cbr%3E%0A++%3C%2Fdiv%3E%0A++%3Cdiv+style%3D%22color%3Argb%28212%2C212%2C212%29%3Bbackground-color%3Argb%2830%2C30%2C30%29%3Bfont-family%3AConsolas%2C+%27Courier+New%27%2C+monospace%3Bfont-size%3A14px%3Bline-height%3A19px%3Bwhite-space%3Apre%3B%22%3E%0A+++%3Cbr%3E%0A++%3C%2Fdiv%3E%0A++%3Cp%3E%3C%2Fp%3E%0A++%3Cp%3E%3Cbr%3E%3Cbr%3E%3C%2Fp%3E%0A++%3Ch2%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180430224554793%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22+alt%3D%22%22%3E%3Cbr%3E%3Cbr%3E%3C%2Fh2%3E%0A++%3Cp+style%3D%22color%3Argb%2825%2C25%2C25%29%3B%22%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180425001235188%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22+alt%3D%22%22%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180425001144107%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22+alt%3D%22%22%3E%3Cbr%3E%3C%2Fp%3E%0A++%3Cp+style%3D%22color%3Argb%2825%2C25%2C25%29%3B%22%3E%E7%BD%91%E5%9D%80%EF%BC%9Ahttp%3A%2F%2Fwww.qukuailianxueyuan.io%2F%3Cbr%3E%3C%2Fp%3E%0A++%3Cp+style%3D%22color%3Argb%2825%2C25%2C25%29%3B%22%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180426145827720%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22+alt%3D%22%22%3E%3Cbr%3E%3C%2Fp%3E%0A++%3Cp+style%3D%22color%3Argb%2825%2C25%2C25%29%3B%22%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F2018042614570887%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22+alt%3D%22%22%3E%3Cbr%3E%3C%2Fp%3E%0A++%3Cp+style%3D%22color%3Argb%2825%2C25%2C25%29%3B%22%3E%E6%AC%B2%E9%A2%86%E5%8F%96%E9%80%A0%E5%B8%81%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%85%A8%E5%A5%97%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%B5%84%E6%96%99%3C%2Fp%3E%0A++%3Cp%3E%3Cspan+style%3D%22color%3Argb%2825%2C25%2C25%29%3B%22%3E%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%BA%A4%E6%B5%81QQ%E7%BE%A4%EF%BC%9A%3C%2Fspan%3E%3Cspan+style%3D%22color%3Argb%28255%2C0%2C0%29%3Bbackground-color%3Argb%28255%2C255%2C255%29%3B%22%3E756146052%26nbsp%3B%26nbsp%3B%3C%2Fspan%3E%3Cspan+style%3D%22color%3Argb%2825%2C25%2C25%29%3B%22%3E%E5%A4%87%E6%B3%A8%EF%BC%9ACSDN%3C%2Fspan%3E%3C%2Fp%3E%0A++%3Cp+style%3D%22color%3Argb%2825%2C25%2C25%29%3B%22%3E%E5%B0%B9%E6%88%90%E5%AD%A6%E9%99%A2%E5%BE%AE%E4%BF%A1%EF%BC%9A%E5%A4%87%E6%B3%A8%EF%BC%9ACSDN%3C%2Fp%3E%0A++%3Cp+style%3D%22color%3Argb%2825%2C25%2C25%29%3Btext-align%3Acenter%3B%22%3E%3Cimg+src%3D%22https%3A%2F%2Fblog.uzzz.org%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdn.net%2F20180425000635656%3Fwatermark%2F2%2Ftext%2FaHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmNoZW5nMDE%3D%2Ffont%2F5a6L5L2T%2Ffontsize%2F400%2Ffill%2FI0JBQkFCMA%3D%3D%2Fdissolve%2F70%22+alt%3D%22%22%3E%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn+btn-red-hollow%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fitcastcpp%2Farticle%2Fdetails%2F80304343%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fitcastcpp%2Farticle%2Fdetails%2F80304343%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}
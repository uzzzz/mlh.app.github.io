---
layout: default
title: 深度学习入门 中根据源代码下载到mnist数据集,训练识别率超级低问题
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Cdiv+class%3D%22article-copyright%22%3E%0A+++%E7%89%88%E6%9D%83%E5%A3%B0%E6%98%8E%EF%BC%9A%E6%9C%AC%E6%96%87%E4%B8%BA%E5%8D%9A%E4%B8%BB%E5%8E%9F%E5%88%9B%E6%96%87%E7%AB%A0%EF%BC%8C%E6%9C%AA%E7%BB%8F%E5%8D%9A%E4%B8%BB%E5%85%81%E8%AE%B8%E4%B8%8D%E5%BE%97%E8%BD%AC%E8%BD%BD%E3%80%82+https%3A%2F%2Fblog.csdn.net%2FMHeartWGO%2Farticle%2Fdetails%2F87867533+%0A+%3C%2Fdiv%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-f57960eb32.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22+id%3D%22content_views%22%3E+%0A++%3Cp%3E%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8+%E4%B8%AD%E6%A0%B9%E6%8D%AE%E6%BA%90%E4%BB%A3%E7%A0%81%E4%B8%8B%E8%BD%BD%E5%88%B0mnist%E6%95%B0%E6%8D%AE%E9%9B%86%2C%E8%AE%AD%E7%BB%83%E8%AF%86%E5%88%AB%E7%8E%87%E8%B6%85%E7%BA%A7%E4%BD%8E%E9%97%AE%E9%A2%98%3C%2Fp%3E+%0A++%3Cp+style%3D%22text-align%3Acenter%3B%22%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+height%3D%22285%22+src%3D%22https%3A%2F%2Fblog.uzzz.org.cn%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdnimg.cn%2F20190221195910510.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01IZWFydFdHTw%3D%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70%22+width%3D%22669%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E4%B8%8A%E5%9B%BE%E6%98%AF%E6%B2%A1%E6%9C%89%E6%8B%B7%E8%B4%9D%E5%8E%9F%E6%96%87%E4%BB%B6mnist.pkl%E7%9A%84%E8%AE%AD%E7%BB%83%E7%BB%93%E6%9E%9C%3C%2Fp%3E+%0A++%3Cp+style%3D%22text-align%3Acenter%3B%22%3E%3Cimg+alt%3D%22%22+class%3D%22has%22+height%3D%22285%22+src%3D%22https%3A%2F%2Fblog.uzzz.org.cn%2F_p%3Fhttps%3A%2F%2Fimg-blog.csdnimg.cn%2F20190221200153174.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01IZWFydFdHTw%3D%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70%22+width%3D%22669%22%3E%3C%2Fp%3E+%0A++%3Cp%3E%E4%B8%8A%E5%9B%BE%E6%98%AF%E6%8B%B7%E8%B4%9D%E5%8E%9F%E6%96%87%E4%BB%B6mnist.pkl%E7%9A%84%E8%AE%AD%E7%BB%83%E7%BB%93%E6%9E%9C%3C%2Fp%3E+%0A++%3Cp%3E%E7%8E%B0%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98%E6%98%AF%EF%BC%8C%E7%9B%B8%E5%90%8C%E7%9A%84%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%BE%97%E8%A6%81%E7%9A%84%E8%AF%86%E5%88%AB%E7%B2%BE%E5%BA%A6%E5%B7%AE%E8%B7%9D%E8%BE%83%E5%A4%A7%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E6%83%B3%E5%8F%AF%E8%83%BD%E5%8E%9F%E6%96%87%E4%BB%B6mnist.py%E5%9C%A8%E8%AE%AD%E7%BB%83%E7%9A%84%E6%97%B6%E5%80%99%E8%BF%98%E9%87%87%E5%8F%96%E4%BA%86%E5%85%B6%E4%BB%96%E5%8A%9E%E6%B3%95%E6%9D%A5%E6%8F%90%E9%AB%98%E8%AF%86%E5%88%AB%E7%B2%BE%E5%BA%A6%E3%80%82%E6%81%A9%EF%BC%8C%E6%88%91%E6%9A%82%E6%97%B6%E4%B8%8D%E4%BC%9A%EF%BC%8C%E6%89%80%E4%BB%A5%E5%90%8E%E9%9D%A2%E4%BC%9A%E5%B0%9D%E8%AF%95%E7%9D%80%E8%83%BD%E4%B8%8D%E8%83%BD%E8%A7%A3%E5%86%B3%E4%BA%86%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%E4%B8%8B%E9%9D%A2%E9%99%84%E4%B8%8Amnist.py%E6%96%87%E4%BB%B6%E5%92%8Cmnist_show%E6%96%87%E4%BB%B6%EF%BC%8C%E5%B8%8C%E6%9C%9B%E5%A4%A7%E5%AE%B6%E5%8F%AF%E4%BB%A5%E5%B8%AE%E5%BF%99%E7%9C%8B%E4%B8%80%E4%B8%8B%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3Emnist.py%E6%96%87%E4%BB%B6%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-python%22%3E%23+coding%3A+utf-8%0Atry%3A%0A++++import+urllib.request%0Aexcept+ImportError%3A%0A++++raise+ImportError%28%27You+should+use+Python+3.x%27%29%0Aimport+os.path%0Aimport+gzip%0Aimport+pickle%0Aimport+os%0Aimport+numpy+as+np%0A%0A%0Aurl_base+%3D+%27http%3A%2F%2Fyann.lecun.com%2Fexdb%2Fmnist%2F%27%0Akey_file+%3D+%7B%0A++++%27train_img%27%3A%27train-images-idx3-ubyte.gz%27%2C%0A++++%27train_label%27%3A%27train-labels-idx1-ubyte.gz%27%2C%0A++++%27test_img%27%3A%27t10k-images-idx3-ubyte.gz%27%2C%0A++++%27test_label%27%3A%27t10k-labels-idx1-ubyte.gz%27%0A%7D%0A%0Adataset_dir+%3D+os.path.dirname%28os.path.abspath%28__file__%29%29%23%E5%BE%97%E5%88%B0%E5%BD%93%E5%89%8D%E6%96%87%E4%BB%B6%E6%89%80%E5%9C%A8%E6%96%87%E4%BB%B6%E5%A4%B9%0Asave_file+%3D+dataset_dir+%2B+%22%2Fmnist.pkl%22+%23%E5%9C%A8%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%E4%BF%9D%E5%AD%98%E4%B8%80%E4%B8%AAmnist.pkl%E6%96%87%E4%BB%B6%0A%0Atrain_num+%3D+60000%0Atest_num+%3D+10000%0Aimg_dim+%3D+%281%2C+28%2C+28%29%0Aimg_size+%3D+784%0A%0A%0Adef+_download%28file_name%29%3A+++++%23%E4%B8%8B%E8%BD%BD%E8%AE%AD%E7%BB%83%E9%9B%86%E5%8C%85%E6%89%80%E9%9C%80%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0%0A++++file_path+%3D+dataset_dir+%2B+%22%2F%22+%2B+file_name%0A++++%0A++++if+os.path.exists%28file_path%29%3A%0A++++++++return%0A%0A++++print%28%22Downloading+%22+%2B+file_name+%2B+%22+...+%22%29%0A++++urllib.request.urlretrieve%28url_base+%2B+file_name%2C+file_path%29%0A++++print%28%22Done%22%29%0A++++%0Adef+download_mnist%28%29%3A%23%E4%B8%8B%E8%BD%BDmnist%E6%96%87%E4%BB%B6%0A++++for+v+in+key_file.values%28%29%3A%0A+++++++_download%28v%29%0A++++++++%0Adef+_load_label%28file_name%29%3A%23%E6%8A%8Alabel.gz%E6%96%87%E4%BB%B6%E8%BD%AC%E6%8D%A2%E4%B8%BAnumpy%E6%95%B0%E7%BB%84%0A++++file_path+%3D+dataset_dir+%2B+%22%2F%22+%2B+file_name%0A++++%0A++++print%28%22Converting+%22+%2B+file_name+%2B+%22+to+NumPy+Array+...%22%29%0A++++with+gzip.open%28file_path%2C+%27rb%27%29+as+f%3A%0A++++++++++++labels+%3D+np.frombuffer%28f.read%28%29%2C+np.uint8%2C+offset%3D24%29%0A++++print%28%22Done%22%29%0A++++%0A++++return+labels%0A%0Adef+_load_img%28file_name%29%3A+%23%E6%8A%8Aimage.gz%E6%96%87%E4%BB%B6%E8%BD%AC%E6%8D%A2%E4%B8%BAnumpy%E6%95%B0%E7%BB%84%0A++++file_path+%3D+dataset_dir+%2B+%22%2F%22+%2B+file_name%0A++++%0A++++print%28%22Converting+%22+%2B+file_name+%2B+%22+to+NumPy+Array+...%22%29++++%0A++++with+gzip.open%28file_path%2C+%27rb%27%29+as+f%3A%0A++++++++++++data+%3D+np.frombuffer%28f.read%28%29%2C+np.uint8%2C+offset%3D16%29%0A++++data+%3D+data.reshape%28-1%2C+img_size%29%0A++++print%28%22Done%22%29%0A++++%0A++++return+data%0A++++%0Adef+_convert_numpy%28%29%3A+%23%E5%B0%86%E6%95%B0%E7%BB%84%E4%BF%9D%E5%AD%98%E5%9C%A8dataset%E6%95%B0%E7%BB%84%E4%B8%AD%0A++++dataset+%3D+%7B%7D%0A++++dataset%5B%27train_img%27%5D+%3D++_load_img%28key_file%5B%27train_img%27%5D%29%0A++++dataset%5B%27train_label%27%5D+%3D+_load_label%28key_file%5B%27train_label%27%5D%29++++%0A++++dataset%5B%27test_img%27%5D+%3D+_load_img%28key_file%5B%27test_img%27%5D%29%0A++++dataset%5B%27test_label%27%5D+%3D+_load_label%28key_file%5B%27test_label%27%5D%29%0A++++%0A++++return+dataset%0A%0Adef+init_mnist%28%29%3A%0A++++download_mnist%28%29%0A++++dataset+%3D+_convert_numpy%28%29%0A++++print%28%22Creating+pickle+file+...%22%29%0A++++with+open%28save_file%2C+%27wb%27%29+as+f%3A%0A++++++++pickle.dump%28dataset%2C+f%2C+-1%29%0A++++print%28%22Done%21%22%29%0A%0Adef+_change_one_hot_label%28X%29%3A%0A++++T+%3D+np.zeros%28%28X.size%2C+10%29%29%0A++++for+idx%2C+row+in+enumerate%28T%29%3A%0A++++++++row%5BX%5Bidx%5D%5D+%3D+1%0A++++++++%0A++++return+T%0A++++%0A%0Adef+load_mnist%28normalize%3DTrue%2C+flatten%3DTrue%2C+one_hot_label%3DFalse%29%3A%0A++++%22%22%22%E8%AF%BB%E5%85%A5MNIST%E6%95%B0%E6%8D%AE%E9%9B%86%0A++++%0A++++Parameters%0A++++----------%0A++++normalize+%3A+%E5%B0%86%E5%9B%BE%E5%83%8F%E7%9A%84%E5%83%8F%E7%B4%A0%E5%80%BC%E6%AD%A3%E8%A7%84%E5%8C%96%E4%B8%BA0.0%7E1.0%0A++++one_hot_label+%3A+%0A++++++++one_hot_label%E4%B8%BATrue%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E6%A0%87%E7%AD%BE%E4%BD%9C%E4%B8%BAone-hot%E6%95%B0%E7%BB%84%E8%BF%94%E5%9B%9E%0A++++++++one-hot%E6%95%B0%E7%BB%84%E6%98%AF%E6%8C%87%5B0%2C0%2C1%2C0%2C0%2C0%2C0%2C0%2C0%2C0%5D%E8%BF%99%E6%A0%B7%E7%9A%84%E6%95%B0%E7%BB%84%0A++++flatten+%3A+%E6%98%AF%E5%90%A6%E5%B0%86%E5%9B%BE%E5%83%8F%E5%B1%95%E5%BC%80%E4%B8%BA%E4%B8%80%E7%BB%B4%E6%95%B0%E7%BB%84%0A++++%0A++++Returns%0A++++-------%0A++++%28%E8%AE%AD%E7%BB%83%E5%9B%BE%E5%83%8F%2C+%E8%AE%AD%E7%BB%83%E6%A0%87%E7%AD%BE%29%2C+%28%E6%B5%8B%E8%AF%95%E5%9B%BE%E5%83%8F%2C+%E6%B5%8B%E8%AF%95%E6%A0%87%E7%AD%BE%29%0A++++%22%22%22%0A++++if+not+os.path.exists%28save_file%29%3A%0A++++++++init_mnist%28%29%0A++++++++%0A++++with+open%28save_file%2C+%27rb%27%29+as+f%3A%0A++++++++dataset+%3D+pickle.load%28f%29%0A++++%0A++++if+normalize%3A%0A++++++++for+key+in+%28%27train_img%27%2C+%27test_img%27%29%3A%0A++++++++++++dataset%5Bkey%5D+%3D+dataset%5Bkey%5D.astype%28np.float32%29%0A++++++++++++dataset%5Bkey%5D+%2F%3D+255.0%0A++++++++++++%0A++++if+one_hot_label%3A%0A++++++++dataset%5B%27train_label%27%5D+%3D+_change_one_hot_label%28dataset%5B%27train_label%27%5D%29%0A++++++++dataset%5B%27test_label%27%5D+%3D+_change_one_hot_label%28dataset%5B%27test_label%27%5D%29%0A++++%0A++++if+not+flatten%3A%0A+++++++++for+key+in+%28%27train_img%27%2C+%27test_img%27%29%3A%0A++++++++++++dataset%5Bkey%5D+%3D+dataset%5Bkey%5D.reshape%28-1%2C+1%2C+28%2C+28%29%0A%0A++++return+%28dataset%5B%27train_img%27%5D%2C+dataset%5B%27train_label%27%5D%29%2C+%28dataset%5B%27test_img%27%5D%2C+dataset%5B%27test_label%27%5D%29+%0A%0A%0Aif+__name__+%3D%3D+%27__main__%27%3A%0A++++init_mnist%28%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3Emnist_show.py%E6%96%87%E4%BB%B6%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-python%22%3Eimport+sys%2C+os%0Asys.path.append%28os.pardir%29%0Aimport+numpy+as+np+%0Afrom+dataest.mnist+import+load_mnist%0Afrom+PIL+import+Image%0A%0Adef+img_show%28img%29%3A%0A%09pil_img+%3D+Image.fromarray%28np.uint8%28img%29%29%0A%09pil_img+.show%28%29%0A%0A%28x_train%2Ct_train%29%2C%28x_test%2Ct_test%29+%3D+load_mnist%28flatten%3DTrue%2Cnormalize%3DFalse%29%0Aimg+%3D+x_train%5B0%5D%0Alabel+%3D+t_train%5B0%5D%0Aprint%28label%29%0A%0Aprint%28img.shape%29%0Aimg+%3D+img.reshape%2828%2C28%29%0Aprint%28img.shape%29%0A%0Aimg_show%28img%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E" | url_decode}}
---
layout: default
title: 依赖openssl的bn.h实现的BigNumber类
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-e2445db1a8.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22%3E+%0A++%3Cp%3E%E6%9C%80%E8%BF%91%E5%9C%A8%E7%9C%8Bmangos%E7%9A%84%E6%BA%90%E7%A0%81%EF%BC%8C%E5%8F%91%E7%8E%B0%E4%BA%86%E4%B8%80%E4%B8%AABigNumber%E7%B1%BB%E7%9A%84%E5%B0%81%E8%A3%85%EF%BC%8C%E5%9C%A8%E6%AD%A4%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8B%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E%3C%2Fp%3E+%0A++%3Ch1%3EBigNumber.h%E6%96%87%E4%BB%B6%3C%2Fh1%3E+%0A++%3Cp%3E%E5%85%B6%E4%B8%ADcommon.h%E6%96%87%E4%BB%B6%E6%9C%80%E5%88%9D%E5%AE%9A%E4%B9%89%E4%BA%86uint32%E8%BF%99%E4%BA%9B%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%8E%BB%E6%8E%89%E8%87%AA%E5%B7%B1%E5%AE%9A%E4%B9%89%E4%B9%9F%E6%97%A0%E5%A6%A8%3A%3C%2Fp%3E+%0A++%3Cp%3E%3C%2Fp%3E%0A++%3Cpre%3E%3Ccode+class%3D%22language-cpp%22%3E%23ifndef+_AUTH_BIGNUMBER_H%0A%23define+_AUTH_BIGNUMBER_H%0A%0A%23include+%22Common.h%22%0A%0Astruct+bignum_st%3B%0A%0Aclass+BigNumber%0A%7B%0A++++public%3A%0A++++++++BigNumber%28%29%3B%0A++++++++BigNumber%28const+BigNumber%26amp%3B+bn%29%3B%0A++++++++BigNumber%28uint32%29%3B%0A++++++++%7EBigNumber%28%29%3B%0A%0A++++++++void+SetDword%28uint32%29%3B%0A++++++++void+SetQword%28uint64%29%3B%0A++++++++void+SetBinary%28const+uint8*+bytes%2C+int+len%29%3B%0A++++++++void+SetHexStr%28const+char*+str%29%3B%0A%0A++++++++void+SetRand%28int+numbits%29%3B%0A%0A++++++++BigNumber+operator%3D%28const+BigNumber%26amp%3B+bn%29%3B%0A%0A++++++++BigNumber+operator%2B%3D%28const+BigNumber%26amp%3B+bn%29%3B%0A++++++++BigNumber+operator%2B%28const+BigNumber%26amp%3B+bn%29%0A++++++++%7B%0A++++++++++++BigNumber+t%28*this%29%3B%0A++++++++++++return+t+%2B%3D+bn%3B%0A++++++++%7D%0A++++++++BigNumber+operator-%3D%28const+BigNumber%26amp%3B+bn%29%3B%0A++++++++BigNumber+operator-%28const+BigNumber%26amp%3B+bn%29%0A++++++++%7B%0A++++++++++++BigNumber+t%28*this%29%3B%0A++++++++++++return+t+-%3D+bn%3B%0A++++++++%7D%0A++++++++BigNumber+operator*%3D%28const+BigNumber%26amp%3B+bn%29%3B%0A++++++++BigNumber+operator*%28const+BigNumber%26amp%3B+bn%29%0A++++++++%7B%0A++++++++++++BigNumber+t%28*this%29%3B%0A++++++++++++return+t+*%3D+bn%3B%0A++++++++%7D%0A++++++++BigNumber+operator%2F%3D%28const+BigNumber%26amp%3B+bn%29%3B%0A++++++++BigNumber+operator%2F%28const+BigNumber%26amp%3B+bn%29%0A++++++++%7B%0A++++++++++++BigNumber+t%28*this%29%3B%0A++++++++++++return+t+%2F%3D+bn%3B%0A++++++++%7D%0A++++++++BigNumber+operator%25%3D%28const+BigNumber%26amp%3B+bn%29%3B%0A++++++++BigNumber+operator%25%28const+BigNumber%26amp%3B+bn%29%0A++++++++%7B%0A++++++++++++BigNumber+t%28*this%29%3B%0A++++++++++++return+t+%25%3D+bn%3B%0A++++++++%7D%0A%0A++++++++bool+isZero%28%29+const%3B%0A%0A++++++++BigNumber+ModExp%28const+BigNumber%26amp%3B+bn1%2C+const+BigNumber%26amp%3B+bn2%29%3B%0A++++++++BigNumber+Exp%28const+BigNumber%26amp%3B%29%3B%0A%0A++++++++int+GetNumBytes%28void%29%3B%0A%0A++++++++struct+bignum_st*+BN%28%29+%7B+return+_bn%3B+%7D%0A%0A++++++++uint32+AsDword%28%29%3B%0A++++++++uint8*+AsByteArray%28int+minSize+%3D+0%2C+bool+reverse+%3D+true%29%3B%0A%0A++++++++const+char*+AsHexStr%28%29%3B%0A++++++++const+char*+AsDecStr%28%29%3B%0A%0A++++private%3A%0A++++++++struct+bignum_st*+_bn%3B%0A++++++++uint8*+_array%3B%0A%7D%3B%0A%23endif%3C%2Fcode%3E%3C%2Fpre%3E%0A++%3Cbr%3E%0A++%3Cbr%3E%0A++%3Ch1%3EBigNumber.cpp%3C%2Fh1%3E+%0A++%3Cdiv%3E%0A+++%E6%AD%A4%E6%96%87%E4%BB%B6%E4%BE%9D%E8%B5%96%E4%BA%86openssl%E7%9A%84bn.h%E6%96%87%E4%BB%B6%EF%BC%8C%E5%A6%82%E4%B8%8B%EF%BC%9A%0A++%3C%2Fdiv%3E+%0A++%3Cdiv%3E%0A+++%3Cbr%3E%0A++%3C%2Fdiv%3E+%0A++%3Cp%3E%3C%2Fp%3E%0A++%3Cpre%3E%3Ccode+class%3D%22language-cpp%22%3E%23include+%22Auth%2FBigNumber.h%22%0A%23include+%26lt%3Bopenssl%2Fbn.h%26gt%3B%0A%23include+%26lt%3Balgorithm%26gt%3B%0A%0ABigNumber%3A%3ABigNumber%28%29%0A%7B%0A++++_bn+%3D+BN_new%28%29%3B%0A++++_array+%3D+NULL%3B%0A%7D%0A%0ABigNumber%3A%3ABigNumber%28const+BigNumber%26amp%3B+bn%29%0A%7B%0A++++_bn+%3D+BN_dup%28bn._bn%29%3B%0A++++_array+%3D+NULL%3B%0A%7D%0A%0ABigNumber%3A%3ABigNumber%28uint32+val%29%0A%7B%0A++++_bn+%3D+BN_new%28%29%3B%0A++++BN_set_word%28_bn%2C+val%29%3B%0A++++_array+%3D+NULL%3B%0A%7D%0A%0ABigNumber%3A%3A%7EBigNumber%28%29%0A%7B%0A++++BN_free%28_bn%29%3B%0A++++if+%28_array%29+delete%5B%5D+_array%3B%0A%7D%0A%0Avoid+BigNumber%3A%3ASetDword%28uint32+val%29%0A%7B%0A++++BN_set_word%28_bn%2C+val%29%3B%0A%7D%0A%0Avoid+BigNumber%3A%3ASetQword%28uint64+val%29%0A%7B%0A++++BN_add_word%28_bn%2C+%28uint32%29%28val+%26gt%3B%26gt%3B+32%29%29%3B%0A++++BN_lshift%28_bn%2C+_bn%2C+32%29%3B%0A++++BN_add_word%28_bn%2C+%28uint32%29%28val+%26amp%3B+0xFFFFFFFF%29%29%3B%0A%7D%0A%0Avoid+BigNumber%3A%3ASetBinary%28const+uint8*+bytes%2C+int+len%29%0A%7B%0A++++uint8+t%5B1000%5D%3B%0A++++for+%28int+i+%3D+0%3B+i+%26lt%3B+len%3B+%2B%2Bi%29%0A++++++++t%5Bi%5D+%3D+bytes%5Blen+-+1+-+i%5D%3B%0A++++BN_bin2bn%28t%2C+len%2C+_bn%29%3B%0A%7D%0A%0Avoid+BigNumber%3A%3ASetHexStr%28const+char*+str%29%0A%7B%0A++++BN_hex2bn%28%26amp%3B_bn%2C+str%29%3B%0A%7D%0A%0Avoid+BigNumber%3A%3ASetRand%28int+numbits%29%0A%7B%0A++++BN_rand%28_bn%2C+numbits%2C+0%2C+1%29%3B%0A%7D%0A%0ABigNumber+BigNumber%3A%3Aoperator%3D%28const+BigNumber%26amp%3B+bn%29%0A%7B%0A++++BN_copy%28_bn%2C+bn._bn%29%3B%0A++++return+*this%3B%0A%7D%0A%0ABigNumber+BigNumber%3A%3Aoperator%2B%3D%28const+BigNumber%26amp%3B+bn%29%0A%7B%0A++++BN_add%28_bn%2C+_bn%2C+bn._bn%29%3B%0A++++return+*this%3B%0A%7D%0A%0ABigNumber+BigNumber%3A%3Aoperator-%3D%28const+BigNumber%26amp%3B+bn%29%0A%7B%0A++++BN_sub%28_bn%2C+_bn%2C+bn._bn%29%3B%0A++++return+*this%3B%0A%7D%0A%0ABigNumber+BigNumber%3A%3Aoperator*%3D%28const+BigNumber%26amp%3B+bn%29%0A%7B%0A++++BN_CTX*+bnctx%3B%0A%0A++++bnctx+%3D+BN_CTX_new%28%29%3B%0A++++BN_mul%28_bn%2C+_bn%2C+bn._bn%2C+bnctx%29%3B%0A++++BN_CTX_free%28bnctx%29%3B%0A%0A++++return+*this%3B%0A%7D%0A%0ABigNumber+BigNumber%3A%3Aoperator%2F%3D%28const+BigNumber%26amp%3B+bn%29%0A%7B%0A++++BN_CTX*+bnctx%3B%0A%0A++++bnctx+%3D+BN_CTX_new%28%29%3B%0A++++BN_div%28_bn%2C+NULL%2C+_bn%2C+bn._bn%2C+bnctx%29%3B%0A++++BN_CTX_free%28bnctx%29%3B%0A%0A++++return+*this%3B%0A%7D%0A%0ABigNumber+BigNumber%3A%3Aoperator%25%3D%28const+BigNumber%26amp%3B+bn%29%0A%7B%0A++++BN_CTX*+bnctx%3B%0A%0A++++bnctx+%3D+BN_CTX_new%28%29%3B%0A++++BN_mod%28_bn%2C+_bn%2C+bn._bn%2C+bnctx%29%3B%0A++++BN_CTX_free%28bnctx%29%3B%0A%0A++++return+*this%3B%0A%7D%0A%0ABigNumber+BigNumber%3A%3AExp%28const+BigNumber%26amp%3B+bn%29%0A%7B%0A++++BigNumber+ret%3B%0A++++BN_CTX*+bnctx%3B%0A%0A++++bnctx+%3D+BN_CTX_new%28%29%3B%0A++++BN_exp%28ret._bn%2C+_bn%2C+bn._bn%2C+bnctx%29%3B%0A++++BN_CTX_free%28bnctx%29%3B%0A%0A++++return+ret%3B%0A%7D%0A%0ABigNumber+BigNumber%3A%3AModExp%28const+BigNumber%26amp%3B+bn1%2C+const+BigNumber%26amp%3B+bn2%29%0A%7B%0A++++BigNumber+ret%3B%0A++++BN_CTX*+bnctx%3B%0A%0A++++bnctx+%3D+BN_CTX_new%28%29%3B%0A++++BN_mod_exp%28ret._bn%2C+_bn%2C+bn1._bn%2C+bn2._bn%2C+bnctx%29%3B%0A++++BN_CTX_free%28bnctx%29%3B%0A%0A++++return+ret%3B%0A%7D%0A%0Aint+BigNumber%3A%3AGetNumBytes%28void%29%0A%7B%0A++++return+BN_num_bytes%28_bn%29%3B%0A%7D%0A%0Auint32+BigNumber%3A%3AAsDword%28%29%0A%7B%0A++++return+%28uint32%29BN_get_word%28_bn%29%3B%0A%7D%0A%0Abool+BigNumber%3A%3AisZero%28%29+const%0A%7B%0A++++return+BN_is_zero%28_bn%29+%21%3D+0%3B%0A%7D%0A%0Auint8*+BigNumber%3A%3AAsByteArray%28int+minSize%2C+bool+reverse%29%0A%7B%0A++++int+length+%3D+%28minSize+%26gt%3B%3D+GetNumBytes%28%29%29+%3F+minSize+%3A+GetNumBytes%28%29%3B%0A%0A++++delete%5B%5D+_array%3B%0A++++_array+%3D+new+uint8%5Blength%5D%3B%0A%0A++++%2F%2F+If+we+need+more+bytes+than+length+of+BigNumber+set+the+rest+to+0%0A++++if+%28length+%26gt%3B+GetNumBytes%28%29%29%0A++++++++memset%28%28void*%29_array%2C+0%2C+length%29%3B%0A%0A++++BN_bn2bin%28_bn%2C+%28unsigned+char*%29_array%29%3B%0A%0A++++if+%28reverse%29%0A++++++++std%3A%3Areverse%28_array%2C+_array+%2B+length%29%3B%0A%0A++++return+_array%3B%0A%7D%0A%0Aconst+char*+BigNumber%3A%3AAsHexStr%28%29%0A%7B%0A++++return+BN_bn2hex%28_bn%29%3B%0A%7D%0A%0Aconst+char*+BigNumber%3A%3AAsDecStr%28%29%0A%7B%0A++++return+BN_bn2dec%28_bn%29%3B%0A%7D%0A%3C%2Fcode%3E%3C%2Fpre%3E%0A++%3Cbr%3E%0A++%3Cbr%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn+btn-red-hollow%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fzzhongcy%2Farticle%2Fdetails%2F43019563%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fzzhongcy%2Farticle%2Fdetails%2F43019563%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}
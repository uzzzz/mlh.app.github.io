---
layout: default
title: MapReduce编程之自定义序列化类及自定义排序
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-f57960eb32.css%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-f57960eb32.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22+id%3D%22content_views%22%3E+%0A++%3Cp%3E%3Cstrong%3E%E6%95%B0%E6%8D%AE%EF%BC%9A%3C%2Fstrong%3E%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode%3E%2F%2F%E5%A7%93%E5%90%8D+%E6%94%B6%E5%85%A5+%E6%94%AF%E5%87%BA+%E6%97%B6%E9%97%B4%0Azhangsan+6000+0+2016-05-01%0Alisi+2000+0+2016-05-01%0Alisi+0+100+2016-05-01%0Azhangsan+3000+0+2016-05-01%0Awangwu+9000+0+2016-05-01%0Awangwu+0+200+2016-05-01%0Azhangsan+200+400+2016-05-01%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%3Cstrong%3E%E9%9C%80%E6%B1%82%EF%BC%9A%3C%2Fstrong%3E%3C%2Fp%3E+%0A++%3Cp%3E%E8%AE%A1%E7%AE%97%E6%AF%8F%E4%B8%AA%E7%94%A8%E6%88%B7%E7%9A%84%E6%94%B6%E5%85%A5%E3%80%81%E6%94%AF%E5%87%BA%E5%8F%8A%E5%88%A9%E6%B6%A6%E6%83%85%E5%86%B5%EF%BC%8C%E5%B9%B6%E4%BC%98%E5%85%88%E6%98%BE%E7%A4%BA%E5%88%A9%E6%B6%A6%E6%9C%80%E5%A4%A7%E7%9A%84%E7%94%A8%E6%88%B7%EF%BC%88%E6%8C%89%E5%88%A9%E6%B6%A6%E9%99%8D%E5%BA%8F%E3%80%81%E5%A6%82%E6%9E%9C%E5%88%A9%E6%B6%A6%E7%9B%B8%E5%90%8C%E5%88%99%E6%8C%89%E6%94%B6%E5%85%A5%E9%99%8D%E5%BA%8F%EF%BC%89%3C%2Fp%3E+%0A++%3Cp%3E%3Cstrong%3E%E5%88%86%E6%9E%90%EF%BC%9A%3C%2Fstrong%3E%3C%2Fp%3E+%0A++%3Cp%3E%3Cspan+style%3D%22color%3A%23f33b45%3B%22%3E%E5%AE%9E%E7%8E%B0WritableComparable%E6%8E%A5%E5%8F%A3%EF%BC%8C%3C%2Fspan%3EWritable%E6%8E%A5%E5%8F%A3%E6%98%AF%E4%B8%80%E4%B8%AA%E5%AE%9E%E7%8E%B0%E4%BA%86%E5%BA%8F%E5%88%97%E5%8C%96%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%B9%E8%B1%A1%E3%80%82%E5%9C%A8Hadoop%E4%B8%AD%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E7%BB%93%E6%9E%84%E5%8C%96%E5%AF%B9%E8%B1%A1%E9%83%BD%E8%A6%81%E5%AE%9E%E7%8E%B0Writable%E6%8E%A5%E5%8F%A3%EF%BC%8C%E4%BD%BF%E5%BE%97%E8%AF%A5%E7%BB%93%E6%9E%84%E5%8C%96%E5%AF%B9%E8%B1%A1%E5%8F%AF%E4%BB%A5%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%BA%E5%AD%97%E8%8A%82%E6%B5%81%EF%BC%8C%E5%AD%97%E8%8A%82%E6%B5%81%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%BA%E7%BB%93%E6%9E%84%E5%8C%96%E5%AF%B9%E8%B1%A1%E3%80%82%E9%82%A3WritableComparable%E6%8E%A5%E5%8F%A3%E6%98%AF%E5%8F%AF%E5%BA%8F%E5%88%97%E5%8C%96%E5%B9%B6%E4%B8%94%E5%8F%AF%E6%AF%94%E8%BE%83%E7%9A%84%E6%8E%A5%E5%8F%A3%E3%80%82+MapReduce%E4%B8%AD%E6%89%80%E6%9C%89%E7%9A%84key%E5%80%BC%E7%B1%BB%E5%9E%8B%E9%83%BD%E5%BF%85%E9%A1%BB%E5%AE%9E%E7%8E%B0%E8%BF%99%E4%B8%AA%E6%8E%A5%E5%8F%A3%EF%BC%8C%E6%97%A2%E7%84%B6%E6%98%AF%E5%8F%AF%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E9%82%A3%E5%B0%B1%E5%BF%85%E9%A1%BB%E5%BE%97%E5%AE%9E%E7%8E%B0readFields%EF%BC%88%EF%BC%89%E5%92%8Cwrite%EF%BC%88%EF%BC%89%E8%BF%99%E4%B8%A4%E4%B8%AA%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%87%BD%E6%95%B0%EF%BC%9B%E6%97%A2%E7%84%B6%E6%98%AF%E5%8F%AF%E6%AF%94%E8%BE%83%E7%9A%84%E5%B0%B1%E5%BF%85%E9%A1%BB%E5%AE%9E%E7%8E%B0compareTo%EF%BC%88%EF%BC%89%E5%87%BD%E6%95%B0%EF%BC%8C%E8%AF%A5%E5%87%BD%E6%95%B0%E5%8D%B3%E6%98%AF%E6%AF%94%E8%BE%83%E5%92%8C%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99%E7%9A%84%E5%AE%9E%E7%8E%B0%E3%80%82%E8%BF%99%E6%A0%B7MR%E4%B8%AD%E7%9A%84key%E5%80%BC%E5%B0%B1%E6%97%A2%E8%83%BD%E5%8F%AF%E5%BA%8F%E5%88%97%E5%8C%96%E5%8F%88%E6%98%AF%E5%8F%AF%E6%AF%94%E8%BE%83%E7%9A%84%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%3Cstrong%3E%E4%BB%A3%E7%A0%81%EF%BC%9A%3C%2Fstrong%3E%3C%2Fp%3E+%0A++%3Cp%3E%3Cspan+style%3D%22color%3A%233399ea%3B%22%3E%3Cstrong%3ETradeBean%E7%B1%BB%EF%BC%9A%3C%2Fstrong%3E%3C%2Fspan%3E%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-java%22%3Epackage+com.wqs.myWritableComparable%3B%0A%0Aimport+java.io.DataInput%3B%0Aimport+java.io.DataOutput%3B%0Aimport+java.io.IOException%3B%0A%0Aimport+org.apache.hadoop.io.WritableComparable%3B%0A%0Apublic+class+TradeBean+implements+WritableComparable%26lt%3BTradeBean%26gt%3B%7B%0A%09private+String+name%3B%0A%09private+int+income%3B%0A%09private+int+pay%3B%0A%09private+int+profit%3B%0A%09%0A%09public+TradeBean%28%29+%7B%0A%09%09super%28%29%3B%0A%09%09%2F%2F+TODO+%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%9A%84%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%AD%98%E6%A0%B9%0A%09%7D%0A%0A%09public+TradeBean%28String+name%2C+int+income%2C+int+pay%2C+int+profit%29+%7B%0A%09%09super%28%29%3B%0A%09%09this.name+%3D+name%3B%0A%09%09this.income+%3D+income%3B%0A%09%09this.pay+%3D+pay%3B%0A%09%09this.profit+%3D+profit%3B%0A%09%7D%0A%0A%09%40Override%0A%09public+void+readFields%28DataInput+in%29+throws+IOException+%7B%0A%09%09name+%3D+in.readUTF%28%29%3B%0A%09%09income+%3D+in.readInt%28%29%3B%0A%09%09pay+%3D+in.readInt%28%29%3B%0A%09%09profit+%3D+in.readInt%28%29%3B%0A%09%7D%0A%0A%09%40Override%0A%09public+void+write%28DataOutput+out%29+throws+IOException+%7B%0A%09%09out.writeUTF%28name%29%3B%0A%09%09out.writeInt%28income%29%3B%0A%09%09out.writeInt%28pay%29%3B%0A%09%09out.writeInt%28profit%29%3B%0A%09%7D%0A%0A%09%40Override%0A%09public+int+compareTo%28TradeBean+tradeBean%29+%7B%0A%09%09if%28this.profit+%26gt%3B+tradeBean.getProfit%28%29%29+return+-1%3B%0A%09%09else+if%28this.profit+%26lt%3B+tradeBean.getProfit%28%29%29+return+1%3B%0A%09%09else+if%28this.income+%26gt%3B+tradeBean.getIncome%28%29%29+return+-1%3B%0A%09%09else+if%28this.income+%26lt%3B+tradeBean.getIncome%28%29%29+return+-1%3B%0A%09%09else+return+0%3B%0A%09%7D%0A%09%0A%09%40Override%0A%09public+String+toString%28%29+%7B%0A%09%09return+name+%2B+%22+%22+%2B+income+%2B+%22+%22+%2B+pay+%2B+%22+%22+%2B+profit%3B%0A%09%7D%0A%0A%09public+String+getName%28%29+%7B%0A%09%09return+name%3B%0A%09%7D%0A%0A%09public+void+setName%28String+name%29+%7B%0A%09%09this.name+%3D+name%3B%0A%09%7D%0A%0A%09public+int+getIncome%28%29+%7B%0A%09%09return+income%3B%0A%09%7D%0A%0A%09public+void+setIncome%28int+income%29+%7B%0A%09%09this.income+%3D+income%3B%0A%09%7D%0A%0A%09public+int+getPay%28%29+%7B%0A%09%09return+pay%3B%0A%09%7D%0A%0A%09public+void+setPay%28int+pay%29+%7B%0A%09%09this.pay+%3D+pay%3B%0A%09%7D%0A%0A%09public+int+getProfit%28%29+%7B%0A%09%09return+profit%3B%0A%09%7D%0A%0A%09public+void+setProfit%28int+profit%29+%7B%0A%09%09this.profit+%3D+profit%3B%0A%09%7D%0A%0A%7D%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%3Cspan+style%3D%22color%3A%233399ea%3B%22%3E%3Cstrong%3EMap%E7%B1%BB%EF%BC%9A%3C%2Fstrong%3E%3C%2Fspan%3E%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-java%22%3Epackage+com.wqs.myWritableComparable%3B%0A%0Aimport+java.io.IOException%3B%0A%0Aimport+org.apache.hadoop.io.Text%3B%0Aimport+org.apache.hadoop.mapreduce.Mapper%3B%0A%0Apublic+class+Map+extends+Mapper%26lt%3BObject%2C+Text%2C+Text%2C+TradeBean%26gt%3B%7B%0A%09private+TradeBean+bean+%3D+new+TradeBean%28%29%3B%0A%09private+Text+name+%3D+new+Text%28%29%3B%0A%09%40Override%0A%09protected+void+map%28Object+key%2C+Text+value%2C+Context+context%29+throws+IOException%2C+InterruptedException%7B%0A%09%09String+line+%3D+value.toString%28%29%3B%0A%09%09String%5B%5D+temp+%3D+line.split%28%22+%22%29%3B%0A%09%09name.set%28temp%5B0%5D%29%3B%0A%09%09bean.setName%28temp%5B0%5D%29%3B%0A%09%09bean.setIncome%28Integer.valueOf%28temp%5B1%5D%29%29%3B%0A%09%09bean.setPay%28Integer.valueOf%28temp%5B2%5D%29%29%3B%0A%09%09bean.setProfit%280%29%3B%0A%09%09context.write%28name%2C+bean%29%3B%0A%09%7D%0A%7D%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%3Cspan+style%3D%22color%3A%233399ea%3B%22%3E%3Cstrong%3EReduce%E7%B1%BB%EF%BC%9A%3C%2Fstrong%3E%3C%2Fspan%3E%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-java%22%3Epackage+com.wqs.myWritableComparable%3B%0A%0Aimport+java.io.IOException%3B%0Aimport+java.util.ArrayList%3B%0Aimport+java.util.Collections%3B%0A%0Aimport+org.apache.hadoop.io.NullWritable%3B%0Aimport+org.apache.hadoop.io.Text%3B%0Aimport+org.apache.hadoop.mapreduce.Reducer%3B%0A%0Apublic+class+Reduce+extends+Reducer%26lt%3BText%2C+TradeBean%2C+TradeBean%2C+NullWritable%26gt%3B%7B%0A%09ArrayList%26lt%3BTradeBean%26gt%3B+tradeBeans+%3D+new+ArrayList%26lt%3B%26gt%3B%28%29%3B%0A%09%40Override%0A%09protected+void+reduce%28Text+k2%2C+Iterable%26lt%3BTradeBean%26gt%3B+vs2%2C+Context+context%29+%0A%09%09%09throws+IOException%2C+InterruptedException+%7B%0A%09%09String+name+%3D+null%3B%0A%09%09int+income+%3D+0%3B%0A%09%09int+pay+%3D+0%3B%0A%09%09int+profit+%3D+0%3B%0A%09%09for+%28TradeBean+tradeBean+%3A+vs2%29+%7B%0A%09%09%09income+%2B%3D+tradeBean.getIncome%28%29%3B%0A%09%09%09pay+%2B%3D+tradeBean.getPay%28%29%3B%0A%09%09%7D%0A%09%09name+%3D+k2.toString%28%29%3B%0A%09%09profit+%3D+income+-+pay%3B%0A%09%09tradeBeans.add%28new+TradeBean%28name%2C+income%2C+pay%2C+profit%29%29%3B%0A%09%7D%0A%09%0A%09%2F**%0A%09+*+%E5%9C%A8%E6%89%80%E6%9C%89reduce%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9D%9F%E4%B9%8B%E5%90%8E%E5%AF%B9tradeBeans%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F%0A%09+*+cleanup%E6%96%B9%E6%B3%95%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%9A%E5%9C%A8%E6%89%80%E6%9C%89reduce%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9D%9F%E4%B9%8B%E5%90%8E%E8%B0%83%E7%94%A8%0A%09+*+%E7%9B%AE%E7%9A%84%EF%BC%9A%E4%BD%BF%E7%BB%93%E6%9E%9C%E6%8C%89%E7%85%A7%E5%88%A9%E6%B6%A6%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F%E3%80%82%E5%89%8D%E9%9D%A2map%E9%98%B6%E6%AE%B5%E4%B8%BA%E4%BA%86reduce%E9%98%B6%E6%AE%B5%E5%AE%B9%E6%98%93%E7%BB%9F%E8%AE%A1%E6%AF%8F%E4%B8%AA%E4%BA%BA%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%B0%86K1%E8%AE%BE%E7%BD%AE%E4%B8%BA%E4%BA%86name%0A%09+*+%E9%82%A3%E4%B9%88%E6%AD%A4%E6%97%B6%E6%88%91%E4%BB%AC%E5%8F%91%E7%8E%B0%E7%BB%93%E6%9E%9C%E6%8E%92%E5%BA%8F%E6%98%AF%E6%8C%89%E7%85%A7name%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F%E7%9A%84%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E9%9C%80%E6%B1%82%E6%89%80%E8%A6%81%E6%B1%82%E7%9A%84%E6%8C%89%E7%85%A7%E5%88%A9%E6%B6%A6%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F%EF%BC%8C%E6%95%85%E6%8A%8A%E6%9C%80%E7%BB%88%E7%9A%84%E7%BB%93%E6%9E%9C%E9%9B%86%0A%09+*+sort%E4%B8%80%E4%B8%8B%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86%0A%09+*%2F%0A%09%40Override%0A%09protected+void+cleanup%28Context+context%29+throws+IOException%2C+InterruptedException+%7B%0A%09%09Collections.sort%28tradeBeans%29%3B%0A%09%09for+%28TradeBean+tradeBean+%3A+tradeBeans%29+%7B%0A%09%09%09context.write%28tradeBean%2C+NullWritable.get%28%29%29%3B%0A%09%09%7D%0A%09%7D%0A%7D%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%3Cspan+style%3D%22color%3A%233399ea%3B%22%3E%3Cstrong%3EMain%EF%BC%9A%3C%2Fstrong%3E%3C%2Fspan%3E%3C%2Fp%3E+%0A++%3Cpre+class%3D%22has%22%3E%0A%3Ccode+class%3D%22language-java%22%3Epackage+com.wqs.myWritableComparable%3B%0A%0Aimport+org.apache.hadoop.conf.Configuration%3B%0Aimport+org.apache.hadoop.fs.Path%3B%0Aimport+org.apache.hadoop.io.NullWritable%3B%0Aimport+org.apache.hadoop.io.Text%3B%0Aimport+org.apache.hadoop.mapreduce.Job%3B%0Aimport+org.apache.hadoop.mapreduce.lib.input.FileInputFormat%3B%0Aimport+org.apache.hadoop.mapreduce.lib.output.FileOutputFormat%3B%0Aimport+org.apache.hadoop.util.GenericOptionsParser%3B%0A%0Apublic+class+Main+%7B%0A%09%0A%09public+static+void+main%28String%5B%5D+args%29+throws+Exception+%7B%0A++++++++Configuration+conf+%3D+new+Configuration%28%29%3B%0A++++++++System.setProperty%28%22hadoop.home.dir%22%2C+%22E%3A%2Fhadoop-2.7.7%22%29%3B%0A%09%09args+%3D+new+String%5B%5D+%7B+%22%2Fdemo03%2Fin%2F%22%2C+%22%2Fdemo03%2Fout%22+%7D%3B%0A++++++++String%5B%5D+otherArgs+%3D+new+GenericOptionsParser%28conf%2Cargs%29.getRemainingArgs%28%29%3B%0A++++++++if%28otherArgs.length+%21%3D+2%29%7B%0A++++++++++++System.err.println%28%22Usage%3AInvertedIndex%22%29%3B%0A++++++++++++System.exit%282%29%3B%0A++++++++%7D%0A++++++++Job+job+%3D+Job.getInstance%28%29%3B%0A++++++++job.setJarByClass%28Main.class%29%3B%0A++++++++job.setMapperClass%28Map.class%29%3B%0A++++++++job.setReducerClass%28Reduce.class%29%3B%0A++++++++job.setMapOutputKeyClass%28Text.class%29%3B%0A++++++++job.setMapOutputValueClass%28TradeBean.class%29%3B%0A++++++++job.setOutputKeyClass%28TradeBean.class%29%3B%0A++++++++job.setOutputValueClass%28NullWritable.class%29%3B%0A+++++++++%0A++++++++FileInputFormat.addInputPath%28job%2C+new+Path%28%22hdfs%3A%2F%2F192.168.222.128%3A9000%22+%2B+args%5B0%5D%29%29%3B%0A++++++++FileOutputFormat.setOutputPath%28job%2C+new+Path%28%22hdfs%3A%2F%2F192.168.222.128%3A9000%22+%2B+args%5B1%5D%29%29%3B%0A+++++++++%0A++++++++System.exit%28job.waitForCompletion%28true%29+%3F+0+%3A+1%29%3B%0A++++%7D%0A%7D%0A%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%26nbsp%3B%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E" | url_decode}}
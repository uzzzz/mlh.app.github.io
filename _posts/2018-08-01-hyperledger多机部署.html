---
layout: default
title: hyperledger多机部署
---

<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css"> 
 <div class="htmledit_views"> 
  <p>一、环境配置</p> 
  <p>5台服务器全部是centos7.4</p> 
  <p>orderer 47.75.123.155 orderer.example.com orderer</p> 
  <p>peer0.org1&nbsp;47.52.202.124&nbsp;</p> 
  <p>二、服务器的初始化和安装有关软件</p> 
  <p>（1）更新依赖源 sudo yum update</p> 
  <p>（2）安装docker</p> 
  <p>sudo yum install -y yum-utils \device-mapper-persistent-data \lvm2</p> 
  <p>（3）安装有关的依赖</p> 
  <p>sudo yum-config-manager \--add-repo \https://download.docker.com/linux/centos/docker-ce.repo</p> 
  <p>（4）安装docker-ce</p> 
  <p>sudo yum install docker-ce</p> 
  <p>（5）检查安装结果</p> 
  <p>docker --version</p> 
  <p>（6）启动&nbsp;service docker start</p> 
  <p>（7）每次自动启动 chkconfig docker on</p> 
  <p>（8）安装curl 命令 yum install curl</p> 
  <p>（9）下载docker-compose，注意不是单引号</p> 
  <p>sudo curl -L https://github.com/docker/compose/releases/download/1.20.1/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</p> 
  <p>（10）cp /usr/local/bin/docker-compose /usr/bin</p> 
  <p>（11）docker-compose version&nbsp; 如果提示权限不足，那么chmod +x /usr/local/bin/docker-compose</p> 
  <p>（12）安装go</p> 
  <p>curl -O https://storage.googleapis.com/golang/go1.10.1.linux-amd64.tar.gz</p> 
  <p>tar -C /usr/local -xzf go1.10.1.linux-amd64.tar.gz</p> 
  <p>解压缩到/usr/local目录</p> 
  <p>&nbsp; (13)配置环境</p> 
  <p>vim /etc/profile</p> 
  <p>export PATH=$PATH:/usr/local/go/bin</p> 
  <p>export GOPATH=/opt/gopath</p> 
  <p>source /etc/profile</p> 
  <p>（14）查看go 安装信息</p> 
  <p>echo $PATH</p> 
  <p>go version</p> 
  <p>（15）安装git</p> 
  <p>yum install git</p> 
  <p>（16）创建安装目录</p> 
  <p>mkdir -p /opt/gopath/src/github.com/hyperledger</p> 
  <p>（17）进入安装目录</p> 
  <p>cd /opt/gopath/src/github.com/hyperledger</p> 
  <p>（18）拉取源代码</p> 
  <p>git clone https://github.com/hyperledger/fabric.git</p> 
  <p>（19）切换到分支</p> 
  <p>cd fabric</p> 
  <p>git checkout -b v1.0.0 切换到分支</p> 
  <p><span style="color:#f33b45;"><strong>git checkout v1.0.0&nbsp; &nbsp;这两个有差异！应该这样而不是上面的 -b是新建分支的意思！</strong></span></p> 
  <p>（20）拉取docker</p> 
  <p>------------------------------------------------------------</p> 
  <p><strong>cd fabric/examples/e2e_cli/</strong></p> 
  <p>chmod +x download-dockerimages.sh</p> 
  <p>./download-dockerimages.sh -c x86_64-1.0.0 -f x86_64-1.0.0</p> 
  <p><strong>docker images 查看下载内容</strong></p> 
  <p><strong>8、运行fabric网络</strong></p> 
  <p>./network_setup.sh up</p> 
  <p><strong>如果遇到问题，参考</strong></p> 
  <p><a href="https://blog.csdn.net/frankxixu/article/details/80641336" rel="nofollow">https://blog.csdn.net/frankxixu/article/details/80641336</a></p> 
  <pre class="has">
<code class="language-html">2018-01-26 05:03:26.153 UTC [msp/identity] Sign -&gt; DEBU 00f Sign: digest: A5892BF4C08D07882B34D959932CFA784DE00E1B29D40411B1CF8B59C16DF557 
fatal error: unexpected signal during runtime execution
[signal SIGSEGV: segmentation violation code=0x1 addr=0x63 pc=0x7ff4023cb259]</code></pre> 
  <p><strong>./network_setup.sh down</strong></p> 
  <p>docker rm -f $(docker ps -aq)</p> 
  <p><strong>解决办法：</strong></p> 
  <p><strong>修改</strong>vim /etc/resolv.conf&nbsp;<strong>配置，将&nbsp;options timeout:2 attempts:3 rotate single-request-reopen&nbsp;这一行内容注释掉</strong></p> 
  <p><strong>还有问题的话 rm -rf fabric文件夹 重来</strong></p> 
  <p><span style="color:#f33b45;"><strong>生成了bin 在fabric/release/linux-amd64/下</strong></span></p> 
  <p>在fabric目录下mkdir aberic目录</p> 
  <p>将bin考入aberic</p> 
  <p><strong>./network_setup.sh down 先停止服务</strong></p> 
  <p>cp -r bin /opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>还需要configtx.yaml 和 crypto-config.yaml</p> 
  <p>这两个文件来自/opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli</p> 
  <p>cp configtx.yaml /opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>cp crypto-config.yaml /opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>配置文件已经齐了！</p> 
  <p>准备启动&nbsp;&nbsp;aberic目录下</p> 
  <p>./bin/cryptogen generate --config=./crypto-config.yaml</p> 
  <p>结果生成</p> 
  <p>org1.example.com</p> 
  <p>org2.example.com</p> 
  <p>crypto-config 目录也添加了</p> 
  <p>生成创世区块</p> 
  <p>export FABRIC_CFG_PATH=$PWD</p> 
  <p>在fabric/aberic目录下执行以上</p> 
  <p>echo&nbsp;$PWD</p> 
  <p>输出：/opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>6、执行创世区块生成</p> 
  <p>在fabric/aberic目录下创建channel-artifacts目录</p> 
  <p>mkdir channel-artifacts</p> 
  <p>执行</p> 
  <p>./bin/configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block</p> 
  <p>./bin/configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/mychannel.tx -channelID mychannel</p> 
  <p><span style="color:#f33b45;">分析：之前单独拉取docker image或者下载bin文件，都导致各种的问题</span></p> 
  <p><span style="color:#f33b45;">最终通过执行example/e2e-cli 的 network_setup 脚本 完成</span></p> 
  <p><span style="color:#f33b45;">说明该脚本中下载了合适版本的二进制工具！</span></p> 
  <p>三、准备orderer启动脚本</p> 
  <p>1、准备docker-orderer.yaml脚本，内容P91</p> 
  <p>2、在aberic目录下启动</p> 
  <p>docker-compose -f docker-orderer.yaml up -d</p> 
  <p>docker ps&nbsp; 没有信息？</p> 
  <p>./bin/configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/mychannel.tx -channelID mychannel</p> 
  <p>这步不能少</p> 
  <p>四、启动1个peer节点（单独服务器） peer0.org1</p> 
  <p>1、按照第二步准备好环境</p> 
  <p>2、遇到了错误：</p> 
  <p>可能是1G内存不够！此时bin文件目录已经生成，先继续</p> 
  <p><span style="color:#f33b45;">./bin/configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block</span></p> 
  <p><span style="color:#f33b45;">上面这步没做</span></p> 
  <p>把chaincode 目录考入 aberic&nbsp;&nbsp;/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode</p> 
  <p>cp -r chaincode /opt/gopath/src/github.com/hyperledger/fabric/aberic</p> 
  <p>3、准备peer0.org1启动脚本 P92-P93</p> 
  <p>其中具体的　CA编号要替换</p> 
  <p>scp -r /Users/developer/Desktop/hyperledger/scripts/docker-peer01.yaml&nbsp;root@47.52.202.124:/opt/gopath/src/<a href="http://github.com/hyperledger/fabric/aberi" rel="nofollow">github.com/hyperledger/fabric/aberi</a>c</p> 
  <p>docker-compose -f docker-peer01.yaml up -d</p> 
  <p>进入cli</p> 
  <p>创建 mychannel</p> 
  <p>peer channel create -o orderer.example.com:7050 -c mychannel -t 50 -f ./channel-artifacts/mychannel.tx</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
  <p>&nbsp;</p> 
 </div> 
</div> 
<div class="hide-article-box text-center"> 
 <a class="btn btn-red-hollow" id="btn-readmore" data-track-view="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/frankxixu/article/details/81348874,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_376&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/frankxixu/article/details/81348874,&quot;}">阅读更多</a> 
</div>
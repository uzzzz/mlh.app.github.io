---
layout: default
title: TensorFlow-一种改进的inception-v3迁移学习(图文）
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-f57960eb32.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22+id%3D%22content_views%22%3E+%0A++%3Cp%3E%E6%9C%AC%E6%96%87%E6%98%AF%E5%85%B3%E4%BA%8E%E5%A6%82%E4%BD%95%E7%94%A8%E8%B0%B7%E6%AD%8C%E6%8F%90%E4%BE%9B%E7%9A%84%E8%AE%AD%E7%BB%83%E5%A5%BD%E7%9A%84Inception-v3%E8%BF%9B%E8%A1%8C%E6%B0%B4%E6%9E%9C%E5%9B%BE%E7%89%87%E5%88%86%E7%B1%BB%EF%BC%8C%E6%B6%89%E5%8F%8A%E4%BB%A5%E4%B8%8B%E5%87%A0%E4%B8%AA%E5%86%85%E5%AE%B9%EF%BC%9A%E4%B8%8B%E8%BD%BDinception-v3%EF%BC%88%E8%B0%B7%E6%AD%8C%E8%AE%AD%E7%BB%83%E5%A5%BD%E7%9A%84%E6%A8%A1%E5%9E%8B%EF%BC%89%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%E7%9A%84%E6%B8%85%E6%B4%97%E5%B0%86%E6%A8%A1%E5%9E%8B%E7%94%A8%E4%BA%8E%E5%9B%BE%E7%89%87%E5%88%86%E7%B1%BB-------------------------------------------------------------------%E8%AF%A6%E8%A7%A3%EF%BC%9A%E3%80%90%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E3%80%91+%26nbsp%3B%7C--baidu_search.py+%26nbsp%3B+%26nbsp%3B+%23%E9%80%9A%E8%BF%87%E7%99%BE%E5%BA%A6%E7%88%AC%E5%8F%96%E5%9B%BE%E7%89%87+%26nbsp%3B%7C--ulibs.py+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%23%E7%94%A8%E4%BA%8E%E5%AD%98%E6%94%BE%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E7%AD%89%E5%8A%9F%E8%83%BD%E5%87%BD%E6%95%B0+%26nbsp%3B%7C--inception-v3.py+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%23+%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%87%BD%E6%95%B0+%26nbsp%3B%7C--data%2F+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%23%E5%AD%98%E6%94%BE%E6%95%B0%E6%8D%AE+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%7C--model%2F+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%23%E5%AD%98%E6%94%BE%E5%B7%B2%E8%AE%AD%E7%BB%83%E5%A5%BD%E7%9A%84%E6%A8%A1%E5%9E%8B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%7C--fruit_photos%2F+%26nbsp%3B+%23%E5%AD%98%E6%94%BE%E7%88%AC%E5%8F%96%E7%9A%84%E5%9B%BE%E7%89%87+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%7C--tmp%2F+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%23%E5%AD%98%E6%94%BE%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6%E3%80%90%E4%B8%8B%E8%BD%BDinception-v3%E3%80%91https%3A%2F%2Fstorage.googleapis.com%2Fdownload.tensorflow.org%2Fmodels%2Finception_dec_2015.zip%E8%A7%A3%E5%8E%8B%E5%90%8E%E6%94%BE%E5%9C%A8.%2Fdata%2Fmodel%2F%E7%9B%AE%E5%BD%95%E4%B8%8B%E3%80%90%E4%B8%8B%E8%BD%BD%E6%B0%B4%E6%9E%9C%E5%9B%BE%E7%89%87%E3%80%91%EF%BC%9A%E9%80%9A%E8%BF%87%E5%85%B3%E9%94%AE%E5%AD%97%E4%BB%8E%E7%99%BE%E5%BA%A6%E7%88%AC%E5%8F%96baidu_search.py%3A%23+-*-+coding%3A+utf-8+-*-%3Cbr%3E+%22%22%22%3Cbr%3E+Created+on+Tue+Feb+27+11%3A10%3A45+2018%3C%2Fp%3E+%0A++%3Cp%3E%40author%3A+mc.meng%3Cbr%3E+%22%22%22%3Cbr%3E+import+re%2C+os%3Cbr%3E+import+requests%3Cbr%3E+from+urllib.request+import+urlretrieve%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+download1%28url%2C+filename%2C+filepath%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+full_name+%3D+os.path.join%28filepath%2C+filename%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+if+os.path.exists%28full_name%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22%E3%80%90%E6%B6%88%E6%81%AF%E3%80%91%E6%96%87%E4%BB%B6%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%EF%BC%9A%22%2C+full_name%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+try%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+pic+%3D+requests.get%28url%2C+timeout%3D5%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+except%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%27%E3%80%90%E9%94%99%E8%AF%AF%E3%80%91%E5%BD%93%E5%89%8D%E5%9B%BE%E7%89%87%E6%97%A0%E6%B3%95%E4%B8%8B%E8%BD%BD%27%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+return%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+try%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+with+open%28filepath+%2B+%22%2F%22+%2B+filename%2C+%27wb%27%29+as+wf%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+wf.write%28pic.content%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+except+%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22%E3%80%90%E9%94%99%E8%AF%AF%E3%80%91%E5%86%99%E5%85%A5%E5%A4%B1%E8%B4%A5%22%29%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+download2%28url%2C+filename%2C+filepath%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+full_name+%3D+os.path.join%28filepath%2C+filename%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+if+os.path.exists%28full_name%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22%E3%80%90%E6%B6%88%E6%81%AF%E3%80%91%E6%96%87%E4%BB%B6%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%EF%BC%9A%22%2C+full_name%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+try%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+urlretrieve%28url%2C+full_name%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+except%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%27%E3%80%90%E9%94%99%E8%AF%AF%E3%80%91%E5%BD%93%E5%89%8D%E5%9B%BE%E7%89%87%E6%97%A0%E6%B3%95%E4%B8%8B%E8%BD%BD%27%29%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+search%28word%3D%22%E7%BE%8E%E5%A5%B3%22%2C+local_path%3D%22.%2Fdata%2Fdown%2F%22%2C+page%3DNone%2C+keep_original_name%3DTrue%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+local_path+%2B%3D+word%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+os.makedirs%28local_path%2C+exist_ok%3DTrue%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+url+%3D+%27http%3A%2F%2Fimage.baidu.com%2Fsearch%2Fflip%3Ftn%3Dbaiduimage%26amp%3Bie%3Dutf-8%26amp%3Bword%3D%7Bword%7D%26amp%3Bpn%3D%7Bpn%7D%26amp%3Bgsm%3D%7Bgsm%3Ax%7D%26amp%3Bct%3D%26amp%3Bic%3D0%26amp%3Blm%3D-1%26amp%3Bwidth%3D0%26amp%3Bheight%3D0%27.format%28word%3Dword%2C+pn%3D20+*+page%2C+gsm%3D40+%2B+20+*+page%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+print%28%22HHHC%3A0%3D%3D%3D%3D%26gt%3Bpage%3D%25d%2Curl%3D%5C%22%25s%5C%22%22+%25+%28page%2Curl%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+html+%3D+requests.get%28url%29.text%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+pic_url+%3D+re.findall%28%27%22objURL%22%3A%22%28.*%3F%29%22%2C%27%2C+html%2C+re.S%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+i+%3D+0%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+for+url+in+pic_url%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28url%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+i+%3D+i+%2B+1%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+filename+%3D+os.path.split%28url%29%5B1%5D.split%28%27%3F%27%29%5B0%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+filename_split+%3D+filename.split%28%27.%27%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+if+len%28filename_split%29+%21%3D+2%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22%E3%80%90%E9%94%99%E8%AF%AF%E3%80%91%E6%96%87%E4%BB%B6%E5%90%8D%E5%BC%82%E5%B8%B8%3A%22+%2B+filename%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+continue%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%23print%28%22HHHA%3A0%3D%3D%3D%3D%26gt%3B%22%2C+filename_split%5B1%5D%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+if+filename_split%5B1%5D+%21%3D+%27jpg%27+and+filename_split%5B1%5D+%21%3D+%27JPG%27+%5C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+and+filename_split%5B1%5D+%21%3D+%27png%27+and+filename_split%5B1%5D+%21%3D+%27PNG%27%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22%E3%80%90%E9%94%99%E8%AF%AF%E3%80%91%E7%B1%BB%E5%9E%8B%E5%BC%82%E5%B8%B8%3A%22+%2B+filename%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+continue%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+if+not+keep_original_name%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+filename+%3D+filename.split%28%27.%27%29%5B0%5D.strip%28%29+%2B+%22-%22+%2B+str%28page%29+%2B+%22-%22+%2B+str%28i%29+%2B+%22.%22+%2B+filename.split%28%27.%27%29%5B1%5D.strip%28%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+download1%28url%2C+filename%2C+local_path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+search_50_page%28word%2C+local_path%3D%22.%2Fdata%2Fdown%2F%22%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+for+i+in+range%281%2C+50%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+search%28word%2C+local_path%2C+i%29%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+search_50_page_test%28%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+search_50_page%28%22%E7%BE%8E%E5%A5%B3%22%29%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+search_list_test%28%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+obj_list+%3D+%5B%22%E8%8B%B9%E6%9E%9C%22%2C+%22%E9%A6%99%E8%95%89%22%2C+%22%E6%A1%94%E5%AD%90%22%2C+%22%E6%A1%83%E5%AD%90%22%2C+%22%E6%A8%B1%E6%A1%83%22%2C+%22%E9%BE%99%E7%9C%BC%22%2C+%22%E8%8D%94%E6%9E%9D%22%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%23obj_list+%3D+%5B%22%E8%8B%B9%E6%9E%9C%22%2C+%22%E9%A6%99%E8%95%89%22%2C+%22%E6%A1%94%E5%AD%90%22%2C+%22%E6%A9%99%E5%AD%90%22%2C+%22%E6%A1%83%E5%AD%90%22%2C+%22%E6%A8%B1%E6%A1%83%22%2C+%22%E9%BE%99%E7%9C%BC%22%2C+%22%E8%8D%94%E6%9E%9D%22%2C+%22%E9%9B%AA%E6%A2%A8%22%2C+%22%E8%8D%89%E8%8E%93%22%2C+%22%E8%91%A1%E8%90%84%22%2C+%22%E7%8C%95%E7%8C%B4%E6%A1%83%22%2C+%22%E8%8F%A0%E8%90%9D%22%2C+%22%E7%95%AA%E7%9F%B3%E6%A6%B4%22%2C+%22%E9%9D%92%E6%A2%85%22%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%23obj_list+%3D+%5B%22%E8%8F%8A%E8%8A%B1%22%2C+%22%E8%92%B2%E5%85%AC%E8%8B%B1%22%2C+%22%E7%8E%AB%E7%91%B0%22%2C+%22%E5%90%91%E6%97%A5%E8%91%B5%22%2C+%22%E9%83%81%E9%87%91%E9%A6%99%22%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+for+obj+in+obj_list%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+search_50_page%28obj%2C+%22.%2Fdata%2Ffruit_photos%2F%22%29%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+if+__name__+%3D%3D+%27__main__%27%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+search_list_test%28%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%EF%BC%88PS%EF%BC%9A%E6%BA%90%E7%A0%81%E6%9A%97%E8%97%8F%E7%A6%8F%E5%88%A9%EF%BC%8C%E4%BD%86%E6%98%AF%E6%88%91%E4%B8%8D%E8%AF%B4%5EV%5E%EF%BC%89%E7%AD%89%E6%95%88%E4%BA%8E%E6%8C%89%E4%B8%8B%E5%9B%BE%E6%AD%A5%E9%AA%A4%E6%8A%8A%E7%99%BE%E5%BA%A6%E5%9B%BE%E7%89%87%E5%88%87%E6%8D%A2%E5%88%B0%E2%80%9D%E4%BC%A0%E7%BB%9F%E7%BF%BB%E9%A1%B5%E7%89%88%E2%80%9C%EF%BC%8C%E7%84%B6%E5%90%8E%E6%89%8B%E5%8A%A8%E6%8A%8A%E5%89%8D%E9%9D%A250%E9%A1%B5%E9%83%BD%E4%B8%8B%E8%BD%BD%E4%B8%8B%E6%9D%A5%E4%BA%86%E5%A6%82%E6%9E%9C%E4%BD%A0%E5%B0%9D%E8%AF%95%E8%BF%87%E6%89%8B%E5%8A%A8%E4%B8%8B%E8%BD%BD%EF%BC%8C%E4%BD%A0%E5%B0%B1%E4%BC%9A%E5%8F%91%E7%8E%B0%E5%9B%BE%E7%89%87%E4%B8%AD%E6%9C%89%E5%BE%88%E5%A4%9A%E6%98%AF%E7%9B%B8%E5%90%8C%E7%9A%84%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E5%90%8D%E5%92%8CURL%E9%83%BD%E4%B8%80%E6%A0%B7%E3%80%82%E6%AD%A4%E7%88%AC%E8%99%AB%E5%9C%A8%E6%96%87%E4%BB%B6%E4%BF%9D%E5%AD%98%E7%9A%84%E6%97%B6%E5%80%99%E7%94%A8%E5%8E%9F%E5%A7%8B%E6%96%87%E4%BB%B6%E5%90%8D%E4%BF%9D%E5%AD%98%EF%BC%8C%E5%B9%B6%E5%9C%A8%E5%9C%A8%E4%BF%9D%E5%AD%98%E6%96%B0%E6%96%87%E4%BB%B6%E5%89%8D%E5%85%88%E5%88%A4%E6%96%AD%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%EF%BC%8C%E8%BF%99%E5%B0%B1%E9%81%BF%E5%85%8D%E4%BA%86%E9%87%8D%E5%A4%8D%E7%9A%84%E6%96%87%E4%BB%B6%E3%80%82%E5%A6%82%E6%9E%9C%E6%8A%8A%E2%80%9C%E8%8B%B9%E6%9E%9C%E2%80%9D%E6%8D%A2%E6%88%90%E2%80%9Capple%22%E4%BD%A0%E5%B0%86%E7%9C%8B%E5%88%B0%EF%BC%9A%E8%BF%99%E6%98%BE%E7%84%B6%E4%B8%8D%E6%98%AF%E6%88%91%E4%BB%AC%E6%83%B3%E8%A6%81%E7%9A%84%E6%95%88%E6%9E%9C%E2%80%94%E2%80%94%E6%88%91%E4%BB%AC%E4%BB%8A%E5%A4%A9%E9%9C%80%E8%A6%81%E7%9A%84%E6%98%AF%E6%B0%B4%E6%9E%9C%E5%9B%BE%E7%89%87%EF%BC%8C%E5%9B%A0%E6%AD%A4%E6%88%91%E4%BB%AC%E5%85%88%E7%94%A8%E4%B8%AD%E6%96%87%E5%85%B3%E9%94%AE%E5%AD%97%E7%88%AC%E5%8F%96%EF%BC%8C%E5%AE%8C%E4%BA%86%E4%B9%8B%E5%90%8E%E5%86%8D%E6%89%8B%E5%8A%A8%E6%8A%8A%E6%96%87%E4%BB%B6%E5%A4%B9%E5%90%8D%E6%94%B9%E6%88%90%E8%8B%B1%E6%96%87%E7%9A%84%EF%BC%9A%E3%80%90%E5%9B%BE%E7%89%87%E7%BB%9F%E4%B8%80%E8%BD%AC%E6%88%90jpg%E3%80%91%E4%BB%8E%E7%99%BE%E5%BA%A6%E7%88%AC%E5%8F%96%E7%9A%84%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%E6%9C%89png%E3%80%81jpg%E3%80%81gpeg%E7%AD%89%E6%A0%BC%E5%BC%8F%EF%BC%8C%E4%B8%BA%E4%BA%86%E6%96%B9%E4%BE%BF%E5%A4%84%E7%90%86%EF%BC%8C%E5%85%88%E6%8A%8A%E5%AE%83%E4%BB%AC%E7%BB%9F%E4%B8%80%E6%88%90jpg%28%E5%88%9B%E5%BB%BAulibs.py%E7%94%A8%E4%BA%8E%E5%AD%98%E6%94%BE%E6%88%91%E4%BB%AC%E7%9A%84%E6%B8%85%E6%B4%97%E5%87%BD%E6%95%B0%29%3Adef+png_to_jpg%28path%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%22%22%22convert+images+into+jpg+format+under+the+path%22%22%22%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+print%28%22%E3%80%90%E6%B6%88%E6%81%AF%E3%80%91%E5%B0%86%E5%9B%BE%E7%89%87%E8%BD%AC%E6%8D%A2%E6%88%90jpg%22%2C+path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+for+root%2C+sub_dir%2C+files+in+os.walk%28path%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22%E3%80%90%E6%B6%88%E6%81%AF%E3%80%91%E8%BF%9B%E5%85%A5%E7%9B%AE%E5%BD%95%EF%BC%9A%25s%22+%25+root%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+if+root+%3D%3D+path+or+not+files%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+continue%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+for+file+in+files%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+if+file.split%28%27.%27%29%5B1%5D+%21%3D+%27jpg%27%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22%E3%80%90%E6%B6%88%E6%81%AF%E3%80%91%E4%B8%8D%E6%98%AFjpg%3A%22%2C+file%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+old_file+%3D+os.path.join%28root%2C+file%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+img+%3D+cv2.imread%28old_file%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+new_file+%3D+os.path.join%28root%2C+file.split%28%27.%27%29%5B0%5D+%2B+%22.jpg%22%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22%E8%BD%AC%E6%8D%A2%E6%88%90%3A%22%2C+new_file%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+cv2.imwrite%28new_file%2C+img%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+os.remove%28old_file%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+print%28%22%E3%80%90%E6%B6%88%E6%81%AF%E3%80%91%E8%BD%AC%E6%8D%A2%E5%AE%8C%E6%AF%95%22%29%3C%2Fp%3E+%0A++%3Cp%3Edef+png_to_jpg_test%28%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+png_to_jpg%28%22.%2Fdata%2Ffruit_photos%2F%22%29%E3%80%90%E6%89%8B%E5%8A%A8%E5%88%A0%E9%99%A4%E6%97%A0%E6%B3%95%E9%A2%84%E8%A7%88%E5%8F%8A%E6%98%8E%E6%98%BE%E9%94%99%E8%AF%AF%E7%9A%84%E5%9B%BE%E7%89%87%E3%80%91%EF%BC%9A%E3%80%90%E7%BB%9F%E4%B8%80%E5%91%BD%E5%90%8D%E3%80%91%EF%BC%9A%E4%BB%8E%E7%99%BE%E5%BA%A6%E7%88%AC%E5%8F%96%E7%9A%84%E5%9B%BE%E7%89%87%E7%9A%84%E6%96%87%E4%BB%B6%E5%90%8D%E4%B8%8D%E7%BB%9F%E4%B8%80%EF%BC%8C%E5%BE%88%E5%A4%9A%E2%80%9C%25%E2%80%9D%EF%BC%8C%E9%95%BF%E5%BA%A6%E4%B9%9F%E5%8F%82%E5%B7%AE%E4%B8%8D%E9%BD%90%EF%BC%8C%E4%B8%BA%E4%BA%86%E7%BE%8E%E8%A7%82%E8%B5%B7%E8%A7%81%E6%88%91%E4%BB%AC%E4%B9%9F%E6%8A%8A%E6%96%87%E4%BB%B6%E5%90%8D%E5%A4%84%E7%90%86%E4%B8%80%E4%B8%8B%EF%BC%9A%E7%B1%BB%E5%9E%8B%2B%E7%BC%96%E5%8F%B7%EF%BC%9Adef+rename_files%28path%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%22%22%22rename+files+under+path%22%22%22%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+for+root%2C+sub_dir%2C+files+in+os.walk%28path%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+if+root+%3D%3D+path+or+not+files%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+continue%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22will+rename+files+under%5B%25s%5D%22+%25+root%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+count+%3D+1%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+for+file+in+files%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+os.rename%28os.path.join%28root%2C+file%29%2C+os.path.join%28root%2C+os.path.basename%28root%29+%2B+%22-%22+%2B+str%28count%29+%2B+%22.jpg%22%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+count+%2B%3D+1%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+rename_files_test%28%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+rename_files%28%22.%2Fdata%2Ffruit_photos%2F%22%29%E6%95%88%E6%9E%9C%EF%BC%9A%E3%80%90%E5%B0%86inception-v3%E7%94%A8%E4%BA%8E%E6%B0%B4%E6%9E%9C%E5%88%86%E7%B1%BB%E3%80%91%E9%87%8D%E5%A4%B4%E6%88%8F%E7%BB%88%E4%BA%8E%E5%BC%80%E5%A7%8B%E4%BA%86%EF%BC%8C%E5%85%88%E4%B8%8A%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%EF%BC%8C%E7%84%B6%E5%90%8E%E7%9C%8B%E6%95%88%E6%9E%9C%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%8D%E8%AF%A6%E8%A7%A3%E4%BB%A3%E7%A0%81%EF%BC%9A%27%27%27%3Cbr%3E+data%3A+http%3A%2F%2Fdownload.tensorflow.org%2Fexample_images%2Fflower_photos.tgz%3Cbr%3E+model%3A+https%3A%2F%2Fstorage.googleapis.com%2Fdownload.tensorflow.org%2Fmodels%2Finception_dec_2015.zip%3C%2Fp%3E+%0A++%3Cp%3Einception-v4%3A+http%3A%2F%2Fdownload.tensorflow.org%2Fmodels%2Finception_v4_2016_09_09.tar.gz%3C%2Fp%3E+%0A++%3Cp%3E%27%27%27%3Cbr%3E+import+glob%3Cbr%3E+import+os.path%3Cbr%3E+import+random%3Cbr%3E+import+cv2%3Cbr%3E+import+numpy+as+np%3Cbr%3E+import+tensorflow+as+tf%3Cbr%3E+from+tensorflow.python.platform+import+gfile%3Cbr%3E+from+tensorflow.python.framework+import+graph_util%3C%2Fp%3E+%0A++%3Cp%3Eos.environ%5B%27TF_CPP_MIN_LOG_LEVEL%27%5D+%3D+%272%27%3C%2Fp%3E+%0A++%3Cp%3EBOTTLENECK_TENSOR_SIZE+%3D+2048%3Cbr%3E+BOTTLENECK_TENSOR_NAME+%3D+%27pool_3%2F_reshape%3A0%27%3Cbr%3E+JPEG_DATA_TENSOR_NAME+%3D+%27DecodeJpeg%2Fcontents%3A0%27%3Cbr%3E+MODEL_DIR+%3D+%27.%2Fdata%2Fmodel%2Finception_dec_2015%27%3Cbr%3E+MODEL_FILE+%3D+%27tensorflow_inception_graph.pb%27%3Cbr%3E+THIS_MODEL_DIR+%3D+%22.%2Fdata%2Fmodel%2Finception%2F%22%3Cbr%3E+THIS_MODEL_FILE+%3D+%22inception.pb%22%3Cbr%3E+CACHE_DIR+%3D+%27.%2Fdata%2Ftmp%2Fbottleneck%2Finception%27%3Cbr%3E+%23INPUT_DATA+%3D+%27.%2Fdata%2Fflower_photos%27%3Cbr%3E+INPUT_DATA+%3D+%27.%2Fdata%2Ffruit_photos%27%3Cbr%3E+INPUT_DATA+%3D+%27.%2Fdata%2Fanimal_photos%27%3Cbr%3E+VALIDATION_PERCENTAGE+%3D+10%3Cbr%3E+TEST_PERCENTAGE+%3D+10%3Cbr%3E+LEARNING_RATE+%3D+0.01%3Cbr%3E+STEPS+%3D+1000%3Cbr%3E+BATCH+%3D+100%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+create_image_lists%28file_dir%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+training+%3D+%7B%7D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+validation+%3D+%7B%7D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+testing+%3D+%7B%7D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+if+not+os.path.exists%28file_dir%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22Not+such+path%3A%22%2C+file_dir%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+return+None%2C+None%2C+None%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+for+this_dir%2C+sub_dirs%2C+files+in+os.walk%28file_dir%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+if+this_dir+%3D%3D+file_dir+or+not+files%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+continue%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+np.random.shuffle%28files%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+percent10+%3D+int%28len%28files%29+*+0.1%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+this_dir+%3D+os.path.basename%28this_dir.lower%28%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+training%5Bthis_dir%5D+%3D+files%5B%3Apercent10+*+8%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+validation%5Bthis_dir%5D+%3D+files%5Bpercent10+*+8%3Apercent10+*+9%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+testing%5Bthis_dir%5D+%3D+files%5Bpercent10+*+9%3A%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+training%2C+validation%2C+testing%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+get_or_create_bottleneck%28sess_mod%2C+image_path%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+path_seg+%3D+image_path.split%28%27%5C%5C%27%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+label_name+%3D+path_seg%5B-2%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+os.makedirs%28os.path.join%28CACHE_DIR%2C+label_name%29%2C+exist_ok%3DTrue%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+bottleneck_path+%3D+os.path.join%28CACHE_DIR%2C+path_seg%5B-2%5D%2C+path_seg%5B-1%5D%29+%2B+%22.txt%22%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+if+not+os.path.exists%28bottleneck_path%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+image_data+%3D+gfile.FastGFile%28image_path%2C+%27rb%27%29.read%28%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck_values+%3D+sess_mod%5B%27sess%27%5D.run%28sess_mod%5B%27premod_bottleneck%27%5D%2C+feed_dict%3D%7Bsess_mod%5B%27premod_input%27%5D%3A+image_data%7D%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck_values+%3D+np.squeeze%28bottleneck_values%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22HHHA%3A0%3D%3D%3D%3D%26gt%3B%22%2C+image_path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28bottleneck_values%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck_string+%3D+%27%2C%27.join%28str%28x%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%29+for+x+in+bottleneck_values%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+with+open%28bottleneck_path%2C+%27w%27%29+as+bottleneck_file%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck_file.write%28bottleneck_string%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+else%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+with+open%28bottleneck_path%2C+%27r%27%29+as+bottleneck_file%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck_string+%3D+bottleneck_file.read%28%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck_values+%3D+%5Bfloat%28x%29+for+x+in+bottleneck_string.split%28%27%2C%27%29%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+bottleneck_values%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+get_cached_bottleneck%28sess_mod%2C+images%2C+label%3DNone%2C+index%3DNone%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+label_list+%3D+list%28images.keys%28%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+label_list.sort%28%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+if+label+is+None%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+label+%3D+label_list%5Brandom.randrange%28len%28label_list%29%29%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+if+index+is+None%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+index+%3D+random.randrange%28len%28images%5Blabel%5D%29%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+image_path+%3D+os.path.join%28INPUT_DATA%2C+label%2C+images%5Blabel%5D%5Bindex%5D%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+bottleneck+%3D+get_or_create_bottleneck%28sess_mod%2C+image_path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+ground_truth+%3D+np.zeros%28len%28label_list%29%2C+dtype%3Dnp.float32%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+ground_truth%5Blabel_list.index%28label%29%5D+%3D+1.0%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+bottleneck%2C+ground_truth%2C+image_path%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+fill_feed_dict%28sess_mod%2C+image_lists%2C+amount%3DNone%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+bottlenecks+%3D+%5B%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+ground_truths+%3D+%5B%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+this_paths+%3D+%5B%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+if+amount+is+None%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+for+label+in+list%28image_lists.keys%28%29%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+for+index%2C+file+in+enumerate%28image_lists%5Blabel%5D%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck%2C+ground_truth%2C+path+%3D+get_cached_bottleneck%28sess_mod%2C+image_lists%2C+label%2C+index%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottlenecks.append%28bottleneck%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+ground_truths.append%28ground_truth%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+this_paths.append%28path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+else%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+for+_+in+range%28amount%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck%2C+ground_truth%2C+path+%3D+get_cached_bottleneck%28sess_mod%2C+image_lists%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottlenecks.append%28bottleneck%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+ground_truths.append%28ground_truth%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+this_paths.append%28path%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+feed_dict+%3D+%7B%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+sess_mod%5B%27placeholder_input%27%5D%3A+bottlenecks%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+sess_mod%5B%27placeholder_labels%27%5D%3A+ground_truths%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%7D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+feed_dict%2C+this_paths%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+inference%28inputs%2C+n_classes%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+this_input+%3D+tf.reshape%28inputs%2C+%5B-1%2C+BOTTLENECK_TENSOR_SIZE%5D%2C+name%3D%27input_images%27%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+weights+%3D+tf.get_variable%28%22weights%22%2C+%5BBOTTLENECK_TENSOR_SIZE%2C+n_classes%5D%2C+initializer%3Dtf.truncated_normal_initializer%28stddev%3D0.001%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+biases+%3D+tf.get_variable%28%22biases%22%2C+%5Bn_classes%5D%2C+initializer%3Dtf.constant_initializer%280.0%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+logits+%3D+tf.add%28tf.matmul%28this_input%2C+weights%29%2C+biases%2C+%22logits%22%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+logits%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+loss%28logits%2C+labels%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+labels+%3D+tf.to_int64%28labels%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+cross_entropy+%3D+tf.nn.softmax_cross_entropy_with_logits%28logits%3Dlogits%2C+labels%3Dlabels%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+tf.reduce_mean%28cross_entropy%29%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+training%28loss%2C+learning_rate%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+tf.summary.scalar%28%27loss%27%2C+loss%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+optimizer+%3D+tf.train.GradientDescentOptimizer%28learning_rate%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+global_step+%3D+tf.Variable%280%2C+name%3D%27global_step%27%2C+trainable%3DFalse%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+train_op+%3D+optimizer.minimize%28loss%2C+global_step%3Dglobal_step%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+train_op%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+evaluation%28logits%2C+labels%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+with+tf.name_scope%28%27evaluation%27%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+correct_prediction+%3D+tf.equal%28tf.argmax%28logits%2C+1%29%2C+tf.argmax%28labels%2C+1%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+evaluation_step+%3D+tf.reduce_mean%28tf.cast%28correct_prediction%2C+tf.float32%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+return+evaluation_step%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+model_save%28sess%2C+model_path%2C+input_tensor_name%2C+bottleneck_tensor_name%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+graph_def+%3D+tf.get_default_graph%28%29.as_graph_def%28%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+outpput_graph_def+%3D+graph_util.convert_variables_to_constants%28sess%2C+graph_def%2C+%5Binput_tensor_name%2C+bottleneck_tensor_name%5D%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+with+tf.gfile.GFile%28model_path%2C+%22wb%22%29+as+wf%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+wf.write%28outpput_graph_def.SerializeToString%28%29%29%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+model_restore%28model_path%2C+input_tensor_name%2C+bottleneck_tensor_name%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+with+gfile.FastGFile%28model_path%2C+%27rb%27%29+as+rf%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+graph_def+%3D+tf.GraphDef%28%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+graph_def.ParseFromString%28rf.read%28%29%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+in_tensor%2C+out_tensor%2C+%26nbsp%3B%3D+tf.import_graph_def%28graph_def%2C+return_elements%3D%5Binput_tensor_name%2C+bottleneck_tensor_name%5D%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+in_tensor%2C+out_tensor%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+run_training%28epoch%3DSTEPS%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+imgs_training%2C+imgs_validation%2C+imgs_testing+%3D+create_image_lists%28INPUT_DATA%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+n_classes+%3D+len%28imgs_training.keys%28%29%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+m1_input%2C+m1_bottleneck+%3D+model_restore%28os.path.join%28MODEL_DIR%2C+MODEL_FILE%29%2C+JPEG_DATA_TENSOR_NAME%2C+BOTTLENECK_TENSOR_NAME%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+placeholder_input+%3D+tf.placeholder%28tf.float32%2C+%5BNone%2C+BOTTLENECK_TENSOR_SIZE%5D%2C+name%3D%27in_images%27%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+placeholder_labels+%3D+tf.placeholder%28tf.float32%2C+%5BNone%2C+n_classes%5D%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+logits+%3D+inference%28placeholder_input%2C+n_classes%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+this_loss+%3D+loss%28logits%2C+placeholder_labels%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+train_step+%3D+training%28this_loss%2C+LEARNING_RATE%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+evaluation_step+%3D+evaluation%28logits%2C+placeholder_labels%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+init+%3D+tf.global_variables_initializer%28%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+with+tf.Session%28%29+as+sess%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+sess.run%28init%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+sess_mod+%3D+%7B%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27sess%27%3A+sess%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27premod_input%27%3A+m1_input%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27premod_bottleneck%27%3A+m1_bottleneck%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27placeholder_input%27%3A+placeholder_input%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27placeholder_labels%27%3A+placeholder_labels%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%7D%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+for+step+in+range%28epoch%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+feed_dict%2C+image_path+%3D+fill_feed_dict%28sess_mod%2C+imgs_training%2C+BATCH%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+sess.run%28train_step%2C+feed_dict%3Dfeed_dict%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+if+step+%25+100+%3D%3D+0+or+step+%2B+1+%3D%3D+STEPS%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+feed_dict%2C+image_path+%3D+fill_feed_dict%28sess_mod%2C+imgs_validation%2C+BATCH%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+accuracy+%3D+sess.run%28evaluation_step%2C+feed_dict%3Dfeed_dict%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22Step+%25d%3A+Validation+accuracy+on+random+sampled+%25d+examples+%3D+%25.2f%25%25%22+%25+%28step%2C+BATCH%2C+accuracy+*+100%29%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+accuracy+%3D+sess.run%28evaluation_step%2C+feed_dict%3Dfill_feed_dict%28sess_mod%2C+imgs_testing%29%5B0%5D%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22Final+test+accuracy+%3D+%25.1f%25%25%22+%25+%28accuracy+*+100%29%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+model_save%28sess%2C+os.path.join%28THIS_MODEL_DIR%2C+THIS_MODEL_FILE%29%2C+%22in_images%22%2C+%27logits%27%29%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+predict_test%28%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+imgs_training%2C+imgs_validation%2C+imgs_testing+%3D+create_image_lists%28INPUT_DATA%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+m1_input%2C+m1_bottleneck+%3D+model_restore%28os.path.join%28MODEL_DIR%2C+MODEL_FILE%29%2C+JPEG_DATA_TENSOR_NAME%2C+BOTTLENECK_TENSOR_NAME%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+m2_input%2C+m2_bottleneck+%3D+model_restore%28os.path.join%28THIS_MODEL_DIR%2C+THIS_MODEL_FILE%29%2C+%22in_images%3A0%22%2C+%22logits%3A0%22%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+placeholder_labels+%3D+tf.placeholder%28tf.float32%2C+%5BNone%2C+len%28imgs_training.keys%28%29%29%5D%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+evaluation_step+%3D+evaluation%28m2_bottleneck%2C+placeholder_labels%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+placeholder_logits+%3D+tf.placeholder%28tf.float32%2C+%5BNone%2C+len%28imgs_training.keys%28%29%29%5D%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+final_tensor+%3D+tf.nn.softmax%28placeholder_logits%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+final_index+%3D+tf.argmax%28final_tensor%2C+1%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+with+tf.Session%28%29+as+sess%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+sess.run%28tf.global_variables_initializer%28%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+sess_mod+%3D+%7B%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27sess%27%3A+sess%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27premod_input%27%3A+m1_input%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27premod_bottleneck%27%3A+m1_bottleneck%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27placeholder_input%27%3A+m2_input%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27placeholder_labels%27%3A+placeholder_labels%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%7D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+feed_dict%2C+image_path+%3D+fill_feed_dict%28sess_mod%2C+imgs_testing%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+accuracy+%3D+sess.run%28evaluation_step%2C+feed_dict%3Dfeed_dict%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22Final+test+accuracy+%3D+%25.1f%25%25%22+%25+%28accuracy+*+100%29%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+while+True%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+feed_dict%2C+image_path+%3D+fill_feed_dict%28sess_mod%2C+imgs_testing%2C+1%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+this_logits+%3D+sess.run%28m2_bottleneck%2C+feed_dict%3Dfeed_dict%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+f_tensor%2C+f_index+%3D+sess.run%28%5Bfinal_tensor%2C+final_index%5D%2C+feed_dict%3D%7Bplaceholder_logits%3A+this_logits%7D%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+image_path+%3D+image_path%5B0%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+f_tensor+%3D+f_tensor%5B0%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+f_index+%3D+f_index%5B0%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22image_path%3A%22%2C+image_path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22f_tensor%3A%22%2C+f_tensor%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22f_index%22%2C+f_index%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+label_list+%3D+list%28imgs_testing.keys%28%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+label_list.sort%28%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+f_predict+%3D+label_list%5Bf_index%5D%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22f_predict%3A%22%2C+f_predict%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+img+%3D+cv2.imread%28image_path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+if+img+is+None%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22File+not+found%3A%22%2C+image_path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+continue%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+img+%3D+cv2.resize%28img%2C+%28500%2C+500%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+cv2.putText%28img%2C+os.path.basename%28image_path%29%2C+%2850%2C+50%29%2C+cv2.FONT_HERSHEY_COMPLEX%2C+1%2C+%28255%2C+0%2C+0%29%2C+1%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+cv2.putText%28img%2C+f_predict%2C+%2850%2C+150%29%2C+cv2.FONT_HERSHEY_COMPLEX%2C+3%2C+%28255%2C+0%2C+255%29%2C+5%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+cv2.imshow%28%22predict%22%2C+img%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+key+%3D+cv2.waitKey%28%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+if+key+%26amp%3B+0xFF+%3D%3D+ord%28%27q%27%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+break%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+elif+key+%26amp%3B+0xFF+%3D%3D+ord%28%27d%27%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22removing%3A%22%2C+image_path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+os.remove%28image_path%29%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+main%28argv%3DNone%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%23run_training%28STEPS%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+predict_test%28%29%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+if+__name__+%3D%3D+%22__main__%22%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+tf.app.run%28%29%3Cbr%3E+%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%A6%82%E6%9E%9C%E5%87%BA%E7%8E%B0%E9%94%99%E8%AF%AF%EF%BC%8C%E4%B8%80%E8%88%AC%E6%98%AF%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%E6%97%A0%E6%B3%95%E6%89%93%E5%BC%80%EF%BC%88%E6%96%87%E4%BB%B6%E6%8D%9F%E5%9D%8F%E3%80%81%E5%8E%9F%E5%9B%BE%E6%98%AFgif%E6%96%87%E4%BB%B6%E7%AD%89%EF%BC%89%EF%BC%8C%E7%9B%B4%E6%8E%A5%E5%B0%86%E5%85%B6%E5%88%A0%E9%99%A4%E5%B0%B1%E5%A5%BD%E4%BA%86%E3%80%82%E8%BE%93%E5%87%BA%EF%BC%9A94.2%25%E7%9A%84%E5%87%86%E7%A1%AE%E7%8E%87%EF%BC%8C%E8%BF%98%E7%AE%97%E4%B8%8D%E9%94%99%E3%80%82%E3%80%90%E5%8F%AF%E8%A7%86%E5%8C%96%E9%A2%84%E6%B5%8B%E7%BB%93%E6%9E%9C%E3%80%91%E4%B8%BB%E5%87%BD%E6%95%B0%E4%BF%AE%E6%94%B9%E5%A6%82%E4%B8%8B%E5%86%8D%E8%BF%90%E8%A1%8C%EF%BC%9Adef+main%28argv%3DNone%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%23run_training%28500%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+predict_test%28%29%E6%8C%89q%E9%94%AE%E9%80%80%E5%87%BA%EF%BC%8C%E6%8C%89d%E9%94%AE%E5%88%A0%E9%99%A4%E5%BD%93%E5%89%8D%E6%96%87%E4%BB%B6%EF%BC%8C%E6%8C%89%E5%85%B6%E5%AE%83%E4%BD%95%E6%84%8F%E9%94%AE%E5%88%87%E6%8D%A2%E5%88%B0%E4%B8%8B%E4%B8%80%E5%BC%A0%EF%BC%9A%E3%80%90%E4%BB%A3%E7%A0%81%E8%AF%A6%E8%A7%A3%E3%80%91%EF%BC%9A%E4%B8%BB%E5%87%BD%E6%95%B0%E5%BC%80%E5%A7%8B%EF%BC%9Adef+main%28argv%3DNone%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+run_training%28STEPS%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%23predict_test%28%29%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%87%BA%EF%BC%8C%E6%88%91%E4%BB%AC%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%88%86%E8%AE%AD%E7%BB%83%E5%92%8C%E9%A2%84%E6%B5%8B%E4%B8%A4%E4%B8%AA%E9%98%B6%E6%AE%B5%EF%BC%9A+%26nbsp%3B+%26nbsp%3Brun_training%28%29%E6%98%AF%E5%B0%86inception-3%E8%BF%81%E7%A7%BB%E5%88%B0%E6%88%91%E4%BB%AC%E7%9A%84%E6%B0%B4%E6%9E%9C%E5%88%86%E7%B1%BB%EF%BC%8C%E8%AE%AD%E7%BB%83%E5%B9%B6%E5%B0%86%E4%BF%9D%E5%AD%98%E6%96%B0%E6%A8%A1%E5%9E%8B%EF%BC%9B+%26nbsp%3B+%26nbsp%3Bpredict_test%28%29%E6%98%AF%E4%BD%BF%E7%94%A8%E6%96%B0%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E9%A2%84%E6%B5%8B%EF%BC%8C%E5%B9%B6%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B1%95%E7%A4%BA%E9%A2%84%E6%B5%8B%E7%BB%93%E6%9E%9C%EF%BC%9B%E3%80%90%E6%A8%A1%E5%9E%8B%E4%BF%9D%E5%AD%98%E5%8F%8A%E6%81%A2%E5%A4%8D%E3%80%91%EF%BC%9Amodel_save%28%29%E3%80%81model_restore%28%29%E5%88%86%E5%88%AB%E6%98%AF%E4%BF%9D%E5%AD%98%E5%92%8C%E6%81%A2%E5%A4%8D%E6%A8%A1%E5%9E%8Bdef+model_save%28sess%2C+model_path%2C+input_tensor_name%2C+bottelneck_tensor_name%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+graph_def+%3D+tf.get_default_graph%28%29.as_graph_def%28%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+outpput_graph_def+%3D+graph_util.convert_variables_to_constants%28sess%2C+graph_def%2C+%5Binput_tensor_name%2C+bottelneck_tensor_name%5D%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+with+tf.gfile.GFile%28model_path%2C+%22wb%22%29+as+wf%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+wf.write%28outpput_graph_def.SerializeToString%28%29%29%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+model_restore%28model_path%2C+input_tensor_name%2C+bottelneck_tensor_name%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+with+gfile.FastGFile%28model_path%2C+%27rb%27%29+as+rf%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+graph_def+%3D+tf.GraphDef%28%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+graph_def.ParseFromString%28rf.read%28%29%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+in_tensor%2C+out_tensor%2C+%26nbsp%3B%3D+tf.import_graph_def%28graph_def%2C+return_elements%3D%5Binput_tensor_name%2C+bottelneck_tensor_name%5D%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+in_tensor%2C+out_tensor%E5%8F%82%E6%95%B0%EF%BC%9A+%26nbsp%3B+%26nbsp%3Bmodel_path%EF%BC%9A%E6%8C%87%E5%AE%9A%E4%BA%86%E6%A8%A1%E5%9E%8B%E6%96%87%E4%BB%B6%E6%89%80%E5%9C%A8%E7%9A%84%E8%B7%AF%E5%BE%84%EF%BC%9B+%26nbsp%3B+%26nbsp%3Binput_tensor_name%3A+%26nbsp%3B%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%BE%93%E5%85%A5%E5%BC%A0%E9%87%8F%E5%90%8D%E7%A7%B0%EF%BC%9B+%26nbsp%3B+%26nbsp%3Bbottelneck_tensor_name%3A+%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%93%B6%E9%A2%88%E5%BC%A0%E9%87%8F%EF%BC%9B+%26nbsp%3B+%26nbsp%3Bsess%3A+%E4%BF%9D%E5%AD%98%E6%A8%A1%E5%9E%8B%E6%97%B6%E9%9C%80%E8%A6%81%E4%BC%A0%E5%85%A5%E5%BD%93%E5%89%8D%E7%9A%84%E4%BC%9A%E8%AF%9D%EF%BC%9Bmodel_restore%28%29%E5%9C%A8run_training%28%29%E5%92%8Cpredict_test%28%29%E4%B8%AD%E9%83%BD%E6%9C%89%E4%BD%BF%E7%94%A8%EF%BC%9A%E5%9C%A8run_training%28%29%E4%B8%AD%E6%98%AF%E6%81%A2%E5%A4%8Dinception-v3%E6%A8%A1%E5%9E%8B%EF%BC%9B%E8%80%8C%E5%9C%A8predict_test%28%29%E4%B8%AD%E4%B8%8D%E4%BB%85%E8%A6%81%E6%81%A2%E5%A4%8Dinception-v3%E6%A8%A1%E5%9E%8B%EF%BC%8C%E8%BF%98%E8%A6%81%E6%81%A2%E5%A4%8D%E6%88%91%E4%BB%AC%E5%88%9A%E5%88%9A%E8%AE%AD%E7%BB%83%E5%A5%BD%E7%9A%84%E6%96%B0%E6%A8%A1%E5%9E%8B%EF%BC%8C%E5%9B%A0%E6%AD%A4%E8%B0%83%E7%94%A8%E4%BA%86%E4%B8%A4%E6%AC%A1%E3%80%82%E3%80%90%E5%9B%9B%E5%A4%A7%E9%87%91%E5%88%9A%E3%80%91%EF%BC%9A%E6%A8%A1%E5%9E%8B%E3%80%81%E6%8D%9F%E5%A4%B1%E3%80%81%E8%AE%AD%E7%BB%83%E3%80%81%E8%AF%84%E4%BC%B0def+inference%28inputs%2C+n_classes%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+this_input+%3D+tf.reshape%28inputs%2C+%5B-1%2C+BOTTLENECK_TENSOR_SIZE%5D%2C+name%3D%27input_images%27%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+weights+%3D+tf.get_variable%28%22weights%22%2C+%5BBOTTLENECK_TENSOR_SIZE%2C+n_classes%5D%2C+initializer%3Dtf.truncated_normal_initializer%28stddev%3D0.001%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+biases+%3D+tf.get_variable%28%22biases%22%2C+%5Bn_classes%5D%2C+initializer%3Dtf.constant_initializer%280.0%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+logits+%3D+tf.add%28tf.matmul%28this_input%2C+weights%29%2C+biases%2C+%22logits%22%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+logits%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+loss%28logits%2C+labels%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+labels+%3D+tf.to_int64%28labels%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+cross_entropy+%3D+tf.nn.softmax_cross_entropy_with_logits%28logits%3Dlogits%2C+labels%3Dlabels%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+tf.reduce_mean%28cross_entropy%29%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+training%28loss%2C+learning_rate%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+tf.summary.scalar%28%27loss%27%2C+loss%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+optimizer+%3D+tf.train.GradientDescentOptimizer%28learning_rate%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+global_step+%3D+tf.Variable%280%2C+name%3D%27global_step%27%2C+trainable%3DFalse%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+train_op+%3D+optimizer.minimize%28loss%2C+global_step%3Dglobal_step%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+train_op%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+evaluation%28logits%2C+labels%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+with+tf.name_scope%28%27evaluation%27%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+correct_prediction+%3D+tf.equal%28tf.argmax%28logits%2C+1%29%2C+tf.argmax%28labels%2C+1%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+evaluation_step+%3D+tf.reduce_mean%28tf.cast%28correct_prediction%2C+tf.float32%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+return+evaluation_step%E8%BF%99%E5%9B%9B%E4%B8%AA%E5%87%BD%E6%95%B0%E9%83%BD%E6%98%AF%E9%92%88%E5%AF%B9%E6%88%91%E4%BB%AC%E7%9A%84%E6%96%B0%E6%A8%A1%E5%9E%8B%E8%80%8C%E8%A8%80%EF%BC%9A+%26nbsp%3B+%26nbsp%3Binference%3A+%26nbsp%3B%E5%90%91%E5%89%8D%E4%BC%A0%E6%92%AD%E6%A8%A1%E5%9E%8B%EF%BC%9B+%26nbsp%3B+%26nbsp%3Bloss%3A+%E6%8D%9F%E5%A4%B1%E7%9A%84%E8%AE%A1%E7%AE%97%EF%BC%9B+%26nbsp%3B+%26nbsp%3Btraining%3A+%E9%80%9A%E8%BF%87%E6%9C%80%E5%B0%8F%E5%8C%96%E6%8D%9F%E5%A4%B1%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%EF%BC%9B+%26nbsp%3B+%26nbsp%3Bevaluation%3A+%E8%AE%A1%E7%AE%97%E9%A2%84%E6%B5%8B%E7%9A%84%E7%B2%BE%E7%A1%AE%E5%BA%A6%EF%BC%9B%E3%80%90%E7%93%B6%E9%A2%88%E5%BC%A0%E9%87%8F%E7%9A%84%E8%AE%A1%E7%AE%97%E3%80%91def+create_image_lists%28file_dir%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+training+%3D+%7B%7D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+validation+%3D+%7B%7D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+testing+%3D+%7B%7D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+if+not+os.path.exists%28file_dir%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22Not+such+path%3A%22%2C+file_dir%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+return+None%2C+None%2C+None%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+for+this_dir%2C+sub_dirs%2C+files+in+os.walk%28file_dir%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+if+this_dir+%3D%3D+file_dir+or+not+files%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+continue%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+np.random.shuffle%28files%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+percent10+%3D+int%28len%28files%29+*+0.1%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+this_dir+%3D+os.path.basename%28this_dir.lower%28%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+training%5Bthis_dir%5D+%3D+files%5B%3Apercent10+*+8%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+validation%5Bthis_dir%5D+%3D+files%5Bpercent10+*+8%3Apercent10+*+9%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+testing%5Bthis_dir%5D+%3D+files%5Bpercent10+*+9%3A%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+training%2C+validation%2C+testing%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+get_or_create_bottleneck%28sess_mod%2C+image_path%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+path_seg+%3D+image_path.split%28%27%5C%5C%27%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+label_name+%3D+path_seg%5B-2%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+os.makedirs%28os.path.join%28CACHE_DIR%2C+label_name%29%2C+exist_ok%3DTrue%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+bottleneck_path+%3D+os.path.join%28CACHE_DIR%2C+path_seg%5B-2%5D%2C+path_seg%5B-1%5D%29+%2B+%22.txt%22%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+if+not+os.path.exists%28bottleneck_path%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+image_data+%3D+gfile.FastGFile%28image_path%2C+%27rb%27%29.read%28%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck_values+%3D+sess_mod%5B%27sess%27%5D.run%28sess_mod%5B%27premod_bottleneck%27%5D%2C+feed_dict%3D%7Bsess_mod%5B%27premod_input%27%5D%3A+image_data%7D%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck_values+%3D+np.squeeze%28bottleneck_values%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22HHHA%3A0%3D%3D%3D%3D%26gt%3B%22%2C+image_path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28bottleneck_values%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck_string+%3D+%27%2C%27.join%28str%28x%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B%29+for+x+in+bottleneck_values%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+with+open%28bottleneck_path%2C+%27w%27%29+as+bottleneck_file%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck_file.write%28bottleneck_string%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+else%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+with+open%28bottleneck_path%2C+%27r%27%29+as+bottleneck_file%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck_string+%3D+bottleneck_file.read%28%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck_values+%3D+%5Bfloat%28x%29+for+x+in+bottleneck_string.split%28%27%2C%27%29%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+bottleneck_values%3C%2Fp%3E+%0A++%3Cp%3E%3Cbr%3E+def+get_cached_bottleneck%28sess_mod%2C+images%2C+label%3DNone%2C+index%3DNone%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+label_list+%3D+list%28images.keys%28%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+label_list.sort%28%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+if+label+is+None%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+label+%3D+label_list%5Brandom.randrange%28len%28label_list%29%29%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+if+index+is+None%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+index+%3D+random.randrange%28len%28images%5Blabel%5D%29%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+image_path+%3D+os.path.join%28INPUT_DATA%2C+label%2C+images%5Blabel%5D%5Bindex%5D%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+bottleneck+%3D+get_or_create_bottleneck%28sess_mod%2C+image_path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+ground_truth+%3D+np.zeros%28len%28label_list%29%2C+dtype%3Dnp.float32%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+ground_truth%5Blabel_list.index%28label%29%5D+%3D+1.0%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+bottleneck%2C+ground_truth%2C+image_pathcreate_image_lists%28%29%EF%BC%9A%E7%90%86%E8%A7%A3%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E9%9C%80%E8%A6%81%E7%BB%93%E5%90%88%E6%88%91%E4%BB%AC%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%EF%BC%9Afruit_photos%E4%B8%8B%E9%9D%A2%E6%AF%8F%E7%A7%8D%E6%B0%B4%E6%9E%9C%E7%9A%84%E5%9B%BE%E7%89%87%E6%94%BE%E5%9C%A8%E4%B8%80%E4%B8%AA%E4%BB%A5%E8%AF%A5%E6%B0%B4%E6%9E%9C%E5%91%BD%E5%90%8D%E7%9A%84%E5%B0%8F%E7%9B%AE%E5%BD%95%E4%B8%AD%EF%BC%9A%E5%8F%82%E6%95%B0file_dir%E4%BC%A0%E5%85%A5%E7%9A%84%E5%B0%86%E6%98%AFfruit_photos%E6%89%80%E5%9C%A8%E8%B7%AF%E5%BE%84%E3%80%82%E7%94%A8os.walk%E9%81%8D%E5%8E%86%E8%BF%99%E4%B8%AA%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%B9%B6%E6%8C%891%EF%BC%9A1%EF%BC%9A8%E7%9A%84%E6%AF%94%E4%BE%8B%E6%8A%8A%E6%89%80%E6%9C%89%E5%9B%BE%E7%89%87%E5%88%86%E5%89%B2%E6%88%90%E8%AE%AD%E7%BB%83%E3%80%81%E9%AA%8C%E8%AF%81%E3%80%81%E6%B5%8B%E8%AF%95%E4%B8%89%E4%B8%AA%E6%95%B0%E6%8D%AE%E9%9B%86%EF%BC%8C%E6%AF%8F%E4%B8%AA%E6%95%B0%E6%8D%AE%E9%9B%86%E9%83%BD%E6%98%AF%E4%B8%80%E4%B8%AA%E5%AD%97%E5%85%B8%EF%BC%9A%E4%BB%A5%E6%B0%B4%E6%9E%9C%E5%90%8D%E7%A7%B0%E4%B8%BA%E9%94%AE%EF%BC%8C%E4%BB%A5%E5%9B%BE%E7%89%87%E5%90%8D%E7%A7%B0%E5%88%97%E8%A1%A8%E4%B8%BA%E5%80%BC%E3%80%82get_or_create_bottleneck%28%29%3A%E8%8E%B7%E5%8F%96%E6%88%96%E5%88%9B%E5%BB%BA%E7%93%B6%E9%A2%88%E5%90%91%E9%87%8F%EF%BC%9A%E7%94%A8%E6%8C%87%E5%AE%9A%E7%9A%84%E6%A8%A1%E5%9E%8B%E8%AE%A1%E7%AE%97%E6%8C%87%E5%AE%9A%E5%9B%BE%E7%89%87%E7%9A%84%E7%93%B6%E9%A2%88%E5%90%91%E9%87%8F%E3%80%82%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D%E5%91%A2%EF%BC%9F%E5%85%B7%E4%BD%93%E5%B0%B1%E6%98%AF%E8%8E%B7%E5%8F%96%E5%9B%BE%E7%89%87A%E7%BB%8F%E8%BF%87inception-v3%E8%BF%99%E4%B8%AA%E6%A8%A1%E5%9E%8B%E4%B9%8B%E5%90%8E%E7%9A%84%E8%BE%93%E5%87%BA%E3%80%82%E5%8F%82%E6%95%B0sess_mod%E6%98%AF%E5%B0%81%E8%A3%85%E4%BA%86inception-v3%E7%9A%84%E8%BE%93%E5%85%A5%E3%80%81%E8%BE%93%E5%87%BA%E3%80%81%E5%92%8C%E7%94%A8%E4%BA%8E%E8%AE%A1%E7%AE%97%E7%9A%84sess%EF%BC%9Abottleneck_values+%3D+sess_mod%5B%27sess%27%5D.run%28sess_mod%5B%27premod_bottleneck%27%5D%2C+feed_dict%3D%7Bsess_mod%5B%27premod_input%27%5D%3A+image_data%7D%29%E5%8F%AF%E5%AF%B9%E6%AF%94tensorflow%E7%9A%84%E7%BB%8F%E5%85%B8%E6%96%B9%E5%BC%8F%E8%BF%9B%E8%A1%8C%E7%90%86%E8%A7%A3%EF%BC%9Asess.run%28z%2C+feed_dict%3D%7Bx%3Aa%2C+y%3Ab%7D%29%E8%AE%A1%E7%AE%97%E7%93%B6%E9%A2%88%E5%90%91%E9%87%8F%E6%AF%94%E8%BE%83%E8%80%97%E6%97%B6%EF%BC%8C%E4%B8%BA%E4%BA%86%E9%81%BF%E5%85%8D%E9%87%8D%E5%A4%8D%E8%AE%A1%E7%AE%97%EF%BC%8C%E6%8A%8A%E8%AE%A1%E7%AE%97%E7%BB%93%E6%9E%9C%E5%AD%98%E6%94%BE%E5%9C%A8CACHE_DIR%2F%E6%B0%B4%E6%9E%9C%E5%90%8D%2F%E4%B8%AD%EF%BC%8C%E4%BB%A5%E5%9B%BE%E7%89%87%E5%90%8D.txt%E5%91%BD%E5%90%8D%E3%80%82%E6%AF%8F%E6%AC%A1%E8%8E%B7%E5%8F%96%E6%97%B6%E5%85%88%E5%B0%9D%E8%AF%95%E4%BB%8E%E8%AF%A5%E7%9B%AE%E5%BD%95%E4%B8%AD%E8%8E%B7%E5%8F%96%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%96%87%E4%BB%B6%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%88%99%E7%94%A8%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E8%AE%A1%E7%AE%97%E5%B9%B6%E4%BF%9D%E5%AD%98%E3%80%82%E5%8F%82%E6%95%B0image_path%E6%8C%87%E6%98%8E%E4%BA%86%E7%BB%99%E8%8E%B7%E5%8F%96%E5%93%AA%E5%BC%A0%E5%9B%BE%E7%89%87%E7%9A%84%E7%93%B6%E9%A2%88%E5%90%91%E9%87%8F%E3%80%82get_cached_bottleneck%28%29%3A%E5%9F%BA%E4%BA%8Eget_or_create_bottleneck%28%29%E7%9A%84%E5%B0%81%E8%A3%85%EF%BC%8C%E5%8F%82%E6%95%B0%EF%BC%9A+%26nbsp%3B+images%3A+%E5%9B%BE%E7%89%87%E5%88%97%E8%A1%A8%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AFcreate_image_list%E4%B8%AD%E5%88%86%E5%89%B2%E5%87%BA%E6%9D%A5%E7%9A%84training%2C+validation%2C+testing%E4%B8%89%E4%B8%AA%E6%95%B0%E6%8D%AE%E9%9B%86%E4%B8%AD%E7%9A%84%E4%B8%80%E4%B8%AA%EF%BC%9B+%26nbsp%3B+label%3A+%E6%B0%B4%E6%9E%9C%E5%90%8D%E7%A7%B0%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%EF%BC%8C%E5%88%99%E9%9A%8F%E6%9C%BA%E9%80%89%E6%8B%A9%E4%B8%80%E7%A7%8D%E6%B0%B4%E6%9E%9C+%26nbsp%3B+index%3A+%E6%96%87%E4%BB%B6%E4%B8%8B%E6%A0%87%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%EF%BC%8C%E5%88%99%E9%9A%8F%E6%9C%BA%E9%80%89%E6%8B%A9%E4%B8%80%E4%B8%AA%E4%B8%8B%E6%A0%87%E5%A6%82%EF%BC%9Aget_cached_bottleneck%28sess_mod%2C+training%2C+%22apple%22%2C+0%29%E7%9A%84%E6%84%8F%E6%80%9D%E6%98%AF%E8%8E%B7%E5%8F%96%E8%AE%AD%E7%BB%83%E9%9B%86%E4%B8%AD%E7%9A%84%E8%8B%B9%E6%9E%9C%E7%9A%84%E4%B8%8B%E6%A0%87%E4%B8%BA0%E7%9A%84%E5%9B%BE%E7%89%87%E7%9A%84%E7%93%B6%E9%A2%88%E5%90%91%E9%87%8F%EF%BC%9B%E5%8F%88%E5%A6%82%EF%BC%9Aget_cached_bottleneck%28sess_mod%2C+training%29%E7%9A%84%E6%84%8F%E6%80%9D%E6%98%AF%E4%BB%8E%E8%AE%AD%E7%BB%83%E9%9B%86%E4%B8%AD%E9%9A%8F%E6%9C%BA%E8%8E%B7%E5%8F%96%E4%B8%80%E5%BC%A0%E5%9B%BE%E7%89%87%E7%9A%84%E7%93%B6%E9%A2%88%E5%90%91%E9%87%8F%E3%80%82%E3%80%90%E8%AE%AD%E7%BB%83%E5%AD%97%E5%85%B8%E7%9A%84%E7%94%9F%E6%88%90%E3%80%91def+fill_feed_dict%28sess_mod%2C+image_lists%2C+amount%3DNone%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+bottlenecks+%3D+%5B%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+ground_truths+%3D+%5B%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+this_paths+%3D+%5B%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+if+amount+is+None%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+for+label+in+list%28image_lists.keys%28%29%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+for+index%2C+file+in+enumerate%28image_lists%5Blabel%5D%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck%2C+ground_truth%2C+path+%3D+get_cached_bottleneck%28sess_mod%2C+image_lists%2C+label%2C+index%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottlenecks.append%28bottleneck%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+ground_truths.append%28ground_truth%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+this_paths.append%28path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+else%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+for+_+in+range%28amount%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottleneck%2C+ground_truth%2C+path+%3D+get_cached_bottleneck%28sess_mod%2C+image_lists%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+bottlenecks.append%28bottleneck%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+ground_truths.append%28ground_truth%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+this_paths.append%28path%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+feed_dict+%3D+%7B%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+sess_mod%5B%27placeholder_input%27%5D%3A+bottlenecks%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+sess_mod%5B%27placeholder_labels%27%5D%3A+ground_truths%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%7D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+return+feed_dict%2C+this_paths%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%9C%80%E7%BB%88%E8%BE%93%E5%87%BA%E4%B8%80%E4%B8%AA%E5%AD%97%E5%85%B8%EF%BC%8C%E7%94%A8%E4%BA%8E%E6%96%B0%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%AE%A1%E7%AE%97%E3%80%82+%26nbsp%3B+feed_dict+%3D+%7B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3Bsess_mod%5B%27placeholder_input%27%5D%3A+bottlenecks%2C+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3Bsess_mod%5B%27placeholder_labels%27%5D%3A+ground_truths%2C%7Dbottlenecks%E6%98%AF%E5%9B%BE%E7%89%87%E7%BB%8F%E8%BF%87inception-v3%E7%9A%84%E8%BE%93%E5%87%BA%EF%BC%8C%E5%AE%83%E5%B0%86%E4%BD%9C%E4%B8%BA%E6%96%B0%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%BE%93%E5%85%A5%E3%80%82sess_mod%5B%27placeholder_input%27%5D%E6%98%AF%E6%96%B0%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%BE%93%E5%87%BA%E5%8D%A0%E4%BD%8D%E5%BC%A0%E9%87%8F%EF%BC%9Bsess_mod%5B%27placeholder_labels%27%5D%E6%98%AF%E5%9B%BE%E7%89%87%E7%9A%84%E6%AD%A3%E7%A1%AE%E6%A0%87%E7%AD%BE%E2%80%94%E2%80%94%E8%AE%A1%E7%AE%97%E7%93%B6%E9%A2%88%E5%90%91%E9%87%8F%E7%9A%84%E6%97%B6%E5%80%99%E2%80%9C%E9%A1%BA%E4%BE%BF%E2%80%9D%E7%94%9F%E6%88%90%E7%9A%84%E3%80%82%E5%86%8D%E7%9C%8Bamount%E8%BF%99%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%9A%E8%AE%AD%E7%BB%83%E7%9A%84%E6%97%B6%E5%80%99%E7%94%A8BATCH%EF%BC%8C%E8%AF%84%E4%BC%B0%E7%9A%84%E6%97%B6%E5%80%99%E6%9C%AA%E6%8C%87%E5%AE%9A%E2%80%94%E2%80%94%E7%AD%89%E6%95%88%E4%BA%8ENone%EF%BC%8Cpredict_test%28%29%E7%9A%84%E6%97%B6%E5%80%99%E7%94%A81%EF%BC%8C%E8%BF%99%E6%98%AF%E4%B8%BA%E4%BB%80%E4%B9%88%E5%91%A2%EF%BC%9F%E5%8E%9F%E6%9D%A5amount%E6%98%AF%E6%8C%87%E6%98%8E%E8%A6%81%E9%9A%8F%E6%9C%BA%E5%A1%AB%E5%85%85%E7%9A%84%E5%9B%BE%E7%89%87%E6%95%B0%E9%87%8F%EF%BC%8C%E5%BD%93%E4%B8%BA%E7%A9%BA%E6%97%B6%E5%80%99%E5%B0%86%E5%A1%AB%E5%85%85%E4%BC%A0%E5%85%A5%E7%9A%84%E6%95%B4%E4%B8%AA%E5%9B%BE%E7%89%87%E5%88%97%E8%A1%A8%E3%80%82predict_test%28%29%E9%98%B6%E6%AE%B5%E7%94%B1%E4%BA%8E%E8%A6%81%E5%90%91%E7%94%A8%E6%88%B7%E5%B1%95%E7%A4%BA%E5%9B%BE%E7%89%87%EF%BC%8C%E5%9B%A0%E6%AD%A4%E6%AF%8F%E6%AC%A1%E5%8F%AA%E5%A1%AB%E5%85%85%E4%B8%80%E5%BC%A0%E3%80%82%E3%80%90%E8%BF%90%E8%A1%8C%E8%AE%AD%E7%BB%83%E3%80%91def+run_training%28epoch%3DSTEPS%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+imgs_training%2C+imgs_validation%2C+imgs_testing+%3D+create_image_lists%28INPUT_DATA%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+n_classes+%3D+len%28imgs_training.keys%28%29%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+m1_input%2C+m1_bottleneck+%3D+model_restore%28os.path.join%28MODEL_DIR%2C+MODEL_FILE%29%2C+JPEG_DATA_TENSOR_NAME%2C+BOTTLENECK_TENSOR_NAME%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+placeholder_input+%3D+tf.placeholder%28tf.float32%2C+%5BNone%2C+BOTTLENECK_TENSOR_SIZE%5D%2C+name%3D%27in_images%27%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+placeholder_labels+%3D+tf.placeholder%28tf.float32%2C+%5BNone%2C+n_classes%5D%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+logits+%3D+inference%28placeholder_input%2C+n_classes%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+this_loss+%3D+loss%28logits%2C+placeholder_labels%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+train_step+%3D+training%28this_loss%2C+LEARNING_RATE%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+evaluation_step+%3D+evaluation%28logits%2C+placeholder_labels%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+init+%3D+tf.global_variables_initializer%28%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+with+tf.Session%28%29+as+sess%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+sess.run%28init%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+sess_mod+%3D+%7B%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27sess%27%3A+sess%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27premod_input%27%3A+m1_input%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27premod_bottleneck%27%3A+m1_bottleneck%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27placeholder_input%27%3A+placeholder_input%2C%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%27placeholder_labels%27%3A+placeholder_labels%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%7D%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+for+step+in+range%28epoch%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+feed_dict%2C+image_path+%3D+fill_feed_dict%28sess_mod%2C+imgs_training%2C+BATCH%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+sess.run%28train_step%2C+feed_dict%3Dfeed_dict%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+if+step+%25+100+%3D%3D+0+or+step+%2B+1+%3D%3D+STEPS%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+feed_dict%2C+image_path+%3D+fill_feed_dict%28sess_mod%2C+imgs_validation%2C+BATCH%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+accuracy+%3D+sess.run%28evaluation_step%2C+feed_dict%3Dfeed_dict%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22Step+%25d%3A+Validation+accuracy+on+random+sampled+%25d+examples+%3D+%25.2f%25%25%22+%25+%28step%2C+BATCH%2C+accuracy+*+100%29%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+accuracy+%3D+sess.run%28evaluation_step%2C+feed_dict%3Dfill_feed_dict%28sess_mod%2C+imgs_testing%29%5B0%5D%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22Final+test+accuracy+%3D+%25.1f%25%25%22+%25+%28accuracy+*+100%29%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+model_save%28sess%2C+os.path.join%28THIS_MODEL_DIR%2C+THIS_MODEL_FILE%29%2C+%22in_images%22%2C+%27logits%27%29%E8%BF%99%E6%98%AF%E8%AE%AD%E7%BB%83%E7%9A%84%E4%B8%BB%E5%B9%B2%E8%BF%87%E7%A8%8B%EF%BC%8C%E8%A7%A3%E9%87%8A%E5%AE%8C%E5%89%8D%E9%9D%A2%E7%9A%84%E5%B0%8F%E5%87%BD%E6%95%B0%E4%B9%8B%E5%90%8E%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%BC%BC%E4%B9%8E%E6%B2%A1%E6%9C%89%E5%A4%AA%E5%A4%9A%E9%9C%80%E8%A6%81%E8%A7%A3%E9%87%8A%E7%9A%84%E4%BA%86%EF%BC%8C%E5%AE%83%E5%B0%B1%E6%98%AF%E6%8A%8A%E5%89%8D%E4%BB%8B%E7%BB%8D%E7%9A%84%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E4%BA%86%E4%B8%80%E9%81%8D%EF%BC%81sess_mod%E7%9A%84%E8%BF%99%E6%A0%B7%E5%B0%81%E8%A3%85%E7%9A%84%E5%8E%9F%E5%9B%A0%E6%98%AFsess%E3%80%81m1_input%EF%BC%8Cm1_bottelneck%E8%BF%99%E5%87%A0%E4%B8%AA%E5%8F%82%E6%95%B0%E7%BB%8F%E8%BF%87%E5%A4%9A%E5%B1%82%E4%BC%A0%E9%80%92%E6%9C%80%E7%BB%88%E6%89%A7%E8%A1%8C%EF%BC%8C%E6%8A%8A%E5%AE%83%E4%BB%AC%E5%85%A5%E5%9C%A8%E5%AD%97%E5%85%B8%E4%B8%AD%E5%8F%AF%E5%87%8F%E5%B0%91%E4%B8%AD%E9%97%B4%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0%E6%95%B0%E9%87%8F%EF%BC%8C%E5%A2%9E%E5%8A%A0%E4%BB%A3%E7%A0%81%E7%9A%84%E5%8F%AF%E8%AF%BB%E6%80%A7%E3%80%82%E3%80%90%E5%9B%BE%E7%89%87%E5%B1%95%E7%A4%BA%E5%87%BD%E6%95%B0%E7%89%87%E6%AE%B5%E3%80%91while+True%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+this_logits+%3D+sess.run%28m2_bottleneck%2C+feed_dict%3Dfeed_dict%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+f_tensor%2C+f_index+%3D+sess.run%28%5Bfinal_tensor%2C+final_index%5D%2C+feed_dict%3D%7Bplaceholder_logits%3A+this_logits%7D%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+image_path+%3D+image_path%5B0%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+f_tensor+%3D+f_tensor%5B0%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+f_index+%3D+f_index%5B0%5D%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+print%28%22image_path%3A%22%2C+image_path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+print%28%22f_tensor%3A%22%2C+f_tensor%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+print%28%22f_index%22%2C+f_index%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+label_list+%3D+list%28imgs_testing.keys%28%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+label_list.sort%28%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+f_predict+%3D+label_list%5Bf_index%5D%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+print%28%22f_predict%3A%22%2C+f_predict%29%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B+%26nbsp%3B+img+%3D+cv2.imread%28image_path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+if+img+is+None%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22File+not+found%3A%22%2C+image_path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+continue%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+img+%3D+cv2.resize%28img%2C+%28500%2C+500%29%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+cv2.putText%28img%2C+os.path.basename%28image_path%29%2C+%2850%2C+50%29%2C+cv2.FONT_HERSHEY_COMPLEX%2C+1%2C+%28255%2C+0%2C+0%29%2C+1%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+cv2.putText%28img%2C+f_predict%2C+%2850%2C+150%29%2C+cv2.FONT_HERSHEY_COMPLEX%2C+3%2C+%28255%2C+0%2C+255%29%2C+5%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+cv2.imshow%28%22predict%22%2C+img%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+key+%3D+cv2.waitKey%28%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+if+key+%26amp%3B+0xFF+%3D%3D+ord%28%27q%27%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+break%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+elif+key+%26amp%3B+0xFF+%3D%3D+ord%28%27d%27%29%3A%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+print%28%22removing%3A%22%2C+image_path%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+%26nbsp%3B+os.remove%28image_path%29%E7%94%A8opencv%EF%BC%8Ccv2.imread%28%29%3A+%E8%AF%BB%E5%8F%96%E5%9B%BE%E7%89%87%EF%BC%9Bcv2.resize%28%29%3A+%E5%B0%86%E5%9B%BE%E7%89%87%E5%A4%A7%E5%B0%8F%E8%B0%83%E6%95%B4%E4%B8%BA500*500%EF%BC%8C%E8%BF%99%E6%98%AF%E5%9B%A0%E4%B8%BA%E5%8E%9F%E5%9B%BE%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%B9%B6%E9%9D%9E%E7%BB%9F%E4%B8%80%E7%9A%84%EF%BC%8C%E5%BB%BA%E8%AE%AE%E8%AF%BB%E8%80%85%E8%AF%95%E8%AF%95%E5%8E%BB%E6%8E%89%E7%9A%84%E6%95%88%E6%9E%9C%EF%BC%9Bcv2.putText%28%29%3A+%E5%9C%A8%E5%9B%BE%E4%B8%8A%E6%98%BE%E7%A4%BA%E6%96%87%E5%AD%97%EF%BC%9Bcv2.imshow%28%29%3A+%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87%EF%BC%9Bcv2.waitKey%28%29%3A+%E7%AD%89%E5%BE%85%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%3A+%26nbsp%3B+%26nbsp%3B%E5%A6%82%E6%9E%9C%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5q%3A+%E9%80%80%E5%87%BA%E5%BE%AA%E7%8E%AF%EF%BC%9B+%26nbsp%3B+%26nbsp%3B%E5%A6%82%E6%9E%9C%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5d%3A+%E5%88%A0%E9%99%A4%E5%BD%93%E5%89%8D%E5%9B%BE%E7%89%87%EF%BC%8C%E8%BF%99%E5%9C%A8%E5%89%94%E9%99%A4%E9%94%99%E8%AF%AF%E5%9B%BE%E7%89%87%E6%97%B6%E7%9B%B8%E5%BD%93%E6%96%B9%E4%BE%BF%E3%80%90%E6%89%A9%E5%B1%95%E3%80%91%E5%B0%86model_save%28%29%2Fmodel_restore%28%29%E6%94%B6%E5%85%A5ulibs.py%E4%B8%AD%EF%BC%8C%E7%84%B6%E5%90%8E%E9%80%9A%E8%BF%87%E4%BB%A5%E4%B8%8B%E6%96%B9%E5%BC%8F%E8%B0%83%E7%94%A8%3Aimport+ulibs+ulibs.model_save%28%29+%26nbsp%3Bulibs.model_restore%28%29%E5%8F%82%E8%80%83%EF%BC%9A%E3%80%8ATensorFlow%E5%AE%9E%E6%88%98Google%E5%B0%9D%E8%AF%95%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6%E3%80%8B--%E9%83%91%E6%B3%BD%E5%AE%87+%E9%A1%BE%E6%80%9D%E5%AE%87%3Cbr%3E+%26nbsp%3B%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E" | url_decode}}
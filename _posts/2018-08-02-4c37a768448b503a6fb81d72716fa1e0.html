---
layout: default
title: 区块链开发之BTC离线签名
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Cdiv+class%3D%22markdown_views%22%3E+%0A++%3Ch1+id%3D%22%E5%BC%95%E8%A8%80%22%3E%E5%BC%95%E8%A8%80%3C%2Fh1%3E+%0A++%3Cp%3Ebtc%E7%9A%84%E8%B4%A6%E6%88%B7%E7%B3%BB%E7%BB%9F%E6%98%AF%E5%9F%BA%E4%BA%8Eutxo%E6%A8%A1%E5%BC%8F%E7%9A%84%EF%BC%88utxo%E5%85%B7%E4%BD%93%E8%A7%A3%E9%87%8A%EF%BC%8C%E5%A4%A7%E5%AE%B6%E5%8F%AF%E4%BB%A5%E8%87%AA%E8%A1%8C%E6%90%9C%E7%B4%A2%EF%BC%89%EF%BC%8C%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96utxo%E5%88%97%E8%A1%A8%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E6%88%91%E5%89%8D%E7%AF%87%E6%96%87%E7%AB%A0%EF%BC%9A%3Ca+href%3D%22https%3A%2F%2Fblog.csdn.net%2Fwypeng2010%2Farticle%2Fdetails%2F81355647%22+rel%3D%22nofollow%22%3E%E5%8C%BA%E5%9D%97%E9%93%BE%E5%BC%80%E5%8F%91%E4%B9%8B%E8%8E%B7%E5%8F%96BTC%EF%BC%8CETH%E7%9A%84%E4%BD%99%E9%A2%9D%EF%BC%8CBTC%E7%9A%84UTXO%E5%88%97%E8%A1%A8%EF%BC%8CETH%E7%9A%84nonce%3C%2Fa%3E%3C%2Fp%3E+%0A++%3Cp%3E%E8%8E%B7%E5%8F%96%E5%88%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%A4%A7%E8%87%B4%E5%A6%82%E4%B8%8B%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-java+hljs+%22%3E%5B%0A++%7B%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22address%22%3C%2Fspan%3E%3A%3Cspan+class%3D%22hljs-string%22%3E%22mo9ncXisMeAoXwqcV5EWuyncbmCcQN4rVs%22%3C%2Fspan%3E%2C%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22txid%22%3C%2Fspan%3E%3A%3Cspan+class%3D%22hljs-string%22%3E%22d5f8a96faccf79d4c087fa217627bb1120e83f8ea1a7d84b1de4277ead9bbac1%22%3C%2Fspan%3E%2C%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22vout%22%3C%2Fspan%3E%3A%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22scriptPubKey%22%3C%2Fspan%3E%3A%3Cspan+class%3D%22hljs-string%22%3E%2276a91453c0307d6851aa0ce7825ba883c6bd9ad242b48688ac%22%3C%2Fspan%3E%2C%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22amount%22%3C%2Fspan%3E%3A%3Cspan+class%3D%22hljs-number%22%3E0.000006%3C%2Fspan%3E%2C%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22satoshis%22%3C%2Fspan%3E%3A%3Cspan+class%3D%22hljs-number%22%3E600%3C%2Fspan%3E%2C%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22confirmations%22%3C%2Fspan%3E%3A%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22ts%22%3C%2Fspan%3E%3A%3Cspan+class%3D%22hljs-number%22%3E1461349425%3C%2Fspan%3E%0A++%7D%2C%0A++%7B%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22address%22%3C%2Fspan%3E%3A+%3Cspan+class%3D%22hljs-string%22%3E%22mo9ncXisMeAoXwqcV5EWuyncbmCcQN4rVs%22%3C%2Fspan%3E%2C%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22txid%22%3C%2Fspan%3E%3A+%3Cspan+class%3D%22hljs-string%22%3E%22bc9df3b92120feaee4edc80963d8ed59d6a78ea0defef3ec3cb374f2015bfc6e%22%3C%2Fspan%3E%2C%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22vout%22%3C%2Fspan%3E%3A+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%2C%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22scriptPubKey%22%3C%2Fspan%3E%3A+%3Cspan+class%3D%22hljs-string%22%3E%2276a91453c0307d6851aa0ce7825ba883c6bd9ad242b48688ac%22%3C%2Fspan%3E%2C%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22amount%22%3C%2Fspan%3E%3A+%3Cspan+class%3D%22hljs-number%22%3E0.12345678%3C%2Fspan%3E%2C%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22satoshis%3A+12345678%2C+%22%3C%2Fspan%3Econfirmations%3Cspan+class%3D%22hljs-string%22%3E%22%3A+1%2C+%22%3C%2Fspan%3Eheight%3Cspan+class%3D%22hljs-string%22%3E%22%3A+300001+%7D+%5D%3C%2Fspan%3E%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%85%B7%E4%BD%93%E4%BB%A3%E7%A0%81%E5%A6%82%E4%B8%8B%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22language-java+hljs+%22%3E+++%3Cspan+class%3D%22hljs-keyword%22%3Epublic%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Estatic%3C%2Fspan%3E+String+%3Cspan+class%3D%22hljs-title%22%3EsignBTCTransactionData%3C%2Fspan%3E%28%40NonNull+List%26lt%3BUnSpentBTC%26gt%3B+unSpentBTCList%2C+%40NonNull+String+from%2C+%40NonNull+String+to%2C+%40NonNull+String+privateKey%2C+%3Cspan+class%3D%22hljs-keyword%22%3Elong%3C%2Fspan%3E+value%2C+%3Cspan+class%3D%22hljs-keyword%22%3Elong%3C%2Fspan%3E+fee%29+%3Cspan+class%3D%22hljs-keyword%22%3Ethrows%3C%2Fspan%3E+Exception+%7B%0A++++++++NetworkParameters+networkParameters+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enull%3C%2Fspan%3E%3B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28%21BTC_TEST_NET%29%0A++++++++++++networkParameters+%3D+MainNetParams.get%28%29%3B%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%0A++++++++++++networkParameters+%3D+TestNet3Params.get%28%29%3B%0A%0A++++++++Transaction+transaction+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+Transaction%28networkParameters%29%3B%0A++++++++DumpedPrivateKey+dumpedPrivateKey+%3D+DumpedPrivateKey.fromBase58%28networkParameters%2C+privateKey%29%3B%0A%0A++++++++ECKey+ecKey+%3D+dumpedPrivateKey.getKey%28%29%3B%0A%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Elong%3C%2Fspan%3E+totalMoney+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3B%0A++++++++List%26lt%3BUTXO%26gt%3B+utxos+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+ArrayList%26lt%3B%26gt%3B%28%29%3B%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E9%81%8D%E5%8E%86%E6%9C%AA%E8%8A%B1%E8%B4%B9%E5%88%97%E8%A1%A8%EF%BC%8C%E7%BB%84%E8%A3%85%E5%90%88%E9%80%82%E7%9A%84item%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+%28UnSpentBTC+us+%3A+unSpentBTCList%29+%7B%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28totalMoney+%26gt%3B%3D+%28value+%2B+fee%29%29%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ebreak%3C%2Fspan%3E%3B%0A++++++++++++UTXO+utxo+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+UTXO%28Sha256Hash.wrap%28us.getTxid%28%29%29%2C+us.getVout%28%29%2C+Coin.valueOf%28us.getSatoshis%28%29%29%2C%0A++++++++++++++++++++us.getHeight%28%29%2C+%3Cspan+class%3D%22hljs-keyword%22%3Efalse%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+Script%28Hex.decode%28us.getScriptPubKey%28%29%29%29%29%3B%0A++++++++++++utxos.add%28utxo%29%3B%0A++++++++++++totalMoney+%2B%3D+us.getSatoshis%28%29%3B%0A++++++++%7D%0A%0A++++++++transaction.addOutput%28Coin.valueOf%28value%29%2C+Address.fromBase58%28networkParameters%2C+to%29%29%3B%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F+transaction.%3C%2Fspan%3E%0A%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%B6%88%E8%B4%B9%E5%88%97%E8%A1%A8%E6%80%BB%E9%87%91%E9%A2%9D+-+%E5%B7%B2%E7%BB%8F%E8%BD%AC%E8%B4%A6%E7%9A%84%E9%87%91%E9%A2%9D+-+%E6%89%8B%E7%BB%AD%E8%B4%B9+%E5%B0%B1%E7%AD%89%E4%BA%8E%E9%9C%80%E8%A6%81%E8%BF%94%E5%9B%9E%E7%BB%99%E8%87%AA%E5%B7%B1%E7%9A%84%E9%87%91%E9%A2%9D%E4%BA%86%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Elong%3C%2Fspan%3E+balance+%3D+totalMoney+-+value+-+fee%3B%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%BE%93%E5%87%BA-%E8%BD%AC%E7%BB%99%E8%87%AA%E5%B7%B1%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28balance+%26gt%3B+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%29+%7B%0A++++++++++++transaction.addOutput%28Coin.valueOf%28balance%29%2C+Address.fromBase58%28networkParameters%2C+from%29%29%3B%0A++++++++%7D%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%BE%93%E5%85%A5%E6%9C%AA%E6%B6%88%E8%B4%B9%E5%88%97%E8%A1%A8%E9%A1%B9%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+%28UTXO+utxo+%3A+utxos%29+%7B%0A++++++++++++TransactionOutPoint+outPoint+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+TransactionOutPoint%28networkParameters%2C+utxo.getIndex%28%29%2C+utxo.getHash%28%29%29%3B%0A++++++++++++transaction.addSignedInput%28outPoint%2C+utxo.getScript%28%29%2C+ecKey%2C+Transaction.SigHash.ALL%2C+%3Cspan+class%3D%22hljs-keyword%22%3Etrue%3C%2Fspan%3E%29%3B%0A++++++++%7D%0A%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+Hex.toHexString%28transaction.bitcoinSerialize%28%29%29%3B%0A++++%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A+%3C%2Fdiv%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fmarkdown_views-ea0013b516.css%22%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn+btn-red-hollow%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fwypeng2010%2Farticle%2Fdetails%2F81357265%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fwypeng2010%2Farticle%2Fdetails%2F81357265%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}
---
layout: default
title: RBD创建一个image
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Cdiv+class%3D%22markdown_views%22%3E+%0A++%3Cp%3ERBD%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAimage%E7%9A%84%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%E3%80%82%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+cpp%22%3Erbd.cc%0Ado_create%28librbd%3A%3ARBD+%26amp%3Brbd%2C+librados%3A%3AIoCtx%26amp%3B+io_ctx%2C%3Cspan+class%3D%22hljs-keyword%22%3Econst%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Echar%3C%2Fspan%3E+*imgname%2C%0A++++++++++uint64_t+size%2C+%3Cspan+class%3D%22hljs-keyword%22%3Eint%3C%2Fspan%3E+*order%2C%3Cspan+class%3D%22hljs-keyword%22%3Eint%3C%2Fspan%3E+format%2C+uint64_t+features%2C%0A++++++++++uint64_t+stripe_unit%2C+uint64_t+stripe_count%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAimage%3C%2Fspan%3E%0A++++%26gt%3Brbd.create3%28io_ctx%2C+imgname%2C+size%2C+features%2C+order%2Cstripe_unit%2C+stripe_count%29%2Fcreate%28...%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2Frbd+%E5%88%9B%E5%BB%BAimage%3C%2Fspan%3E%0A++++++++%26gt%3Blibrbd%3A%3Acreate%28io_ctx%2C+name%2C+size%2C+%3Cspan+class%3D%22hljs-keyword%22%3Efalse%3C%2Fspan%3E%2C+features%2C+order%2Cstripe_unit%2C+stripe_count%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2Flibrbd+%E5%88%9B%E5%BB%BAimage%3C%2Fspan%3E%0A++++++++++++%26gt%3Bdetect_format%28io_ctx%2C+imgname%2C+NULL%2C+NULL%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%8E%B7%E5%8F%96image%E7%9A%84%E6%A0%BC%E5%BC%8F%EF%BC%8C%E8%BF%99%E9%87%8C%E7%94%A8%E5%AE%83%E6%9D%A5%E5%88%A4%E6%96%AD%E8%AF%A5image%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%3C%2Fspan%3E%0A++++++++++++%26gt%3Buint64_t+bid+%3D+rados.get_instance_id%28%29%0A++++++++++++%26gt%3Bcreate_v1%28io_ctx%2C+imgname%2C+bid%2C+size%2C+*order%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2Fformat+%3D%3D+1%3C%2Fspan%3E%0A++++++++++++%26gt%3Bcreate_v2%28io_ctx%2C+imgname%2C+bid%2C+size%2C+*order%2C+features%2Cstripe_unit%2C+stripe_count%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2Fformat+%3D%3D2+%E4%BB%A5v2%E4%B8%BA%E4%BE%8B%3C%2Fspan%3E%0A++++++++++++++++%26gt%3Bvalidate_pool%28io_ctx%2C+cct%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%88%A4%E6%96%ADpool%E6%98%AF%E5%90%A6%E6%9C%89%E6%95%88%3C%2Fspan%3E%0A++++++++++++++++%26gt%3Bid_obj_name%28imgname%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%9E%84%E5%BB%BAimage%E7%9A%84ID+rbd_id.%7Bimgname%7D%3C%2Fspan%3E%0A++++++++++++++++%26gt%3Bio_ctx.create%28id_obj%2C+%3Cspan+class%3D%22hljs-keyword%22%3Etrue%3C%2Fspan%3E%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%88%9B%E5%BB%BAimage%E7%9A%84ID%E5%AF%B9%E8%B1%A1%3C%2Fspan%3E%0A++++++++++++++++++++%26gt%3Bio_ctx_impl-%26gt%3Bcreate%28obj%2C+exclusive%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%88%9B%E5%BB%BAobject_t%E7%9A%84%E5%AE%9E%E4%BE%8B%3C%2Fspan%3E%0A++++++++++++++++++++++++%26gt%3Bio_ctx_impl-%26gt%3Bcreate%28obj%2C+exclusive%29%0A++++++++++++++++++++++++++++%26gt%3Bop.create%28exclusive%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2Fop%28ObjectOperation%29%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++%26gt%3B%3A%3AObjectOperation+*o+%3D+%28%3A%3AObjectOperation+*%29impl%3B%0A++++++++++++++++++++++++++++++++%26gt%3Bo-%26gt%3Bcreate%28exclusive%29%0A++++++++++++++++++++++++++++++++++++%26gt%3BOSDOp%26amp%3B+o+%3D+add_op%28CEPH_OSD_OP_CREATE%29%0A++++++++++++++++++++++++++++%26gt%3Boperate%28oid%2C+%26amp%3Bop%2C+NULL%29%0A++++++++++++++++++++++++++++++++%26gt%3BObjecter%3A%3AOp+*objecter_op+%3D+objecter-%26gt%3Bprepare_mutate_op%28oid%2C+oloc%2C*o%2C+snapc%2C+ut%2C+flags%2CNULL%2C+oncommit%2C+%26amp%3Bver%29%0A++++++++++++++++++++++++++++++++%26gt%3Bobjecter-%26gt%3Bop_submit%28objecter_op%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%8F%90%E4%BA%A4Objecter%3A%3AOp%2C%E8%BF%9B%E5%85%A5Objecter%E5%B1%82%3C%2Fspan%3E%0A++++++++++++++++%26gt%3Bcls_client%3A%3Aset_id%28%26amp%3Bio_ctx%2C+id_obj%2C+id%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%AE%BE%E7%BD%AEimage%E7%9A%84id+%EF%BC%88%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0%EF%BC%89%3C%2Fspan%3E%0A++++++++++++++++++++%26gt%3Bioctx-%26gt%3Bexec%28oid%2C+%3Cspan+class%3D%22hljs-string%22%3E%22rbd%22%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-string%22%3E%22set_id%22%3C%2Fspan%3E%2C+in%2C+out%29%0A++++++++++++++++++++++++%26gt%3Bio_ctx_impl-%26gt%3Bexec%28obj%2C+cls%2C+method%2C+inbl%2C+outbl%29%0A++++++++++++++++++++++++++++%26gt%3B%28%3A%3AObjectOperation%29rd.call%28cls%2C+method%2C+inbl%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%B0%86%E8%AF%A5%E6%93%8D%E4%BD%9C%E5%B0%81%E8%A3%85%E6%88%90OSDOp%EF%BC%8C%E6%94%BE%E5%85%A5ObjectOperation%E5%AF%B9%E8%B1%A1%E7%9A%84vector%E9%9B%86%E5%90%88%E4%B8%AD%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++%26gt%3Badd_call%28CEPH_OSD_OP_CALL%2C+cname%2C+method%2C+indata%2C+NULL%2C+NULL%2C+NULL%29%0A++++++++++++++++++++++++++++%26gt%3Boperate_read%28oid%2C+%26amp%3Brd%2C+%26amp%3Boutbl%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%8F%91%E8%B5%B7%E8%AF%BB%E8%AF%B7%E6%B1%82%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++%26gt%3BObjecter%3A%3AOp+*objecter_op+%3D+objecter-%26gt%3Bprepare_read_op%28oid%2C+oloc%2C*o%2C+snap_seq%2C+pbl%2C+flags%2Conack%2C+%26amp%3Bver%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%88%9B%E5%BB%BAOp%E7%9A%84%E5%AE%9E%E4%BE%8B+%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%98%E6%88%90Op%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++%26gt%3Bobjecter-%26gt%3Bop_submit%28objecter_op%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%8F%90%E4%BA%A4%E5%88%B0objecter%E5%B1%82+%E6%93%8D%E4%BD%9C%E5%AF%B9%E8%B1%A1%E4%B8%BAObjecter%3A%3AOp%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++++++%26gt%3B_op_submit_with_budget%28op%2C+lc%2C+ctx_budget%29%0A++++++++++++++++++++++++++++++++++++++++%26gt%3B%3Cspan+class%3D%22hljs-keyword%22%3Eint%3C%2Fspan%3E+op_budget+%3D+_take_op_budget%28op%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%87%8F%E5%8E%BB%E8%AF%A5Op%E7%9A%84%E9%A2%84%E7%AE%97for+throttle%3B%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++++++++++++++%26gt%3B%3Cspan+class%3D%22hljs-keyword%22%3Eint%3C%2Fspan%3E+op_budget+%3D+calc_op_budget%28op%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E9%A2%84%E7%AE%97%E5%80%BC%E6%98%AF%E8%AF%A5Op%E7%9A%84%E5%AD%97%E8%8A%82%E5%A4%A7%E5%B0%8F%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++++++++++++++%26gt%3B+_throttle_op%28op%2C+op_budget%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%BF%99%E9%87%8C%E6%98%AFObjecter%E7%9A%84Throttle%E5%B1%82%EF%BC%8C%E5%A6%82%E6%9E%9Ckeep_balanced_budget%3Dtrue%EF%BC%8C%E8%83%BD%E5%AE%9E%E7%8E%B0%E5%AF%B9%E9%80%9F%E5%BA%A6%E7%9A%84%E9%99%90%E5%88%B6%EF%BC%88op_throttle_bytes%26amp%3Bop_throttle_ops%EF%BC%89%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++++++++++%26gt%3B_op_submit%28op%2C+lc%29%0A++++++++++++++++++++++++++++++++++++++++++++%26gt%3B_calc_target%28%26amp%3Bop-%26gt%3Btarget%2C+%26amp%3Bop-%26gt%3Blast_force_resend%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%AE%A1%E7%AE%97%E8%AF%A5op%E7%9A%84%E6%93%8D%E4%BD%9C%E5%AF%B9%E8%B1%A1%EF%BC%88%E7%94%A8%E5%88%B0CRUSH%E7%AE%97%E6%B3%95%EF%BC%89%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++++++++++++++%26gt%3B_get_session%28op-%26gt%3Btarget.osd%2C+%26amp%3Bs%2C+lc%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E4%B8%BA%E8%AF%A5Op%E6%9E%84%E5%BB%BA%E4%B8%8Eosd%E5%AF%B9%E5%BA%94%E7%9A%84OSDSession%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++++++++++++++%26gt%3B_send_op_account%28op%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E7%99%BB%E8%AE%B0%E8%AF%A5%E6%AC%A1op%E6%93%8D%E4%BD%9C%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++++++++++++++%26gt%3B+m+%3D+_prepare_osd_op%28op%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E4%BD%BF%E7%94%A8Op%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%88%9D%E5%A7%8B%E5%8C%96MOSDOp%E7%9A%84%E5%AE%9E%E4%BE%8B%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++++++++++++++%26gt%3B_session_op_assign%28s%2C+op%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%B0%86Op%E4%B8%8EOSDSession%E7%9B%B8%E5%85%B3%E8%81%94%E3%80%82%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++++++++++++++%26gt%3B+_send_op%28op%2C+m%29%0A++++++++++++++++++++++++++++++++++++++++++++++++%26gt%3Bop-%26gt%3Bsession-%26gt%3Bcon-%26gt%3Bsend_message%28m%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%BF%9B%E5%85%A5Massenger%E5%B1%82%EF%BC%8C%E6%93%8D%E4%BD%9C%E5%AF%B9%E8%B1%A1MOSDOp%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++++++++++++++++++++++%26gt%3B%3Cspan+class%3D%22hljs-keyword%22%3Estatic_cast%3C%2Fspan%3E%26lt%3BSimpleMessenger*%26gt%3B%28msgr%29-%26gt%3Bsend_message%28m%2C+%3Cspan+class%3D%22hljs-keyword%22%3Ethis%3C%2Fspan%3E%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E4%BD%BF%E7%94%A8%E4%BD%BF%E7%94%A8massenger%E5%B1%82%E7%9A%84SimpleMessenger%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8F%91%E7%94%9F%E6%B6%88%E6%81%AF%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++++++++++++++++++++++++++%26gt%3B_send_message%28m%2C+con%29%0A++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++%26gt%3Bsubmit_message%28m%2C+%3Cspan+class%3D%22hljs-keyword%22%3Estatic_cast%3C%2Fspan%3E%26lt%3BPipeConnection*%26gt%3B%28con%29%2Ccon-%26gt%3Bget_peer_addr%28%29%2C+con-%26gt%3Bget_peer_type%28%29%2C+%3Cspan+class%3D%22hljs-keyword%22%3Efalse%3C%2Fspan%3E%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%8F%90%E4%BA%A4%E4%BF%A1%E6%81%AF%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++%26gt%3B%3Cspan+class%3D%22hljs-keyword%22%3Estatic_cast%3C%2Fspan%3E%26lt%3BPipeConnection*%26gt%3B%28con%29-%26gt%3Btry_get_pipe%28%26amp%3Bpipe%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%8E%B7%E5%8F%96%E8%AF%A5PipConnection%E5%AF%B9%E5%BA%94%E7%9A%84Pipe%E7%9A%84%E5%AE%9E%E4%BE%8B%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++%26gt%3Bpipe-%26gt%3B_send%28m%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E9%80%9A%E8%BF%87Pipe%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%EF%BC%8C%E5%8D%B3%EF%BC%9A%E6%8A%8A%E6%B6%88%E6%81%AF%E6%94%BE%E5%85%A5%E5%88%B0Pipe%3A%3Aout_q%E9%98%9F%E5%88%97%E4%B8%AD%EF%BC%8C%E5%B9%B6%E9%80%9A%E7%9F%A5Pipe%E4%B8%AD%E7%9A%84%E5%86%99%E7%BA%BF%E7%A8%8B%E6%9D%A5%E5%81%9A%E5%AE%9E%E9%99%85%E7%9A%84%E5%8F%91%E7%94%9F%E6%93%8D%E4%BD%9C%E3%80%82%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++%26gt%3Bout_q%5Bm-%26gt%3Bget_priority%28%29%5D.push_back%28m%29%3B%0A++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++%26gt%3Bdispatch_queue.local_delivery%28m%2C+m-%26gt%3Bget_priority%28%29%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%A6%82%E6%9E%9C%E5%8F%91%E9%80%81%E7%AB%AF%E4%B8%8E%E6%8E%A5%E6%94%B6%E7%AB%AF%E6%98%AF%E5%90%8C%E4%B8%80%E4%B8%AA%EF%BC%8C%E5%88%99%E7%9B%B4%E6%8E%A5%E5%B0%86%E6%B6%88%E6%81%AF%E6%8A%95%E9%80%92%E5%88%B0DispathcQueue%3A%3Alocal_messages%E4%B8%AD%E3%80%82%3C%2Fspan%3E%0A%0A%0A++++++++++++++++%26gt%3Bcls_client%3A%3Adir_add_image%28%26amp%3Bio_ctx%2C+RBD_DIRECTORY%2C+imgname%2C+id%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%B0%86%E6%96%B0%E5%BB%BA%E7%9A%84image%E6%B3%A8%E5%86%8C%E5%88%B0RBD_DIRECTORY%E4%B8%AD%3C%2Fspan%3E%0A++++++++++++++++++++%26gt%3Bioctx-%26gt%3Bexec%28oid%2C+%3Cspan+class%3D%22hljs-string%22%3E%22rbd%22%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-string%22%3E%22dir_add_image%22%3C%2Fspan%3E%2C+in%2C+out%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%81%9A%E7%94%A8%E4%BA%8E%E8%B7%A8%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%B7%A5%E4%BD%9C%3C%2Fspan%3E%0A++++++++++++++++++++++++%26gt%3Bio_ctx_impl-%26gt%3Bexec%28obj%2C+cls%2C+method%2C+inbl%2C+outbl%29+%0A++++++++++++++++++++++++++++%26gt%3Brd.call%28cls%2C+method%2C+inbl%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2Frd%E6%98%AF%28%3A%3AObjectOperation%29%E7%9A%84%E5%AE%9E%E4%BE%8B%3C%2Fspan%3E%0A++++++++++++++++++++++++++++%26gt%3Boperate_read%28oid%2C+%26amp%3Brd%2C+%26amp%3Boutbl%29%0A++++++++++++++++++++++++++++++++%26gt%3BObjecter%3A%3AOp+*objecter_op+%3D+objecter-%26gt%3Bprepare_read_op%28oid%2C+oloc%2C*o%2C+snap_seq%2C+pbl%2C+flags%2Conack%2C+%26amp%3Bver%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%9E%84%E5%BB%BAObjecter%3A%3AOp%E7%9A%84%E5%AE%9E%E4%BE%8B%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++%26gt%3Bobjecter-%26gt%3Bop_submit%28objecter_op%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%BF%9B%E5%85%A5Objecter%E5%B1%82%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++...%E5%90%8C%E4%B8%8A%0A++++++++++++++++%26gt%3Bheader_name%28id%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%9E%84%E5%BB%BAimage%E7%9A%84header%E6%A0%87%E8%AF%86%3C%2Fspan%3E%0A++++++++++++++++%26gt%3Bcls_client%3A%3Acreate_image%28%26amp%3Bio_ctx%2C+header_oid%2C+size%2C+order%2Cfeatures%2C+oss.str%28%29%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%88%9B%E5%BB%BAimage%E7%9A%84header%E5%AF%B9%E8%B1%A1%3C%2Fspan%3E%0A++++++++++++++++++++%26gt%3Bioctx-%26gt%3Bexec%28oid%2C+%3Cspan+class%3D%22hljs-string%22%3E%22rbd%22%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-string%22%3E%22create%22%3C%2Fspan%3E%2C+bl%2C+bl2%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%EF%BC%8C%E4%B8%BA%E8%B7%A8%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E5%81%9A%E5%BA%8F%E5%88%97%E5%8C%96%E5%B7%A5%E4%BD%9C%3C%2Fspan%3E%0A++++++++++++++++++++++++%26gt%3Bio_ctx_impl-%26gt%3Bexec%28obj%2C+cls%2C+method%2C+inbl%2C+outbl%29+%0A++++++++++++++++++++++++++++%26gt%3Brd.call%28cls%2C+method%2C+inbl%29%0A++++++++++++++++++++++++++++%26gt%3Boperate_read%28oid%2C+%26amp%3Brd%2C+%26amp%3Boutbl%29%0A++++++++++++++++++++++++++++++++%26gt%3BObjecter%3A%3AOp+*objecter_op+%3D+objecter-%26gt%3Bprepare_read_op%28oid%2C+oloc%2C*o%2C+snap_seq%2C+pbl%2C+flags%2Conack%2C+%26amp%3Bver%29%0A++++++++++++++++++++++++++++++++%26gt%3Bobjecter-%26gt%3Bop_submit%28objecter_op%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%BF%9B%E5%85%A5Objecter%E5%B1%82%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++...%E5%90%8C%E4%B8%8A%0A++++++++++++++++%26gt%3Bcls_client%3A%3Aset_stripe_unit_count%28%26amp%3Bio_ctx%2C+header_oid%2Cstripe_unit%2C+stripe_count%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%AE%BE%E7%BD%AEimage+stripe%E7%9A%84%E7%9B%B8%E5%85%B3%E5%B1%9E%E6%80%A7%EF%BC%8C%E4%B8%8Eheader%E5%AF%B9%E8%B1%A1%E5%85%B3%E8%81%94%3C%2Fspan%3E%0A++++++++++++++++++++%26gt%3Bioctx-%26gt%3Bexec%28oid%2C+%3Cspan+class%3D%22hljs-string%22%3E%22rbd%22%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-string%22%3E%22set_stripe_unit_count%22%3C%2Fspan%3E%2C+in%2C+out%29%0A++++++++++++++++++++++++%26gt%3Bio_ctx_impl-%26gt%3Bexec%28obj%2C+cls%2C+method%2C+inbl%2C+outbl%29+%0A++++++++++++++++++++++++++++%26gt%3Brd.call%28cls%2C+method%2C+inbl%29%0A++++++++++++++++++++++++++++%26gt%3Boperate_read%28oid%2C+%26amp%3Brd%2C+%26amp%3Boutbl%29%0A++++++++++++++++++++++++++++++++%26gt%3BObjecter%3A%3AOp+*objecter_op+%3D+objecter-%26gt%3Bprepare_read_op%28oid%2C+oloc%2C*o%2C+snap_seq%2C+pbl%2C+flags%2Conack%2C+%26amp%3Bver%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%9E%84%E5%BB%BAObjecter%3A%3AOp%E7%9A%84%E5%AE%9E%E4%BE%8B%3C%2Fspan%3E%0A++++++++++++++++++++++++++++++++%26gt%3Bobjecter-%26gt%3Bop_submit%28objecter_op%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E8%BF%9B%E5%85%A5Objecter%E5%B1%82%3C%2Fspan%3E%0A++++++++++++++++%26gt%3Bcls_client%3A%3Aobject_map_resize%28%26amp%3Bop%2C+Striper%3A%3Aget_num_objects%28layout%2C+size%29%2COBJECT_NONEXISTENT%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%9E%84%E5%BB%BAop%EF%BC%8C%E8%AF%A5op%E7%94%A8%E4%BA%8Eresize+object+map%3C%2Fspan%3E%0A++++++++++++++++++++%26gt%3Brados_op-%26gt%3Bexec%28%3Cspan+class%3D%22hljs-string%22%3E%22rbd%22%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-string%22%3E%22object_map_resize%22%3C%2Fspan%3E%2C+in%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2Frados_op%28librados%3A%3AObjectWriteOperation%29+%E5%81%9A%E5%BA%8F%E5%88%97%E5%8C%96%E5%B7%A5%E4%BD%9C%3C%2Fspan%3E%0A++++++++++++++++++++++++%26gt%3B%3A%3AObjectOperation+*o+%3D+%28%3A%3AObjectOperation+*%29impl%3B+%0A++++++++++++++++++++++++%26gt%3Bo-%26gt%3Bcall%28cls%2C+method%2C+inbl%29%3B%0A++++++++++++++++%26gt%3Bio_ctx.operate%28ObjectMap%3A%3Aobject_map_name%28id%2C+CEPH_NOSNAP%29%2C+%26amp%3Bop%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%89%A7%E8%A1%8Cop%3C%2Fspan%3E%0A++++++++++++++++++++%26gt%3Bio_ctx_impl-%26gt%3Boperate%28obj%2C+%28%3A%3AObjectOperation*%29o-%26gt%3Bimpl%2C+o-%26gt%3Bpmtime%29%0A++++++++++++++++++++++++%26gt%3BObjecter%3A%3AOp+*objecter_op+%3D+objecter-%26gt%3Bprepare_mutate_op%28oid%2C+oloc%2C*o%2C+snapc%2C+ut%2C+flags%2CNULL%2C+oncommit%2C+%26amp%3Bver%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E5%88%9B%E5%BB%BAObjecter%3A%3AOp%E7%9A%84%E5%AE%9E%E4%BE%8B%EF%BC%8C%E5%B0%86ObjectOperation%E8%BD%AC%E5%8C%96%E6%88%90Objecter%3A%3AOp%3C%2Fspan%3E%0A++++++++++++++++++++++++%26gt%3Bobjecter-%26gt%3Bop_submit%28objecter_op%29+%3Cspan+class%3D%22hljs-comment%22%3E%2F%2F%E6%8F%90%E4%BA%A4Objecter%3A%3AOp%EF%BC%8C%E8%BF%9B%E5%85%A5Objecter%E5%B1%82%3C%2Fspan%3E%0A%0A%0A%0A%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAImage%E7%9A%84%E6%AD%A5%E9%AA%A4%28%E6%96%B0image%E7%BB%84%E6%88%90%E6%A0%BC%E5%BC%8F%29%EF%BC%9A+%3Cbr%3E+1.%E5%88%9B%E5%BB%BAimage%E7%9A%84ID%E5%AF%B9%E8%B1%A1+rbd_id.%7Bimagename%7D+%3Cbr%3E+2.%E5%88%9B%E5%BB%BAimage%E7%9A%84id%28%E9%9A%8F%E6%9C%BA%E7%94%9F%E4%BA%A7%E7%9A%84%EF%BC%8C%E4%B8%8Eimage%E7%9A%84ID%E5%AF%B9%E8%B1%A1%E5%AE%8C%E5%85%A8%E4%B8%8D%E5%90%8C%29+%3Cbr%3E+3.%E5%B0%86%E8%AF%A5image%E6%B3%A8%E5%86%8C%E5%88%B0RBD_DIRECTORY%E4%B8%AD%28imagename+%2Cid%29+%3Cbr%3E+4.%E5%88%9B%E5%BB%BAimage%E7%9A%84header%E5%AF%B9%E8%B1%A1+%3Cbr%3E+6.%E5%B0%86image%E7%9A%84%E7%9B%B8%E5%85%B3%E5%85%83%E4%BF%A1%E6%81%AF%EF%BC%8C%E7%BB%91%E5%AE%9A%E5%88%B0header%E5%AF%B9%E8%B1%A1%E4%B8%8A%E3%80%82%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fmarkdown_views-ea0013b516.css%22%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn+btn-red-hollow%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Flitianze99%2Farticle%2Fdetails%2F53927639%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Flitianze99%2Farticle%2Fdetails%2F53927639%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}
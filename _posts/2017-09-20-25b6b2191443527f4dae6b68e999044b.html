---
layout: default
title: python ethereum 代码分析 《3》
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Cdiv+class%3D%22markdown_views%22%3E+%0A++%3Ch1+id%3D%22python-ethereum-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-3%22%3Epython+ethereum+%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90+%E3%80%8A3%E3%80%8B%3C%2Fh1%3E+%0A++%3Ch2+id%3D%22python-%E7%89%88%E6%9C%AC%E4%BB%A5%E5%A4%AA%E5%9D%8A%22%3Epython+%E7%89%88%E6%9C%AC%E4%BB%A5%E5%A4%AA%E5%9D%8A%3C%2Fh2%3E+%0A++%3Ch2+id%3D%22pyethereum%E9%83%A8%E5%88%86%22%3Epyethereum%E9%83%A8%E5%88%86%3C%2Fh2%3E+%0A++%3Cp%3E%E6%9C%AC%E6%96%87%E4%B8%BB%E8%A6%81%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%A4%AA%E5%9D%8AMerkle+Patricia+Trie%E4%BB%A5%E5%8F%8A%E5%8C%BA%E5%9D%97%E7%9A%84%E6%A0%A1%E9%AA%8C%E5%AD%98%E5%82%A8%3C%2Fp%3E+%0A++%3Ch3+id%3D%22%E4%B8%80%E4%BA%9B%E5%85%B3%E9%94%AE%E5%AD%97%E8%A7%A3%E9%87%8A%22%3E%E4%B8%80%E4%BA%9B%E5%85%B3%E9%94%AE%E5%AD%97%E8%A7%A3%E9%87%8A%3C%2Fh3%3E+%0A++%3Cp%3Esha3%EF%BC%9A+%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%89%80%E7%94%A8%E7%9A%84%E4%B8%80%E7%A7%8Dhash%E6%96%B9%E6%B3%95%3C%2Fp%3E+%0A++%3Cp%3Erlp+%EF%BC%9ARecursive+Length+Prefix%2C%E9%80%92%E5%BD%92%E9%95%BF%E5%BA%A6%E5%89%8D%E7%BC%80%E7%BC%96%E7%A0%81%EF%BC%8C%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%94%A8%E4%BA%8E%E7%BC%96%E7%A0%81%E6%95%B0%E6%8D%AE%E3%80%82%E7%94%A8%E4%BA%8E%E7%BC%96%E7%A0%81%E4%BB%BB%E6%84%8F%E7%9A%84%E5%B5%8C%E5%A5%97%E7%BB%93%E6%9E%84%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%EF%BC%88%E5%9C%A8python%E4%B8%AD%E5%B0%B1%E6%98%AF%E5%88%97%E8%A1%A8%EF%BC%8C%E5%85%B6%E5%AE%9Erlp%E5%9C%A8Merkle+Patricia+Trie%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%AD%E4%B8%BB%E8%A6%81%E5%B0%B1%E6%98%AF%E7%BC%96%E7%A0%81%E5%88%97%E8%A1%A8%E7%94%A8%E7%9A%84%EF%BC%89%EF%BC%8C%E5%AE%83%E6%98%AF%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%AD%E6%95%B0%E6%8D%AE%E5%BA%8F%E5%88%97%E5%8C%96%2F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E4%B8%BB%E8%A6%81%E6%96%B9%E6%B3%95%EF%BC%8C%E5%8C%BA%E5%9D%97%E3%80%81%E4%BA%A4%E6%98%93%E7%AD%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9C%A8%E6%8C%81%E4%B9%85%E5%8C%96%E6%97%B6%E4%BC%9A%E5%85%88%E7%BB%8F%E8%BF%87RLP%E7%BC%96%E7%A0%81%E5%90%8E%E5%86%8D%E5%AD%98%E5%82%A8%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E3%80%82%3C%2Fp%3E+%0A++%3Ch2+id%3D%22blockheader%22%3EBlockHeader%3C%2Fh2%3E+%0A++%3Cp%3E%E5%85%88%E7%9C%8B%E4%B8%80%E4%B8%8B%E4%BB%A5%E5%A4%AA%E5%9D%8Ablock%3Ca+href%3D%22https%3A%2F%2Fgithub.com%2Fethereum%2Fpyethereum%2Fblob%2Fefb08554ee95aa18b08d8f5d21d76097631d2c4a%2Fethereum%2Fblocks.py%23L169%22+rel%3D%22nofollow%22+target%3D%22_blank%22%3E%E5%8C%BA%E5%9D%97%E5%A4%B4%3C%2Fa%3E%E7%9A%84%E7%BB%93%E6%9E%84%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+python%22%3E%3Cspan+class%3D%22hljs-class%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Eclass%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-title%22%3EBlockHeader%3C%2Fspan%3E%3Cspan+class%3D%22hljs-params%22%3E%28rlp.Serializable%29%3C%2Fspan%3E%3A%3C%2Fspan%3E%0A%0A++++%3Cspan+class%3D%22hljs-string%22%3E%22%22%22A+block+header.+If+the+block+with+this+header+exists+as+an+instance+of+%3Aclass%3A%60Block%60%2C+the+connection+can+be+made+explicit+by+setting+%3Aattr%3A%60BlockHeader.block%60.+Then%2C+%3Aattr%3A%60BlockHeader.state_root%60%2C+%3Aattr%3A%60BlockHeader.tx_list_root%60+and+%3Aattr%3A%60BlockHeader.receipts_root%60+always+refer+to+the+up-to-date+value+in+the+block+instance.+%3Aivar+block%3A+an+instance+of+%3Aclass%3A%60Block%60+or+%60None%60+%3Aivar+prevhash%3A+the+32+byte+hash+of+the+previous+block+%3Aivar+uncles_hash%3A+the+32+byte+hash+of+the+RLP+encoded+list+of+uncle+headers+%3Aivar+coinbase%3A+the+20+byte+coinbase+address+%3Aivar+state_root%3A+the+root+of+the+block%27s+state+trie+%3Aivar+tx_list_root%3A+the+root+of+the+block%27s+transaction+trie+%3Aivar+receipts_root%3A+the+root+of+the+block%27s+receipts+trie+%3Aivar+bloom%3A+TODO+%3Aivar+difficulty%3A+the+block%27s+difficulty+%3Aivar+number%3A+the+number+of+ancestors+of+this+block+%280+for+the+genesis+block%29+%3Aivar+gas_limit%3A+the+block%27s+gas+limit+%3Aivar+gas_used%3A+the+total+amount+of+gas+used+by+all+transactions+in+this+block+%3Aivar+timestamp%3A+a+UNIX+timestamp+%3Aivar+extra_data%3A+up+to+1024+bytes+of+additional+data+%3Aivar+nonce%3A+a+32+byte+nonce+constituting+a+proof-of-work%2C+or+the+empty+string+as+a+placeholder+%22%22%22%3C%2Fspan%3E%0A%0A++++fields+%3D+%5B%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27prevhash%27%3C%2Fspan%3E%2C+hash32%29%2C%3Cspan+class%3D%22hljs-comment%22%3E%23%E7%88%B6%E5%8C%BA%E5%9D%97%E7%9A%84hash%3C%2Fspan%3E%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27uncles_hash%27%3C%2Fspan%3E%2C+hash32%29%2C%3Cspan+class%3D%22hljs-comment%22%3E%23%E7%9F%BF%E5%B7%A5%E5%BC%95%E7%94%A8%E7%9A%84uncle%E5%8C%BA%E5%9D%97%E5%88%97%E8%A1%A8%E7%9A%84hash%3C%2Fspan%3E%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27coinbase%27%3C%2Fspan%3E%2C+address%29%2C%3Cspan+class%3D%22hljs-comment%22%3E%23%E6%8C%96%E5%87%BA%E6%AD%A4%E5%8C%BA%E5%9D%97%E7%9F%BF%E5%B7%A5%E7%9A%84%E5%9C%B0%E5%9D%80%3C%2Fspan%3E%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27state_root%27%3C%2Fspan%3E%2C+trie_root%29%2C%3Cspan+class%3D%22hljs-comment%22%3E%23state+trie%E6%A0%91%E6%A0%91%E6%A0%B9%3C%2Fspan%3E%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27tx_list_root%27%3C%2Fspan%3E%2C+trie_root%29%2C%3Cspan+class%3D%22hljs-comment%22%3E%23%E4%BA%A4%E6%98%93trie%E6%A0%91%E6%A0%91%E6%A0%B9%3C%2Fspan%3E%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27receipts_root%27%3C%2Fspan%3E%2C+trie_root%29%2C%3Cspan+class%3D%22hljs-comment%22%3E%23%E6%94%B6%E6%8D%AEtrie%E6%A0%91%E6%A0%91%E6%A0%B9%3C%2Fspan%3E%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27bloom%27%3C%2Fspan%3E%2C+int256%29%2C%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27difficulty%27%3C%2Fspan%3E%2C+big_endian_int%29%2C%3Cspan+class%3D%22hljs-comment%22%3E%23%E5%BD%93%E5%89%8D%E5%8C%BA%E5%9D%97%E9%9A%BE%E5%BA%A6%3C%2Fspan%3E%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27number%27%3C%2Fspan%3E%2C+big_endian_int%29%2C%3Cspan+class%3D%22hljs-comment%22%3E%23%E5%8C%BA%E5%9D%97%E7%9A%84%E9%AB%98%E5%BA%A6%3C%2Fspan%3E%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27gas_limit%27%3C%2Fspan%3E%2C+big_endian_int%29%2C%3Cspan+class%3D%22hljs-comment%22%3E%23%E5%8C%BA%E5%9D%97gas%E4%B8%8A%E9%99%90%3C%2Fspan%3E%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27gas_used%27%3C%2Fspan%3E%2C+big_endian_int%29%2C%3Cspan+class%3D%22hljs-comment%22%3E%23%E5%8C%BA%E5%9D%97%E4%BD%BF%E7%94%A8%E7%9A%84gas%3C%2Fspan%3E%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27timestamp%27%3C%2Fspan%3E%2C+big_endian_int%29%2C%3Cspan+class%3D%22hljs-comment%22%3E%23%E6%97%B6%E9%97%B4%E6%88%B3%3C%2Fspan%3E%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27extra_data%27%3C%2Fspan%3E%2C+binary%29%2C%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27mixhash%27%3C%2Fspan%3E%2C+binary%29%2C%0A++++++++%28%3Cspan+class%3D%22hljs-string%22%3E%27nonce%27%3C%2Fspan%3E%2C+Binary%28%3Cspan+class%3D%22hljs-number%22%3E8%3C%2Fspan%3E%2C+allow_empty%3D%3Cspan+class%3D%22hljs-keyword%22%3ETrue%3C%2Fspan%3E%29%29%3Cspan+class%3D%22hljs-comment%22%3E%23%E5%B7%A5%E4%BD%9C%E9%87%8F%E8%AF%81%E6%98%8E%E9%9A%8F%E6%9C%BA%E6%95%B0%EF%BC%8C%E9%80%9A%E8%BF%87%E6%A0%A1%E9%AA%8C%E8%AF%A5%E5%80%BC%E6%9D%A5%E5%88%A4%E6%96%AD%E7%9F%BF%E5%B7%A5%E7%9A%84%E5%B7%A5%E4%BD%9C%E9%87%8F%E8%AF%81%E6%98%8E%E6%98%AF%E5%90%A6%E5%90%88%E6%B3%95%E3%80%82%3C%2Fspan%3E%0A++++%5D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Ch2+id%3D%22merkle-patricia-trie%22%3EMerkle+Patricia+Trie%3C%2Fh2%3E+%0A++%3Cp%3E%E9%A6%96%E5%85%88%E8%A6%81%E6%8F%90%E4%B8%80%E7%82%B9%EF%BC%8C%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%94%A8Merkle+Patricia+Trie+%E8%BF%99%E7%A7%8D%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%9D%A5%E5%81%9A%E5%8C%BA%E5%9D%97%E4%B8%AD%E4%BA%A4%E6%98%93%E7%9A%84%E5%BF%AB%E9%80%9F%E6%A0%A1%E9%AA%8C%E5%92%8C%E5%85%A8%E7%BD%91%E7%8A%B6%E6%80%81state%E7%9A%84%E5%BF%AB%E9%80%9F%E9%AA%8C%E8%AF%81%E3%80%82Merkle+Patricia+Trie%E6%98%AF%E4%B8%80%E7%A7%8D%E6%A0%91%EF%BC%8C%E5%8C%BA%E5%9D%97%E5%A4%B4%E4%B8%AD%E7%9A%84state_root%EF%BC%8Ctx_list_root%EF%BC%8Creceipts_root+%E5%88%86%E5%88%AB%E6%98%AFState+Trie+%EF%BC%8CTransactions+Trie%EF%BC%8CReceipts+Trie%E7%9A%84%E6%A0%91%E6%A0%B9%EF%BC%8C%E8%BF%99%E4%B8%89%E4%B8%AA%E6%A0%91%E9%83%BD%E6%98%AFMerkle+Patricia+Trie%E3%80%82%3C%2Fp%3E+%0A++%3Cp%3E%E6%99%AE%E9%80%9Atrie%E6%A0%91%E5%92%8Cmerkle%E6%A0%91%E7%9C%8B%3Ca+href%3D%22http%3A%2F%2Fblog.csdn.net%2Fqq_33935254%2Farticle%2Fdetails%2F55505472%22+rel%3D%22nofollow%22+target%3D%22_blank%22%3E%E8%BF%99%E7%AF%87%E5%8D%9A%E5%AE%A2%3C%2Fa%3E%3C%2Fp%3E+%0A++%3Cp%3E%E5%85%88%E8%AF%B4%E4%B8%8Btrie%E6%A0%91%E7%9A%84%E4%B8%80%E4%B8%AA%E6%89%A9%E5%B1%95Radix+Trie%E6%A0%91%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%A0%91%E4%B9%9F%E6%98%AF%E5%8F%AA%E5%AD%98key+%2F+value%E7%9A%84%E4%B8%80%E6%A3%B5%E6%A0%91+%3Cbr%3E+%E8%BF%99%E6%A3%B5%E6%A0%91%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9C%8B%E8%B5%B7%E6%9D%A5%E6%98%AF%E8%BF%99%E6%A0%B7%E7%9A%84%5Bi0%2C+i1+%E2%80%A6+in%2C+value%5D+%EF%BC%8C%E7%8E%B0%E5%9C%A8%E5%A6%82%E6%9E%9C%E6%88%91%E4%BB%AC%E7%9A%84key%E6%98%AF%E7%94%A816%E8%BF%9B%E5%88%B6%EF%BC%88hex%EF%BC%89%E7%BC%96%E7%A0%81%EF%BC%8C%E9%82%A3%E4%B9%88n%3D15%EF%BC%8C%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E5%88%97%E8%A1%A8%E9%95%BF%E5%BA%A6%E4%B8%BA17%EF%BC%8C%5Bi0%2Ci1%2C%E2%80%A6i15%2Cvalue%5D%EF%BC%8C%E5%88%97%E8%A1%A8%E4%B8%AD%E7%9A%840%7E15%E7%9A%84%E6%9F%90%E4%B8%80%E4%BD%8D%E5%B0%B1%E8%A1%A8%E7%A4%BAkey%E4%B8%AD%E7%9A%84%E4%B8%80%E4%B8%AA16%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E3%80%82+%3Cbr%3E+Radix+Trie%E6%A0%91%E6%9C%89%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%88%91%E8%A6%81%E5%AD%98%E5%82%A8%E4%B8%80%E4%B8%AA%E9%95%BF%E5%BA%A6%E4%B8%BA20%E7%9A%84hex%E7%BC%96%E7%A0%81%E7%9A%84key%EF%BC%8C%E9%82%A3%E4%B9%88%E8%BF%99%E4%B8%AA%E6%A0%91%E7%9A%84%E9%AB%98%E5%BA%A6%E5%B0%B1%E6%9C%8920%EF%BC%8C%E6%AF%8F%E4%B8%80%E5%B1%82%E5%B0%B1%E5%8F%AA%E5%AD%98%E4%BA%86key%E4%B8%AD%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6%EF%BC%8C%E8%BF%99%E6%A0%B7%E6%95%88%E7%8E%87%E5%B0%B1%E4%B8%8D%E9%AB%98%EF%BC%8C%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%B0%B1%E6%94%B9%E8%BF%9B%E4%BA%86%E4%B8%80%E4%B8%8B%EF%BC%8C%E5%A2%9E%E5%8A%A0%E4%BA%86%E4%B8%80%E4%BA%9B%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B%E6%9D%A5%E8%A7%A3%E5%86%B3%E8%BF%99%E4%B8%AA%E4%BA%8B%E6%83%85%E3%80%82+%3Cbr%3E+Merkle+Patricia+Trie%E6%A0%91%E4%B9%9F%E6%98%AF%E7%94%A8%E6%9D%A5%E5%AD%98key+%2F+value%E7%9A%84%E4%B8%80%E6%A3%B5%E6%A0%91+%3Cbr%3E+Merkle+Patricia+Trie%E7%9A%84%E5%9B%9B%E7%A7%8D%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B+%3Cbr%3E+1.NULL+%28represented+as+the+empty+string%29+%E7%A9%BA%E8%8A%82%E7%82%B9+%3Cbr%3E+2.branch+A+17-item+node+%5B+v0+%E2%80%A6+v15%2C+vt+%5D+%E5%88%86%E6%94%AF%E8%8A%82%E7%82%B9%EF%BC%8C0%7E15%E6%AF%8F%E4%B8%80%E4%BD%8D%E8%A1%A8%E7%A4%BA16%E8%BF%9B%E5%88%B6%E7%BC%96%E7%A0%81%E7%9A%84%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6+%3Cbr%3E+3.leaf+A+2-item+node+%5B+encodedPath%2C+value+%5D+%E8%BF%99%E4%B8%AAvalue%E6%98%AF%E5%8E%9F%E5%A7%8Bkey%E5%9C%A8%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9%E4%B8%8A%E5%AF%B9%E5%BA%94%E7%9A%84value%E5%80%BC+%3Cbr%3E+4.extension+A+2-item+node+%5B+encodedPath%2C+key+%5D+%E8%BF%99%E4%B8%AAkey%E6%98%AF%E5%AD%90%E8%8A%82%E7%82%B9%E7%9A%84hash%3C%2Fp%3E+%0A++%3Cp%3E%E5%AE%9E%E9%99%85%E5%9C%A8Merkle+Patricia+Trie%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%AD%EF%BC%8C%E8%BF%98%E7%94%A8%E4%BA%86HP%EF%BC%88hex+prefix%EF%BC%89%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F%E5%8E%BB%E7%BC%96%E7%A0%81%E7%9A%84key%EF%BC%8C%E5%85%B6%E5%AE%9E%E5%B0%B1%E6%98%AF%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E7%BC%96%E7%A0%81%E5%86%8D%E5%8A%A0%E5%89%8D%E7%BC%80%E6%9D%A5%E8%A1%A8%E7%A4%BA%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B%E3%80%82%E5%90%8C%E6%97%B6key%E6%98%AF%E4%BB%A5bytes%E5%AD%98%E5%82%A8%E7%9A%84%EF%BC%8C%E8%80%8C%E4%B8%80%E4%B8%AAhex+char%E5%8F%AA%E6%9C%894%E4%BD%8D%EF%BC%8C%E4%B8%80%E4%B8%AAbyte%E6%9C%89%E5%85%AB%E4%BD%8D%EF%BC%8C%E6%89%80%E4%BB%A5%E4%B8%8D%E5%A4%9F%E5%85%AB%E4%BD%8D%E7%9A%84%E6%97%B6%E5%80%99prefix+%E5%90%8E%E9%9D%A2%E5%86%8D%E5%8A%A00000%E8%A1%A5%E5%85%A8%E3%80%82+%3Cbr%3E+HP%E7%BC%96%E7%A0%81%E5%89%8D%E7%BC%80%E7%9A%84%E8%A7%84%E5%88%99%3C%2Fp%3E+%0A++%3Ctable%3E+%0A+++%3Cthead%3E+%0A++++%3Ctr%3E+%0A+++++%3Cth%3Ehex+char%3C%2Fth%3E+%0A+++++%3Cth+align%3D%22center%22%3Ebits%3C%2Fth%3E+%0A+++++%3Cth+align%3D%22right%22%3Enode+type+partial%3C%2Fth%3E+%0A+++++%3Cth%3Epath+length%3C%2Fth%3E+%0A++++%3C%2Ftr%3E+%0A+++%3C%2Fthead%3E+%0A+++%3Ctbody%3E%0A++++%3Ctr%3E+%0A+++++%3Ctd%3E0%3C%2Ftd%3E+%0A+++++%3Ctd+align%3D%22center%22%3E0000%3C%2Ftd%3E+%0A+++++%3Ctd+align%3D%22right%22%3Eextension%3C%2Ftd%3E+%0A+++++%3Ctd%3Eeven%3C%2Ftd%3E+%0A++++%3C%2Ftr%3E+%0A++++%3Ctr%3E+%0A+++++%3Ctd%3E1%3C%2Ftd%3E+%0A+++++%3Ctd+align%3D%22center%22%3E0001%3C%2Ftd%3E+%0A+++++%3Ctd+align%3D%22right%22%3Eextension%3C%2Ftd%3E+%0A+++++%3Ctd%3Eodd%3C%2Ftd%3E+%0A++++%3C%2Ftr%3E+%0A++++%3Ctr%3E+%0A+++++%3Ctd%3E2%3C%2Ftd%3E+%0A+++++%3Ctd+align%3D%22center%22%3E0010%3C%2Ftd%3E+%0A+++++%3Ctd+align%3D%22right%22%3Eterminating+%28leaf%29%3C%2Ftd%3E+%0A+++++%3Ctd%3Eeven%3C%2Ftd%3E+%0A++++%3C%2Ftr%3E+%0A++++%3Ctr%3E+%0A+++++%3Ctd%3E3%3C%2Ftd%3E+%0A+++++%3Ctd+align%3D%22center%22%3E0011%3C%2Ftd%3E+%0A+++++%3Ctd+align%3D%22right%22%3Eterminating+%28leaf%29%3C%2Ftd%3E+%0A+++++%3Ctd%3Eodd%3C%2Ftd%3E+%0A++++%3C%2Ftr%3E+%0A+++%3C%2Ftbody%3E%0A++%3C%2Ftable%3E+%0A++%3Cp%3E%E5%85%88%E7%9C%8B%E4%B8%80%E4%B8%AAMerkle+Patricia+Trie%E5%AD%98%E5%82%A8%E7%9A%84%E5%88%97%E5%AD%90+%3Cbr%3E+%E4%BB%A5%E4%B8%8B%E6%98%AF%E8%A6%81%E5%AD%98%E5%82%A8%E5%88%B0tire%E6%A0%91%E4%B8%AD%E7%9A%84%E5%9B%9B%E4%B8%AA%E9%94%AE%E5%80%BC%E5%AF%B9+%3Cbr%3E+%26lt%3B64+6f%26gt%3B+%3A+%E2%80%98verb%E2%80%99+%3Cbr%3E+%26lt%3B64+6f+67%26gt%3B+%3A+%E2%80%98puppy%E2%80%99+%3Cbr%3E+%26lt%3B64+6f+67+65%26gt%3B+%3A+%E2%80%98coin%E2%80%99+%3Cbr%3E+%26lt%3B68+6f+72+73+65%26gt%3B+%3A+%E2%80%98stallion%E2%80%99+%3Cbr%3E+%E6%B7%BB%E5%8A%A0%E4%B9%8B%E5%90%8E%EF%BC%8Ctrie%E6%A0%91%E7%BB%93%E6%9E%84%EF%BC%9A+%3Cbr%3E+rootHash%3A+%5B+%26lt%3B16%26gt%3B%2C+hashA+%5D+%2F%2F+extension+node+%3Cbr%3E+hashA%3A+%5B+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+hashB%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+hashC%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B+%5D+%2F%2F+branch+node+%3Cbr%3E+hashC%3A+%5B+%26lt%3B20+6f+72+73+65%26gt%3B%2C+%E2%80%98stallion%E2%80%99+%5D+%2F%2Fleaf+node+%3Cbr%3E+hashB%3A+%5B+%26lt%3B00+6f%26gt%3B%2C+hashD+%5D+%2F%2F+extension+node+%3Cbr%3E+hashD%3A+%5B+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+hashE%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+verb+%5D+%2F%2F+branch+node+%3Cbr%3E+hashE%3A+%5B+%26lt%3B17%26gt%3B%2C+hashF+%5D+%2F%2F+extension+node+%3Cbr%3E+hashF%3A+%5B+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+hashG%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+puppy+%5D+%2F%2F+branch+node+%3Cbr%3E+hashG%3A+%5B+%26lt%3B35%26gt%3B%2C+%E2%80%98coin%E2%80%99+%5D+%2F%2Fleaf+node%3C%2Fp%3E+%0A++%3Cp%3E%E6%B3%A8%E6%84%8F%E5%88%B0root+node+%E6%9C%89%E5%85%AC%E5%85%B1%E5%89%8D%E7%BC%80hex+char+6+%EF%BC%8C6%E5%89%8D%E9%9D%A2%E7%9A%841%E8%A1%A8%E7%A4%BA%E8%BF%99%E6%98%AF%E4%B8%AAextension+node%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%8E%9F%E6%9D%A5%E9%95%BF%E5%BA%A6%E6%98%AF%E5%A5%87%E6%95%B0%EF%BC%8C%E8%A1%A5%E4%BA%86%E4%B8%AA%E5%89%8D%E7%BC%801%E5%90%8E%E6%AD%A3%E5%A5%BD%E5%87%91%E6%88%90%E4%B8%80%E4%B8%AAbyte%E3%80%82+%3Cbr%3E+%E5%AD%98%E5%82%A8%E5%9C%A8root+node%E4%B8%8A%E7%9A%84key%EF%BC%8Cvalue+%E4%BE%BF%E6%98%AF+%26lt%3B16%26gt%3B%2C+hashA%EF%BC%8C%E8%80%8ChashA%E5%8F%88%E6%98%AF%E5%AD%90%E8%8A%82%E7%82%B9%E5%9C%A8leveldb%E4%B8%AD%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%9B+%3Cbr%3E+%E5%85%B6%E4%B8%AD%EF%BC%8ChashA+%3D+sha3%EF%BC%88rlp_encode%EF%BC%88%5B+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+hashB%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+hashC%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B%2C+%26lt%3B%26gt%3B+%5D%EF%BC%89%EF%BC%89+%3Cbr%3E+%E8%BF%99%E4%B8%AAhashA%E7%9A%84%E8%AE%A1%E7%AE%97%E6%96%B9%E5%BC%8F%E6%AD%A3%E6%98%AF%E4%BD%93%E7%8E%B0%E4%BA%86Merkle+Patricia+Trie%E7%9A%84%E2%80%98Merkle%E2%80%99%E9%83%A8%E5%88%86%EF%BC%8C%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84hash%E5%9C%B0%E5%9D%80%E6%AD%A3%E6%98%AF%E8%8A%82%E7%82%B9%E6%95%B0%E6%8D%AErlp%E7%BC%96%E7%A0%81%E8%BF%87%E5%90%8E%E7%9A%84hash%E3%80%82%E5%A6%82%E6%9E%9C%E6%9F%90%E4%B8%AA%E7%9F%BF%E5%B7%A5%E7%AF%A1%E6%94%B9%E4%BA%86%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%AF%94%E5%A6%82State+Trie%E6%9F%90%E4%B8%AA%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9%E4%B8%80%E4%B8%AA%E8%B4%A6%E6%88%B7%E7%9A%84%E4%BD%99%E9%A2%9D%EF%BC%8C%E5%B9%B6%E7%94%9F%E6%88%90%E4%BA%86State+Tire%E7%9A%84root+hash%EF%BC%8C%E5%85%B6%E4%BB%96%E7%9F%BF%E5%B7%A5%E9%80%9A%E8%BF%87transaction+list%E7%AE%97%E5%87%BA%E6%9D%A5%E7%9A%84State+Tire%E7%9A%84root+hash%E4%B8%80%E5%AE%9A%E8%B7%9F%E4%BB%96%E7%9A%84%E4%B8%8D%E4%B8%80%E8%87%B4%E3%80%82+%3Cbr%3E+hashA+%E6%8C%87%E5%90%91%E4%B8%80%E4%B8%AA%E5%88%86%E6%94%AF%E8%8A%82%E7%82%B9%EF%BC%8C%E5%88%86%E6%94%AF%E8%8A%82%E7%82%B9%E4%B8%AD%E7%9A%84%E7%AC%AC4%E4%BD%8D%E6%9C%89hashB%EF%BC%8C%E8%A1%A8%E7%A4%BA%E6%9C%89%E5%85%AC%E5%85%B1%E5%89%8D%E7%BC%80%E2%80%984%E2%80%99%EF%BC%9BhashB+%E7%9A%84%E5%85%AC%E5%85%B1%E5%89%8D%E7%BC%80%E6%98%AF%26lt%3B00+6f%26gt%3B%EF%BC%8C%E5%8F%8A%E5%85%AC%E5%85%B1%E5%89%8D%E7%BC%80%E4%B8%BA%E2%80%986f%E2%80%99%EF%BC%8C%E4%B8%80%E7%9B%B4%E5%88%B0hashD%EF%BC%8ChashD%E7%9A%84value%E4%B8%BA%E2%80%99verb%E2%80%99+%EF%BC%8C%E7%BB%8F%E8%BF%87%E7%9A%84%E6%95%B4%E4%B8%AA%E8%B7%AF%E5%BE%846-4-6f+%E5%8D%B3%E4%B8%BA%E5%8E%9F%E6%9D%A5%E7%9A%84key%E3%80%82+%3Cbr%3E+%E5%86%8D%E5%88%B0hashG%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9+%EF%BC%8C%E7%BB%8F%E8%BF%87%E7%9A%84%E6%95%B4%E4%B8%AA%E8%B7%AF%E5%8A%B26-4-6f-6-7-6-5+%E5%8D%B3%E4%B8%BAvalue+%E2%80%98coin%E2%80%99+%E7%9A%84key%3C%2Fp%3E+%0A++%3Cp%3E%E5%9C%A8State+Trie%E4%B8%AD%EF%BC%8C%E8%B7%AF%E5%BE%84path%EF%BC%88key%EF%BC%89%E9%83%BD%E6%98%AFsha3%28ethereumAddress%29+%E8%B4%A6%E6%88%B7%E5%9C%B0%E5%9D%80%E7%9A%84hash%EF%BC%8Cvalue+%E9%83%BD%E6%98%AF%E8%AF%A5%E8%B4%A6%E6%88%B7%E7%9A%84%E4%BF%A1%E6%81%AF%EF%BC%9A%5Bnonce%EF%BC%88%E5%BD%93%E5%89%8D%E4%BA%A4%E6%98%93%E6%AC%A1%E6%95%B0%EF%BC%89%2Cbalance%EF%BC%88%E8%B4%A6%E6%88%B7%E4%BD%99%E9%A2%9D%EF%BC%89%2CstorageRoot%2CcodeHash%5D%3C%2Fp%3E+%0A++%3Cp%3ETransactions+Trie%E5%92%8CReceipts+Trie+%E4%B8%8E+State+Trie%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%EF%BC%8C%E6%AF%8F%E4%B8%AA%E5%8C%BA%E5%9D%97%E9%83%BD%E6%9C%89%E7%8B%AC%E7%AB%8B%E7%9A%84Transactions+Trie%E5%92%8CReceipts+Trie+%EF%BC%8C%E8%80%8CState+Trie%E6%98%AF%E5%85%A8%E5%B1%80%E7%9A%84%E3%80%82+%3Cbr%3E+%E5%9C%A8Transactions+Trie%E4%B8%AD%EF%BC%8C%E8%B7%AF%E5%BE%84path%EF%BC%88key%EF%BC%89%E9%83%BD%E6%98%AFrlp%28transactionIndex%29%EF%BC%8CtransactionIndex%E6%98%AF%E4%BA%A4%E6%98%93%E7%9A%84%E7%BC%96%E5%8F%B7%EF%BC%8Cvalue%E9%83%BD%E6%98%AFrlp%28transactionData%29%3C%2Fp%3E+%0A++%3Cp%3EMerkle+Patricia+Trie%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99+%3Cbr%3E+%3Ca+href%3D%22https%3A%2F%2Fgithub.com%2Fethereum%2Fwiki%2Fwiki%2FPatricia-Tree%22+rel%3D%22nofollow%22+target%3D%22_blank%22%3Ehttps%3A%2F%2Fgithub.com%2Fethereum%2Fwiki%2Fwiki%2FPatricia-Tree%3C%2Fa%3E+%3Cbr%3E+%3Ca+href%3D%22https%3A%2F%2Feasythereentropy.wordpress.com%2F2014%2F06%2F04%2Funderstanding-the-ethereum-trie%2F%22+rel%3D%22nofollow%22+target%3D%22_blank%22%3Ehttps%3A%2F%2Feasythereentropy.wordpress.com%2F2014%2F06%2F04%2Funderstanding-the-ethereum-trie%2F%3C%2Fa%3E%3C%2Fp%3E+%0A++%3Ch2+id%3D%22%E5%8C%BA%E5%9D%97%E7%9A%84%E6%A0%A1%E9%AA%8C%E4%B8%8E%E5%AD%98%E5%82%A8%22%3E%E5%8C%BA%E5%9D%97%E7%9A%84%E6%A0%A1%E9%AA%8C%E4%B8%8E%E5%AD%98%E5%82%A8%3C%2Fh2%3E+%0A++%3Cp%3E%3Ca+href%3D%22https%3A%2F%2Fgithub.com%2Fethereum%2Fpyethapp%2Fblob%2Fe4ce60854785ffec4fd2b9490fd58a015287c7c0%2Fpyethapp%2Feth_service.py%23L228%22+rel%3D%22nofollow%22+target%3D%22_blank%22%3E%E4%BB%8E%E9%98%9F%E9%87%8C%E4%B8%AD%E5%8F%96%E5%87%BA%E4%B8%80%E4%B8%AAblock%E6%95%B0%E6%8D%AE%E5%B9%B6%E5%B0%9D%E8%AF%95%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%9C%AC%E5%9C%B0chain%3C%2Fa%3E+%3Cbr%3E+%3Ca+href%3D%22https%3A%2F%2Fgithub.com%2Fethereum%2Fpyethereum%2Fblob%2Fefb08554ee95aa18b08d8f5d21d76097631d2c4a%2Fethereum%2Fblocks.py%23L404%22+rel%3D%22nofollow%22+target%3D%22_blank%22%3E%E5%B0%9D%E8%AF%95%E5%AE%9E%E4%BE%8B%E5%8C%96block%E5%AF%B9%E8%B1%A1%3C%2Fa%3E%EF%BC%8C%E4%BC%A0%E5%85%A5%E7%9A%84%E5%8F%82%E6%95%B0%E6%9C%89header%E5%8C%BA%E5%9D%97%E5%A4%B4%2C+transaction_list%E4%BA%A4%E6%98%93%E5%88%97%E8%A1%A8%2C+uncles+%E5%8F%94%E5%8F%94%E5%8C%BA%E5%9D%97%E5%88%97%E8%A1%A8+%3Cbr%3E+%E5%8C%BA%E5%9D%97%E4%B8%80%E8%87%B4%E6%80%A7%E6%A0%A1%E9%AA%8C%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+lasso%22%3E++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eparent%3C%2Fspan%3E%3A%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+hasattr%28%3Cspan+class%3D%22hljs-keyword%22%3Eparent%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-string%22%3E%27db%27%3C%2Fspan%3E%29+%3Cspan+class%3D%22hljs-literal%22%3Eand%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-built_in%22%3Eself%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Edb+%3Cspan+class%3D%22hljs-subst%22%3E%21%3D%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eparent%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Edb+%3Cspan+class%3D%22hljs-literal%22%3Eand%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-built_in%22%3Eself%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Edb%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Edb+%3Cspan+class%3D%22hljs-subst%22%3E%21%3D%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eparent%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Edb%3A%0A++++++++++++++++raise+ValueError%28%3Cspan+class%3D%22hljs-string%22%3E%22Parent+lives+in+different+database%22%3C%2Fspan%3E%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-built_in%22%3Eself%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Eprevhash+%3Cspan+class%3D%22hljs-subst%22%3E%21%3D%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eparent%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3E%3Cspan+class%3D%22hljs-keyword%22%3Eheader%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Ehash%3A%0A++++++++++++++++raise+ValueError%28%3Cspan+class%3D%22hljs-string%22%3E%22Block%27s+prevhash+and+parent%27s+hash+do+not+match%22%3C%2Fspan%3E%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-built_in%22%3Eself%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Enumber+%3Cspan+class%3D%22hljs-subst%22%3E%21%3D%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eparent%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3E%3Cspan+class%3D%22hljs-keyword%22%3Eheader%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Enumber+%3Cspan+class%3D%22hljs-subst%22%3E%2B%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%3A%0A++++++++++++++++raise+ValueError%28%3Cspan+class%3D%22hljs-string%22%3E%22Block%27s+number+is+not+the+successor+of+its+parent+number%22%3C%2Fspan%3E%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-literal%22%3Enot%3C%2Fspan%3E+check_gaslimit%28%3Cspan+class%3D%22hljs-keyword%22%3Eparent%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-built_in%22%3Eself%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Egas_limit%29%3A%0A++++++++++++++++raise+ValueError%28%3Cspan+class%3D%22hljs-string%22%3E%22Block%27s+gaslimit+is+inconsistent+with+its+parent%27s+gaslimit%22%3C%2Fspan%3E%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-built_in%22%3Eself%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Edifficulty+%3Cspan+class%3D%22hljs-subst%22%3E%21%3D%3C%2Fspan%3E+calc_difficulty%28%3Cspan+class%3D%22hljs-keyword%22%3Eparent%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-built_in%22%3Eself%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Etimestamp%29%3A%0A++++++++++++++++raise+ValueError%28%3Cspan+class%3D%22hljs-string%22%3E%22Block%27s+difficulty+is+inconsistent+with+its+parent%27s+difficulty%22%3C%2Fspan%3E%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-built_in%22%3Eself%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Egas_used+%3Cspan+class%3D%22hljs-subst%22%3E%26gt%3B%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-built_in%22%3Eself%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Egas_limit%3A%0A++++++++++++++++raise+ValueError%28%3Cspan+class%3D%22hljs-string%22%3E%22Gas+used+exceeds+gas+limit%22%3C%2Fspan%3E%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-built_in%22%3Eself%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Etimestamp+%3Cspan+class%3D%22hljs-subst%22%3E%26lt%3B%3D%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eparent%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3E%3Cspan+class%3D%22hljs-keyword%22%3Eheader%3C%2Fspan%3E%3Cspan+class%3D%22hljs-built_in%22%3E.%3C%2Fspan%3Etimestamp%3A%0A++++++++++++++++raise+ValueError%28%3Cspan+class%3D%22hljs-string%22%3E%22Timestamp+equal+to+or+before+parent%22%3C%2Fspan%3E%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E4%BA%A4%E6%98%93%E5%8F%8A%E7%8A%B6%E6%80%81%E6%A0%A1%E9%AA%8C%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+ruby%22%3E++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%80%E4%B8%AA%E7%A9%BA%E7%9A%84transaction+trie%EF%BC%8C%E9%80%9A%E8%BF%87%E6%B7%BB%E5%8A%A0transaction+list%E4%B8%AD%E7%9A%84%E4%BA%A4%E6%98%93%E6%9D%A5%E9%87%8D%E6%96%B0%E6%9E%84%E5%BB%BAtransaction+trie%EF%BC%8C%E8%BF%99%E4%B8%AAtransaction+trie%E7%9A%84root+hash%E5%BF%85%E9%A1%BB%E8%B7%9F%E7%9F%BF%E5%B7%A5%E7%BB%99%E5%87%BA%E7%9A%84transaction+trie+root+hash+%E4%B8%80%E8%87%B4%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.transactions+%3D+%3Cspan+class%3D%22hljs-constant%22%3ETrie%3C%2Fspan%3E%28db%2C+trie.%3Cspan+class%3D%22hljs-constant%22%3EBLANK_ROOT%3C%2Fspan%3E%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.receipts+%3D+%3Cspan+class%3D%22hljs-constant%22%3ETrie%3C%2Fspan%3E%28db%2C+trie.%3Cspan+class%3D%22hljs-constant%22%3EBLANK_ROOT%3C%2Fspan%3E%29%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+replay+transactions+if+state+is+unknown%3C%2Fspan%3E%0A++++++++state_unknown+%3D+%28header.prevhash+%21%3D+%3Cspan+class%3D%22hljs-constant%22%3EGENESIS_PREVHASH%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eand%3C%2Fspan%3E%0A+++++++++++++++++++++++++header.number+%21%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eand%3C%2Fspan%3E%0A+++++++++++++++++++++++++header.state_root+%21%3D+trie.%3Cspan+class%3D%22hljs-constant%22%3EBLANK_ROOT%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eand%3C%2Fspan%3E%0A+++++++++++++++++++++++++%28len%28header.state_root%29+%21%3D+%3Cspan+class%3D%22hljs-number%22%3E32%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eor%3C%2Fspan%3E%0A++++++++++++++++++++++++++b%3Cspan+class%3D%22hljs-string%22%3E%27validated%3A%27%3C%2Fspan%3E+%2B+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.hash+%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ein%3C%2Fspan%3E+db%29+%3Cspan+class%3D%22hljs-keyword%22%3Eand%3C%2Fspan%3E%0A+++++++++++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+making%29%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E6%B7%BB%E5%8A%A0%E8%BF%87%E8%AF%A5%E5%8C%BA%E5%9D%97%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-symbol%22%3Estate_unknown%3A%3C%2Fspan%3E%0A++++++++++++assert+transaction_list+is+%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-constant%22%3ENone%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-symbol%22%3Eparent%3A%3C%2Fspan%3E%0A++++++++++++++++parent+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.get_parent_header%28%29%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23%E5%8F%96%E5%87%BA%E8%AF%A5%E5%8C%BA%E5%9D%97%E7%88%B6%E5%8C%BA%E5%9D%97%E7%9A%84state+trie%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.state+%3D+%3Cspan+class%3D%22hljs-constant%22%3ESecureTrie%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-constant%22%3ETrie%3C%2Fspan%3E%28db%2C+parent.state_root%29%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.transaction_count+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.gas_used+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+replay%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+tx+%3Cspan+class%3D%22hljs-keyword%22%3Ein%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-symbol%22%3Etransaction_list%3A%3C%2Fspan%3E%0A++++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23%E6%89%A7%E8%A1%8C%E6%AF%8F%E4%B8%80%E7%AC%94%E4%BA%A4%E6%98%93%EF%BC%8C%E5%90%8C%E6%97%B6%E6%9B%B4%E6%96%B0transaction+trie%E5%92%8Cstate+trie%3C%2Fspan%3E%0A++++++++++++++++success%2C+output+%3D+processblock.apply_transaction%28%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E%2C+tx%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.finalize%28%29%0A++++++++%3Cspan+class%3D%22hljs-symbol%22%3Eelse%3A%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+trust+the+state+root+in+the+header%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.state+%3D+%3Cspan+class%3D%22hljs-constant%22%3ESecureTrie%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-constant%22%3ETrie%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.db%2C+header._state_root%29%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.transaction_count+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-symbol%22%3Etransaction_list%3A%3C%2Fspan%3E%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+tx+%3Cspan+class%3D%22hljs-keyword%22%3Ein%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-symbol%22%3Etransaction_list%3A%3C%2Fspan%3E%0A++++++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.add_transaction_to_list%28tx%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.transactions.root_hash+%21%3D+header.%3Cspan+class%3D%22hljs-symbol%22%3Etx_list_root%3A%3C%2Fspan%3E%0A++++++++++++++++raise+%3Cspan+class%3D%22hljs-constant%22%3EValueError%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-string%22%3E%22Transaction+list+root+hash+does+not+match%22%3C%2Fspan%3E%29%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+receipts+trie+populated+by+add_transaction_to_list+is+incorrect%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+%28it+doesn%27t+know+intermediate+states%29%2C+so+reset+it%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.receipts+%3D+%3Cspan+class%3D%22hljs-constant%22%3ETrie%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.db%2C+header.receipts_root%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%3Ca+href%3D%22https%3A%2F%2Fgithub.com%2Fethereum%2Fpyethereum%2Fblob%2Fefb08554ee95aa18b08d8f5d21d76097631d2c4a%2Fethereum%2Fprocessblock.py%23L119%22+rel%3D%22nofollow%22+target%3D%22_blank%22%3Eprocessblock.apply_transaction%3C%2Fa%3E%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+vhdl%22%3Edef+apply_transaction%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E%2C+tx%29%3A%0A++++%23%E4%BA%A4%E6%98%93%E5%90%88%E6%B3%95%E6%80%A7%E6%A0%A1%E9%AA%8C%0A++++validate_transaction%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E%2C+tx%29%0A%0A++++log_tx.debug%28%3Cspan+class%3D%22hljs-attribute%22%3E%27TX%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3ENEW%3C%2Fspan%3E%27%2C+tx_dict%3Dtx.log_dict%28%29%29%0A++++%23+start+transacting+%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%23%0A++++%23sender%E4%BA%A4%E6%98%93%E6%95%B0nonce%E5%8A%A0%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.increment_nonce%28tx.sender%29%0A++++%23+print+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.get_nonce%28tx.sender%29%2C+%27%40%40%40%27%0A%0A++++%23+buy+startgas%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eassert%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.get_balance%28tx.sender%29+%26gt%3B%3D+tx.startgas+*+tx.gasprice%0A++++%23sender%E8%B4%A6%E6%88%B7%E6%89%A3%E9%99%A4startgas%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.delta_balance%28tx.sender%2C+-tx.startgas+*+tx.gasprice%29%0A++++message_gas+%3D+tx.startgas+-+intrinsic_gas_used%28tx%29%0A++++%23%E5%90%88%E7%BA%A6%E4%BB%A3%E7%A0%81%0A++++message_data+%3D+vm.CallData%28%5Bsafe_ord%28x%29+%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+x+%3Cspan+class%3D%22hljs-keyword%22%3Ein%3C%2Fspan%3E+tx.data%5D%2C+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%2C+len%28tx.data%29%29%0A++++%23%E4%BA%A4%E6%98%93%0A++++message+%3D+vm.Message%28tx.sender%2C+tx.%3Cspan+class%3D%22hljs-keyword%22%3Eto%3C%2Fspan%3E%2C+tx.value%2C+message_gas%2C+message_data%2C+code_address%3Dtx.%3Cspan+class%3D%22hljs-keyword%22%3Eto%3C%2Fspan%3E%29%0A%0A++++%23+MESSAGE%0A++++ext+%3D+VMExt%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E%2C+tx%29%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+tx.%3Cspan+class%3D%22hljs-keyword%22%3Eto%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eand%3C%2Fspan%3E+tx.%3Cspan+class%3D%22hljs-keyword%22%3Eto%3C%2Fspan%3E+%21%3D+CREATE_CONTRACT_ADDRESS%3A%0A++++++++result%2C+gas_remained%2C+data+%3D+apply_msg%28ext%2C+message%29%0A++++++++log_tx.debug%28%27_res_%27%2C+result%3Dresult%2C+gas_remained%3Dgas_remained%2C+data%3Ddata%29%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%3A++%23+CREATE%0A++++++++result%2C+gas_remained%2C+data+%3D+create_contract%28ext%2C+message%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eassert%3C%2Fspan%3E+utils.is_numeric%28gas_remained%29%0A++++++++log_tx.debug%28%27_create_%27%2C+result%3Dresult%2C+gas_remained%3Dgas_remained%2C+data%3Ddata%29%0A%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eassert%3C%2Fspan%3E+gas_remained+%26gt%3B%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%0A%0A++++log_tx.debug%28%3Cspan+class%3D%22hljs-string%22%3E%22TX+APPLIED%22%3C%2Fspan%3E%2C+result%3Dresult%2C+gas_remained%3Dgas_remained%2C%0A+++++++++++++++++data%3Ddata%29%0A%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+result%3A++%23+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E+%3D+OOG+failure+%3Cspan+class%3D%22hljs-keyword%22%3Ein%3C%2Fspan%3E+both+cases%0A++++++++log_tx.debug%28%3Cspan+class%3D%22hljs-attribute%22%3E%27TX%3C%2Fspan%3E+FAILED%27%2C+reason%3D%3Cspan+class%3D%22hljs-attribute%22%3E%27out%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eof%3C%2Fspan%3E+gas%27%2C%0A+++++++++++++++++++++startgas%3Dtx.startgas%2C+gas_remained%3Dgas_remained%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.gas_used+%2B%3D+tx.startgas%0A++++++++%23%E7%BB%99%E7%9F%BF%E5%B7%A5%E6%89%8B%E7%BB%AD%E8%B4%B9%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.delta_balance%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.coinbase%2C+tx.gasprice+*+tx.startgas%29%0A++++++++output+%3D+b%27%27%0A++++++++success+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%3A%0A++++++++log_tx.debug%28%3Cspan+class%3D%22hljs-attribute%22%3E%27TX%3C%2Fspan%3E+SUCCESS%27%2C+data%3Ddata%29%0A++++++++gas_used+%3D+tx.startgas+-+gas_remained%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.refunds+%2B%3D+len%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.suicides%29+*+opcodes.GSUICIDEREFUND%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.refunds+%26gt%3B+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3A%0A++++++++++++log_tx.debug%28%3Cspan+class%3D%22hljs-attribute%22%3E%27Refunding%3C%2Fspan%3E%27%2C+gas_refunded%3Dmin%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.refunds%2C+gas_used+%2F%2F+%3Cspan+class%3D%22hljs-number%22%3E2%3C%2Fspan%3E%29%29%0A++++++++++++gas_remained+%2B%3D+min%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.refunds%2C+gas_used+%2F%2F+%3Cspan+class%3D%22hljs-number%22%3E2%3C%2Fspan%3E%29%0A++++++++++++gas_used+-%3D+min%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.refunds%2C+gas_used+%2F%2F+%3Cspan+class%3D%22hljs-number%22%3E2%3C%2Fspan%3E%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.refunds+%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%0A++++++++%23+sell+remaining+gas%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.delta_balance%28tx.sender%2C+tx.gasprice+*+gas_remained%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.delta_balance%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.coinbase%2C+tx.gasprice+*+gas_used%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.gas_used+%2B%3D+gas_used%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+tx.%3Cspan+class%3D%22hljs-keyword%22%3Eto%3C%2Fspan%3E%3A%0A++++++++++++output+%3D+b%27%27.join%28%3Cspan+class%3D%22hljs-keyword%22%3Emap%3C%2Fspan%3E%28ascii_chr%2C+data%29%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%3A%0A++++++++++++output+%3D+data%0A++++++++success+%3D+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.commit_state%28%29%0A++++suicides+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.suicides%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.suicides+%3D+%5B%5D%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+s+%3Cspan+class%3D%22hljs-keyword%22%3Ein%3C%2Fspan%3E+suicides%3A%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.ether_delta+-%3D+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.get_balance%28s%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.del_account%28s%29%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.add_transaction_to_list%28tx%29%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.logs+%3D+%5B%5D%0A++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+success%2C+output%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3Eblock.commit_state%28%29+%3Cbr%3E+%E6%9B%B4%E6%96%B0state+trie%E8%B4%A6%E6%88%B7%E7%8A%B6%E6%80%81%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+python%22%3E++++%3Cspan+class%3D%22hljs-function%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Edef%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-title%22%3Ecommit_state%3C%2Fspan%3E%3Cspan+class%3D%22hljs-params%22%3E%28self%29%3C%2Fspan%3E%3A%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-string%22%3E%22%22%22Commit+account+caches%22%22%22%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-string%22%3E%22%22%22Write+the+acount+caches+on+the+corresponding+tries.%22%22%22%3C%2Fspan%3E%0A++++++++changes+%3D+%5B%5D%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+len%28self.journal%29+%3D%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3A%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+log_state.trace%28%27delta%27%2C+changes%3D%5B%5D%29%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E%0A++++++++addresses+%3D+sorted%28list%28self.caches%5B%3Cspan+class%3D%22hljs-string%22%3E%27all%27%3C%2Fspan%3E%5D.keys%28%29%29%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+addr+%3Cspan+class%3D%22hljs-keyword%22%3Ein%3C%2Fspan%3E+addresses%3A%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23%E8%8E%B7%E5%8F%96%E4%B8%80%E4%B8%AA%E8%B4%A6%E6%88%B7%3C%2Fspan%3E%0A++++++++++++acct+%3D+self._get_acct%28addr%29%0A%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+storage%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+field+%3Cspan+class%3D%22hljs-keyword%22%3Ein%3C%2Fspan%3E+%28%3Cspan+class%3D%22hljs-string%22%3E%27balance%27%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-string%22%3E%27nonce%27%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-string%22%3E%27code%27%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-string%22%3E%27storage%27%3C%2Fspan%3E%29%3A%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+addr+%3Cspan+class%3D%22hljs-keyword%22%3Ein%3C%2Fspan%3E+self.caches%5Bfield%5D%3A%0A++++++++++++++++++++v+%3D+self.caches%5Bfield%5D%5Baddr%5D%0A++++++++++++++++++++changes.append%28%5Bfield%2C+addr%2C+v%5D%29%0A++++++++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23%E5%AE%9E%E4%BE%8B%E5%8C%96account%E5%AF%B9%E8%B1%A1%3C%2Fspan%3E%0A++++++++++++++++++++setattr%28acct%2C+field%2C+v%29%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23%E6%9B%B4%E6%96%B0account%E7%9A%84storage+trie%3C%2Fspan%3E%0A++++++++++++t+%3D+SecureTrie%28Trie%28self.db%2C+acct.storage%29%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+k%2C+v+%3Cspan+class%3D%22hljs-keyword%22%3Ein%3C%2Fspan%3E+self.caches.get%28%3Cspan+class%3D%22hljs-string%22%3Eb%27storage%3A%27%3C%2Fspan%3E+%2B+addr%2C+%7B%7D%29.items%28%29%3A%0A++++++++++++++++enckey+%3D+utils.zpad%28utils.coerce_to_bytes%28k%29%2C+%3Cspan+class%3D%22hljs-number%22%3E32%3C%2Fspan%3E%29%0A++++++++++++++++val+%3D+rlp.encode%28v%29%0A++++++++++++++++changes.append%28%5B%3Cspan+class%3D%22hljs-string%22%3E%27storage%27%3C%2Fspan%3E%2C+addr%2C+k%2C+v%5D%29%0A++++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+if+self.number+%26gt%3B+18280+and+False%3A%3C%2Fspan%3E%0A++++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+try%3A%3C%2Fspan%3E%0A++++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+self.db.logging+%3D+True%3C%2Fspan%3E%0A++++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+except%3A%3C%2Fspan%3E%0A++++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+pass%3C%2Fspan%3E%0A++++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+sys.stderr.write%28%22pre%3A+%25r%5Cn%22+%25+self.account_to_dict%28addr%29%5B%27storage%27%5D%29%3C%2Fspan%3E%0A++++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+sys.stderr.write%28%22pre%3A+%25r%5Cn%22+%25+self.get_storage%28addr%29.root_hash.encode%28%27hex%27%29%29%3C%2Fspan%3E%0A++++++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+sys.stderr.write%28%22changed%3A+%25s+%25s+%25s%5Cn%22+%25+%28encode_hex%28addr%29%2C+encode_hex%28enckey%29%2C+encode_hex%28val%29%29%29%3C%2Fspan%3E%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+v%3A%0A++++++++++++++++++++t.update%28enckey%2C+val%29%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eelse%3C%2Fspan%3E%3A%0A++++++++++++++++++++t.delete%28enckey%29%0A++++++++++++acct.storage+%3D+t.root_hash%0A++++++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23%E6%9B%B4%E6%96%B0state+trie%E4%B8%AD%E8%AF%A5%E8%B4%A6%E6%88%B7%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%BB%8E%E6%96%B0%E7%94%9F%E6%88%90root+hash%3C%2Fspan%3E%0A++++++++++++self.state.update%28addr%2C+rlp.encode%28acct%29%29%0A++++++++log_state.trace%28%3Cspan+class%3D%22hljs-string%22%3E%27delta%27%3C%2Fspan%3E%2C+changes%3Dchanges%29%0A++++++++self.reset_cache%28%29%0A++++++++self.db.put_temporarily%28%3Cspan+class%3D%22hljs-string%22%3Eb%27validated%3A%27%3C%2Fspan%3E+%2B+self.hash%2C+%3Cspan+class%3D%22hljs-string%22%3E%271%27%3C%2Fspan%3E%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3Eblock.add_transaction_to_list%28tx%29+%3Cbr%3E+%E6%A0%B9%E6%8D%AEtransaction+list+%E9%87%8D%E6%96%B0%E6%9E%84%E5%BB%BAtransaction+trie%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+python%22%3E++++%3Cspan+class%3D%22hljs-function%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Edef%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-title%22%3Eadd_transaction_to_list%3C%2Fspan%3E%3Cspan+class%3D%22hljs-params%22%3E%28self%2C+tx%29%3C%2Fspan%3E%3A%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-string%22%3E%22%22%22Add+a+transaction+to+the+transaction+trie.+Note+that+this+does+not+execute+anything%2C+i.e.+the+state+is+not+updated.+%22%22%22%3C%2Fspan%3E%0A++++++++k+%3D+rlp.encode%28self.transaction_count%29%0A++++++++self.transactions.update%28k%2C+rlp.encode%28tx%29%29%0A++++++++r+%3D+self.mk_transaction_receipt%28tx%29%0A++++++++self.receipts.update%28k%2C+rlp.encode%28r%29%29%0A++++++++self.bloom+%7C%3D+r.bloom++%3Cspan+class%3D%22hljs-comment%22%3E%23+int%3C%2Fspan%3E%0A++++++++self.transaction_count+%2B%3D+%3Cspan+class%3D%22hljs-number%22%3E1%3C%2Fspan%3E%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E6%89%80%E6%9C%89%E4%BA%A4%E6%98%93%E9%83%BD%E6%B7%BB%E5%8A%A0%E5%AE%8C%E5%90%8E%EF%BC%8C%E6%B7%BB%E5%8A%A0%E7%9F%BF%E5%B7%A5%E5%A5%96%E5%8A%B1%EF%BC%8C%3Ca+href%3D%22https%3A%2F%2Fgithub.com%2Fethereum%2Fpyethereum%2Fblob%2Fefb08554ee95aa18b08d8f5d21d76097631d2c4a%2Fethereum%2Fblocks.py%23L483%22+rel%3D%22nofollow%22+target%3D%22_blank%22%3Eself.finalize%28%29%3C%2Fa%3E%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+python%22%3E++++%3Cspan+class%3D%22hljs-function%22%3E%3Cspan+class%3D%22hljs-keyword%22%3Edef%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-title%22%3Efinalize%3C%2Fspan%3E%3Cspan+class%3D%22hljs-params%22%3E%28self%29%3C%2Fspan%3E%3A%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-string%22%3E%22%22%22Apply+rewards+and+commit.%22%22%22%3C%2Fspan%3E%0A++++++++delta+%3D+int%28BLOCK_REWARD+%2B+NEPHEW_REWARD+*+len%28self.uncles%29%29%0A++++++++self.delta_balance%28self.coinbase%2C+delta%29%0A++++++++self.ether_delta+%2B%3D+delta%0A%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+uncle+%3Cspan+class%3D%22hljs-keyword%22%3Ein%3C%2Fspan%3E+self.uncles%3A%0A++++++++++++r+%3D+BLOCK_REWARD+*+%5C%0A++++++++++++++++%28UNCLE_DEPTH_PENALTY_FACTOR+%2B+uncle.number+-+self.number%29+%5C%0A++++++++++++++++%2F+UNCLE_DEPTH_PENALTY_FACTOR%0A++++++++++++r+%3D+int%28r%29%0A++++++++++++self.delta_balance%28uncle.coinbase%2C+r%29%0A++++++++++++self.ether_delta+%2B%3D+r%0A++++++++self.commit_state%28%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E6%89%80%E6%9C%89%E4%BA%A4%E6%98%93%E6%B7%BB%E5%8A%A0%E5%AE%8C%E5%90%8E%EF%BC%8C%E5%86%8D%E6%9D%A5%E6%A0%A1%E9%AA%8Cstate+root+%EF%BC%8Ctransaction+root+%E6%98%AF%E5%90%A6%E4%B8%8Eblock+header+%E4%B8%AD%E7%9A%84%E5%80%BC%E4%B8%80%E8%87%B4%EF%BC%8C%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84%E5%8C%96%EF%BC%8C%E5%8C%BA%E5%9D%97%E4%B8%8D%E5%90%88%E6%B3%95%E3%80%82%3Ca+href%3D%22https%3A%2F%2Fgithub.com%2Fethereum%2Fpyethereum%2Fblob%2Fefb08554ee95aa18b08d8f5d21d76097631d2c4a%2Fethereum%2Fblocks.py%23L514%22+rel%3D%22nofollow%22+target%3D%22_blank%22%3EBlock.%3Cstrong%3Einit%3C%2Fstrong%3E%3C%2Fa%3E%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+ruby%22%3E++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-symbol%22%3Eparent%3A%3C%2Fspan%3E%0A++++++++++++must_equal%28%3Cspan+class%3D%22hljs-string%22%3E%27prev_hash%27%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.prevhash%2C+parent.hash%29%0A++++++++must_equal%28%3Cspan+class%3D%22hljs-string%22%3E%27gas_used%27%3C%2Fspan%3E%2C+original_values%5B%3Cspan+class%3D%22hljs-string%22%3E%27gas_used%27%3C%2Fspan%3E%5D%2C+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.gas_used%29%0A++++++++must_equal%28%3Cspan+class%3D%22hljs-string%22%3E%27timestamp%27%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.timestamp%2C+original_values%5B%3Cspan+class%3D%22hljs-string%22%3E%27timestamp%27%3C%2Fspan%3E%5D%29%0A++++++++must_equal%28%3Cspan+class%3D%22hljs-string%22%3E%27difficulty%27%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.difficulty%2C+original_values%5B%3Cspan+class%3D%22hljs-string%22%3E%27difficulty%27%3C%2Fspan%3E%5D%29%0A++++++++must_equal%28%3Cspan+class%3D%22hljs-string%22%3E%27uncles_hash%27%3C%2Fspan%3E%2C+utils.sha3%28rlp.encode%28uncles%29%29%2C+original_values%5B%3Cspan+class%3D%22hljs-string%22%3E%27uncles_hash%27%3C%2Fspan%3E%5D%29%0A++++++++assert+header.block+is+%3Cspan+class%3D%22hljs-constant%22%3ENone%3C%2Fspan%3E%0A++++++++must_equal%28%3Cspan+class%3D%22hljs-string%22%3E%27state_root%27%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.state.root_hash%2C+header.state_root%29%0A++++++++must_equal%28%3Cspan+class%3D%22hljs-string%22%3E%27tx_list_root%27%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.transactions.root_hash%2C+header.tx_list_root%29%0A++++++++must_equal%28%3Cspan+class%3D%22hljs-string%22%3E%27receipts_root%27%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.receipts.root_hash%2C+header.receipts_root%29%0A++++++++must_equal%28%3Cspan+class%3D%22hljs-string%22%3E%27bloom%27%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.bloom%2C+original_values%5B%3Cspan+class%3D%22hljs-string%22%3E%27bloom%27%3C%2Fspan%3E%5D%29%0A%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+from+now+on%2C+trie+roots+refer+to+block+instead+of+header%3C%2Fspan%3E%0A++++++++header.block+%3D+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E%0A%0A++++++++%3Cspan+class%3D%22hljs-comment%22%3E%23+Basic+consistency+verifications%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.check_fields%28%29%3Cspan+class%3D%22hljs-symbol%22%3E%3A%3C%2Fspan%3E%0A++++++++++++raise+%3Cspan+class%3D%22hljs-constant%22%3EValueError%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-string%22%3E%22Block+is+invalid%22%3C%2Fspan%3E%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+len%28%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.header.extra_data%29+%26gt%3B+%3Cspan+class%3D%22hljs-constant%22%3EMAX_EXTRADATA_LENGTH%3C%2Fspan%3E%3Cspan+class%3D%22hljs-symbol%22%3E%3A%3C%2Fspan%3E%0A++++++++++++raise+%3Cspan+class%3D%22hljs-constant%22%3EValueError%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-string%22%3E%22Extra+data+cannot+exceed+%25d+bytes%22%3C%2Fspan%3E+%25+%3Cspan+class%3D%22hljs-constant%22%3EMAX_EXTRADATA_LENGTH%3C%2Fspan%3E%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.header.coinbase+%3D%3D+%3Cspan+class%3D%22hljs-string%22%3E%27%27%3C%2Fspan%3E%3Cspan+class%3D%22hljs-symbol%22%3E%3A%3C%2Fspan%3E%0A++++++++++++raise+%3Cspan+class%3D%22hljs-constant%22%3EValueError%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-string%22%3E%22Coinbase+cannot+be+empty+address%22%3C%2Fspan%3E%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.state.root_hash_valid%28%29%3Cspan+class%3D%22hljs-symbol%22%3E%3A%3C%2Fspan%3E%0A++++++++++++raise+%3Cspan+class%3D%22hljs-constant%22%3EValueError%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-string%22%3E%22State+Merkle+root+of+block+%25r+not+found+in+%22%3C%2Fspan%3E%0A+++++++++++++++++++++++++++++%3Cspan+class%3D%22hljs-string%22%3E%22database%22%3C%2Fspan%3E+%25+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%28%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.is_genesis%28%29+%3Cspan+class%3D%22hljs-keyword%22%3Eand%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.nonce+%3Cspan+class%3D%22hljs-keyword%22%3Eand%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.header.check_pow%28%29%29%3Cspan+class%3D%22hljs-symbol%22%3E%3A%3C%2Fspan%3E%0A++++++++++++raise+%3Cspan+class%3D%22hljs-constant%22%3EValueError%3C%2Fspan%3E%28%3Cspan+class%3D%22hljs-string%22%3E%22PoW+check+failed%22%3C%2Fspan%3E%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+b%3Cspan+class%3D%22hljs-string%22%3E%27validated%3A%27%3C%2Fspan%3E+%2B+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.hash+%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Ein%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.%3Cspan+class%3D%22hljs-symbol%22%3Edb%3A%3C%2Fspan%3E%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.number+%3D%3D+%3Cspan+class%3D%22hljs-number%22%3E0%3C%2Fspan%3E%3Cspan+class%3D%22hljs-symbol%22%3E%3A%3C%2Fspan%3E%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.db.put%28b%3Cspan+class%3D%22hljs-string%22%3E%27validated%3A%27%3C%2Fspan%3E+%2B+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.hash%2C+%3Cspan+class%3D%22hljs-string%22%3E%271%27%3C%2Fspan%3E%29%0A++++++++++++%3Cspan+class%3D%22hljs-symbol%22%3Eelse%3A%3C%2Fspan%3E%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.db.put_temporarily%28b%3Cspan+class%3D%22hljs-string%22%3E%27validated%3A%27%3C%2Fspan%3E+%2B+%3Cspan+class%3D%22hljs-keyword%22%3Eself%3C%2Fspan%3E.hash%2C+%3Cspan+class%3D%22hljs-string%22%3E%271%27%3C%2Fspan%3E%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%8C%BA%E5%9D%97%E6%A0%A1%E9%AA%8C%E5%AE%8C%E6%88%90%EF%BC%8C%E4%B9%8B%E5%90%8E%E4%BE%BF%E6%98%AF%E5%B0%86%E5%8C%BA%E5%9D%97%E5%8A%A0%E5%85%A5%E6%9C%AC%E5%9C%B0%E5%8C%BA%E5%9D%97%E9%93%BE%3C%2Fp%3E+%0A++%3Cp%3E%3Ca+href%3D%22https%3A%2F%2Fgithub.com%2Fethereum%2Fpyethapp%2Fblob%2Fe4ce60854785ffec4fd2b9490fd58a015287c7c0%2Fpyethapp%2Feth_service.py%23L279%22+rel%3D%22nofollow%22+target%3D%22_blank%22%3E%E7%8E%B0%E5%9C%A8%E5%86%8D%E5%9B%9E%E5%88%B0chain+service+%E6%9C%80%E5%BC%80%E5%A7%8B%E7%9A%84_add_block%E5%87%BD%E6%95%B0%E4%B8%AD%E6%9D%A5%3C%2Fa%3E+%3Cbr%3E+%E5%B0%86%E5%8C%BA%E5%9D%97%E5%8A%A0%E5%85%A5%E6%9C%AC%E5%9C%B0%E9%93%BE%3Ca+href%3D%22https%3A%2F%2Fgithub.com%2Fethereum%2Fpyethereum%2Fblob%2Fefb08554ee95aa18b08d8f5d21d76097631d2c4a%2Fethereum%2Fchain.py%23L274%22+rel%3D%22nofollow%22+target%3D%22_blank%22%3Eself.chain.add_block%3C%2Fa%3E%EF%BC%9A%3C%2Fp%3E+%0A++%3Cpre+class%3D%22prettyprint%22%3E%3Ccode+class%3D%22+hljs+vhdl%22%3E%0A++++def+add_block%28self%2C+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E%2C+forward_pending_transactions%3DTrue%29%3A%0A++++++++%3Cspan+class%3D%22hljs-string%22%3E%22returns+True+if+block+was+added+sucessfully%22%3C%2Fspan%3E%0A++++++++_log+%3D+log.bind%28block_hash%3D%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E%29%0A++++++++%23+make+sure+we+know+the+parent%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.has_parent%28%29+%3Cspan+class%3D%22hljs-keyword%22%3Eand%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.is_genesis%28%29%3A%0A++++++++++++_log.debug%28%3Cspan+class%3D%22hljs-attribute%22%3E%27missing%3C%2Fspan%3E+parent%27%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+False%0A++++++++%23%E5%86%8D%E6%AC%A1%E6%A3%80%E6%9F%A5%E7%9F%BF%E5%B7%A5%E5%BC%95%E7%94%A8%E7%9A%84uncle%E5%8C%BA%E5%9D%97%E6%98%AF%E5%90%A6%E5%90%88%E6%B3%95%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.validate_uncles%28%29%3A%0A++++++++++++_log.debug%28%3Cspan+class%3D%22hljs-attribute%22%3E%27invalid%3C%2Fspan%3E+uncles%27%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+False%0A%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+len%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.nonce%29+%3D%3D+%3Cspan+class%3D%22hljs-number%22%3E8%3C%2Fspan%3E%3A%0A++++++++++++_log.debug%28%3Cspan+class%3D%22hljs-attribute%22%3E%27nonce%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+set%27%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+False%0A++++++++%23%E5%86%8D%E6%AC%A1%E6%A3%80%E6%9F%A5%E5%B7%A5%E4%BD%9C%E9%87%8F%E8%AF%81%E6%98%8E%E6%98%AF%E5%90%A6%E5%90%88%E6%B3%95%0A++++++++elif+%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.header.check_pow%28nonce%3D%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.nonce%29+%3Cspan+class%3D%22hljs-keyword%22%3Eand%3C%2Fspan%3E%5C%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Enot%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.is_genesis%28%29%3A%0A++++++++++++_log.debug%28%3Cspan+class%3D%22hljs-attribute%22%3E%27invalid%3C%2Fspan%3E+nonce%27%29%0A++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+False%0A++++++++%23%E5%86%8D%E6%A3%80%E6%9F%A5%E4%B8%8B%E7%88%B6%E5%8C%BA%E5%9D%97%E6%98%AF%E5%90%A6%E6%98%AF%E5%8C%BA%E5%9D%97%E5%A4%B4%E4%B8%AD%E6%8C%87%E5%AE%9A%E7%9A%84%E7%88%B6%E5%8C%BA%E5%9D%97%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.has_parent%28%29%3A%0A++++++++++++try%3A%0A++++++++++++++++processblock.verify%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E%2C+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.get_parent%28%29%29%0A++++++++++++except+processblock.VerificationFailed+as+e%3A%0A++++++++++++++++_log.critical%28%3Cspan+class%3D%22hljs-attribute%22%3E%27VERIFICATION%3C%2Fspan%3E+FAILED%27%2C+error%3De%29%0A++++++++++++++++f+%3D+os.path.join%28utils.data_dir%2C+%3Cspan+class%3D%22hljs-attribute%22%3E%27badblock%3C%2Fspan%3E.log%27%29%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eopen%3C%2Fspan%3E%28f%2C+%3Cspan+class%3D%22hljs-literal%22%3E%27w%27%3C%2Fspan%3E%29.write%28to_string%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.hex_serialize%28%29%29%29%0A++++++++++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+False%0A%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.number+%26lt%3B+self.head.number%3A%0A++++++++++++_log.debug%28%3Cspan+class%3D%22hljs-string%22%3E%22older+than+head%22%3C%2Fspan%3E%2C+head_hash%3Dself.head%29%0A++++++++++++%23+Q%3A+Should+we+have+any+limitations+%3Cspan+class%3D%22hljs-keyword%22%3Eon%3C%2Fspan%3E+adding+blocks%3F%0A%0A++++++++self.index.add_block%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E%29%0A++++++++%23%E5%AD%98%E5%85%A5%E6%9C%AC%E5%9C%B0chain%0A++++++++self._store_block%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E%29%0A%0A++++++++%23+set+%3Cspan+class%3D%22hljs-keyword%22%3Eto%3C%2Fspan%3E+head+%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+this+makes+the+longest+chain+w%2F+most+work+%3Cspan+class%3D%22hljs-keyword%22%3Efor%3C%2Fspan%3E+that+number%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eif%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.chain_difficulty%28%29+%26gt%3B+self.head.chain_difficulty%28%29%3A%0A++++++++++++_log.debug%28%3Cspan+class%3D%22hljs-attribute%22%3E%27new%3C%2Fspan%3E+head%27%29%0A++++++++++++%23%E6%9B%B4%E6%96%B0head+candidate%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%85%B6%E5%AE%9E%E5%8F%AA%E9%92%88%E5%AF%B9%E7%9F%BF%E5%B7%A5%EF%BC%8C%E5%8F%AA%E8%A6%81%E4%B8%8D%E6%8C%96%E7%9F%BF%EF%BC%8C%E5%B0%B1%E4%B8%8D%E7%94%A8%E5%8E%BB%E7%AE%A1%E5%80%99%E9%80%89%E5%A4%B4%E5%8C%BA%E5%9D%97%E4%B9%9F%E4%B8%8D%E7%94%A8%E5%8E%BB%E6%89%93%E5%8C%85%E4%BA%A4%E6%98%93%0A++++++++++++self._update_head%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E%2C+forward_pending_transactions%29%0A++++++++elif+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.number+%26gt%3B+self.head.number%3A%0A++++++++++++_log.warn%28%3Cspan+class%3D%22hljs-attribute%22%3E%27has%3C%2Fspan%3E+higher+blk+number+than+head+but+lower+chain_difficulty%27%2C%0A++++++++++++++++++++++head_hash%3Dself.head%2C+block_difficulty%3D%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.chain_difficulty%28%29%2C%0A++++++++++++++++++++++head_difficulty%3Dself.head.chain_difficulty%28%29%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.transactions.clear_all%28%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.receipts.clear_all%28%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.state.db.commit_refcount_changes%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.number%29%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.state.db.cleanup%28%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E.number%29%0A++++++++self.commit%28%29++%23+batch+commits+%3Cspan+class%3D%22hljs-keyword%22%3Eall%3C%2Fspan%3E+changes+that+came+%3Cspan+class%3D%22hljs-keyword%22%3Ewith%3C%2Fspan%3E+the+%3Cspan+class%3D%22hljs-keyword%22%3Enew%3C%2Fspan%3E+%3Cspan+class%3D%22hljs-keyword%22%3Eblock%3C%2Fspan%3E%0A++++++++%3Cspan+class%3D%22hljs-keyword%22%3Ereturn%3C%2Fspan%3E+True%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E%E8%87%B3%E6%AD%A4%EF%BC%8C%E6%96%B0%E5%8C%BA%E5%9D%97%E6%88%90%E5%8A%9F%E5%86%99%E5%85%A5%E6%9C%AC%E5%9C%B0%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fmarkdown_views-ea0013b516.css%22%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn+btn-red-hollow%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fleon51639%2Farticle%2Fdetails%2F78043093%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fleon51639%2Farticle%2Fdetails%2F78043093%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}
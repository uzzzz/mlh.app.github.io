---
layout: default
title: 如何部署并调用ethereum智能合约
---

{{ "%3Cdiv+id%3D%22article_content%22+class%3D%22article_content+clearfix+csdn-tracking-statistics%22+data-pid%3D%22blog%22+data-mod%3D%22popu_307%22+data-dsm%3D%22post%22%3E+%0A+%3Clink+rel%3D%22stylesheet%22+href%3D%22https%3A%2F%2Fcsdnimg.cn%2Frelease%2Fphoenix%2Ftemplate%2Fcss%2Fck_htmledit_views-e2445db1a8.css%22%3E+%0A+%3Cdiv+class%3D%22htmledit_views%22%3E+%0A++%3Cp%3E0.%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%A4%B9%26nbsp%3B%E5%AE%89%E8%A3%85%26nbsp%3Bnpm+install+solc+web3+fc%3C%2Fp%3E+%0A++%3Cp%3E0.5%26nbsp%3B%E8%BF%90%E8%A1%8Ctestrpc%3C%2Fp%3E+%0A++%3Cp%3E1.%26nbsp%3B%E9%A6%96%E5%85%88%E8%A6%81%E6%9C%89%E4%B8%80%E4%B8%AA%E5%90%88%E7%BA%A6%E8%A6%81%E4%B8%8D%E8%BE%93%EF%BC%8C%E6%AF%94%E5%A6%82%E5%A6%82%E4%B8%8B%E5%90%88%E7%BA%A6%EF%BC%8C%E4%BF%9D%E5%AD%98%E4%B8%BA%E6%96%87%E4%BB%B6%3Cspan+style%3D%22color%3Argb%28191%2C97%2C106%29%3Bfont-family%3AMenlo%2C+Monaco%2C+%27Courier+New%27%2C+monospace%3Bfont-size%3A13.6px%3Bbackground-color%3Argb%28249%2C249%2C249%29%3B%22%3EToken.sol%3C%2Fspan%3E%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E%3C%2Fp%3E+%0A++%3Cpre%3E%3Ccode+class%3D%22language-javascript%22%3Epragma+solidity+%5E0.4.0%3B%0Acontract+Token+%7B%0Amapping+%28address+%3D%26gt%3B+uint%29+public+balances%3B%0A%0A++++function+Token%28%29+%7B%0A++++++++balances%5Bmsg.sender%5D+%3D+1000000%3B%0A++++%7D%0A%0A++++function+transfer%28address+_to%2C+uint+_amount%29+%7B%0A++++++++if+%28balances%5Bmsg.sender%5D+%26lt%3B+_amount%29+%7B%0A++++++++++++throw%3B%0A++++++++%7D%0A%0A++++++++balances%5Bmsg.sender%5D+-%3D+_amount%3B%0A++++++++balances%5B_to%5D+%2B%3D+_amount%3B%0A++++%7D%0A%7D%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E2.%26nbsp%3B%E7%94%A8js%E9%83%A8%E7%BD%B2%3C%2Fp%3E+%0A++%3Cp%3E%3C%2Fp%3E%0A++%3Cpre%3E%3Ccode+class%3D%22language-javascript%22%3Econst+fs+%3D+require%28%27fs%27%29%3B%0Aconst+solc+%3D+require%28%27solc%27%29%3B%0Aconst+Web3+%3D+require%28%27web3%27%29%3B%0Aconst+async+%3D+require%28%27async%27%29%3B%0Aconst+ethabi+%3D+require%28%27ethereumjs-abi%27%29%3B%0Aweb3+%3D+new+Web3%28new+Web3.providers.HttpProvider%28%27http%3A%2F%2Flocalhost%3A8545%27%29%29%3B%0Ainput+%3D+fs.readFileSync%28%27Token.sol%27%29%3B%0Aoutput+%3D+solc.compile%28input.toString%28%29%2C+1%29%3B%0Abytecode+%3D+output.contracts%5B%27%3AToken%27%5D.bytecode%3B%0Aabi+%3D+JSON.parse%28output.contracts%5B%27Token%27%5D.interface%29%3B%0A+function+deploy%28web3%2C+compiledContract%2C+args%2C+gas%2C+address%2C+sendImmediately%29+%7B%0A++abi+%3D+JSON.parse%28compiledContract.interface%29%3B%0A++bytecode+%3D+compiledContract.bytecode%3B%0A%0A++if+%28args.length+%26gt%3B+0%29+%7B%0A++++constructTypes+%3D+abi%0A++++++.filter%28x+%3D%26gt%3B+x.type+%3D%3D%3D+%27constructor%27%29%5B0%5D%0A++++++.inputs.map%28x+%3D%26gt%3B+x.type%29%3B%0A++++abiEncoded+%3D+ethabi.rawEncode%28constructTypes%2C+args%29%3B%0A++++console.log%28%60ABI+encoded+constructor+arguments%3A+%24%7BabiEncoded.toString%28%27hex%27%29%7D%60%29%3B%0A++%7D%0A%0A++contract+%3D+web3.eth.contract%28abi%29%3B%0A++data+%3D+%600x%24%7Bcontract.new.getData.apply%28null%2C+args.concat%28%7B+data%3A+bytecode+%7D%29%29%7D%60%3B%0A++if+%28gas+%26amp%3B%26amp%3B+address+%26amp%3B%26amp%3B+sendImmediately%29+%7B%0A++++web3.eth.sendTransaction%28%7B+from%3A+address%2C+gas%2C+data+%7D%2C+%28err%2C+txHash%29+%3D%26gt%3B+%7B%0A++++++if+%28err%29+%7B%0A++++++++console.log%28%27err1%3A%27%2C+err%29%3B%0A++++++%7D+else+%7B%0A++++++++let+contractAddress%3B%0A++++++++async.whilst%28%0A++++++++++%28%29+%3D%26gt%3B+%21contractAddress%2C%0A++++++++++%28callback%29+%3D%26gt%3B+%7B%0A++++++++++++web3.eth.getTransactionReceipt%28txHash%2C+%28errReceipt%2C+result%29+%3D%26gt%3B+%7B%0A++++++++++++++if+%28result+%26amp%3B%26amp%3B+result.contractAddress%29+contractAddress+%3D+result.contractAddress%3B%0A++++++++++++++setTimeout%28%28%29+%3D%26gt%3B+%7B%0A++++++++++++++++callback%28null%29%3B%0A++++++++++++++%7D%2C+10+*+1000%29%3B%0A++++++++++++%7D%29%3B%0A++++++++++%7D%2C%0A++++++++++%28errWhilst%29+%3D%26gt%3B+%7B%0A++++++++++++if+%28%21errWhilst%29+%7B%0A++++++++++++++console.log%28contractAddress%29%3B%0A++++++++++++%7D+else+%7B%0A++console.log%28%27err2%3A%27%2C+err%29%3B%0A++++++++++++++console.log%28err%29%3B%0A++++++++++++%7D%0A++++++++++%7D%2C%0A++++++++%29%3B%0A++++++%7D%0A++++%7D%29%3B%0A++%7D+else+%7B%0A++++console.log%28%27Contract+data%3A%27%2C+data%29%3B%0A++%7D%0A%7D%0A++solidityFile+%3D+%27.%2FToken.sol%27%0A++contractName+%3D+%27Token%27%3B%0A++solcVersion+%3D+%27v0.4.9%2Bcommit.364da425%27%3B%0A++address+%3D+web3.eth.coinbase%3B%0A++admin+%3D+address%3B%0A++feeAccount+%3D+address%3B%0A++accountLevelsAddr+%3D+0%3B%0A++feeMake+%3D+0%3B%0A++feeTake+%3D+3000000000000000%3B%0A++feeRebate+%3D+0%3B%0A++gas+%3D+2000000%3B%0A++args+%3D+%5Badmin%2C+feeAccount%2C+accountLevelsAddr%2C+feeMake%2C+feeTake%2C+feeRebate%5D%3B%0A++solc.loadRemoteVersion%28solcVersion%2C+%28err%2C+solcV%29+%3D%26gt%3B+%7B%0A++++console.log%28%27Solc+version%3A%27%2C+solcV.version%28%29%29%3B%2F%E7%AC%AC%E4%B8%80%E9%81%8D%E5%88%B0%E8%BF%99%E9%87%8C%E5%8F%AF%E8%83%BD%E5%A4%B1%E8%B4%A5%EF%BC%8C%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%B0%B1%E8%BF%87%E5%8E%BB%E4%BA%86%0A++++fs.readFile%28solidityFile%2C+%28errRead%2C+result%29+%3D%26gt%3B+%7B%0A++++++source+%3D+result.toString%28%29%3B%0A++++++output+%3D+solcV.compile%28source%2C+1%29%3B+%2F%2F+1+activates+the+optimiser%0A++++++if+%28output.errors%29+console.log%28output.errors%29%3B%0A++++++sendImmediately+%3D+true%3B%0A++++++deploy%28web3%2C+output.contracts%5B%60%3A%24%7BcontractName%7D%60%5D%2C+args%2C+gas%2C+address%2C+sendImmediately%29%3B%2F%2F%E8%BF%87%E4%B8%80%E4%BC%9A%E6%89%93%E5%8D%B0%E9%83%A8%E7%BD%B2%E7%9A%84%E5%90%88%E7%BA%A6%E5%9C%B0%E5%9D%80%0A++++%7D%29%3B%0A++%7D%29%3B%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3E3.%E9%80%9A%E8%BF%87abi%26nbsp%3B%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%3C%2Fp%3E+%0A++%3Cp%3E%E5%BE%97%E5%88%B0abi%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%9Ahttps%3A%2F%2Fchriseth.github.io%2Fbrowser-solidity%2F%23version%3Dsoljson-latest.js%3C%2Fp%3E+%0A++%3Cp%3E%E6%88%96%E8%80%85%26nbsp%3Bsolcjs+--abi%26nbsp%3B+--bin+.%2Ftoken.sol%26nbsp%3B+-o+.%3C%2Fp%3E+%0A++%3Cp%3E%3C%2Fp%3E+%0A++%3Cpre%3E%3Ccode+class%3D%22language-javascript%22%3Eabi+%3D+JSON.parse%28%27%5B%7B%22constant%22%3Atrue%2C%22inputs%22%3A%5B%7B%22name%22%3A%22%22%2C%22type%22%3A%22address%22%7D%5D%2C%22name%22%3A%22balances%22%2C%22outputs%22%3A%5B%7B%22name%22%3A%22%22%2C%22type%22%3A%22uint256%22%7D%5D%2C%22payable%22%3Afalse%2C%22stateMutability%22%3A%22view%22%2C%22type%22%3A%22function%22%7D%2C%7B%22constant%22%3Afalse%2C%22inputs%22%3A%5B%7B%22name%22%3A%22_to%22%2C%22type%22%3A%22address%22%7D%2C%7B%22name%22%3A%22_amount%22%2C%22type%22%3A%22uint256%22%7D%5D%2C%22name%22%3A%22transfer%22%2C%22outputs%22%3A%5B%5D%2C%22payable%22%3Afalse%2C%22stateMutability%22%3A%22nonpayable%22%2C%22type%22%3A%22function%22%7D%2C%7B%22inputs%22%3A%5B%5D%2C%22payable%22%3Afalse%2C%22stateMutability%22%3A%22nonpayable%22%2C%22type%22%3A%22constructor%22%7D%5D%27%29%0A%0A+++tokenContract+%3D+web3.eth.contract%28abi%29%0A%0A+++tokenContract+%3D+tokenContract.at%28%270x35877aa1a91a936c52571dad91213fca6b49789f%27%29%0A%0A+++tokenContract.balances%28web3.eth.coinbase%5B0%5D%29%0A%0A+++tokenContract.transfer%28web3.eth.accounts%5B1%5D%2C+222%2C+%7Bfrom%3A+web3.eth.accounts%5B0%5D%7D%29%3C%2Fcode%3E%3C%2Fpre%3E+%0A++%3Cp%3Efaq%3A%E5%87%BA%E9%94%99%E5%A4%84%E7%90%86%EF%BC%9A%3C%2Fp%3E+%0A++%3Cp%3E1.+gTypeError%3A+Cannot+read+property+%27interface%27+of+undefined%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+at+deploy+%28repl%3A2%3A43%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+at+fs.readFile+%28repl%3A10%3A7%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+at+FSReqWrap.readFileAfterClose+%5Bas+oncomplete%5D+%28fs.js%3A528%3A3%29%3Cbr%3E%3C%2Fp%3E+%0A++%3Cp%3E%3Cspan+style%3D%22color%3Argb%2881%2C81%2C81%29%3Bfont-family%3AMenlo%2C+Monaco%2C+%27Courier+New%27%2C+monospace%3Bfont-size%3A12.8px%3Bbackground-color%3Argb%28255%2C255%2C255%29%3B%22%3Edeploy%28web3%2C+output.contracts%5B%60%3A%24%7BcontractName%7D%60%5D%2C+args%2C+gas%2C+address%2C+sendImmediately%29%3B%E8%BF%99%E9%87%8C%E7%9A%84%E5%90%8D%E7%A7%B0%E6%9C%89%E9%97%AE%E9%A2%98%3C%2Fspan%3E%3Cbr%3E%3C%2Fp%3E+%0A++%3Cp%3E%3Cspan+style%3D%22color%3Argb%2881%2C81%2C81%29%3Bfont-family%3AMenlo%2C+Monaco%2C+%27Courier+New%27%2C+monospace%3Bfont-size%3A12.8px%3Bbackground-color%3Argb%28255%2C255%2C255%29%3B%22%3E2.tokenContract.transfer%28web3.eth.accounts%5B3%5D%2C+999%29%3B%3C%2Fspan%3E%3C%2Fp%3E+%0A++%3Cp%3E%3Cspan+style%3D%22color%3Argb%2881%2C81%2C81%29%3Bfont-family%3AMenlo%2C+Monaco%2C+%27Courier+New%27%2C+monospace%3Bfont-size%3A12.8px%3Bbackground-color%3Argb%28255%2C255%2C255%29%3B%22%3E%26nbsp%3B+%26nbsp%3B+Error%3A+invalid+address%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+at+inputAddressFormatter+%28%2Fhome%2Fsam%2Fethereum%2Fweb3.js%2Fexample%2Fnode_modules%2Fweb3%2Flib%2Fweb3%2Fformatters.js%3A271%3A11%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+at+inputTransactionFormatter+%28%2Fhome%2Fsam%2Fethereum%2Fweb3.js%2Fexample%2Fnode_modules%2Fweb3%2Flib%2Fweb3%2Fformatters.js%3A97%3A20%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+at+%2Fhome%2Fsam%2Fethereum%2Fweb3.js%2Fexample%2Fnode_modules%2Fweb3%2Flib%2Fweb3%2Fmethod.js%3A89%3A28%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+at+Array.map+%28%26lt%3Banonymous%26gt%3B%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+at+Method.formatInput+%28%2Fhome%2Fsam%2Fethereum%2Fweb3.js%2Fexample%2Fnode_modules%2Fweb3%2Flib%2Fweb3%2Fmethod.js%3A88%3A32%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+at+Method.toPayload+%28%2Fhome%2Fsam%2Fethereum%2Fweb3.js%2Fexample%2Fnode_modules%2Fweb3%2Flib%2Fweb3%2Fmethod.js%3A114%3A23%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+at+Eth.send+%5Bas+sendTransaction%5D+%28%2Fhome%2Fsam%2Fethereum%2Fweb3.js%2Fexample%2Fnode_modules%2Fweb3%2Flib%2Fweb3%2Fmethod.js%3A139%3A30%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+at+SolidityFunction.sendTransaction+%28%2Fhome%2Fsam%2Fethereum%2Fweb3.js%2Fexample%2Fnode_modules%2Fweb3%2Flib%2Fweb3%2Ffunction.js%3A133%3A26%29%3Cbr%3E+%26nbsp%3B+%26nbsp%3B+at+SolidityFunction.execute+%28%2Fhome%2Fsam%2Fethereum%2Fweb3.js%2Fexample%2Fnode_modules%2Fweb3%2Flib%2Fweb3%2Ffunction.js%3A219%3A37%29%3C%2Fspan%3E%3C%2Fp%3E+%0A++%3Cp%3E%3Cspan+style%3D%22color%3Argb%2881%2C81%2C81%29%3Bfont-family%3AMenlo%2C+Monaco%2C+%27Courier+New%27%2C+monospace%3Bfont-size%3A12.8px%3Bbackground-color%3Argb%28255%2C255%2C255%29%3B%22%3E%E8%A6%81%E6%8C%87%E5%AE%9A%E5%8F%82%E6%95%B0%3AtokenContract.transfer%28web3.eth.accounts%5B4%5D%2C+999%2C+%7Bfrom%3Aweb3.eth.accounts%5B3%5D%7D%29%3B%3C%2Fspan%3E%3C%2Fp%3E+%0A++%3Cp%3E%26nbsp%3B%26nbsp%3B%3C%2Fp%3E+%0A+%3C%2Fdiv%3E+%0A%3C%2Fdiv%3E+%0A%3Cdiv+class%3D%22hide-article-box+text-center%22%3E+%0A+%3Ca+class%3D%22btn+btn-red-hollow%22+id%3D%22btn-readmore%22+data-track-view%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fnortheastsqure%2Farticle%2Fdetails%2F79256730%2C%26quot%3B%7D%22+data-track-click%3D%22%7B%26quot%3Bmod%26quot%3B%3A%26quot%3Bpopu_376%26quot%3B%2C%26quot%3Bcon%26quot%3B%3A%26quot%3B%2Chttps%3A%2F%2Fblog.csdn.net%2Fnortheastsqure%2Farticle%2Fdetails%2F79256730%2C%26quot%3B%7D%22%3E%E9%98%85%E8%AF%BB%E6%9B%B4%E5%A4%9A%3C%2Fa%3E+%0A%3C%2Fdiv%3E" | url_decode}}